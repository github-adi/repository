define("room:widget/newroom/step1/mod-christmas-dialog/mod-christmas-dialog.js",function(e,o,t){function n(e,o){if(1===o.isRecord){var t,n=u.popup.createDialog({id:"mod-christmas-dialog",contentHTML:c(e,o.record)}).show(),r=u("#info-form")[0].elements,a=i(r,n);n.on("click",".submit",function(){a&&u.ajax({url:"/activity/Christmas/record",data:{realName:r.realName.value,address:r.address.value,phone:r.phone.value},type:"POST"}).done(function(e){e&&e.message&&"0"===e.message.errNum&&n.close()})}).on("keydown","input",function(){clearTimeout(t),t=setTimeout(function(){a=i(r,n)},300)})}else if(0===o.isRecord)var n=u.popup.createDialog({id:"mod-christmas-dialog",contentHTML:c(e,o.record)}).show()}function r(e){var o=!0;for(var t in e)if(e.hasOwnProperty(t)&&""===e[t]){o=!1;break}return o&&e}function i(e,o){var t=r({realName:u.trim(e.realName.value),address:u.trim(e.address.value),phone:u.trim(e.phone.value)});return t?u(".submit",o).addClass("info-btn"):u(".submit",o).removeClass("info-btn"),t}{var a,s,u=e("common:widget/ui/jquery/jquery.js"),c=e("common:widget/public/public-arttemplate/public-arttemplate.js");console.log.bind(console,"lwss")}c.helper("getType",function(e){return a[e]}),c.helper("getGift",function(e){return s[e].name}),u(document).on("popupForm",function(e,o,t){n(o,t)}),t.exports={init:function(e,o){a={self:e.text23,calendar:e.text24},s=o}}});
;define("room:widget/newroom/step1/mod-newroom-app/mod-newroom-app.js",function(o,n,e){e.exports={run:function(){}}});
;define("room:widget/newroom/step1/mod-newroom-uitab/mod-newroom-uitab.js",function(a,t,i){var e=a("common:widget/ui/jquery/jquery.js"),o=e(".mod-newroom-uitab"),r=o.find("[data-uitab]");i.exports={run:function(){var a=e(".uitab");a.each(function(){var a=e('<img class="img-preload" src = "'+e(this).data("imghover")+'">');e("document").append(a),a.remove()});new Image;o.on("click","[data-uitab]",function(){var a=e("[data-uitab]"),t=e(this).data("uitab"),i=e(this).data("imghover");a.removeClass("cur"),a.each(function(){var a=e(this).data("img");e(this).find(".img-icon").attr("src",a)});var o=a.filter('[data-uitab="'+t+'"]');o.addClass("cur").trigger("tab"),o.find(".img-icon").attr("src",i)})},setMessageNum:function(a,t){var i=r.filter('[data-uitab="'+a+'"]').find("span");return t=+t,0>=t?void i.hide():(t>99&&(t=99),void i.text(t).show())}}});
;define("room:widget/newroom/step1/mod-newroom-usermenu/js/handleClick.js",function(o,n,t){var e=o("common:widget/ui/jquery/jquery.js"),i=o("common:widget/public/mod-public-login/mod-public-login.js"),c=o("common:widget/public/public-tools/public-tools.js"),r=o("common:widget/public/public-dialog/public-dialog.js");t.exports={kickOutAction:function(o,n){var t="/liveroom/studio/anchorKickuser",e="GET",i={rid:getConf("roomId"),kid:o},c=function(o){-1===o.errNum?r.alert({iconShow:"upset",contentText:n.failtokick,confirmText:n.ok}):0===o.errNum&&r.alert({iconShow:"smile",contentText:n.suctokick,confirmText:n.ok})};this.send(t,e,i,c)},followAction:function(o,n){if(0===getConf("userId"))return void i.showDialog("mod-newroom-usermenu");var t="/anchor?f=addFollow",e="POST",c={anchorId:o},d=function(o){r.alert(o===!0?{iconShow:"smile",contentText:n.followsuc,confirmText:n.ok}:{iconShow:"upset",contentText:o.message.errMessage,confirmText:n.ok})};this.send(t,e,c,d)},delAdmin:function(o,n){var t=getConf("adminGroupId"),e="/liveroom/studio/delAdminstrator",i="GET",c={aid:o,roomid:getConf("roomId"),groupid:t},d=function(o){r.alert(-1===o.errNum?{iconShow:"upset",contentText:n.delAdminfail}:{iconShow:"smile",contentText:n.delAdminSuccess})};this.send(e,i,c,d)},setAdmin:function(o,n){var t=getConf("adminGroupId"),e="/liveroom/studio/setAdminstrator",i="GET",c={aid:o,roomid:getConf("roomId"),groupid:t},d=function(o){r.alert(-1===o.errNum?{iconShow:"upset",contentText:n.setAdminfail}:{iconShow:"smile",contentText:n.setAdminSuccess})};this.send(e,i,c,d)},setVip:function(o,n){var t=(getConf("adminGroupId"),"/mall?f=sendRight"),e="POST",i={userId:o};this.send(t,e,i,sucCallback)},send:function(o,n,t,i,r){var d=1e4,u=c.formatData(u);e.ajax({url:o,timeout:d,type:n,dataType:"json",data:t}).done(function(o){i&&"function"==typeof i&&i(o)}).fail(function(o){r&&"function"==typeof r&&r(o)}).always(function(){})}}});
;define("room:widget/newroom/step1/mod-newroom-usermenu/mod-newroom-usermenu.js",function(e,i,t){function n(e){var i={isDisabled:!1,isAdmin:!1,isMe:!1,isVipOpen:!1,isAdminList:!1,textMap:{},uid:0,userName:"",vip:""};return getConf("userId")===o(e).data("userid")?(i.isDisabled=!0,i.textMap=h,i):(i.isAdmin=d.identity.getIsAdmin(),i.isMe=d.identity.getIsCurAnchor(),i.isVipOpen=h.isVipOpen,i.isAdminList="adminList"===o(e).data("menutype")?!0:!1,i.userName=o(e).data("name"),i.uid=o(e).data("userid"),i.vip=o(e).data("vip")?o(e).data("vip"):"",i.textMap=h,i)}function s(e,i,t){var n={};return"left"===i?(n.top=e.clientY-40,n.left=o(t).offset().left-158-o(document).scrollLeft()):"rightBottom"===i&&(n.left=e.clientX,n.top=e.clientY),n}function a(e){var i=r("modNewroomUsermenu",e);return i}var o=e("common:widget/ui/jquery/jquery.js"),r=e("common:widget/public/public-arttemplate/public-arttemplate.js"),d=e("common:widget/public/mod-public-property/mod-public-property.js"),u=e("room:widget/newroom/step1/mod-newroom-usermenu/js/handleClick.js"),l=o(".mod-newroom-usermenu"),c=null,h={};t.exports={handler:{selectOne:[],publicChat:[],wisperChat:[],sendGift:[]},uid:null,init:function(e){h=e.textMap,this.bindEvent()},showPop:function(e,i,t,r){clearTimeout(c),this.hidePop(),this.uid=o(t).data("userid");var d=this,u=s(e,i,t),h=n(t),p=a(h);l.html(p).css(u),l.css("display","block"),r&&(c=setTimeout(function(){d.hidePop()},2e3))},hidePop:function(e){e?c=setTimeout(function(){l.hide()},200):l.hide()},resetPop:function(e){l.css("top",e.clientY-40)},on:function(e,i){this.handler[e]instanceof Array?this.handler[e].push(i):(this.handler[e]=[],this.handler[e].push(i))},bindEvent:function(){var e=this;l.on("mouseenter",function(){clearTimeout(c)}),l.on("mouseenter","li",function(){l.find("li").removeClass("active"),o(this).addClass("active"),clearTimeout(c)}).on("mouseleave",function(){e.hidePop()}),l.on("click","li",function(){var i=o(this).data("type"),t=o(this).parents("ul.userlist");switch(i){case"publicChat":if(0!==e.handler.publicChat.length)for(var n=0;n<e.handler.publicChat.length;n++)e.handler.publicChat[n](t);break;case"wisperChat":if(0!==e.handler.wisperChat.length)for(var s=0;s<e.handler.wisperChat.length;s++)e.handler.wisperChat[s](t);break;case"sendGift":if(0!==e.handler.sendGift.length)for(var a=0;a<e.handler.sendGift.length;a++)e.handler.sendGift[a](t);break;case"kickOutAction":u.kickOutAction(e.uid,h);break;case"followAction":u.followAction(e.uid,h);break;case"delAdmin":u.delAdmin(e.uid,h);break;case"setAdmin":u.setAdmin(e.uid,h);break;case"setVip":u.setVip(e.uid,h)}e.hidePop()})},trigger:function(e,i){for(var t in this.handler[e]){var n=this.handler[e][t];n(i)}}}});
;define("room:widget/newroom/step1/mod-newroom-backpack/mod-newroom-backpack.js",function(t,e,i){var s=t("common:widget/ui/jquery/jquery.js"),a=t("common:widget/public/public-socket/public-socket.unpack.js"),o=t("common:widget/public/mod-public-login/mod-public-login.js"),n=t("common:widget/public/public-tools/public-tools.js"),d=(t("common:widget/ui/jquery/widget/jquery.ui.tip/jquery.ui.tip.js"),t("room:widget/newroom/step1/mod-newroom-uitab/mod-newroom-uitab.js")),r=(t("common:widget/ui/jquery/widget/jquery.ui.scrollable/jquery.ui.scrollable.js"),t("room:widget/newroom/step1/mod-newroom-usermenu/mod-newroom-usermenu.js")),c=t("common:widget/public/public-dialog/public-dialog.js"),p=function(t){this.textMap=t,this.$con=s(".mod-newroom-backpack"),this.$mod=s(".newroom-backpack-icon",this.$con),this.$redPoint=s(".backpack-icon-redpoint",this.$mod),this.isInitMain=!1,this.MainCon={},this.isCreateNewTip=!1,this.isCreateExpiredTip=!1,this.newItemTipTpl="<div>"+this.textMap.newTipText+"</div>",this.expiredItemTipTpl="<div>"+this.textMap.expiredTipText+"</div>",this.init()};p.prototype={constructor:p,init:function(){var t=this;this.bindEvent(),this.handleMessage(),getConf("isLogined")&&s.getJSON("/hiapi/userpackage/msg").done(function(e){if(-1!==e.errNum&&0!==e.data.length){var i=e.data,s=i.length,a=parseInt(t.textMap.tipShowTime,10),o=s>1?!0:!1;(o||"new item"!==i[0].type)&&i.reverse();for(var n=!1,d=0;s>d;d++){var r=parseInt(i[d].num,10);if("new item"===i[d].type){if(0===r){o=!1;continue}n=!0,t.isCreateNewTip?t.changeNewTipNum(i[d].num):(t.createNewTip(i[d].num),t.isCreateNewTip=!0),t.$mod.trigger("newItem-tip-show"),setTimeout(function(){t.$mod.trigger("newItem-tip-hide")},a||3e3)}else{if(0===r)continue;n=!0;var c=o?a:0;t.isCreateExpiredTip?t.changeExpiredTipNum(i[d].num):(t.createExpiredTip(i[d].num),t.isCreateExpiredTip=!0),setTimeout(function(){t.$con.trigger("expired-tip-show")},c),setTimeout(function(){t.$con.trigger("expired-tip-hide")},c+a)}}n&&t.$redPoint.show()}}).fail(function(){})},createHoverTip:function(){var t="<div>"+this.textMap.myBag+"</div>";s("a",this.$mod).tip({backgroundColor:"#fff",borderColor:"#ccc",className:"backpack-hover-tip",showEvent:"hover-tip-show",hideEvent:"hover-tip-hide",content:s(t),dir:"top",customLocation:!0})},createNewTip:function(t){var e={};e.number=t;var i=s.replaceTpl(this.newItemTipTpl,e);this.$mod.tip({backgroundColor:"#fff",borderColor:"#ccc",className:"backpack-newItem-tip",showEvent:"newItem-tip-show",hideEvent:"newItem-tip-hide",content:s(i),dir:"top",customLocation:!0})},changeNewTipNum:function(t){s(".jq-content em",s(".backpack-newItem-tip")).text(t)},createExpiredTip:function(t){var e={};e.number=t;var i=s.replaceTpl(this.expiredItemTipTpl,e);this.$con.tip({backgroundColor:"#fff",borderColor:"#ccc",className:"backpack-expiredItem-tip",showEvent:"expired-tip-show",hideEvent:"expired-tip-hide",content:s(i),dir:"top",customLocation:!0})},changeExpiredTipNum:function(t){s(".jq-content em",s(".backpack-expiredItem-tip")).text(t)},bindEvent:function(){var t=this;this.$mod.on("click",function(){return getConf("isLogined")?(t.isInitMain||(t.MainCon=new u(t.textMap),t.isInitMain=!0),t.MainCon.isShowMain?(s(".triangle",t.$con).hide(),s(".newroom-backpack-con",t.$con).hide(),s(".backpack-icon",s(this)).removeClass("backpack-icon-click"),t.MainCon.isShowMain=!1):(s(".triangle",t.$con).show(),s(".newroom-backpack-con",t.$con).show(),s(".backpack-icon",s(this)).addClass("backpack-icon-click"),t.MainCon.isShowMain=!0),t.$redPoint.hide(),void UT.send({type:"click",modId:"backpackClick"})):void o.showDialog("backpack")}),s("a",this.$mod).on("mouseenter",function(){"none"===s(".triangle",t.$con).css("display")&&s(".backpack-hover-tip",t.$con).show()}).on("mouseleave",function(){s(".backpack-hover-tip",t.$con).hide()})},handleMessage:function(){var t=this;a.on("Package_DP",function(e){var i=e.body;i.userId===getConf("userId")&&(t.$redPoint.show(),t.isCreateNewTip?t.changeNewTipNum(i.num):(t.createNewTip(i.num),t.isCreateNewTip=!0),t.$mod.trigger("newItem-tip-show"),setTimeout(function(){t.$mod.trigger("newItem-tip-hide")},parseInt(t.textMap.tipShowTime,10)))})}};var l=function(t){this.title=t,this.tabId=t.categoryId,this.userList=[],this.$tabTitle=s('<li class="backpack-tab-title" data-shouldres="1" data-send="0" data-titleId="'+this.title.categoryId+'" data-sendType="'+this.title.sendType+'">'+this.title.categoryName+"</li>"),this.$tabCon=s('<ul class="backpack-gifts-list cf" data-tabId="'+this.title.categoryId+'"></ul>'),this.$tabConDiv=s('<div class="div-gifts-list"></div>').append(this.$tabCon),this.selectItemId=0,this.shouldRequest=!0,this.init()};l.prototype={constructor:l,$mainCon:s(".newroom-backpack-con"),init:function(){s(".backpack-tab-titles",this.$mainCon).append(this.$tabTitle),s(".backpack-tab-con",this.$mainCon).append(this.$tabConDiv),this.bindEvent(),this.$tabCon.scrollable({autoHide:!1})},bindEvent:function(){var t=this,e=s("#backpackPreviewImage",t.$mainCon),i=s(".backpack-tab-con",t.$mainCon);this.$tabCon.on("mouseenter","li",function(a){a.stopPropagation();var o=s(this),n=i.offset(),d=a.pageX-n.left,r=a.pageY-n.top;if(s(".backpack-divimg img",e).attr("src",o.data("bigimg")),s(".item-name",e).text(o.data("itemname")),s(".total-number",e).text(o.data("itemnum")),s(".item-explanation",e).text(o.data("itemexplan")),o.data("expirednum")){s(".expired-number",e).text(o.data("expirednum"));var c=o.data("expiredtime").split(" "),p=c[0].split("-");s(".expired-date",e).text(p[2]+"-"+p[1]+" "+c[1]),s(".item-expired",e).show(),s(".item-expired-new",e).hide()}else{var c=o.data("expiredtime").split(" "),p=c[0].split("-");s(".expired-date-new",e).text(p[2]+"-"+p[1]+" "+c[1]),s(".item-expired-new",e).show(),s(".item-expired",e).hide()}t.selectItemId!==o.data("itemid")?e.removeClass("pb-select"):e.addClass("pb-select"),e.css({left:d+50,top:r+40}).show()}).on("mousemove","li",function(t){t.stopPropagation();var s=i.offset(),a=t.pageX-s.left,o=t.pageY-s.top;e.css({left:a+50,top:o+40})}).on("mouseleave","li",function(t){t.stopPropagation(),s(".item-expired",e).hide(),e.hide()}).on("click","li",function(i){var a=s(this),o=a.data("itemid");t.selectItemId!==o?(s("li[data-itemid="+t.selectItemId+"]",t.$tabCon).removeClass("list-focus"),t.selectItemId=o,e.addClass("pb-select"),s("li[data-itemid="+o+"]",t.$tabCon).addClass("list-focus")):(t.selectItemId=0,e.removeClass("pb-select"),s("li[data-itemid="+o+"]",t.$tabCon).removeClass("list-focus")),i.stopPropagation()}),a.on("Package_DP",function(){t.$tabTitle.data("shouldres","1")})},getTilById:function(t){return parseInt(this.tabId,10)===parseInt(t,10)?this.$tabTitle:void 0}};var m=function(t){this.textMap=t,this.$mod=s(".newroom-backpack-send"),this.$sendLeftNum=s(".send-left-number",this.$mod),this.$giftsCon=s("#gifts-con"),this.$backTabTitles=s(".backpack-tab-titles"),this.$selectTab=s(".tab-title-select"),this.$sendBt=s("#sendBggiftAction",this.$mod),this.$selectUser=s(".bp-current-contact",this.$mod),this.$sendNum=s("#bp-goodNum",this.$mod),this.$bpGiftList=s(".bp-giftslist",this.$mod),this.$ulList=s(".contact-list-add ul",this.$mod),this.propsTipId=0,this.selectProps=!1,this.selectUser=!1,this.isCreateNumShortTip=!1,this.iscreateSendSelfTip=!1,this.isCreatePropsTip=!1,this.userLists=[],this.myselfList=[],this.userLiTpl='<li class="toe" data-userid="#{userId}" data-name="#{name}" data-vip="#{vip}">#{nameText}</li>',this.init()};m.prototype={constructor:m,init:function(){var t={userId:getConf("userId"),name:n.escapeToHtml(getConf("userName")),nameText:this.textMap.yourself,vip:getConf("vip")},e={userId:getConf("anchorId"),name:n.escapeToHtml(getConf("anchorName")),nameText:n.escapeToHtml(getConf("anchorName"))};this.addToUserlist(t,0),this.addToUserlist(e,0),this.bindEvent(),this.bindMessage()},addToUserlist:function(t,e){if(-1!==this.userLists.join("").indexOf('data-userid="'+t.userId+'"')||-1!==this.myselfList.join("").indexOf('data-userid="'+t.userId+'"'))return void this.$ulList.html(this.userLists.join("")+this.myselfList.join(""));var i=s.replaceTpl(this.userLiTpl,t);if(1===parseInt(e,10)){var a=this.userLists.length;4>a?this.userLists.unshift(i):(this.userLists.pop(),this.userLists.unshift(i))}else this.myselfList.unshift(i);this.$ulList.html(this.userLists.join("")+this.myselfList.join(""))},removeFromUserList:function(t){s('li[data-userid="'+t+'"]:contains("'+this.textMap.yourself+'")',this.$ulList).remove()},bindMessage:function(){var t=this;r.on("sendGift",function(e){var i=t.$backTabTitles.find("li.tab-title-select").data("titleid");+i!==+t.textMap.tabIdCurr&&(t.addToUserlist({userId:e.data("userid"),name:n.escapeToHtml(e.data("name")),nameText:n.escapeToHtml(e.data("name")),vip:e.data("vip")},1),1===parseInt(s(".tab-title-select",t.$backTabTitles).data("sendtype"),10)&&getConf("userId")!==getConf("anchorId")&&t.removeFromUserList(getConf("userId")),t.$selectUser.html(n.escapeToHtml(e.data("name"))).data({name:n.escapeToHtml(e.data("name")),userid:e.data("userid")}))})},bindEvent:function(){var t=this;t.$mod.on("firstClick",function(){s(".firstClickTip",t.$mod).show(),s.cookie("hiclub-backpack-first","1")}).on("tabChange",function(){s(".bp-giftshow",t.$mod).hide(),s(".contact-list-add",t.$mod).hide(),s(".bp-select em",t.$mod).removeClass("bp-contact-down").addClass("bp-contact-up"),t.selectUser=!1,s(".bp-btn-up em",t.$mod).removeClass("bp-gift-down").addClass("bp-gift-up"),t.selectProps=!1}).on("click",".firstClickTip .tipClose",function(e){e.preventDefault(),s(".firstClickTip",t.$mod).hide(),e.stopPropagation()}).on("click",".bp-btn-up",function(e){e.stopPropagation();var i=parseInt(s(".tab-title-select",t.$backTabTitles).data("sendtype"),10);2===i?(t.isCreatePropsTip||(t.createPropsTip(t.textMap.propsTip),t.isCreatePropsTip=!0),t.$sendLeftNum.trigger("sendProps-tip-show"),setTimeout(function(){t.$sendLeftNum.trigger("sendProps-tip-hide")},3e3|t.textMap.tipShowTime)):(t.selectUser&&(s(".contact-list-add",t.$mod).hide(),s(".bp-select em",t.$mod).removeClass("bp-contact-down").addClass("bp-contact-up"),t.selectUser=!1),t.selectProps?(s(".bp-giftshow",t.$mod).hide(),s("em",s(this)).removeClass("bp-gift-down").addClass("bp-gift-up"),t.selectProps=!1):(s(".bp-giftshow",t.$mod).show(),s("em",s(this)).removeClass("bp-gift-up").addClass("bp-gift-down"),t.selectProps=!0))}).on("hover",".bp-giftslist li",function(){s(".bp-comdity img",t.$mod).attr("src",s(this).data("imageurl")),s(".bp-comdity",t.$mod).show()}).on("mouseleave",".bp-giftslist li",function(){s(".bp-comdity",t.$mod).hide()}).on("click",".bp-giftslist li",function(e){s(".bp-giftshow",t.$mod).hide(),s(".bp-btn-up em",t.$mod).removeClass("bp-gift-down").addClass("bp-gift-up"),t.selectProps=!1,t.$sendNum.val(s(this).data("value")),e.stopPropagation()}).on("click","#bp-goodNum",function(e){e.stopPropagation(),t.selectProps&&(s(".bp-giftshow",t.$mod).hide(),s(".bp-btn-up em",t.$mod).removeClass("bp-gift-down").addClass("bp-gift-up"),t.selectProps=!1);var i=parseInt(s(".tab-title-select",t.$backTabTitles).data("sendtype"),10);2===i&&(t.isCreatePropsTip||(t.createPropsTip(t.textMap.propsTip),t.isCreatePropsTip=!0),t.$sendLeftNum.trigger("sendProps-tip-show"),setTimeout(function(){t.$sendLeftNum.trigger("sendProps-tip-hide")},3e3|t.textMap.tipShowTime))}).on("click",".bp-select",function(e){e.preventDefault(),e.stopPropagation(),t.selectProps&&(s(".bp-giftshow",t.$mod).hide(),s(".bp-btn-up em",t.$mod).removeClass("bp-gift-down").addClass("bp-gift-up"),t.selectProps=!1);var i=t.$backTabTitles.find("li.tab-title-select").data("titleid");+i!==+t.textMap.tabIdCurr&&(t.selectUser?(s(".contact-list-add",t.$mod).hide(),s("em",s(this)).removeClass("bp-contact-down").addClass("bp-contact-up"),t.selectUser=!1):(s(".contact-list-add",t.$mod).show(),s("em",s(this)).removeClass("bp-contact-up").addClass("bp-contact-down"),t.selectUser=!0))}).on("click",".contact-list-add li",function(e){e.preventDefault(),e.stopPropagation(),s(".contact-list-add",t.$mod).hide(),s(".bp-contact-arrow em",t.$mod).removeClass("bp-contact-down").addClass("bp-contact-up"),t.selectUser=!1,t.$selectUser.html(n.escapeToHtml(s(this).text())),t.$selectUser.data({name:s(this).data("name"),userid:s(this).data("userid")})}).on("click","#sendBggiftAction",function(e){e.stopPropagation();var i=t.$sendNum.val(),a=t.$selectUser.data("userid"),o=(t.$selectUser.data("name"),s(".tab-title-select",t.$backTabTitles)),n=s('.backpack-gifts-list[data-tabid="'+o.data("titleid")+'"]',t.$giftsCon),d=s(".list-focus",n);if(0===d.length)return void c.alert({iconShow:"upset",contentText:t.textMap.chooseonegood,confirmText:getText("ok")});var r=d.data("itemnum");if(parseInt(i,10)>parseInt(r,10)){var p=s.replaceTpl(t.textMap.itemInadequate,{number:r});return t.isCreateNumShortTip?t.changeShortNum(r):(t.createNumShortTip(p),t.isCreateNumShortTip=!0),t.$sendNum.trigger("numShort-tip-show"),void setTimeout(function(){t.$sendNum.trigger("numShort-tip-hide")},3e3|t.textMap.tipShowTime)}if(1===parseInt(o.data("sendtype"),10)&&getConf("userId")===a)return t.iscreateSendSelfTip||(t.createSendSelfTip(t.textMap.canSendSelf),t.iscreateSendSelfTip=!0),t.$selectUser.trigger("canSendSelf-tip-show"),void setTimeout(function(){t.$selectUser.trigger("canSendSelf-tip-hide")},3e3|t.textMap.tipShowTime);var l=d.data("type"),m=d.data("itemid");s.post("/goods/useGood",{toUserId:parseInt(a,10),type:l,goodId:m,roomId:getConf("roomId"),num:i},function(e){(-1!==(e+"").indexOf("error")||-1===e.errNum||501===e.errNum)&&c.alert({iconShow:"upset",contentText:t.textMap.failSend,confirmText:getText("ok")}),o.data("shouldres","1"),o.data("send","1"),o.click()})})},changeWithTab:function(t){var t=parseInt(t,10);this.$sendNum.val("1"),1===t?(this.$sendBt.text(this.textMap.send),getConf("userId")!==getConf("anchorId")?(this.$selectUser.html(n.escapeToHtml(getConf("anchorName"))),this.removeFromUserList(getConf("userId"))):this.$selectUser.html(this.textMap.yourself),this.$selectUser.data("userid",getConf("anchorId")).data("username",n.escapeToHtml(getConf("anchorName"))),this.$sendNum.attr("readonly",!1)):2===t&&(this.$sendBt.text(this.textMap.use),this.$selectUser.html(this.textMap.yourself).data("userid",getConf("userId")).data("username",n.escapeToHtml(getConf("userName"))),this.$sendNum.attr("readonly",!0),this.addToUserlist({userId:getConf("userId"),name:n.escapeToHtml(getConf("userName")),nameText:this.textMap.yourself,vip:getConf("vip")},0))},createNumShortTip:function(t){var e="<div>"+t+"</div>";this.$sendNum.tip({backgroundColor:"#fff",borderColor:"#ccc",className:"num-short-tip",showEvent:"numShort-tip-show",hideEvent:"numShort-tip-hide",content:s(e),dir:"top",customLocation:!0})},changeShortNum:function(t){s(".jq-content em",s(".num-short-tip")).text(t)},createSendSelfTip:function(t){var e="<div>"+t+"</div>";this.$selectUser.tip({backgroundColor:"#fff",borderColor:"#ccc",className:"can-sendSelf-tip",showEvent:"canSendSelf-tip-show",hideEvent:"canSendSelf-tip-hide",content:s(e),dir:"top",customLocation:!0})},createPropsTip:function(t){var e="<div>"+t+"</div>";this.$sendLeftNum.tip({backgroundColor:"#fff",borderColor:"#ccc",className:"backpack-sendProps-tip",showEvent:"sendProps-tip-show",hideEvent:"sendProps-tip-hide",content:s(e),dir:"top",customLocation:!0})}};var u=function(t){this.textMap=t,this.isShowMain=!1,this.selectTabId=0,this.sendCon={},this.$mod=s(".newroom-backpack-con"),this.$triangle=s(".triangle"),this.listTpl='<li data-itemName="#{Name}" data-itemId="#{goodId}" data-uitab="#{goodId}"data-type="#{Type}" data-bigImg="#{Logo}" data-itemExplan="#{Explantion}"data-itemNum="#{times}" data-expiredTime="#{expireTime}" data-expiredNum="#{nearExpire}"data-islucky="#{isLucky}" data-effectiveTime="#{EffectiveTime}"<a href="javascript:;"><img src="#{SmallLogo}"></a><span class="liselect"></span>',this.tabs={},this.init()};u.prototype={constructor:u,init:function(){var t=this;this.bindEvent(),this.sendCon=new m(this.textMap),s.cookie("hiclub-backpack-first")||s(".newroom-backpack-send",t.$mod).trigger("firstClick"),s.getJSON("/hiapi/userpackage/getPackageCategory").done(function(e){if(-1!==e.errNum){for(var i=e.data,s=i.length,a=0;s>a;a++)t.tabs[i[a].categoryId]=new l(i[a]);t.tabs[i[0].categoryId].getTilById(i[0].categoryId).click()}}).fail(function(){})},bindEvent:function(){var t=this;this.$mod.on("click",function(e){e.stopPropagation(),t.sendCon.$mod.trigger("tabChange")}).on("click",".backpack-tab-title",function(e){var i=s(this),a=parseInt(i.data("titleid"),10),o=parseInt(i.data("sendtype"),10);t.sendCon.$mod.trigger("tabChange"),0===parseInt(i.data("send"),10)&&t.sendCon.changeWithTab(o),i.data("send","0");var n=s('.backpack-gifts-list[data-tabId="'+a+'"]',t.$mod);1===parseInt(i.data("shouldres"),10)&&(t.requestItemList(a),i.data("shouldres","0")),i.siblings("li").removeClass("tab-title-select"),i.addClass("tab-title-select"),s(".backpack-gifts-list",t.$mod).parent().hide(),n.parent().show(),e.stopPropagation()}).on("click",".backpack-con-close",function(e){e.stopPropagation(),t.$mod.hide(),t.$triangle.hide(),t.isShowMain=!1,s(".backpack-icon",s(".mod-newroom-backpack")).removeClass("backpack-icon-click")})},requestItemList:function(t){var e=this;s.getJSON("/hiapi/userpackage/getUserPackageList",{cateId:t}).done(function(i){if(e.tabs[t].selectItemId=0,void 0!==i&&-1!==i.errNum){for(var a=e.tabs[t].$tabTitle.data("sendtype"),o=i.data,n=o.length,r="",c=0;n>c;c++){var p=e.listTpl;p+=parseInt(o[c].times,10)<99?'<div class="bigRedpoint">'+o[c].times+"</div>":'<div class="ellipsePoint">99+</div>',0!==parseInt(o[c].nearExpire,10)&&(p+='<div class="liexpired">'+e.textMap.akanExpired+"</div>"),parseInt(o[c].isLucky,10)&&(p+='<div class="lucky">'+e.textMap.lucky+"</div>"),2===parseInt(a,10)&&(p+='<div class="item-props">'+o[c].EffectiveTime+"</div>"),p+="</li>",r+=s.replaceTpl(p,o[c]),d.setMessageNum(o[c].goodId,o[c].times)}""===r&&(r='<div class="backpack-empty">'+e.textMap.emptyText+"</div>"),s('ul[data-tabId="'+t+'"]',this.$mod).html(r)}}).fail(function(){})}},i.exports={run:function(t){var e=new p(t);window.moduleMaster.exports("mod-newroom-backpack",e)}}});
;define("room:widget/newroom/step1/mod-newroom-preview/mod-newroom-preview.js",function(e,o,i){function n(e){t(e),w.show()}function t(e){if(h){switch($.attr("href","/liveroom/"+e.RoomID),w.find(".prompt-block").hide(),h){case"flash":r(e);break;case"videoLive":a(e);break;default:y.$flashDownload.show()}clearTimeout(p),p=setTimeout(function(){l(e)},1e3*f.previewSeconds),w.show()}}function r(e){var o={server:e.liveStreamUri.rtmp,play_url:encodeURIComponent(e.RoomID+"?token="+e.token+"&uid="+(getConf("userId")||getConf("NoLoginID"))),video_id:e.RoomID,virtualCamera:"liveCamera",domId:g},i={wmode:"opaque",allowfullscreen:"true",allowscriptaccess:"sameDomain",id:g};swfobject.embedSWF("/static/room/swf/videoPlayer_ecce1d3.swf",g,I,x,"9.0.0","",o,i)}function a(){}function l(e){m("#"+g).after('<div id="'+g+'"></div>').remove(),y.$previewEnd.find("img").attr("src",e.RoomImg),y.$previewEnd.show()}function s(e,o){for(var i in C)if(C[i].module===e)return;C.push({module:e,operation:o})}function d(){L||(L=!0,m.ajax({url:"/interface/recommend/anchorlist/getRecommendList",data:{roomId:getConf("roomId"),limit:27},dataType:"json",cache:!1}).done(function(e){if(200!==+e.message.errNum&&201!==+e.message.errNum)return void alert(e.message.errMessage);b=e.result;for(var o in b){var i=b[o];i.RoomImg||(i.RoomImg=f.defImg)}if(k=!1,setTimeout(function(){k=!0},3e3),C.length)for(o in C)C[o].module[C[o].operation]();C=[]}).always(function(){L=!1}))}function c(e,o){this.curIndex=0,this.total=27,this.maxIndex=this.total-1,this.$ul=e,this.volume=+o}function v(e){var o=b[e],i='<li class="recommend-item"><div class="pic-wrap"><img src="'+o.RoomImg+'">'+(o.isLive?'<i class="live-icon"></i>':"")+'<div class="hover-wrap mask"></div><p class="viewer-num"><i></i>'+o.Likes+'</p><div class="hover-wrap"><div class="front">'+(o.isLive?'<a href="javascript:;" class="btn-preview" data-anchor-index="'+e+'" data-sort="previewBtn" data-val="preview">'+u.preview+"</a>":"")+'<a href="/liveroom/'+o.RoomID+'" class="btn-enter" log-index="enterRoom">'+u.enter+'</a></div></div></div><p class="anchor-name toe">'+o.NickName+"</p></li>";return i}var m=e("common:widget/ui/jquery/jquery.js");e("common:widget/ui/jquery/widget/jquery.ui.popup/jquery.ui.popup.js");var u,f,p,w=m(".mod-newroom-preview"),h="flash",g="videoPreview",I=280,x=210,y={$flashDownload:null,$liveShowEnd:null,$previewEnd:null},$=null;w.popup({isDraggable:!0,isModal:!1,position:"left bottom",onLoad:function(e){y={$flashDownload:e.find(".flash-download"),$liveShowEnd:e.find(".live-show-end"),$previewEnd:e.find(".preview-end")},$=e.find("[data-fill=roomLink]")},afterClose:function(e){e.revertPosition()}}),liveControl.setFlashCallBack("liveShowStopCallback",g,function(){y.$liveShowEnd.show()}),liveControl.setFlashCallBack("liveShowStartCallback",g,function(){y.$liveShowEnd.hide()});var b,L,k=!1,C=[],j=c.prototype;j.next=function(){var e=this;if(!b||k)return s(this,"next"),d(),void e.$ul.html('<li style="text-align:center;line-height:100px;"><img src="/static/room/widget/newroom/step1/mod-newroom-preview/img/loading_953c665.gif"></li>');var o=e.getNextIndexArray();e.fillListTpl(o),e.bindListEvent()},j.prev=function(){var e=this;if(!L){var o=e.getPrevIndexArray();e.fillListTpl(o),e.bindListEvent()}},j.fillListTpl=function(e){var o=this,i="";for(var n in e){var t=e[n];i+=v(t)}o.$ul.html(i)},j.bindListEvent=function(){this.$ul.on("click",".btn-preview",function(){var e=m(this).data("anchorIndex");n(b[e])})},j.getNextIndexArray=function(){var e=this,o=e.volume,i=e.curIndex+o>e.total?0:e.curIndex,n=b.length,t=i+o,r=[];if(n){if(i>=n)return e.curIndex=t,e.getNextIndexArray();for(;t>i&&n>i;)r.push(i++);return e.curIndex=i>=e.total?0:t,r}},j.getPrevIndexArray=function(){var e=this,o=e.volume,i=e.curIndex-2*o;i=0>i?Math.floor(e.total/o)*o+i:i;var n=b.length,t=i+o,r=[];if(n){if(i>=n)return e.curIndex=t,e.getPrevIndexArray();for(;t>i&&n>i;)r.push(i++);return e.curIndex=i>=e.total?0:t,r}},i.exports={init:function(e,o){var i=new Image;i.src="/static/room/widget/newroom/step1/mod-newroom-preview/img/loading_953c665.gif",u=e,f=o,d()},showPreview:n,RecommendedList:c,$previewPopup:w}});
;define("room:widget/newroom/step1/mod-newroom-belowrecommend/mod-newroom-belowrecommend.js",function(o,e,n){var i=o("common:widget/ui/jquery/jquery.js"),t=o("room:widget/newroom/step1/mod-newroom-preview/mod-newroom-preview.js"),m=i(".mod-newroom-belowrecommend"),d=m.find("[data-fill=list]"),w={$expend:m.find(".expend"),$fold:m.find(".fold")},c=(m.find(".list-wrap"),155),r=155,f=new t.RecommendedList(d,4);f.next(),m.on("click",".btn-next",function(){f.next()}),m.on("click",".btn-prev",function(){f.prev()}),m.on("click",".expend",function(){var o=i(this);o.hide(),m.animate({height:c},r)}),m.on("click",".fold",function(){i(this);m.animate({height:0},r,function(){w.$expend.show()})}),i(document).on("newroomBelowRecommendShow",function(){m.show()}),n.exports={run:function(o){o&&m.show()},show:function(){m.show()}}});
;define("room:widget/newroom/step1/mod-newroom-bg/mod-newroom-bg.js",function(o,r,n){var e=o("common:widget/ui/jquery/jquery.js");n.exports={run:function(o,r){var n=e(".body-content-container");for(var u in r)if(getConf("anchorId")===+r[u].userId)return void n.css("backgroundImage","url("+r[u].bgSrc+")");o&&n.css("backgroundImage","url("+o+")")}}});
;define("room:widget/newroom/step1/mod-newroom-chat/js/anchorSetting.js",function(t){function e(t){for(var e=["a","span","font","b","u","i","h1","h2","h3","h4","h5","h6","p","li","ul","table","div"],n=0;n<e.length;n++){var o=0,a=0,i=new RegExp("<"+e[n]+"( [^<>]+|)>","ig"),r=t.match(i);null!=r&&(o=r.length),i=new RegExp("</"+e[n]+">","ig"),r=t.match(i),null!=r&&(a=r.length);for(var u=0;o-a>u;u++)t+="</"+e[n]+">";for(var u=0;a-o>u;u++)t="<"+e[n]+">"+t}return t}var n=t("common:widget/ui/jquery/jquery.js"),o=t("common:widget/public/public-tools/public-tools.js");t("common:widget/ui/jquery/widget/jquery.ui.popup/jquery.ui.popup.js");var a=n(".mod-newroom-chat").find("[data-fill=announcement]"),i=n("#anchorSettingPopup").popup(),r=i.find("textarea"),u=i.find(".text-confine .num");u.text(r.val().length),n(document).on("anchorSetting",function(){i.show()}),i.on("keyup input","textarea",function(){u.text(r.val().length)});var c;i.on("click",".submit",function(){if(!c){c=!0;var t=r.val();t=getConf("isSign")?e(t):o.escapeToHtml(t),n.ajax({url:"/anchor?f=setChatNotice",data:o.formatData({roomId:getConf("roomId"),type:0,content:t}),type:"POST",cache:!1}).done(function(e){Boolean(e)?(i.close(),a.html(t),a.attr("title",o.escapeToHtml(t))):alert(e.message.errMessage)}).always(function(){c=!1})}})});
;define("room:widget/newroom/step1/mod-newroom-chat/js/chatContactList.js",function(t,i,n){function e(t,i,n){i||(i=5),this.textMap=n,this.num=i,this.type=t,this.current={id:0,name:""},this.list=[],this.$container=a("#contactList"+this.type),this.bindEvent()}function c(t,i){for(var n=0,e=i.length;e>n;n++)if(t==i[n].userId)return!0;return!1}var a=t("common:widget/ui/jquery/jquery.js"),s=t("common:widget/public/public-tools/public-tools.js"),o=t("common:widget/public/public-bubble/public-bubble.js"),r=window.getConf;e.prototype.add=function(t,i,n,e){i=s.escapeToHtml(i);c(t,this.list)||0===t||t===r("anchorId")||(this.list.unshift({userId:t,name:i,vipSrc:n}),this.list.length>this.num&&(delete this.list[this.list.length-1],this.list.length=this.num)),e||(this.current.id=t,this.current.name=i,this.current.vipSrc=n,a(".current-contact-user",this.$container).html(i))},e.prototype.initList=function(){var t="";"public"==this.type&&(t+='<li class="toe" data-userid="0" data-name="'+this.textMap.publicChatToAll+'">'+this.textMap.publicChatToAll+"</li>");for(var i=this.list,n=0,e=i.length;e>n;n++)t+='<li class="toe" data-userid="'+i[n].userId+'" data-name="'+i[n].name+'"'+(i[n].vipSrc?' data-vip="'+i[n].vipSrc+'"':"")+">"+i[n].name+"</li>";if(t+='<li class="toe" data-userid="'+r("anchorId")+'" data-name="'+s.escapeToHtml(r("anchorName"))+'">'+s.escapeToHtml(r("anchorName"))+"</li>",a("ul",this.$container).html(t),i[0]&&!this.current.id){{var c=(this.current.id=i[0].userId,this.current.name=s.escapeToHtml(i[0].name));this.current.vipSrc=i[0].vipSrc}a(".current-contact-user",this.$container).html(c)}},e.prototype.bindEvent=function(){function t(){a(".contact-content-list",n.$container).hide(),a(".contact-arrow em",n.$container).removeClass("contact-down").addClass("contact-up")}function i(){n.initList(),a(".contact-content-list",n.$container).show(),a(".contact-arrow em",n.$container).removeClass("contact-up").addClass("contact-down")}var n=this,e=new o(i,t);this.$container.on("click",".select",function(){e.toggle()}),a(".contact-content-list",n.$container).on("mouseenter","li",function(){a(this).addClass("addto")}).on("mouseleave","li",function(){a(this).removeClass("addto")}).on("click","li",function(){var t=s.escapeToHtml(a(this).data("name"));a(".current-contact-user",n.$container).html(t),n.add(a(this).data("userid"),t,a(this).data("vipSrc"))})},n.exports=e});
;define("room:widget/newroom/step1/mod-newroom-chat/js/handleChatArea.js",function(t,e,n){function o(t,e,n){var o=n?new Date(n):new Date,a=o.getHours()<10?"0"+o.getHours():o.getHours(),c=o.getMinutes()<10?"0"+o.getMinutes():o.getMinutes(),n=a+":"+c;t='<li class="cf"><span class="time">'+n+"</span>"+t+"</li>";var l=p("#"+e+" .messages");p(t).appendTo(p(".theMessageContent",l)),p(t).appendTo(p(".lastChatContent",l)),s(e),i(e)}function i(t){try{if("publicChat"===t){if(I.updateState(),"lock"===d.data("status")&&"block"==m.find("div.mod-scroll_thumb-y").css("display"))return void I.initLayout();I.goTo({x:0,y:0-I.state._y})}else C.updateState(),C.goTo({x:0,y:0-C.state._y})}catch(e){}}function s(t){var e=4e3,n=18,o="#"+t+" .messages",i=p(o+" .lastChatContent"),s=p(o+" .theMessageContent"),a=i.find("li").length;for(a>n&&i.find("li").eq(0).remove();s.height()>e;)i.find("li").eq(0).remove(),s.html(i.html())}function a(t,e,n,i,s,a,l,r){if(i){a||(a={}),n&&(n=u.escapeToHtml(n)),a.userName&&(a.userName=u.escapeToHtml(a.userName)),a.toUserName&&(a.toUserName=u.escapeToHtml(a.toUserName)),a.isVipAndIcon&&(a.isVipAndIcon=/"/.test(a.isVipAndIcon)?!1:u.escapeToHtml(a.isVipAndIcon)),a.toClientId&&(a.toClientId=u.escapeToHtml(a.toClientId)),a.toClientName&&(a.toClientName=u.escapeToHtml(a.toClientName)),a.isToVipAndIcon&&(a.isToVipAndIcon=/"/.test(a.isToVipAndIcon)?!1:u.escapeToHtml(a.isToVipAndIcon));var p="";if(("publicChat"==t&&e==g("AnchorId")||"submitWhisper"==s)&&(p="anchorChat"),+a.type>=1e3&&+a.type<=1002||"submitWhisper"==s||14===+a.type){var d=/\([^\)]+\)/g;h.require("mod-public-emotion",function(t){i=i.replace(d,function(e){return t.getEmotionImgTpl(e,a.isVipAndIcon)})})}var m="";null!=n&&("submitWhisper"!==s&&(m='<span class="'+(0!==+e?"user-name-hook":"gryColor ")+(e===g("anchorId")?" anchor":"")+(a.isVipAndIcon?" vip":"")+'" data-userid="'+e+'" data-name="'+n+'"'+(a.isVipAndIcon?' data-vip="'+a.isVipAndIcon+'"':"")+">"+c(e)+(a.isVipAndIcon?'<img class="badge" src="'+a.isVipAndIcon+'"> ':"")+n+"</span>"),("submitWhisper"===s||"submit1to1Chat"===s)&&(m+="<span>"+l.to+'</span><span class="user-name-hook'+(a.toClientId===g("anchorId")?" anchor":"")+(a.isToVipAndIcon?" vip":"")+'" data-userid="'+a.toClientId+'" data-name="'+a.toClientName+'"'+(a.isToVipAndIcon?' data-vip="'+a.isToVipAndIcon+'"':"")+">"+c(a.toClientId)+(a.isToVipAndIcon?'<img class="badge" src="'+a.isToVipAndIcon+'"> ':"")+a.toClientName+"</span>"),m+="<span>: </span>");var I=m+'<span class="'+p+'">'+i+"</span>";r?o(I,t,r):o(I,t)}}function c(t){var e="";return p.each(T,function(n,o){t+""===o.uid&&(e='<img class="customerIcon" src="'+o.icon+'" title="'+o.title+'" alt="'+o.title+'">')}),e}function l(){I&&(I.updateState(),I.goTo({x:0,y:0-I.state._y}))}function r(){C&&(C.updateState(),C.goTo({x:0,y:0-C.state._y}))}var p=t("common:widget/ui/jquery/jquery.js"),u=t("common:widget/public/public-tools/public-tools.js");t("common:widget/ui/jquery/widget/jquery.ui.scrollable/jquery.ui.scrollable.js");var d=p("#publicLock"),m=p("#publicChatList"),h=window.moduleMaster,g=window.getConf,I=null,C=null;try{I=p("#publicChat .theMessageContent").scrollable({autoHide:!1}),C=p("#whisper .theMessageContent").scrollable({autoHide:!1})}catch(f){}var T;p(document).on("newRoomChatInsertHTML",function(t,e,n){o(e,n)}),n.exports={init:function(t){T=t},createOneMessage:a,fixPublicStat:l,fixWhisperStat:r}});
;define("room:widget/newroom/step1/mod-newroom-flyscreen/mod-newroom-flyscreen.js",function(e,o,t){function a(e){m.ajax({url:"/mall?f=getSpecialGoodList&type=flyscreen",dataType:"json",cache:!1}).done(function(e){for(var o=0;2>o;o++)f.eq(o).text(e.result[o].Price),d.eq(o).data("price",e.result[o].Price),d.eq(o).data("type",e.result[o].ID).addClass("id-"+e.result[o].ID)}),N.on("keyup input","textarea",function(){l.hide();var e=m.trim(s.val()).length;c.text(e)}),N.on("click",".choose-fly li",function(){d.removeClass("cur"),m(this).addClass("cur"),T=m(this).data("index")}),N.on("click",".ok-button",function(){UT.send({type:"others",sort:"flyconfime",modId:"flyconfime",value:"flyconfimeValue"});var o=m.trim(s.val());if(!o)return void l.show();var t=d.eq(T),a=t.data("type"),r=t.data("times"),n=t.data("price");return 1>r&&!u.balance.checkBalance(n)?void 0:h.checkSensitiveWords(o)?void m.ajax({url:"/mall?f=sendSpecialGoods",type:"POST",data:{roomId:getConf("roomId"),goodId:a,message:o,type:"flyscreen"},dataType:"json",cache:!1}).done(function(e){if(e.message&&e.result){if("606"===e.message.errNum)return void u.balance.showRechargePrompt();N.close(),u.balance.addBalance(-parseInt(e.result.amount,10))}}):void g.alert({iconShow:"upset",contentText:e.hasSensitiveWords})})}function r(e,o,t){v.animate({left:-w},{duration:1e4,easing:"linear",start:function(){o=o||"blue",v.html(e),k.removeClass("effect-red effect-blue").addClass("effect-"+o),t?k.removeClass("no-event"):k.addClass("no-event"),k.show()},done:function(){v.css("left",w),k.hide()}})}function n(e){function o(e,o,t){return e=e.replace("[host]",o),e=e.replace("[giftname]",t)}y.on("1",function(o){var t=o.body.recordList,a="";for(i=0;i<t.length;i++){var n=t[i];n.NickName=b.escapeToHtml(n.NickName),n.SongName=b.escapeToHtml(n.SongName),n.SongReceiver?(n.SongReceiver=b.escapeToHtml(n.SongReceiver),a=m.replaceTpl(e.orderSongToOneText,n)):a=m.replaceTpl(e.orderSongText,n),r(a)}}),y.on("26 27",function(t){var a,n=t.body.userName+": "+h.filterSensitiveWords(t.body.message),i="blue";if("27"===t.type){var l=t.body.weekFlag;if("weekhost"===l){var s=t.body.userName+": "+e.weekstar2.hostweek;n='<a target="_blank" href="/liveroom/'+m.trim(t.body.RoomID)+'">'+o(s,t.body.nickName,t.body.giftName)+"</a>"}else if("monthhost"===l){var s=t.body.userName+": "+e.weekstar2.hostmonth;n='<a target="_blank" href="/liveroom/'+m.trim(t.body.RoomID)+'">'+o(s,t.body.nickName,t.body.giftName)+"</a>"}else if("weekchest"===l){var s=t.body.userName+": "+e.weekstar2.chestweek;n='<a target="_blank" href="'+e.weekstar2.href+'">'+o(s,t.body.nickName,t.body.giftName)+"</a>"}else if("monthchest"===l){var s=t.body.userName+": "+e.weekstar2.chestmonth;n='<a target="_blank" href="'+e.weekstar2.href+'">'+o(s,t.body.nickName,t.body.giftName)+"</a>"}else if("weeknineClock"===l)n='<a target="_blank" href="'+e.weekstar2.href+'">'+t.body.userName+": "+e.weekstar2.weeknineClock+"</a>";else if("monthnineClock"===l)n='<a target="_blank" href="'+e.weekstar2.href+'">'+t.body.userName+": "+e.weekstar2.monthnineClock+"</a>";else{var c="",d="";t.body.flyType&&"system"===m.trim(t.body.flyType)?t.body.url&&(c='<a target="_blank" href="'+t.body.url+'">',d="</a>"):(c='<a target="_blank" href="/liveroom/'+m.trim(t.body.RoomID)+'">',d="</a>"),n=c+b.escapeToHtml(n)+d}i="red",a=!0}r(n,i,a)}),y.on("weekStarAd",function(e){var o=h.filterSensitiveWords(e.body.message);o='<a target="_blank" href="/weeklystar">'+b.escapeToHtml(o)+"</a>",r(o,"red",!0)})}var l,s,c,d,f,m=e("common:widget/ui/jquery/jquery.js"),u=e("common:widget/public/mod-public-property/mod-public-property.js"),p=e("common:widget/public/mod-public-login/mod-public-login.js"),y=e("common:widget/public/public-socket/public-socket.unpack.js"),b=e("common:widget/public/public-tools/public-tools.js"),h=e("common:widget/public/public-wordsfilter/public-wordsfilter.js"),g=e("common:widget/public/public-dialog/public-dialog.js"),k=m(".mod-newroom-flyscreen"),v=k.find(".message-wrap"),w=1800,N=m(".mod-newroom-flyscreen-popup"),T=0;t.exports={run:function(e){N.popup({isModal:!1,isDraggable:!0,onLoad:function(){l=N.find(".error-hint"),s=N.find("textarea"),c=N.find('[data-fill="inputLength"]'),d=N.find(".choose-fly li"),f=d.find('[data-fill="price"]')},beforeShow:function(){m.ajax({url:"/liveroom/studio/getUserFreeGoodsList",dataType:"json",cache:!1}).done(function(e){if(d.data("times",0),e.result&&e.result.length)for(var o in e.result){var t=e.result[o].GoodsId,a=e.result[o].Times,r=d.filter(".id-"+t);r.data("times",a),r.find('[data-fill="times"]').text(e.result[o].Times)}})},onClose:function(){UT.send({type:"others",sort:"flyCancel",modId:"flyCancel",value:"flyCancelValue"}),l.hide(),s.val(""),c.text(0)}}),a(e),n(e)},showDialog:function(){getConf("isLogined")?N.show():p.showDialog()},flyOnce:r}});
;define("room:widget/newroom/step1/mod-newroom-chat/mod-newroom-chat.js",function(e,o,n){function a(e,o){return e=e||10,(new Date).getTime()-$>5e3?void(o&&o()):void(S.socketStatus?v.getHistory(e,function(e){if(0===e.length)return void(o&&o());for(var n,a=0;a<e.length;a++)n=e[a],M.createOneMessage("publicChat",n.fromUserId,C.escapeToHtml(n.fromNickName),C.escapeToHtml(n.message),null,n,U,n.t),a===e.length-1&&o&&o()}):setTimeout(function(){a(e,o)},1e3))}function t(){var e=y(".loading-panel","#publicChat"),o=y(".reload-panel","#publicChat"),n=0,a={hideLoading:function(){e.fadeOut(200)},showLoading:function(){e.fadeIn(200)},hideReload:function(){o.fadeOut(200)},showReload:function(){U.im_tmp&&(n++,1===n?(y(".bear-head",o).addClass("first-time"),y(".t-main",o).text(U.im_tmp.tip_config.first.tip),y(".t-sec",o).text(U.im_tmp.tip_config.first.sug)):(y(".bear-head",o).removeClass("first-time"),y(".t-main",o).text(U.im_tmp.tip_config.other.tip),y(".t-sec",o).text(U.im_tmp.tip_config.other.sug)),o.fadeIn(200))}};y(".reload-btn",o).on("click",function(){a.hideReload(),a.showLoading(),v.retry({connect:function(e,o){o.emit("connect",{room:x("roomId"),nickName:x("userName"),userId:x("userId"),BDUSS:y.cookie("BDUSS")||""})}})}),v.regState(function(e){switch(e){case"connecting":a.showLoading();break;case"connect":a.hideLoading();break;case"handshake failed":a.hideLoading()}})}function s(){y("#publicChat");y("#publicLock").on("click",function(){y(this).hasClass("unlock-icon")?(y(this).removeClass("unlock-icon").addClass("lock-icon"),y(this).data("status","lock")):(y(this).removeClass("lock-icon").addClass("unlock-icon"),y(this).data("status","unlock"))})}function r(){{var e=(y(".announcement"),y(".notice"));y(".annoucement-Wrap").height()}e.on("click",function(){P.hasClass("announceHide")?(P.removeClass("announceHide"),M.fixPublicStat()):(P.addClass("announceHide"),M.fixPublicStat())})}function c(){var e=_.val();_.on("input propertychange keyup",function(){var o=y(this).val(),n=o.length;return n>140?void y(this).val(e):(e=o,void y("#chatSection .num").text(n))}),_.on("keydown",function(e){if(13===e.keyCode){if(D.isChatFree&&!x("isLogined"))return void u(B);m(B)}}),P.on("click",".btn-submit",function(){return D.isChatFree&&!x("isLogined")?void u(B):void m(B)}),P.on("click",".chose-chart",function(){y(this).hasClass("chosed")?(y(this).removeClass("chosed"),B=!1):(y(this).addClass("chosed"),B=!0)})}function l(){function e(e){t=e.clientY,y(document).on("mousemove.a",function(e){return o(e),!1}),y(document).on("mouseup.a",function(e){n(e)}),r=c.height()-90,s=y(a).parent().height()}function o(e){i=t-e.clientY+s,i=113>i?113:i,i=i>r?r:i,y(a).parent().height(i);var o=y(".whisperCont").height()-22;y("#whisperChatList").height(o),M.fixWhisperStat()}function n(){y(document).off("mousemove.a"),y(document).off("mouseup.a"),M.fixWhisperStat()}var a=null,t=0,s=0,i=0,r=0,c=y(".mod-newroom-chat"),l=y(".whisperCont").height()-22;y("#whisperChatList").height(l);var a=y(".top-scroll");y(a).on("mousedown",function(o){return e(o),!1}),y("#whisperMessageContent").on("click",".loginBtn",function(){I.showDialog("mod-newroom-chat")})}function d(){P.on("click",".user-name-hook",function(){var e=y(this).data("userid"),o={userId:e,$user:y(this),doChat:!0,actionList:{publicChat:!0,whisper:!0,gift:!0,view:!0,follow:!0,addAdmin:!0,kickOut:!0},isVip:y(this).data("vip")};V.require("mod-roompublic-usermenu",function(e){e.showMenu(o)})}),P.on("mouseleave",".user-name-hook",function(){var e=y(this);V.require("mod-roompublic-usermenu",function(o){o.destroyMenu(e)})})}function u(e){if(L.send({type:"click",modId:"sendbtn"}),y.cookie("hiclubFreeChat")&&+y.cookie("hiclubFreeChat")>=D.chatFreeNum)return void T.alert({iconShow:"upset",contentText:U.todayFreeChatLimit,onConfirm:function(){I.showDialog("mod-newroom-chat")}});var o=y.trim(_.val());if(o&&!_.hasClass("default")){if(e)return void T.alert({iconShow:"upset",contentText:U.noLoginCantWhisper,onConfirm:function(){I.showDialog("mod-newroom-chat")}});var n=p(o);if(1===n)return void M.createOneMessage("whisper",0,U.serverdisplayname,D.chatControl.sameChat);if(2===n)return void M.createOneMessage("whisper",0,U.serverdisplayname,D.chatControl.tooFastChat);{C.escapeToHtml(o)}_.focus(),_.val(""),P.find(".num").text(0);var a={toType:"room",message:o,fromUserId:x("userId"),toRoom:x("roomId")};if(0!==j.current.id?(a.toClientId=j.current.id,a.toClientName=j.current.name,j.current.vipSrc&&(a.isToVipAndIcon=j.current.vipSrc),a.type=1e3):a.type=1001,!e||parseInt(j.current.id,10)!==x("userId")){var t=new Date;if(t.setHours(23),t.setMinutes(59),t.setSeconds(59),y.cookie("hiclubFreeChat")&&/^\d+$/.test(+y.cookie("hiclubFreeChat"))){var s=+y.cookie("hiclubFreeChat")+1;y.cookie("hiclubFreeChat",s,{path:"/",expires:t})}else y.cookie("hiclubFreeChat",1,{path:"/",expires:t});v.emitToChat(a)}}}function m(e){if(L.send({type:"click",modId:"sendbtn"}),w.account.checkBDUSS()){if(!x("isLogined"))return void I.showDialog("mod-newroom-chat");var o=y.trim(_.val());if(o&&!_.hasClass("default")){if(e&&0===j.current.id)return void T.alert({iconShow:"upset",contentText:U.whisperToAll});var n=p(o);if(1===n)return void M.createOneMessage("whisper",0,U.serverdisplayname,D.chatControl.sameChat);if(2===n)return void M.createOneMessage("whisper",0,U.serverdisplayname,D.chatControl.tooFastChat);var a=C.escapeToHtml(o);_.focus(),_.val(""),P.find(".num").text(0);var t={toType:"room",message:o,fromUserId:x("userId"),toRoom:x("roomId")};if(x("isVip")&&(t.isVipAndIcon=x("isVipAndIcon")),e){t.toType="client",t.toClientId=j.current.id,t.type=1002;var s=x("isVip"),i=x("anchorId");if(D.vipWispherControl.isOpen&&!s&&t.toClientId===i)return void T.confirm({iconShow:"upset",contentText:U.vipHint,cancelText:U.cancelText,confirmText:'<a class="confirmLink" target="_blank" href="'+U.confirmLink+'">'+U.confirmText+"</a>"});var r=C.escapeToHtml(x("userName"));M.createOneMessage("whisper",x("userId"),r,a,"submitWhisper",{toClientId:j.current.id,toClientName:j.current.name,isToVipAndIcon:j.current.vipSrc,isVipAndIcon:x("isVipAndIcon")},U)}else 0!==j.current.id?(t.toClientId=j.current.id,t.toClientName=j.current.name,j.current.vipSrc&&(t.isToVipAndIcon=j.current.vipSrc),t.type=1e3):t.type=1001;e&&parseInt(j.current.id,10)===x("userId")||v.emitToChat(t)}}}function p(e){if(!D.chatControl.isOpen)return 0;var o=localStorage.getItem("lastChatContent"),n=localStorage.getItem("lastChatTime"),a=(new Date).getTime(),t=!1;if(o)var s=o.split("$-)");else var s=[];if(s.length)for(var i=0;i<s.length;i++){if(e===s[i]){t=!0;break}t=!1}else t=!1;if(t&&n&&a-n<1e3*D.chatControl.chatSameMinTime)return 1;if(n&&a-n<1e3*D.chatControl.chatMinTime)return 2;if(localStorage.setItem("lastChatTime",a),s.length){if(3===s.length){var r=s[1]+"$-)"+s[2];r+="$-)",r+=e}else if(2===s.length){var r=s.join("$-)");r+="$-)",r+=e}else{var r=s[0]+"$-)";r+=e}localStorage.setItem("lastChatContent",r)}else localStorage.setItem("lastChatContent",e);return 0}function h(){var e=x("userId"),o="";if(y.cookie("firstTimeInOneSettion")||y.cookie("firstTimeInOneSettion","true"),R)if(R=!1,x("isLogined")){var n="";O.getUser(e,"base",function(a,t){t.guildMedal&&t.guildId&&(n=A.getGuildIconTpl({guildId:t.guildId,guildName:t.guildMedal,guildLevel:t.guildLevel},t.roleInfo)),t.roleInfo&&t.roleInfo&&(n+=A.getGuildRootIcon(t.roleInfo)),o='<span class="user-name-hook'+(x("isMe")?" anchor":"")+(x("isVipAndIcon")?" vip":"")+'" data-userid="'+e+'" data-name="'+x("userName")+'"'+(x("isVipAndIcon")?' data-vip="'+x("isVipAndIcon")+'"':"")+">"+(x("isVipAndIcon")?'<img class="badge" src="'+x("isVipAndIcon")+'"> ':"")+x("userName")+"</span>"+n+" "+U.enterroom,x("isVipAndIcon")&&(o=""+(x("isVipAndIcon")?'<img class="badge enter-vip" src="'+x("isVipAndIcon")+'"> ':"")+'<span class="vip-bg">'+U.vipEnterRoom+'<span class="user-name-hook'+(x("isMe")?" anchor":"")+(x("isVipAndIcon")?" vip left-offset":"")+'" data-userid="'+e+'" data-name="'+x("userName")+'"'+(x("isVipAndIcon")?' data-vip="'+x("isVipAndIcon")+'"':"")+">"+x("userName")+"</span> "+n+U.enterroom+"</span>"),F&&F.flashPath&&(o+='<img class="car-img" alt="car" src="'+F.smallLogo+'">'),o=g(e)+o,M.createOneMessage("publicChat",0,null,o)})}else{var a=U.visitorInRoom.length,t=Math.floor(Math.random()*a),s=U.visitorInRoom[t],i={};i.userName=x("anchorName"),s=y.replaceTpl(s,i);try{M.createOneMessage("whisper",0,null,s)}catch(r){}M.createOneMessage("publicChat",0,null,'<span class="gryColor">'+x("noLoginUserName")+"</span> "+U.enterroom),y("#visitorBtn").on("click",function(){L.send({type:"others",sort:"visitorClick",modId:"visitorAction",value:"visotorClick"})})}}function g(e){var o="";return y.each(b,function(n,a){e+""===a.uid&&(o='<img class="customerIcon" src="'+a.icon+'" title="'+a.title+'" alt="'+a.title+'">')}),o}function f(){P.on("click",".emotion-btn",function(){var e=y(this);V.require("mod-public-emotion",function(o){o.togglePop({left:e.offset().left+9,top:e.offset().top-3},_)}),_.focus().trigger("input")})}var b,y=e("common:widget/ui/jquery/jquery.js"),v=e("common:widget/public/public-socket/public-socket.unpack.js"),I=e("common:widget/public/mod-public-login/mod-public-login.js"),C=e("common:widget/public/public-tools/public-tools.js"),w=e("common:widget/public/mod-public-property/mod-public-property.js"),k=e("common:widget/public/public-wordsfilter/public-wordsfilter.js"),T=e("common:widget/public/public-dialog/public-dialog.js"),N=e("room:widget/newroom/step1/mod-newroom-chat/js/chatContactList.js"),M=e("room:widget/newroom/step1/mod-newroom-chat/js/handleChatArea.js"),H=e("room:widget/newroom/step1/mod-newroom-flyscreen/mod-newroom-flyscreen.js"),S=e("room:widget/newroom/newroom.js"),O=e("common:widget/public/public-userinfo/public-userinfo.js"),A=e("common:widget/public/public-guildicon/public-guildicon.js"),V=window.moduleMaster,x=window.getConf,L=window.UT,j=null,U={},D={},F={},R=!0,W=parseInt(x("pageStartTime")/1e3,10),P=y(".mod-newroom-chat"),_=y("#textarea"),B=!1;n.exports={run:function(o,n,u){U=o.textMap,D=o.conf,F=n,b=u,M.init(b),P.on("click",".fly-btn",function(){H.showDialog()}),j=new N("public",!1,U),j.add(x("anchorId"),x("anchorName"),"",!0),S.on(function(e){var o=0;o=P.find("annoucement-Wrap").css("display","none")?e-364:e-326,P.find(".resize-fix-hook").css({height:o})}),V.on("mod-roompublic-usermenu","choosePublicChatUser",function(e){j.add(e.UserID,e.NickName,e.BadgeImg&&e.BadgeImg[0]),P.find(".chose-chart").removeClass("chosed"),B=!1}),V.on("mod-roompublic-usermenu","chooseWhisperUser",function(e){j.add(e.UserID,e.NickName,e.BadgeImg&&e.BadgeImg[0]),P.find(".chose-chart").addClass("chosed"),B=!0}),s(),r(),l(),c(),d(),a(D.historyChat,h),f(),x("isMe")&&e.async("room:widget/newroom/step1/mod-newroom-chat/js/anchorSetting.js"),window.ccroomPerformance.chatEndTime=(new Date).getTime()-x("pageStartTime"),v.on("1001",function(e){var o;o="jp"===x("country")?e.message:k.filterSensitiveWords(e.message),C.escapeToHtml(o).length>140||M.createOneMessage("publicChat",e.fromUserId,C.escapeToHtml(e.fromNickName),C.escapeToHtml(o),null,e,U)}),v.on("1000",function(e){var o;o="jp"===x("country")?e.message:k.filterSensitiveWords(e.message),C.escapeToHtml(o).length>140||M.createOneMessage("publicChat",e.fromUserId,C.escapeToHtml(e.fromNickName),C.escapeToHtml(o),"submit1to1Chat",e,U)}),v.on("1002",function(e){var o;o="jp"===x("country")?e.message:k.filterSensitiveWords(e.message),C.escapeToHtml(o).length>140||M.createOneMessage("whisper",e.fromUserId,C.escapeToHtml(e.fromNickName),C.escapeToHtml(o),null,e,U)}),v.on("3",function(e){var o=e.body;if(e.toRoom===x("roomId")+""){var n="",a="",t=parseInt(o.goodNum,10);for(t>36&&(t=36,n="......"),i=0;t>i;i++)a+='<img src="'+o.icon+'" title="'+o.goodName+'" class="gift" />';var s={fromUser:'<span class="user-name-hook'+(e.body.isVipAndIcon?" vip":"")+'" data-userid="'+o.userId+'" data-name="'+C.escapeToHtml(o.userName)+'" data-vip="'+(o.isVipAndIcon?o.isVipAndIcon:"")+'">'+(o.isVipAndIcon?'<img class="badge" src="'+o.isVipAndIcon+'"> ':"")+C.escapeToHtml(o.userName)+"</span>",toUser:'<span class="user-name-hook'+(o.toUserId===x("anchorId")+""?" anchor":"")+(o.isToVipAndIcon?" vip":"")+'"  data-userid="'+o.toUserId+'" data-name="'+C.escapeToHtml(o.toUserName)+'" data-vip="'+(o.isToVipAndIcon?o.isToVipAndIcon:"")+'">'+(o.isToVipAndIcon?'<img class="badge" src="'+o.isToVipAndIcon+'"> ':"")+C.escapeToHtml(o.toUserName)+"</span>",goodNum:o.goodNum,goodName:o.goodName,goodPics:a+n};if(M.createOneMessage("publicChat",0,null,y.replaceTpl(U.sendGiftPrompt,s),null,o),x("userId")==o.toUserId){var r=U.giftWhisper,c={};c.userName=' <span class="user-name-hook" data-userid="'+o.userId+'" data-name="'+C.escapeToHtml(o.userName)+'">'+C.escapeToHtml(o.userName)+"</span> ",c.img='<img src="'+o.icon+'" class="gift" title="'+o.goodName+'">',c.number=o.goodNum,c.gold=o.moneyAmount,r=y.replaceTpl(r,c),0===parseInt(o.moneyAmount,10)&&(r=U.backpackWhisper,r=y.replaceTpl(r,c)),M.createOneMessage("whisper",0,null,r,null,o)}}}),v.on("4",function(e){M.createOneMessage("publicChat",0,U.serverdisplayname,C.escapeToHtml(e.body.userName)+" "+U.beadminnistrator,null,e,U)}),v.on("5",function(e){M.createOneMessage("publicChat",0,U.serverdisplayname,C.escapeToHtml(e.body.userName)+" "+U.hasbecanceledadmin,null,e,U)}),v.on("10",function(e){var o='<a href="'+e.body.link+'">'+e.body.title+"</a>";createOneMessage("publicChat",0,U.serverdisplayname,o,null,e,U),createOneMessage("whisper",0,U.serverdisplayname,o,null,e,U)}),v.on("11",function(e){x("userId")==e.body.userId&&(window.location.href="/?msgtype=kickout"),M.createOneMessage("publicChat",0,U.serverdisplayname,C.escapeToHtml(e.body.userName)+U.kickOut,null,e,U)}),v.on("12",function(e){var o=e.body,n=y.replaceTpl(U.loveCardPrompt,{userName:'<span class="user-name-hook" data-userid="'+o.userId+'" data-name="'+C.escapeToHtml(o.userName)+'">'+C.escapeToHtml(o.userName)+"</span>",pic:'<img src="/static/room/widget/newroom/step1/mod-newroom-chat/img/icon_lovecard_83acdb0.png" >',num:o.num});M.createOneMessage("publicChat",0,null,n,null,e,U)}),v.on("luckyGiftCC35",function(e){e.toRoom==x("roomId")&&(L.send({type:"others",modId:"luckyGiftHit",multiple:e.body.multiple,goodprice:e.body.goodprice,times:e.body.times}),setTimeout(function(){M.createOneMessage("publicChat",0,null,'<span style="font-weight:bold"><span class="luckyname">'+C.escapeToHtml(e.body.userName)+" </span>"+U.pakai+'<img class="gift-img" width=20 height=20 src="'+e.body.icon+'" />'+U.dapat+'<span class = "multiple">'+e.body.multiple+"x</span>"+U.bonus+'<span class = "gold">'+e.body.goodprice*e.body.multiple+"</span>"+U.gold+'<span class = "count"> '+e.body.times+"</span><span>"+U.kali+"</span></span>",null,{}),e.body.userId==x("userId")&&M.createOneMessage("whisper",0,null,"<span>"+U.congratulations+'</span><span style="font-weight:bold"><span class="luckyname">'+C.escapeToHtml(e.body.userName)+" </span>"+U.pakai+'<img class="gift-img" width=20 height=20 src="'+e.body.icon+'" />'+U.dapat+'<span class = "multiple">'+e.body.multiple+"x</span>"+U.bonus+'<span class = "gold">'+e.body.goodprice*e.body.multiple+"</span>"+U.gold+'<span class = "count"> '+e.body.times+"</span><span>"+U.kali+"</span></span>",null,{})},1e3))}),v.on("micConnectCC26",function(){M.createOneMessage("publicChat",0,null,"<span>"+U.archorStartMic+"</span>",null,{})}),v.on("micConnectCC27",function(e){M.createOneMessage("publicChat",0,null,"<span>"+C.escapeToHtml(e.body.nickName)+U.archorConnectMic+"</span>",null,{}),console.log(e.body.nickName+"æ­£åœ¨å’Œä¸»æ’­è¿žéº¦")}),v.on("micConnectCC28",function(e){M.createOneMessage("publicChat",0,null,"<span>"+C.escapeToHtml(e.body.nickName)+U.archorCanceltMic+"</span>",null,{}),console.log(e.body.nickName+"å–æ¶ˆå’Œä¸»æ’­è¿žéº¦")}),v.on("micConnectCC29",function(){M.createOneMessage("publicChat",0,null,"<span>"+U.archorClosetMic+"</span>",null,{}),console.log("ä¸»æ’­å…³é—­æœ¬æ¬¡è¿žéº¦ï¼Œä¸‹æ¬¡å†æ¥çŽ©å„¿å§ï¼")}),v.on("micConnectCC32",function(e){console.log(e.body.nickName+"å–æ¶ˆå’Œä¸»æ’­è¿žéº¦"),M.createOneMessage("publicChat",0,null,"<span>"+C.escapeToHtml(e.body.nickName)+U.archorCanceltMic+"</span>",null,{})}),v.on("weekstar2NewroomRank",function(e){"revenuePlaces"in e.body&&M.createOneMessage("publicChat",0,null,'<span class="weekstar2-chat-wrap">'+U.weekstar2.sys+" "+U.weekstar2.firstrecieve+" "+e.body.giftName+" "+C.escapeToHtml(e.body.toNickName)+" "+U.weekstar2.up+" "+(parseInt(e.body.revenuePlaces,10)+1)+"</span>",null,{}),"consumePlaces"in e.body&&M.createOneMessage("publicChat",0,null,'<span class="weekstar2-chat-wrap">'+U.weekstar2.sys+" "+U.weekstar2.firstsend+" "+e.body.giftName+" "+C.escapeToHtml(e.body.fromNickName)+" "+U.weekstar2.up+" "+(parseInt(e.body.consumePlaces,10)+1)+"</span>",null,{})}),v.on("14",function(e){M.createOneMessage("publicChat",e.body.userId,C.escapeToHtml(e.body.userName),e.body.message,null,e,U)});var m=function(e){var o={time:0};return function(n){var a=+new Date;return n.body.userId!==o.userId||a-o.time>e?(o={userId:n.body.userId,time:a},!0):!1}}(3e3);v.on("15",function(e){var o=e.message;if(e.body.userId!=x("userId")&&e.body.userId!=x("NoLoginID")){if(!m(e))return!1;e.body.userName=C.escapeToHtml(e.body.userName);var n=parseInt(Math.random()*D.visitorEnterShowMaxDuration,10),a=parseInt((new Date).getTime()/1e3,10);if("0"==String(e.body.userId).substr(0,1)&&n>a-W)return;if(W=a,"0"==String(e.body.userId).substr(0,1))M.createOneMessage("publicChat",0,null,'<span class="gryColor"  data-userid="'+e.body.userId+'" data-name="'+e.body.userName+'">'+e.body.userName+"</span> "+U.enterroom,null,e,U);else{var t="";e.body.guildMedal&&e.body.guildId&&(t=A.getGuildIconTpl({guildId:e.body.guildId,guildName:e.body.guildMedal,guildLevel:e.body.guildLevel},e.body.roleInfo)),e.body.roleInfo&&(t+=A.getGuildRootIcon(e.body.roleInfo)),o='<span class="user-name-hook" data-userid="'+e.body.userId+'" data-name="'+e.body.userName+'">'+e.body.userName+"</span>"+t+" "+U.enterroom,e.body.isVipAndIcon&&(o=""+(e.body.isVipAndIcon?'<img class="badge enter-vip" src="'+e.body.isVipAndIcon+'"> ':"")+'<span class="vip-bg">'+U.vipEnterRoom+'<span class="user-name-hook'+(x("isMe")?" anchor":"")+(e.body.isVipAndIcon?" vip":"")+'" data-userid="'+e.body.userId+'" data-name="'+e.body.userName+'"'+(e.body.isVipAndIcon?' data-vip="'+e.body.isVipAndIcon+'"':"")+">"+e.body.userName+"</span> "+t+U.enterroom+"</span>"),o=g(e.body.userId)+o,e.body.car&&e.body.car.FlashPath&&(o+='<img class="car-img" alt="car" src="'+e.body.car.SmallLogo+'">'),M.createOneMessage("publicChat",0,null,o,null,e,U)}}}),v.on("26",function(e){var o=C.escapeToHtml(e.body.userName);M.createOneMessage("publicChat",0,null,'<span class="user-name-hook" data-userid="'+e.body.userId+'" data-name="'+o+'">'+o+"</span>"+U.smallfly+"<span>: </span>"+C.escapeToHtml(k.filterSensitiveWords(e.body.message)),null,e,U)}),v.on("27",function(e){if("weekFlag"in e.body){var o=e.body.weekFlag;switch(o){case"weekhost":return;case"monthhost":return;case"weekchest":return;case"monthchest":return;case"weeknineClock":return;case"monthnineClock":return}}var n=C.escapeToHtml(e.body.userName),a="",t="",s="";e.body.flyType&&"system"===y.trim(e.body.flyType)?(e.body.url&&(a='<a target="_blank" href="'+e.body.url+'">',t="</a>"),s='<span data-userid="0" data-name="'+n+'">'):(s='<span class="user-name-hook" data-userid="'+e.body.userId+'" data-name="'+n+'">',a='<a target="_blank" href="/liveroom/'+y.trim(e.body.RoomID)+'">',t="</a>"),M.createOneMessage("publicChat",0,null,s+n+"</span>"+U.bigfly+"<span>: </span>"+a+C.escapeToHtml(k.filterSensitiveWords(e.body.message)),+t,null,e,U)}),t()}};var $=(new Date).getTime()});
;define("room:widget/newroom/step1/mod-newroom-checkin/mod-newroom-checkin-calendar.js",function(t,e,a){var n=t("common:widget/ui/jquery/jquery.js"),s=function(t){this.conf=t,this.$mod=n(".calendar",".mod-newroom-checkin"),this.$year=n(".year",this.$mod),this.$month=n(".month",this.$mod),this.bindEvent(),this.requestCheckInfo()};s.DEFAULT=0,s.CHECKED=1,s.FUTURE=2,s.prototype={constructor:s,requestCheckInfo:function(){var t=this;n.getJSON("/hiapi/punch/punchInfo",{version:"1.0",country:getConf("country"),hostId:getConf("anchorId")}).done(function(e){0===e.errno&&e.data&&(t.setDate(e.data.year,e.data.month,e.data.date),t.createDom(e.data.dayList,t.getFirstDay()))})},getDays:function(){var t=[31,28,31,30,31,30,31,31,30,31,30,31];return(this.month%400===0||this.month%4===0)&&(t[1]=29),t[this.month]},getFirstDay:function(){var t=new Date(this.year,this.month,1);return t.getDay()},setDate:function(t,e,a){this.year=Number(t),this.month=Number(e)-1,this.day=Number(a),this.$year.text(this.year),this.$month.text(this.conf.monthList[this.month])},createDom:function(t,e){for(var a='<div class="cal-day #{firstDay}" data-day="#{day}" data-state="#{state}"><span class="cal-num #{today}" style="#{hide}">#{day}</span>#{smile}</div>',i="",o=1;o<=this.getDays();o++){var h="",d="";t[o-1]===s.CHECKED&&(h='<span class="smile"></span>',d="display: none"),i+=n.replaceTpl(a,{firstDay:1===o?"pull-"+e:"",today:this.day===o?"cal-today":"",day:o,smile:h,hide:d,state:t[o-1]||s.DEFAULT})}this.$mod.find(".cal-body").html(i)},setElemByState:function(t,e){e===s.DEFAULT?(n(t).find(".cal-num").show(),n(t).find(".smile").hide()):(n(t).find(".cal-num").hide(),n(t).find(".smile").show())},bindEvent:function(){var t=this;t.$mod.on("mouseenter",".cal-day",function(){n(this).data("state")===s.CHECKED&&t.setElemByState(this,s.DEFAULT)}).on("mouseleave",".cal-day",function(){n(this).data("state")===s.CHECKED&&t.setElemByState(this,s.CHECKED)})}},a.exports=s});
;define("room:widget/newroom/step1/mod-newroom-checkin/mod-newroom-checkin.js",function(t,n,o){var e=t("common:widget/ui/jquery/jquery.js");t("common:widget/ui/jquery/widget/jquery.ui.popup/jquery.ui.popup.js"),t("common:widget/ui/jquery/widget/jquery.ui.tip/jquery.ui.tip.js");var i=t("common:widget/public/public-arttemplate/public-arttemplate.js"),c=t("room:widget/newroom/step1/mod-newroom-checkin/mod-newroom-checkin-calendar.js");t("common:widget/ui/scrollable/scrollable.js");var a=function(t){this.conf=t,this.$mod=e(".checkin-tab",".mod-newroom-checkin"),this.$checkBtn=e(".check-btn",this.$mod),this.calendar=new c(t.calendar),this.init()};a.prototype={constructor:a,init:function(){this.requestCheckInfo(),this.bindEvent()},requestCheckInfo:function(){var t=this;e.getJSON("/hiapi/punch/page",{version:"1.0",country:getConf("country"),hostId:getConf("anchorId")}).done(function(n){0===n.errno&&n.data&&(e(".anchor-name",t.$mod)[0].innerHTML=n.data.hostInfo.name,e(".continue-day",t.$mod).text(n.data.userInfo.successive),e(".total-day",t.$mod).text(n.data.userInfo.accumulate),e(".fans-num",t.$mod).text(n.data.hostInfo.todayNum),e(".point-num",t.$mod).text(n.data.hostInfo.score),null===n.data.hostInfo.rank&&(n.data.hostInfo.rank="?"),e(".rank-num",t.$mod).text(n.data.hostInfo.rank),e(".score-num",t.$mod).text(n.data.userInfo.nowDelta),n.data.userInfo.isPunch&&e(".check-btn",t.$mod).addClass("has-checked").text(t.conf.punchAgain+" +"+n.data.userInfo.nextDelta).data("next-delta",n.data.userInfo.nextDelta))})},bindEvent:function(){var t=this;t.$checkBtn.on("click",function(){t.handleCheckClick(this)})},handleCheckClick:function(t){var n=this,o=e(t);o.hasClass("has-checked")||(o.addClass("has-checked"),e.getJSON("/hiapi/punch",{version:"1.0",country:getConf("country"),hostId:getConf("anchorId")}).done(function(t){if(0!==t.errno)return void o.removeClass("has-checked");var i=o.next();i.addClass("actived"),setTimeout(function(){i.removeClass("actived")},2e3),n.requestCheckInfo(),n.calendar.requestCheckInfo(),e(window).trigger("mod-newroom-newanchorinfo-checkin.update"),e(document).trigger("fansRankUpdate"),UT.send({type:"click",modId:"checkin",sort:"checkin-btn"})}).fail(function(){o.removeClass("has-checked")}))},show:function(t){"function"==typeof t&&t()}};var r=function(t){this.conf=t,this.$mod=e(".rank-tab",".mod-newroom-checkin"),this.$cNum=e(".current-anchor .r-num",this.$mod),this.$csb=e(".current-anchor .r-sb",this.$mod),this.$cAnchor=e(".current-anchor .r-anchor",this.$mod),this.$cName=e(".current-anchor .r-name",this.$mod),e(".rank-list-inner",this.$mod).scrollable()};r.prototype={constructor:r,bindEvent:function(){},requestRankList:function(){var t=this;return e.getJSON("/hiapi/punch/getHostRankList",{version:"1.0",country:getConf("country"),start:0,count:50}).done(function(n){if(0===n.errno&&n.data){var o=i("mod-newroom-checkin-rankitem",n);e(".rank-list-inner",t.$mod).html(o)}})},requestCurrent:function(){var t=this;return e.getJSON("/hiapi/punch/hostRank",{version:"1.0",country:getConf("country"),hostId:getConf("anchorId")}).done(function(n){0===n.errno&&n.data&&(null===n.data.rank&&(n.data.rank="?"),t.$cNum.text(n.data.rank),t.$cName[0].innerHTML=n.data.name,t.$csb.text(n.data.score),t.$cAnchor.css("background-image","url("+n.data.userIcon+")"))})},show:function(t){e.when(this.requestRankList(),this.requestCurrent()).done(function(){"function"==typeof t&&t()})}};var s=function(t){this.conf=t,this.$mod=e(".mod-newroom-checkin"),this.$titles=e(".c-title",this.$mod),this.$tabs=e(".c-tab",this.$mod),this.$popup=this.$mod.popup(),this.$rules=e(i("mod-newroom-checkin-rule-list",this.conf)),e(".rule-group",this.$mod).tip({backgroundColor:"#fff",borderColor:"#ccc",className:"checkin-rule-tip",content:this.$rules,dir:"bottom",customLocation:!0}),this.init()};s.prototype={constructor:s,init:function(){this.bindEvent(),this.tabs=[],this.tabs[0]=new a(this.conf),this.tabs[1]=new r(this.conf),this.switchTab(0)},bindEvent:function(){var t=this;e(window).on("mod-newroom-checkin.show",function(){t.$popup.show()}).on("mod-newroom-checkin.hide",function(){t.$popup.hide()}),this.$titles.on("click",function(){t.switchTab(e(this).index())})},switchTab:function(t){var n=this;n.tabs[t].show(function(){n.$titles.removeClass("active").eq(t).addClass("active"),n.$tabs.hide().eq(t).show()})}},o.exports=function(t){new s(t)}});
;define("room:widget/newroom/step1/mod-newroom-christmas/js/scoreLevel.js",function(e,t,r){function i(e){null!==e&&(this.currentScore=e.score||0,this.$levelScroll=e.$levelScroll,this.wholeWidth=e.$levelScroll.parent().outerWidth(),this.levelSet=e.levelSet,this.setScore(this.currentScore))}function n(e,t,r,i){if(0>e)return-1;if(i>=r){if(t[r].start<=e&&t[r].end>=e)return r;if(t[r].start<=e&&t[r].end>=e)return i;var l=Math.ceil((i+r)/2);return t[l].start<=e&&t[l].end>=e?l:t[l].start>e?n(e,t,r,l-1):n(e,t,l+1,i)}return t.length}{var l;e("common:widget/ui/jquery/jquery.js")}i.prototype={currentScore:0,currentLevel:0,proportion:0,levelSet:[],getCurrentScore:function(){return this.currentScore},getCurrentLevel:function(){return this.currentLevel},setScore:function(e,t,r){return e===this.currentScore?!1:(e>this.currentScore&&!t?this.addScore(e,r):this.changeScore(e,r),!0)},addScore:function(e,t){for(var r=!1,i=this.currentLevel;i<this.levelSet.length;i++){if(e>=this.levelSet[i].start&&e<=this.levelSet[i].end){this.proportion=(e-this.levelSet[i].start)/(this.levelSet[i].end-this.levelSet[i].start+1),this.doAnimate("addScore",this.proportion),this.currentLevel=i;break}this.proportion=(this.levelSet[i].end-this.currentScore)/(this.levelSet[i].end-this.levelSet[i].start+1),this.currentScore=this.levelSet[i].end,this.doAnimate("upgrade",this.proportion,i),r=!0}e>this.levelSet[this.levelSet.length-1].end&&(this.proportion=1,this.currentLevel=this.levelSet.length),this.currentScore=e,t&&t(r)},changeScore:function(e,t){var r=n(e,this.levelSet,0,this.levelSet.length-1);-1===r?(this.currentLevel=0,this.proportion=0):r===this.levelSet.length?(this.currentLevel=r,this.proportion=1):(this.currentLevel=r,this.proportion=(e-this.levelSet[this.currentLevel].start)/(this.levelSet[this.currentLevel].end-this.levelSet[this.currentLevel].start+1)),this.$levelScroll.css({width:this.proportion*this.wholeWidth}),this.currentScore=e,t&&t(!1)},doAnimate:function(e,t,r){var i=this;"upgrade"===e?this.$levelScroll.animate({width:this.wholeWidth},1e3*t,function(){r!==i.levelSet.length-1?(i.$levelScroll.css({width:0}),console.info("upgrade to level-"+(r+1))):console.info("upgrade to final!  full level-"+(i.levelSet.length-1))}):this.$levelScroll.animate({width:t*this.wholeWidth},1e3*t,function(){})}},r.exports={init:function(e){e&&(l=new i(e))},getCurrentScore:function(){return l?l.getCurrentScore():void 0},getCurrentLevel:function(){return l?l.getCurrentLevel():void 0},setScore:function(e,t,r){return l?l.setScore(e,t,r):void 0}}});
;define("room:widget/newroom/step1/mod-newroom-christmas/mod-newroom-christmas.js",function(e,t,i){function n(e){return 0===e?'<div class="t'+e+'"><i class="num no-rank-yet"></i></div>':4>e&&e>=1?'<div class="t'+e+'"><i class="num color'+e+'"></i></div>':8===e?'<div class="star"><i class="num color'+e+'"></i></div>':e%10===8&&50>e?h.map(String(e).split(""),function(e){return'<i class="num color'+e+'"></i>'}).join(""):h.map(String(e).split(""),function(e){return'<i class="num number'+e+'"></i>'}).join("")}function o(){k.on("click",".close-mark",function(){x.hide(),N.hide(),D=!1}),k.on("click","#christmas-level-container",function(){x.show(),N.show(),D=!0}),k.on("click",".need-login",function(){C.require("mod-public-login",function(e){e.showDialog("multiplayerroom-header")})}),k.on("mouseenter mouseleave","#christmas-container",r);for(var e=0;6>e;e++){var t=x.find(".christmas-gift-tip.gift-position"+e);A["item"+e]=t,B[e]=k.find(".level-num"+e+" .gift-default")}k.on("mouseenter",".level-gift",function(){var e=+h(this).data("value");e<y.getCurrentLevel()?(A["item"+e].removeClass("can-not-get"),A["item"+e].addClass("can-get")):(A["item"+e].removeClass("can-get"),A["item"+e].addClass("can-not-get")),A["item"+e].show()}),k.on("mouseleave",".level-gift",function(){A["item"+h(this).data("value")].hide()}),k.on("mouseenter",".christmas-gift-tip",function(){h(this).show()}),k.on("mouseleave",".christmas-gift-tip",function(){h(this).hide()});var i=!1;h(document).on("click",".newroom-christmas-gift-btn",function(){if(!i){i=!0;var e=+h(this).data("level");h.ajax({url:"/activity/Christmas/gift",data:{level:e+1},type:"POST"}).done(function(t){t&&t.message&&"0"===t.message.errNum?+t.data.isRecord?h(document).trigger("popupForm",["form-tpl",{isRecord:+t.data.isRecord,record:{type:t.data.recordType,indx:e}}]):h(document).trigger("popupForm",["alert-tpl",{isRecord:+t.data.isRecord,record:{indx:e}}]):t&&t.message&&"400"===t.message.errNum?h(document).trigger("popupForm",["warning-tpl",{isRecord:0,record:{title:g.warning,text:g.notInActivityPeriod}}]):t&&t.message&&"401"===t.message.errNum?C.require("mod-public-login",function(e){e.showDialog("multiplayerroom-header")}):t&&t.message&&"403"===t.message.errNum?h(document).trigger("popupForm",["warning-tpl",{isRecord:0,record:{title:g.warning,text:g.lackScore}}]):console.info("Error: /activity/Christmas/gift")}).always(function(){i=!1})}})}function r(e){var t=k.find(".gift-rank"),i=e.type;G&&clearTimeout(G),t.removeClass("hide"),"mouseenter"===i?c():G=setTimeout(function(){t.addClass("hide")},201),setTimeout(function(){x[0].className="map-rank-"+i},0)}function s(e,t,i){var n=new h.Deferred;return h.ajax({url:e,data:t,type:i}).done(function(t){t&&t.message&&("0"===t.message.errNum||"400"===t.message.errNum)?n.resolve(t):console.info("Error: "+e)}).fail(function(){n.reject()}).always(),n.promise()}function a(){if(b("isLogined")){var e=s("/activity/Christmas/user",null,"GET");h.when(e).done(function(e){d(e.data.credit||0,!0)})}}function c(){if(E!==!0){E=!0;var e=s("/activity/Christmas/receiveRank",{limit:10},"GET");h.when(e).done(function(e){var t=s("/activity/Christmas/anchor",{userID:b("anchorId")},"GET");h.when(t).done(function(t){_(e),m(),L.find(".anchor-socre").html(t.data.credit||0),L.find(".anchor-socre").attr("title",t.data.credit||0);+t.data.rank||0;L.find(".rank-num").html(n(+t.data.rank||0))})}),setTimeout(function(){E=!1},1e4)}}function l(e){e&&(M.play(),D&&(j.show(),setTimeout(function(){j.hide()},3e3)))}function u(){w.on("christmasMessage",function(e){+e.body.userID===+b("userId")&&(y.getCurrentScore()<+e.body.credit&&D&&P(+e.body.credit-y.getCurrentScore()),y.getCurrentScore()>+e.body.credit&&(window.moduleMaster.require("mod-newroom-backpack",function(e){e.MainCon.requestItemList&&e.MainCon.requestItemList("1"),e.MainCon.requestItemList&&e.MainCon.requestItemList("2")}),window.moduleMaster.require("mod-newroom-lovecard",function(e){e(!0)})),d(+e.body.credit,!1,l))})}function d(e,t,i){var n,o,r=y.getCurrentLevel();if(y.setScore(e,t,i)){if(T.html(e),T.attr("title",e),o=y.getCurrentLevel(),r===o)return;if(S.attr("class","level"+o),n=F(o),I.css("height",n.top+"px"),0===o||6===o?q.hide():(q.css({top:n.top-17+"px",left:n.left+"px"}),q.show()),o>r)for(var s=r;o>s;s++)B[s].addClass("gift-hide");else for(var s=o;r>s;s++)B[s].removeClass("gift-hide")}}function m(){p?(p.updateState(),p.goTo({x:0,y:0})):R.find("li").size()>8&&(p=R.scrollable({autoHide:!0}))}function f(e){var t={score:0,$levelScroll:k.find(".level-experice"),levelSet:e};y.init(t),a(),u(),o(),window.swfobject.embedSWF("/static/room/widget/newroom/step1/mod-newroom-christmas/swf/gift_map_bg_73f603c.swf","flashTree","159","236","9.0.0","",0,{wmode:"transparent"},0,function(e){return e.success?void 0:void k.find("#flashTree").addClass("no-fash-bg")})}var p,g,h=e("common:widget/ui/jquery/jquery.js"),v=e("common:widget/public/public-arttemplate/template.js"),w=(e("common:widget/ui/scrollable/scrollable.js"),e("common:widget/public/public-socket/public-socket.unpack.js")),y=e("room:widget/newroom/step1/mod-newroom-christmas/js/scoreLevel.js"),C=window.moduleMaster,b=window.getConf,k=h(".mod-newroom-christmas"),j=k.find(".level-up-popup"),x=k.find("#christmas-container"),T=k.find(".current-score"),I=k.find(".experience-bg"),S=k.find("#christmas-level-container"),q=k.find(".light-point"),L=k.find(".host-star-detail"),R=k.find(".rank-list"),M=(k.find(".score-plus"),document.getElementById("myAudioLevelUp")),N=k.find(".close-tag"),E=!1,D=!0,F=function(){var e=[{top:500,left:0},{top:444,left:162},{top:400,left:149},{top:348,left:144},{top:294,left:152},{top:242,left:126},{top:0,left:0}];return function(t){return e[t]}}();v.helper("getRankUserIcon",function(e){return e||window.getConf("defaultIcon")}),v.helper("changeToIndex",function(e){return n(e)});var G,_=function(){var e=document.getElementById("mod-newroom-christmas-rank").text,t=v.compile(e);return function(e){if("0"===e.message.errNum){var i=t(e);R.html(i)}}}(),A={},B=[],P=function(){var e='<div class="score-plus"><span>###</span></div>',t=k.find(".christmas-tree");return function(i){var n=e.replace("###","+"+i);h(n).appendTo(t).animate({top:-80,opacity:0},5e3,function(){h(this).remove()})}}();i.exports={run:function(e,t){g=t,f(e)}}});
;define("room:widget/newroom/step1/mod-newroom-experience/experience.async.js",function(e,t,n){function i(e,t,n,i){this.$mod=e,this.userId=t,this.userType=n,this.opt=i}var r=e("common:widget/ui/jquery/jquery.js"),o={initPage:function(){var e=this,t=e.userId,n=e.userType;r.ajax({type:"get",url:"/anchor?f=getUserLevel",dataType:"json",data:{userId:t,type:n}}).done(function(t){e.renderHeader(t)})},renderHeader:function(e){var t,n=this,i=n.$mod.find(".info-level-pre"),o=n.$mod.find(".info-level-next");i.attr("title",e.levelTitle),i.attr("src",e.levelIcon),t=e.nextLevelIcon?parseInt(e.levelHighScore,10)<parseInt(e.score,10)?0:parseInt(e.levelHighScore,10)-parseInt(e.score,10):e.score,this.$mod.find(".level-need").text(n.opt.need+t+" "+n.opt.golds),o.attr("title",e.nextLevelTitle),o.attr("src",e.nextLevelIcon);var d=0,s=parseInt(n.$mod.find(".experience-wrap").css("width"),10);d=parseInt(e.score,10)>parseInt(e.levelHighScore,10)?s:e.score/e.levelHighScore*parseInt(n.$mod.find(".experience-wrap").css("width"),10),r(document).on("mouseenter",".level-link",function(){r(this).find(".level-need").show()}),r(document).on("mouseleave",".level-link",function(){r(this).find(".level-need").hide()}),n.$mod.find(".experience").animate({width:Math.ceil(d)},300)},addExperience:function(e){var t=this,n=this.$mod,i=e.body;t.showadd(i,n),i.isUp?t.updateLv(i):t.updateScore(i)},updateScore:function(e){var t=this.$mod,n=parseInt(t.find(".experience-wrap").css("width"),10);e.score<e.levelHighScore&&(n*=e.score/e.levelHighScore),t.find(".experience").animate({width:n},300)},updateLv:function(e){var t=this,n=t.$mod;n.find(".info-level-pre").attr({src:e.levelIcon,title:e.levelTitle}),n.find(".info-level-next").attr({src:e.nextLevelIcon,title:e.nextLevelTitle}),n.find(".experience").animate({width:n.find(".experience-wrap").css("width")},300,function(){n.find(".experience").css("width",0),t.updateScore(e)})},showadd:function(e,t){var n,i=t,o=r("<div>+"+e.updateScore+"</div>");r("body").append(o),o.css({top:i.find(".experience-wrap").offset().top-15,left:i.find(".experience-wrap").offset().left+parseInt(i.find(".experience-wrap").css("width"),10)/2,position:"absolute",color:"#fd6298",zIndex:100}),o.animate({top:"-=20",opacity:0},1e3,function(){r(this).remove()});var d=this;n=e.nextLevelIcon?parseInt(e.levelHighScore,10)<parseInt(e.score,10)?0:parseInt(e.levelHighScore,10)-parseInt(e.score,10):e.score,i.find(".level-need").text(d.opt.need+n+d.opt.golds)}};r.extend(i.prototype,o),n.exports=i});
;define("room:widget/newroom/step1/mod-newroom-game/mod-newroom-game.js",function(o,e,m){function n(o){for(var e="",m=o.info,n=0;n<m.length;n++)!function(o){if(console.log(m[o].url.length),m[o].url.length>5)var n='<a class="game-wrap" target="_blank" href="'+m[o].url+'" >';else var n='<a class="game-wrap" target="_blank" href="/h5game/index?gameid='+m[o].GameId+"&roomid="+getConf("roomId")+'" >';e+=n+'<img class="game-img" title="'+m[o].Name+'" src="'+m[o].Cover+'" /><div class="game-name" >'+m[o].Name+"</div></a>"}(n);r("#gameWrapIn").html(r(e))}function i(){t.on(function(o){l.find(".resize-fix-hook").css({height:o-151})}),l.on("tab",function(){r.ajax({url:"/h5game/listgame",type:"GET"}).done(function(o){n(o),console.log(o)})})}{var r=o("common:widget/ui/jquery/jquery.js"),a=(o("common:widget/public/mod-public-login/mod-public-login.js"),o("common:widget/ui/jquery/widget/jquery.ui.scrollable/jquery.ui.scrollable.js"),o("common:widget/public/mod-public-property/mod-public-property.js"),o("common:widget/public/public-tools/public-tools.js"),o("room:widget/newroom/step1/mod-newroom-uitab/mod-newroom-uitab.js")),t=o("room:widget/newroom/newroom.js"),l=r(".mod-newroom-game");getConf("anchorId"),getConf("roomId")}m.exports={run:function(o){i(),o.isShow&&a.setMessageNum("game",o.number)}}});
;define("room:widget/newroom/step1/mod-newroom-gift/js/flashPlayer.js",function(){window.baidu=window.baidu||{version:"1-0-0",emptyFn:function(){}},baidu.isString=function(e){return"object"==typeof e&&e&&e.constructor==String||"string"==typeof e},baidu.swf=baidu.swf||{},baidu.swf.getMovie=function(e){return document[e]||window[e]},baidu.swf.getVersion=function(){var e=navigator;if(e.plugins&&e.mimeTypes.length){var a=e.plugins["Shockwave Flash"];if(a&&a.description)return a.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s)+r/,".")+".0"}else if(window.ActiveXObject&&!window.opera)for(var i=10;i>=2;i--)try{var s=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+i);if(s)return i+".0.0"}catch(n){}},baidu.swf.createHTML=function(e){e=e||{};var a,i,s=baidu.swf.getVersion(),n=1,r=e.ver||"6.0.0";if(s){s=s.split("."),r=r.split(".");for(var o=0;3>o&&(a=parseInt(s[o],10),i=parseInt(r[o],10),!(a>i));o++)if(i>a){n=0;break}}else n=0;if(!n)return"";var o,t,l,c,d=e.vars,u=["classid","codebase","id","width","height","align"];if(e.align=e.align||"middle",e.classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000",e.codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0",e.movie=e.url||"",delete e.vars,delete e.url,baidu.isString(d))e.flashvars=d;else{var f=[];for(t in d)c=d[t],c&&f.push(t+"="+encodeURIComponent(c));e.flashvars=f.join("&")}var w=["<object "];for(o=0,l=u.length;l>o;o++)c=u[o],w.push(" ",c,'="',e[c],'"');w.push(">");var p={wmode:1,scale:1,quality:1,play:1,loop:1,menu:1,salign:1,bgcolor:1,base:1,allowscriptaccess:1,allownetworking:1,allowfullscreen:1,seamlesstabbing:1,devicefont:1,swliveconnect:1,flashvars:1,movie:1};for(t in e)c=e[t],p[t]&&c&&w.push('<param name="'+t+'" value="'+c+'" />');e.src=e.movie,e.name=e.id,delete e.id,delete e.movie,delete e.classid,delete e.codebase,e.type="application/x-shockwave-flash",e.pluginspage="http://www.macromedia.com/go/getflashplayer",w.push("<embed");for(t in e)c=e[t],c&&w.push(" ",t,'="',c,'"');return w.push("></embed></object>"),w.join("")},baidu.swf.create=function(e,a){e=e||{};var i=baidu.swf.createHTML(e),s=!0;return a&&baidu.isString(a)&&(a=document.getElementById(a)),i.length<=0&&(i=e.errorMessage||"",s=!1),a?a.innerHTML=i:document.write(i),s}});
;define("room:widget/newroom/step1/mod-newroom-gift/js/formatString.js",function(){!function(){this.REGX_HTML_ENCODE=/"|&|'|<|>|[\x00-\x20]|[\x7F-\xFF]|[\u0100-\u2700]/g,this.REGX_HTML_DECODE=/&\w+;|&#(\d+);/g,this.REGX_TRIM=/(^\s*)|(\s*$)/g,this.HTML_DECODE={"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" ","&quot;":'"',"&copy;":"","&nbsp;":"&nbsp;","&iexcl;":"Â¡","&cent;":"Â¢","&pound;":"Â£","&curren;":"Â¤","&yen;":"Â¥","&brvbar;":"Â¦","&sect;":"Â§","&uml;":"Â¨","&copy;":"Â©","&ordf;":"Âª","&laquo;":"Â«","&not;":"Â¬","&shy;":"Â­","&reg;":"Â®","&macr;":"Â¯","&deg;":"Â°","&plusmn;":"Â±","&sup2;":"Â²","&sup3;":"Â³","&acute;":"Â´","&micro;":"Âµ","&para;":"Â¶","&middot;":"Â·","&cedil;":"Â¸","&sup1;":"Â¹","&ordm;":"Âº","&raquo;":"Â»","&frac14;":"Â¼","&frac12;":"Â½","&frac34;":"Â¾","&iquest;":"Â¿","&Agrave;":"Ã€","&Aacute;":"Ã","&Acirc;":"Ã‚","&Atilde;":"Ãƒ","&Auml;":"Ã„","&Aring;":"Ã…","&AElig;":"Ã†","&Ccedil;":"Ã‡","&Egrave;":"Ãˆ","&Eacute;":"Ã‰","&Ecirc;":"ÃŠ","&Euml;":"Ã‹","&Igrave;":"ÃŒ","&Iacute;":"Ã","&Icirc;":"ÃŽ","&Iuml;":"Ã","&ETH;":"Ã","&Ntilde;":"Ã‘","&Ograve;":"Ã’","&Oacute;":"Ã“","&Ocirc;":"Ã”","&Otilde;":"Ã•","&Ouml;":"Ã–","&times;":"Ã—","&Oslash;":"Ã˜","&Ugrave;":"Ã™","&Uacute;":"Ãš","&Ucirc;":"Ã›","&Uuml;":"Ãœ","&Yacute;":"Ã","&THORN;":"Ãž","&szlig;":"ÃŸ","&agrave;":"Ã ","&aacute;":"Ã¡","&acirc;":"Ã¢","&atilde;":"Ã£","&auml;":"Ã¤","&aring;":"Ã¥","&aelig;":"Ã¦","&ccedil;":"Ã§","&egrave;":"Ã¨","&eacute;":"Ã©","&ecirc;":"Ãª","&euml;":"Ã«","&igrave;":"Ã¬","&iacute;":"Ã­","&icirc;":"Ã®","&iuml;":"Ã¯","&eth;":"Ã°","&ntilde;":"Ã±","&ograve;":"Ã²","&oacute;":"Ã³","&ocirc;":"Ã´","&otilde;":"Ãµ","&ouml;":"Ã¶","&divide;":"Ã·","&oslash;":"Ã¸","&ugrave;":"Ã¹","&uacute;":"Ãº","&ucirc;":"Ã»","&uuml;":"Ã¼","&yacute;":"Ã½","&thorn;":"Ã¾","&yuml;":"Ã¿","&fnof;":"Æ’","&Alpha;":"Î‘","&Beta;":"Î’","&Gamma;":"Î“","&Delta;":"Î”","&Epsilon;":"Î•","&Zeta;":"Î–","&Eta;":"Î—","&Theta;":"Î˜","&Iota;":"Î™","&Kappa;":"Îš","&Lambda;":"Î›","&Mu;":"Îœ","&Nu;":"Î","&Xi;":"Îž","&Omicron;":"ÎŸ","&Pi;":"Î ","&Rho;":"Î¡","&Sigma;":"Î£","&Tau;":"Î¤","&Upsilon;":"Î¥","&Phi;":"Î¦","&Chi;":"Î§","&Psi;":"Î¨","&Omega;":"Î©","&alpha;":"Î±","&beta;":"Î²","&gamma;":"Î³","&delta;":"Î´","&epsilon;":"Îµ","&zeta;":"Î¶","&eta;":"Î·","&theta;":"Î¸","&iota;":"Î¹","&kappa;":"Îº","&lambda;":"Î»","&mu;":"Î¼","&nu;":"Î½","&xi;":"Î¾","&omicron;":"Î¿","&pi;":"Ï€","&rho;":"Ï","&sigmaf;":"Ï‚","&sigma;":"Ïƒ","&tau;":"Ï„","&upsilon;":"Ï…","&phi;":"Ï†","&chi;":"Ï‡","&psi;":"Ïˆ","&omega;":"Ï‰","&thetasym;":"?","&upsih;":"?","&piv;":"?","&bull;":"â€¢","&hellip;":"â€¦","&prime;":"â€²","&Prime;":"â€³","&oline;":"â€¾","&frasl;":"â„","&weierp;":"â„˜","&image;":"â„‘","&real;":"â„œ","&trade;":"â„¢","&alefsym;":"â„µ","&larr;":"â†","&uarr;":"â†‘","&rarr;":"â†’","&darr;":"â†“","&harr;":"â†”","&crarr;":"â†µ","&lArr;":"â‡","&uArr;":"â‡‘","&rArr;":"â‡’","&dArr;":"â‡“","&hArr;":"â‡”","&forall;":"âˆ€","&part;":"âˆ‚","&exist;":"âˆƒ","&empty;":"âˆ…","&nabla;":"âˆ‡","&isin;":"âˆˆ","&notin;":"âˆ‰","&ni;":"âˆ‹","&prod;":"âˆ","&sum;":"âˆ‘","&minus;":"âˆ’","&lowast;":"âˆ—","&radic;":"âˆš","&prop;":"âˆ","&infin;":"âˆž","&ang;":"âˆ ","&and;":"âˆ§","&or;":"âˆ¨","&cap;":"âˆ©","&cup;":"âˆª","&int;":"âˆ«","&there4;":"âˆ´","&sim;":"âˆ¼","&cong;":"âˆ","&asymp;":"â‰ˆ","&ne;":"â‰ ","&equiv;":"â‰¡","&le;":"â‰¤","&ge;":"â‰¥","&sub;":"âŠ‚","&sup;":"âŠƒ","&nsub;":"âŠ„","&sube;":"âŠ†","&supe;":"âŠ‡","&oplus;":"âŠ•","&otimes;":"âŠ—","&perp;":"âŠ¥","&sdot;":"â‹…","&lceil;":"?","&rceil;":"?","&lfloor;":"?","&rfloor;":"?","&lang;":"?","&rang;":"?","&loz;":"â—Š","&spades;":"â™ ","&clubs;":"â™£","&hearts;":"â™¥","&diams;":"â™¦","&quot;":'"',"&OElig;":"Å’","&oelig;":"Å“","&Scaron;":"Å ","&scaron;":"Å¡","&Yuml;":"Å¸","&circ;":"Ë†","&tilde;":"Ëœ","&ensp;":"â€‚","&emsp;":"â€ƒ","&thinsp;":"â€‰","&zwnj;":"â€Œ","&zwj;":"â€","&lrm;":"â€Ž","&rlm;":"â€","&ndash;":"â€“","&mdash;":"â€”","&lsquo;":"â€˜","&rsquo;":"â€™","&sbquo;":"â€š","&ldquo;":"â€œ","&rdquo;":"â€","&bdquo;":"â€ž","&dagger;":"â€ ","&Dagger;":"â€¡","&permil;":"â€°","&lsaquo;":"â€¹","&rsaquo;":"â€º","&euro;":"â‚¬"},this.encodeHtml=function(r){return r=void 0!=r?r:this.toString(),"string"!=typeof r?r:r.replace(this.REGX_HTML_ENCODE,function(r){var a=r.charCodeAt(0),i=["&#"];return a=32==a?160:a,i.push(a),i.push(";"),i.join("")})},this.decodeHtml=function(r){var a=this.HTML_DECODE;return r=void 0!=r?r:this.toString(),"string"!=typeof r?r:r.replace(this.REGX_HTML_DECODE,function(r,i){var e=a[r];return void 0==e&&(e=isNaN(i)?r:String.fromCharCode(160==i?32:i)),e})},this.hashCode=function(){var r,a=this.__hash__;if(void 0==a||0==a){a=0;for(var i=0,e=this.length;e>i;i++)r=this.charCodeAt(i),a=31*a+r,a&=a;a=2147483647&a}return this.__hash__=a,this.__hash__}}.call(String.prototype)});
;define("room:widget/newroom/step1/mod-newroom-gift/js/giftContactList.js",function(t,i,n){function e(t,i,n){i||(i=5),this.textMap=n,this.num=i,this.type=t,this.current={id:0,name:""},this.list=[],this.$container=s("#contactList"+this.type),this.bindEvent()}function o(t,i){for(var n=0,e=i.length;e>n;n++)if(t==i[n].userId)return!0;return!1}var s=t("common:widget/ui/jquery/jquery.js"),c=t("common:widget/public/public-tools/public-tools.js"),a=t("common:widget/public/public-bubble/public-bubble.js");e.prototype.add=function(t,i,n){i=c.escapeToHtml(i);o(t,this.list)||0===t||t===getConf("anchorId")||(this.list.unshift({userId:t,name:i,vipSrc:n}),this.list.length>this.num&&(delete this.list[this.list.length-1],this.list.length=this.num)),this.current.id=t,this.current.name=i,this.current.vipSrc=n,s(".current-contact-user",this.$container).html(i)},e.prototype.initList=function(){var t="";"public"==this.type&&(t+='<li class="toe" data-userid="0" data-name="'+this.textMap.publicChatToAll+'">'+this.textMap.publicChatToAll+"</li>");for(var i=this.list,n=0,e=i.length;e>n;n++)t+='<li class="toe" data-userid="'+i[n].userId+'" data-name="'+i[n].name+'"'+(i[n].vipSrc?' data-vip="'+i[n].vipSrc+'"':"")+">"+i[n].name+"</li>";if(t+='<li class="toe" data-userid="'+getConf("anchorId")+'" data-name="'+c.escapeToHtml(getConf("anchorName"))+'">'+c.escapeToHtml(getConf("anchorName"))+"</li>",s("ul",this.$container).html(t),i[0]&&!this.current.id){{var o=(this.current.id=i[0].userId,this.current.name=i[0].userName);this.current.vipSrc=i[0].vipSrc}s(".current-contact-user",this.$container).html(o)}},e.prototype.bindEvent=function(){function t(){n.initList(),s(".contact-content-list",n.$container).show(),s(".contact-arrow em",n.$container).removeClass("contact-up").addClass("contact-down")}function i(){s(".contact-content-list",n.$container).hide(),s(".contact-arrow em",n.$container).removeClass("contact-down").addClass("contact-up")}var n=this,e=new a(t,i);this.$container.on("click",".select",function(){e.toggle()}),s(".contact-content-list",n.$container).on("mouseenter","li",function(){s(this).addClass("addto")}).on("mouseleave","li",function(){s(this).removeClass("addto")}).on("click","li",function(){var t=c.escapeToHtml(s(this).data("name"));s(".current-contact-user",n.$container).html(t),n.add(s(this).data("userid"),t,s(this).data("vipSrc"))})},n.exports=e});
;define("room:widget/newroom/step1/mod-newroom-gift/js/giftEffect.js",function(e,o,t){function n(){d("Pie").setNum(300),t.exports.config.isFlashReady0=!0}function i(e){p++,t.exports.config["isFlashReady"+e]=!0}function a(){var e=u;setTimeout(function(){UT.send({type:"others",modId:"cdnLog",totalSwfCount:e,cdnErrorSwfCount:e-p})},4e4)}function s(){c("#swfContainer_color").addClass("fadehide"),w=!1,f()}function r(e){c("#swfContainer_"+e).addClass("fadehide"),w=!1,f()}function f(e){return e&&h.push(e),!w&&0!==h.length&&t.exports.config["isFlashReady"+h[0].id]?(w=!0,void h.shift().callBack()):void(w||0===h.length||t.exports.config["isFlashReady"+h[0].id]||(clearTimeout(m),m=setTimeout(function(){f()},1e3)))}function d(e){return document[e]||window[e]}var c=e("common:widget/ui/jquery/jquery.js");e("room:widget/newroom/step1/mod-newroom-gift/js/flashPlayer.js");var l=[],u=0,w=!1,h=[],m=null;o.init=function(e){l=e.flashStatus,g();for(var t in l)u++,o.config["isFlashReady"+t]=!1};var g=function(){baidu.swf.create({id:"Pie",width:"1300",height:"631",ver:"9.0.0",errorMessage:"update FP",url:"/static/room/widget/newroom/step1/mod-newroom-gift/js/giftEffect_eb73b1c.swf",wmode:"transparent",vars:{}},"swfContainer_color")};o.config={currentAnimateId:0,isFlashReady0:!1};var p=0;window.initComplete=n,window.initCompleteFlash=i,a(),o.doFlashGiftEffect=function(e,o,n,i){if(!t.exports.config.isFlashReady0)return void console.log("the flash is not ready");var a=null;a=0===e?{type:e,animateId:t.exports.config.currentAnimateId,iconUrl:o,dataUrl:n}:{type:e,animateId:t.exports.config.currentAnimateId,iconUrl:o,num:i},f({id:0,callBack:function(){c("#swfContainer_color").removeClass("fadehide"),d("Pie").setData(a)}})},o.doSpecialFlashGiftEffect=function(e,o){t.exports.config["isFlashReady"+e]||0!==c("#swfContainer_"+e).children().size()||baidu.swf.create({id:"s"+e,width:"100%",height:"100%",ver:"9.0.0",errorMessage:"update FP",url:getConf("resourceCdn")+"/resource/"+getConf("country")+"/swf/"+e+".swf?t="+l[e].reflash,wmode:"transparent",allowscriptaccess:"always",vars:{}},"swfContainer_"+e),f({id:e,callBack:function(){c("#swfContainer_"+e).removeClass("fadehide"),baidu.swf.getMovie("s"+e).setData(o)}})},window.showProductInFlash=s,window.flashCallBack=r});
;define("room:widget/newroom/step1/mod-newroom-gift/mod-newroom-gift.js",function(i,t,e){function o(){m(".giftNavList").on("click","li",function(){$that=m(this);var i=$that.index();m(".giftNavList li").removeClass("current"),$that.addClass("current"),m(".giftsSection").hide();var t=$that.data("id");UT.send({type:"click",sort:t,modId:"swichGift",value:t+"giftsVal"}),m("#giftList"+t).show(),s(i)}),n(),a(),d(),window.ccroomPerformance.giftEndTime=(new Date).getTime()-j("pageStartTime")}function a(){C.on("mouseenter","li",function(i){var t=m(this),e=i.pageX,o=i.pageY,a=t.find("img").eq(0).attr("src");if(m(".divimg",q).data({id:t.data("id"),price:t.data("nowprice"),isLucky:t.data("islucky"),isstar:t.data("isstar"),name:t.data("name")}),"1"==t.data("islucky")){var n=m("#previewImage").find(".divimg"),s=m('<div class="lucky" style="background-image:url('+F.luckyGift.liveShowAnimation.giftluckb+')"></div>');n.append(s),q.find("p.info").eq(0).html(F.luckyGift.lucky0),q.find("p.info").eq(1).html(F.luckyGift.lucky1)}else if(1===t.data("isstar")){var n=m("#previewImage").find(".divimg"),s=m('<div class="lucky" style="background-image:url('+F.weekGift.liveShowAnimation.giftluckb+')"></div>');n.append(s),q.find("p.info").eq(0).html(F.weekGift.lucky0),q.find("p.info").eq(1).html(F.weekGift.lucky1)}else{if(1===+t.data("isstargift")){var n=m("#previewImage").find(".divimg"),s=m('<div class="hallowmas-gift"></div>');n.append(s)}q.find("p.info").eq(0).text(m.replaceTpl(F.giftForHost,{gold:t.data("nowprice")})),q.find("p.info").eq(1).text(m.replaceTpl(F.giftForUser,{gold:t.data("foruser")}))}m(".divimg img",q).attr("src",a).show(),m(".name",q).text(t.data("name")),m(".price",q).html(t.data("nowprice")!=t.data("price")?"<s>"+t.data("price")+'</s><span style="margin-left:5px;color:#f00">'+t.data("nowprice")+"</span>":t.data("price")),x!=t.data("id")?q.removeClass("select"):q.addClass("select"),q.css({left:e+10,top:o+10}).show()}).on("mousemove","li",function(i){var t=i.pageX,e=i.pageY;q.css({left:t+30,top:e-20})}).on("mouseleave","li",function(){q.hide(),m(".divimg").find(".lucky").remove(),m(".divimg").find(".hallowmas-gift").remove()}).on("click","li",function(){UT.send({type:"click",modId:"roomgifts"});var i=m(this),t=i.data("id");x!=t?(m(".giftsSection [data-id="+x+"]").removeClass("select"),x=t,G=i.data("nowprice"),N=i.data("name"),q.addClass("select"),m(".giftsSection [data-id="+t+"]").addClass("select")):(x=0,G=0,q.removeClass("select"),m(".giftsSection [data-id="+t+"]").removeClass("select"))})}function n(){function i(i){m(".giftshow").show(),m(i).find(".gift-up").addClass("gift-down")}function t(){m(".giftshow").hide(),m(".gift-up").removeClass("gift-down")}var e=new S(i,t);m(".giftLr").on("click",".btn-up",function(){e.toggle(this)}),E.on("mouseenter","li",function(){m(this).addClass("hovergiftlist"),L.find(".comdity").show(),L.find(".comdity a img").attr("src",m(this).data("imageurl"))}).on("mouseleave","li",function(){m(this).removeClass("hovergiftlist"),L.find(".comdity").hide()}).on("click","li",function(){m(".valuetext").val(m(this).data("value"))})}function s(i){var i=i?i:0,t=m(".giftNavList .current",L).data("id"),e=m("#giftList"+t);if(!(e.find("li").length>0)){e.show();var o=function(t){if(0===t.error.number){var o=t.result,a="",n=!1;C.eq(i).scrollable({autoHide:!1});for(var s=0;s<o.length;s++){var d=o[s];if("1"===d.isLucky)var r='<div class="lucky-sign" style="background-image:url('+F.luckyGift.liveShowAnimation.giftlucks+')"></div>';else if("1"===d.IsStar)var r='<div class="lucky-sign" style="background-image:url('+F.weekGift.liveShowAnimation.giftlucks+')"></div>';else var r="";if(-1!==m.inArray(d.ID,P.starGiftId)&&(n=!0),n)var r='<div class="hallowmas-gift"></div>';a=a+'<li data-isLucky="'+d.isLucky+'" data-id="'+d.ID+'" data-name="'+d.Name+'" data-price="'+d.Price+'" data-nowprice="'+d.NowPrice+'" data-foruser="'+d.ForUser+'" data-isstar="'+d.IsStar+'" data-isStarGift="'+(n?"1":"0")+'">'+r+'<a href="javascript:;"><img src="'+o[s].Logo+'"/></a><p class="liselect"></p></li>',n=!1}m("ul",e).html(a)}else w.alert({iconShow:"upset",contentText:F.failtogetgoods,confirmText:getText("ok")})},a="/mall",n="GET",s={f:"getGiftList",catId:t};r(n,a,s,o)}}function d(){L.find(".btn-send").click(function(){if(!j("isLogined"))return void p.showDialog("mod-newroom-gift");if(!x)return void w.alert({iconShow:"upset",contentText:F.chooseonegood,confirmText:getText("ok")});var i=parseInt(m("#goodNum").val(),10);if(!i||0>i)return void w.alert({iconShow:"upset",contentText:F.inputrightnum,confirmText:getText("ok")});var t=T.current.id,e=x,o=j("roomId"),a=N,n=parseInt(G,10)*i;if(h.balance.checkBalance(n)){if(t===j("userId"))return void w.alert({iconShow:"upset",contentText:F.sendNoSelf});var s="/mall?f=sendGift",d="POST",c={roomId:o,goodName:a,toUserId:t,goodId:e,num:i,description:""},l=function(e){0===e.error.number?(UT.send({type:"paygiftnum",value:a,giftNum:i,totalPrice:n,toUserId:t}),h.balance.addBalance(-n)):555==e.error.number&&h.balance.showRechargePrompt()};r(d,s,c,l)}})}function r(i,t,e,o,a){var n=1e4,s=v.formatData(s);m.ajax({url:t,timeout:n,type:i,dataType:"json",data:e}).done(function(i){o&&"function"==typeof o&&o(i)}).fail(function(i){a&&"function"==typeof a&&a(i)}).always(function(){})}function c(i){var t=i.body;i.toRoom===j("roomId")+""&&l(t)}function l(i){for(var t,e=i.goodNum,o=i.icon,a=(i.smallIcon?i.smallIcon:o,i.largeIcon?i.largeIcon:o),n=!1,s=0;s<P.giftsEffectNumList.length;s++)if(e+""===P.giftsEffectNumList[s].num){n=!0,t=P.giftsEffectNumList[s];break}if(i.largeIcon&&-1!==i.largeIcon.indexOf("swf")){var d=null;return d=i.largeIcon.match(/[^\/\d]*([\d]+)[^\/\d]*$/)[1],b.doSpecialFlashGiftEffect(d,e),void UT.send({type:"others",sort:i.smallIcon,modId:"giftAction",value:j("roomId")})}if(n)u(t,o);else{var r;r=5>e?a:o,f(e,r)}}function f(i,t){b.doFlashGiftEffect(1,t,null,i)}function u(i,t){b.doFlashGiftEffect(0,t,i.dataFile)}var m=i("common:widget/ui/jquery/jquery.js"),g=i("common:widget/public/public-socket/public-socket.unpack.js"),p=i("common:widget/public/mod-public-login/mod-public-login.js"),v=i("common:widget/public/public-tools/public-tools.js"),w=i("common:widget/public/public-dialog/public-dialog.js"),h=i("common:widget/public/mod-public-property/mod-public-property.js"),y=(i("common:widget/ui/jquery/widget/jquery.ui.scrollable/jquery.ui.scrollable.js"),i("room:widget/newroom/step1/mod-newroom-gift/js/giftContactList.js")),b=i("room:widget/newroom/step1/mod-newroom-gift/js/giftEffect.js"),k=i("room:widget/newroom/newroom.js");i("room:widget/newroom/step1/mod-newroom-gift/js/formatString.js");var I=window.moduleMaster,j=window.getConf,S=i("common:widget/public/public-bubble/public-bubble.js"),T=null,x=0,G=0,N="",L=m(".mod-newroom-gift"),C=m(".giftsSection .mod-gifts-list"),q=m("#previewImage"),E=m(".giftslist"),F={},P={},U=function(i){var t={time:0};return function(e){var o=+new Date;return e.body.userId!==t.userId||o-t.time>i?(t={userId:e.body.userId,time:o},!0):!1}}(3e3);e.exports={run:function(i,t){if(F=i.textMap,P=i,g.on("3",function(i){c(i)}),g.on("15",function(i){if(+i.body.userId!==j("userId")&&i.body.car&&i.body.car.FlashPath){if(!U(i))return!1;var t=i.body.car.FlashPath.match(/[^\/\d]*([\d]+)[^\/\d]*$/)[1];b.doSpecialFlashGiftEffect(t,i.body.userName.decodeHtml())}}),T=new y("sendGift",!1,F),T.add(j("anchorId"),j("anchorName")),b.init(i),t.flashPath){var e=null;e=t.flashPath.match(/[^\/\d]*([\d]+)[^\/\d]*$/)[1],b.doSpecialFlashGiftEffect(e,j("userName").decodeHtml())}o(),s(),I.on("mod-roompublic-usermenu","chooseGiftUser",function(i){T.add(i.UserID,i.NickName,i.BadgeImg&&i.BadgeImg[0])}),k.on(function(i){L.find(".resize-fix-hook").css({height:i-524})})}}});
;define("room:widget/newroom/step1/mod-newroom-giftslist/mod-newroom-giftslist.js",function(t,o,e){function i(){var t=function(t){if(0===t.message.errNum){var o=t.content.data,e="";if(0===g&&0===t.content.length)u.show(),n(".loadMore",l).hide(),n(".gift-list-title",l).hide();else{p=!1;for(var i=0;i<o.length;i++){var s=o[i];e+='<tr data-id="'+s.id+'"><td class="send-item"><p class="toe">'+s.fromNickName+'</p></td><td class="gift-item toe"><img src="'+s.goodLog.SmallLogo+'">x'+s.GoodNum+'</td><td class="recipient-item"><p class="toe">'+s.toNickName+'</td></p><td class="time-item toe">'+s.time.substr(0,5)+"</td></tr>"}0===g?m.html(e):m.append(e),g+=o.length,n(".gift-list-title",l).show(),u.hide(),g<t.content.count?n(".loadMore",l).show():n(".loadMore",l).hide()}}else a.alert({iconShow:"upset",contentText:t.message.errMessage,confirmText:getText("ok")})},o="/mall/getGoodRecordToday",e="get",i={roomid:getConf("roomId"),start:g,count:f};i=d.formatData(i);var s=1e4;n.ajax({url:o,timeout:s,type:e,dataType:"json",data:i}).done(function(o){t&&"function"==typeof t&&t(o)}).fail(function(){}).always(function(){})}function s(){n(".loadMore",".mod-newroom-giftslist").click(function(){i()})}var n=t("common:widget/ui/jquery/jquery.js"),r=t("common:widget/public/public-socket/public-socket.unpack.js"),d=(t("common:widget/ui/jquery/widget/jquery.ui.scrollable/jquery.ui.scrollable.js"),t("common:widget/public/public-tools/public-tools.js")),a=t("common:widget/public/public-dialog/public-dialog.js"),c=(t("room:widget/newroom/step1/mod-newroom-uitab/mod-newroom-uitab.js"),t("room:widget/newroom/newroom.js")),l=n(".mod-newroom-giftslist"),m=n("#getGiftListContent table"),u=n(".emptyTip",".mod-newroom-giftslist"),g=0,f=20,p=!0;e.exports={run:function(){c.on(function(t){l.find(".resize-fix-hook").css({height:t-186})}),s(),l.on("tab",function(){p&&i()}),n(".scrollContainer",l).scrollable({autoHide:!1}),r.on("3",function(t){e.exports.insertNewGift(t)})},insertNewGift:function(t){var o=t.body;if($giftsListRecord=n("tbody","#getGiftListContent"),$giftsListRecord.find("tr").length>0||l.hasClass("cur")){if($giftsListRecord.find("tr[data-id="+o.goodRecordId+"]").length>0)return;if(+o.toUserId!==getConf("anchorId"))return;var e=new Date,i=e.getHours()<10?"0"+e.getHours():e.getHours(),s=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),r=i+":"+s;n('<tr data-id="'+o.goodRecordId+'"><td class="send-item"><p class="toe">'+o.userName+'</p></td><td class="gift-item toe"><img src="'+o.smallIcon+'">x'+o.goodNum+'</td><td class="recipient-item"><p class="toe">'+o.toUserName+'</p></td><td class="time-item toe">'+r+"</td></tr>").prependTo($giftsListRecord),n(".gift-list-title").show(),n(".emptyTip").hide()}}}});
;define("room:widget/newroom/step1/mod-newroom-header/mod-newroom-header.js",function(e,n,o){function i(){var e=s(this).width()-286;e>m&&(e=m),h>e&&(e=h),u.find(".header-center").css("width",e)}function t(){var e=s.trim(w.val());w.val(""),e&&(window.location.href="/user/search/?wd="+encodeURIComponent(e))}function a(){function e(){p("isLogined")&&s.ajax({type:"GET",dataType:"jsonp",url:c+"/message/getNotice?jsonp=?"}).done(function(e){var n=e.result,o=i.find(".subMenu li:eq(3) em");0!=n.length?(i.show(),n[1]||n[2]||!n[5]||i.find(".mClose").hide(),n[2]&&(i.find(".replay").show(),t.text(n[2]),o.text("("+n[2]+")")),n[1]&&(i.find(".fan").show(),a.text(n[1])),a.attr("data-num",n[1])):(i.hide(),o.text(""))})}function n(){var e=a.text();i.find(".fan").hide(),s.ajax({type:"get",dataType:"jsonp",url:c+"/message/delNotice?jsonp=?",jsonp:"jsonp",data:{type:1,count:e}}).done(function(e){e&&(""==t.text()?i.hide():i.find(".fan").hide());var n="";n=p("isOpenJP")?"/user/info/mycard?id="+p("userId")+"&snsTab=3&friendsTab=fansNav":"/sns/myclips?uid="+p("userId"),window.location.href=n})}function o(){var e=t.text();i.find(".replay").hide(),d.text(""),window.open("/user/info/messageCenter"),s.ajax({type:"get",dataType:"jsonp",url:c+"/message/delNotice?jsonp=?",jsonp:"jsonp",data:{type:2,count:e}}).done(function(e){e&&(a.text()?i.find(".replay").hide():i.hide())})}var i=u.find(".message-air"),t=i.find(".replay em"),a=i.find(".fan em"),d=i.find(".subMenu li:eq(3) em"),c=(i.find(".subMenu li:eq(3) a"),p("apiUrlPrefix"));setInterval(e,6e4),e(),s(document).on("click",".mClose",function(){i.hide(),n(),o()});var r=s.getUrlParam("friendsTab")||"";r?i.find("#friendLeftBar").find('li[data-type="followNav"]').click():i.find("#friendLeftBar").find('li[data-type="fansNav"]').click(),s(document).on("click","#newFans",function(){n()}),s(document).on("click",".subMenu li:eq(3) a",function(){var e=t.text();i.hide(),d.text(""),s.ajax({type:"get",dataType:"jsonp",url:c+"/message/delNotice?jsonp=?",jsonp:"jsonp",data:{type:2,count:e}}).done(function(e){})}),s(document).on("click","#newReply",function(){o()})}function d(){function e(){p("isLogined")&&s.ajax({type:"get",dataType:"json",url:"/hiapi/mail/getMailCount"}).done(function(e){if(0===e.errno){var n=Number(e.data.feed),o=Number(e.data.sys);u.find(".cli").addClass("cli-bottom"),0===n?u.find(".cli").hide():n>99?(u.find(".num1").text("99+"),u.find(".cli").show()):(u.find(".num1").text(n),u.find(".cli").show()),0===o?(u.find(".sys").hide(),u.find(".cli").removeClass("cli-bottom")):o>99?(u.find(".num2").text("99+"),u.find(".sys").show()):(u.find(".num2").text(o),u.find(".sys").show()),u.find(".infom").removeAttr("title"),0===n&&0===o&&u.find(".infom").attr("title",u.find(".infom").data("tt"))}})}e(),setInterval(e,15e3)}var s=e("common:widget/ui/jquery/jquery.js"),c=e("common:widget/public/mod-public-login/mod-public-login.js"),r=e("common:widget/public/mod-public-property/mod-public-property.js"),l=e("common:widget/public/public-socket/public-socket.unpack.js"),f=e("common:widget/public/public-tools/public-tools.js"),u=s(".mod-newroom-header"),p=window.getConf,m=1300,h=1080;u.on("click",".btn-login, .go-live-login",function(){c.showDialog("roomHeaderLogin")}),u.on("click",".last-a",function(){var e=window.location.href,n="/user/pass/userpass/logout?cb="+encodeURIComponent(e);window.location.href=n}),s(window).on("load resize",i),i();var w=u.find(".header-search input");u.on("keyup",".header-search input",function(e){13===e.keyCode&&t()}),u.on("click",".btn-search",t);var g=u.find("[data-title]"),y=u.find(".user-gold");r.balance.regBalance(function(e,n){u.find(".gold-number").text(e),g.attr("title",g.data("title")+e);var o="",i=0,t=0;n>0?(o='<span class="gold-plus-yellow-action">+'+n+"</span>",i=30,t=-20):0>n&&(o='<span class="gold-plus-action">'+n+"</span>",t=20),o&&s(o).appendTo(y).css("top",i).animate({top:t,opacity:0},1e3,function(){s(this).remove()})}),l.on("3",function(e){var n=+e.body.isSign;p("userId")===+e.body.toUserId&&1!==n&&2!==n&&e.body.hasOwnProperty("balance")&&r.balance.setBalance(e.body.balance)}),o.exports={init:function(e,n){if(e&&f.browser.versions.mac){var o=u.find(".header-golive"),i="/liveroom/"+e+"?capture=flashCollect";o.find(".drop-sub").remove(),o.removeClass("drop-nav"),o.find("a").attr("href",i)}n.message&&n.message.isShow?d():a()}}});
;define("room:widget/newroom/step1/mod-newroom-header/run-way.js",function(o,n,e){function a(o){c.showRunWay&&(m.show(),m.find(".next").html(o),m.find(".content").animate({left:-p},2500,function(){m.find(".current").html(o),m.find(".content").css("left",0)}))}function i(o){if(0!=o.showRunWay&&0!=o.showRunWay){var n='<img src="'+o.icon+'" title="'+o.goodName+'">',e=u.aSendBNGiftX;e=e.replace("[a]",o.userName),e=e.replace("[b]",o.toUserName),e=e.replace("[n]",o.goodNum),e=e.replace("[x]",n);var i='<a href="/liveroom/'+o.roomId+'">'+e+"</a>";a(i)}}function t(o){var n='<a href="/liveroom/'+o.toRoom+'" target="_blank" id="giftSendNotice"><span class="luckyname">'+o.body.userName+" </span>"+u.pakai+'<img class="gift-img" src="'+o.body.icon+'" />'+u.dapat+'<span class = "multiple">'+o.body.multiple+"x </span>"+u.bonus+'<span class = "gold">'+o.body.goodprice+"</span>"+u.gold+'<span class = "count">'+o.body.times+"</span><span>"+u.kali+"</span></a>";a(n)}function s(){r.on("3",function(o){i(o.body)}),r.on("luckyGiftCC35",function(o){console.log("data",o),setTimeout(function(){500==o.body.multiple&&t(o)},2500)})}var c,u,l=o("common:widget/ui/jquery/jquery.js"),r=o("common:widget/public/public-socket/public-socket.unpack.js"),d=l(".mod-newroom-header"),m=d.find(".run-way"),p=452;e.exports={init:function(o,n){u=n,s(),c=o,i(o)}}});
;define("room:widget/newroom/step1/mod-newroom-leftad/mod-newroom-leftad.js",function(o,e,n){var d=o("common:widget/ui/jquery/jquery.js"),m=d(".mod-newroom-leftad");n.exports={run:function(){m.on("click",".close",function(){m.hide()})}}});
;define("room:widget/newroom/step1/mod-newroom-leftrecommend/mod-newroom-leftrecommend.js",function(e,n,o){var t=e("common:widget/ui/jquery/jquery.js"),i=e("room:widget/newroom/step1/mod-newroom-preview/mod-newroom-preview.js"),d=t(".mod-newroom-leftrecommend"),r=d.find("[data-fill=list]"),c={$expend:d.find(".expend"),$fold:d.find(".fold")},m=(d.find(".list-wrap"),394),f=200,p=new i.RecommendedList(r,9);p.next(),d.on("click",".btn-next",function(){p.next()}),d.on("click",".btn-prev",function(){p.prev()}),setTimeout(function(){t(document).on("click",function(e){d[0]&&!t.contains(d[0],e.target)&&d[0]!==e.target&&i.$previewPopup[0]&&!t.contains(i.$previewPopup[0],e.target)&&i.$previewPopup[0]!==e.target&&d.animate({left:-m+"px"},f,function(){c.$fold.hide(),c.$expend.show()})})},3e3),d.on("click",".expend",function(){var e=t(this);d.animate({left:0},f,function(){e.hide(),c.$fold.show()})}),d.on("click",".fold",function(){var e=t(this);d.animate({left:-m+"px"},f,function(){e.hide(),c.$expend.show()})}),o.exports={run:function(){}}});
;define("room:widget/newroom/step1/mod-newroom-livelogin/mod-newroom-livelogin.js",function(o,n,e){function i(){if(/^8800020/g.test(c.cookie("hiclub_tn"))){!function(){var o=window._fbq||(window._fbq=[]);if(!o.loaded){var n=document.createElement("script");n.async=!0,n.src="//connect.facebook.net/en_US/fbds.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(n,e),o.loaded=!0}}(),window._fbq=window._fbq||[],window._fbq.push(["track","6027577487130",{value:"0.00",currency:"USD"}]);var o=new Image;o.src="https://www.facebook.com/tr?ev=6027577487130&amp;cd[value]=0.00&amp;cd[currency]=USD&amp;noscript=1"}}var c=o("common:widget/ui/jquery/jquery.js"),t=o("common:widget/public/mod-public-login/mod-public-login.js"),l=c(".mod-newroom-livelogin"),s=l.find(".middle-section"),a=l.find(".bottom-section");e.exports={run:function(o){l.on("click",".facebook-login",function(){"function"==typeof ga&&ga("send","event","login","click","live-facebook"),i();var o=window.location.href,n="/user/pass/ha/fblogin?cb="+encodeURIComponent(o);window.location.href=n}),l.on("click",".twitter-login",function(){"function"==typeof ga&&ga("send","event","login","click","live-twitter"),i();var o=window.location.href,n="/user/pass/ha/twlogin?cb="+encodeURIComponent(o);window.location.href=n}),l.on("click",".kaskus-login",function(){"function"==typeof ga&&ga("send","event","login","click","live-kaskus"),i();var o=window.location.href,n="/user/pass/ha/kaskuslogin?cb="+encodeURIComponent(o);window.location.href=n}),l.on("click",".google-login",function(){"function"==typeof ga&&ga("send","event","login","click","live-google");var o=window.location.href,n="/user/pass/ha/googlelogin?cb="+encodeURIComponent(o);window.location.href=n}),setTimeout(function(){s.find(".close").show()},o.closeTime),s.on("click",".close",function(){s.hide(),setTimeout(function(){a.slideDown(1e3)},o.bottomLoginTime),UT.send({type:"others",modId:"liveLoginClose",value:"liveCloseValue",sort:"liveClose"})}),a.on("click",".close",function(){a.slideUp()}),s.on("click",".is-href",function(){c(this).attr("href",o.advertHerfUrl)}),a.on("click",".btn-login",function(){t.showDialog()})}}});
;define("room:widget/newroom/step1/mod-newroom-lovecard/js/flyLoves.js",function(o,e,t){function n(o){if(o--){setTimeout(function(){n(o)},200);var e=r(i),t=-60*Math.random()-10;e.appendTo(m).css({right:10,top:-30}),e.animate({right:3*t/4,top:d.top/4},250,"linear"),e.animate({right:t,top:d.top/2},250,"linear"),e.animate({right:d.right+3*t/4,top:3*d.top/4},250,"linear"),e.animate(d,250,"linear",function(){e.remove(),o||r(document).trigger("addAnchorLoveCard")})}}var r=o("common:widget/ui/jquery/jquery.js"),i='<img class="fly-love" src="/static/room/widget/newroom/step1/mod-newroom-lovecard/img/icon_love_d28e5a2.png">',a=o("room:widget/newroom/newroom.js"),m=r(".mod-newroom-lovecard"),d={right:25,top:-760};a.on(function(o){d.top=10-o}),t.exports=function(){n(5)}});
;define("room:widget/newroom/step1/mod-newroom-lovecard/mod-newroom-lovecard.js",function(o,e,n){function t(){v=!1,clearInterval(f),f=setInterval(function(){return v?void clearInterval(f):void i()},2e4)}function i(o){h.ajax({url:"/hiapi/loveCard/userHeartBeat",data:b.formatData({version:"1.0"}),dataType:"json",cache:!1}).done(function(e){if(e)switch(e.errno+""){case"500":break;case"15000":case"15002":case"0":var n=+e.data.process;(o||+e.data.loveCardNum<p)&&a(+e.data.loveCardNum,n)}})}function r(o){clearTimeout(w);var e=60*+m[H].period,n=Math.floor((new Date).getTime()/1e3),a=20;if(p>=+m[H].volume)return void M.css("height",a);if(null!=o)return a-=20*o,g=Math.ceil(n-e*o)+1,w=setTimeout(r,1e3),void M.css("height",Math.ceil(a));g||(g=n+1);var d=n-g;d>=e?(d>=6e6?i(!0):(i(),t()),g=0,a=0):(a-=20*d/e,w=setTimeout(r,1e3)),M.css("height",Math.ceil(a))}function a(o,e){o>p&&L.css("transform","rotateY("+360*++V+"deg)"),P.text(o),p=o,r(e)}function d(o){U.html(x("isLogined")?"noCard"===o?h.replaceTpl(u.noCard,S):h.replaceTpl(u[H].getRule,S):h.replaceTpl(u.loginPrompt,S))}function c(o){D.css({top:o.clientY-D.height()-45,left:o.clientX-D.width()-5})}function s(){S.card='<img src="/static/room/widget/newroom/step1/mod-newroom-lovecard/img/icon_lovecard_83acdb0.png" alt="'+u.loveCard+'">',S.period=m[H].period,S.volume=m[H].volume,d()}function l(){x("isLogined")&&i(!0),j.on("lovecardHH36",function(o){var e=o.body;+e.userId===x("userId")&&(v=!0,a(+e.num,0))});var o;k.on("click",".love-card",function(e){return x("isLogined")?x("userId")===x("anchorId")?void y.alert({iconShow:"upset",contentText:u.samePerson}):0===p?(d("noCard"),void c(e)):void(o||(o=!0,h.ajax({url:"/lovecard/sendLoveCard",data:b.formatData({roomId:x("roomId"),toUid:x("anchorId"),num:1}),dataType:"json",cache:!1,type:"POST"}).done(function(o){switch(o&&+o.errno){case 0:C(),window.UT.send({modId:"newroom-lovecard",type:"others",value:"sendLoveCard",isVip:I.identity.getIsVIP(),toUserId:x("anchorId")}),h(document).trigger("fansRankUpdate"),a(p-1);break;case 51:return void y.alert({iconShow:"upset",contentText:u.samePerson});case 53:break;case 52:case 54:}i()}).always(function(){o=!1}))):void T.showDialog("loveCard")}),k.on("mouseenter",".love-card",function(o){D.show(),setTimeout(function(){c(o)},0)}),k.on("mousemove",".love-card",function(o){c(o)}),k.on("mouseleave",".love-card",function(){D.hide(),d()})}var u,m,p,v,f,w,g,h=o("common:widget/ui/jquery/jquery.js"),b=o("common:widget/public/public-tools/public-tools.js"),I=o("common:widget/public/mod-public-property/mod-public-property.js"),j=o("common:widget/public/public-socket/public-socket.unpack.js"),T=o("common:widget/public/mod-public-login/mod-public-login.js"),y=o("common:widget/public/public-dialog/public-dialog.js"),C=o("room:widget/newroom/step1/mod-newroom-lovecard/js/flyLoves.js"),k=h(".mod-newroom-lovecard"),x=window.getConf,L=k.find(".num-wrap"),P=L.find("[data-fill=num]"),M=L.find("b"),D=k.find(".mass-info"),U=D.find("p"),H=I.identity.getIsVIP()?"vip":"user",S={card:"",volume:0,period:0},V=0;n.exports={init:function(o,e,n){u=o,m=e,p=n,s(),l(),window.moduleMaster.exports("mod-newroom-lovecard",i)}}});
;define("room:widget/newroom/step1/mod-newroom-luckyGift/time.js",function(t,n,i){function e(){this.eventList=[],this.runEventList=[];var t=this;this.init=function(t,n,i){var e=i?i:0;return{fn:t,parameter:n,time:e}},this.sandbox=function(){var n=t.runEventList.shift();setTimeout(function(){n.fn.apply(window,[n.parameter])},n.time)},this.start=function(n){for(var i=0;i<t.eventList.length;i++)t.runEventList.push(t.eventList[i]);window.setInterval(function(){t.runEventList[0]&&t.sandbox()},n)},this.add=function(n){t.eventList.push(n)},this.watch=function(n){t.runEventList.push(n)}}i.exports=e});
;define("room:widget/newroom/step1/mod-newroom-luckyGift/mod-newroom-luckyGift.js",function(i,o,n){var t,e,a=i("common:widget/ui/jquery/jquery.js"),l=i("room:widget/newroom/step1/mod-newroom-luckyGift/time.js"),c=i("common:widget/public/public-socket/public-socket.unpack.js"),d=i("common:widget/public/mod-public-property/mod-public-property.js"),s=a("#lucyGiftAnimation"),m=new l;m.start(4e3);var u={add:function(i){m.watch(m.init(u.init,i,0))},init:function(i){switch(a("#lucyGiftAnimation").show(),""+i.multiple){case"10":t=a("<div id = 'luckyGiftContent' class='luckyGift-10'></div>");break;case"50":t=a("<div id = 'luckyGiftContent' class='luckyGift-50'></div>");break;case"500":t=a("<div id = 'luckyGiftContent' class='luckyGift-500'></div>");break;default:t=a("<div id = 'luckyGiftContent' class='luckyGift-10'></div>")}s.html(t);var o='<span class="luckyname">'+i.userName+" </span>"+e.liveShowAnimation.pakai+'<img class="gift-img" src="'+i.icon+'" />'+e.liveShowAnimation.dapat+'<span class = "multiple" /></span>'+e.liveShowAnimation.bonus+'<span class = "gold">'+i.goodprice*i.multiple+"</span>"+e.liveShowAnimation.gold+'<span class = "count"> '+i.times+" </span><span>"+e.liveShowAnimation.kali+"</span>",n=a(o);t.html(n),t.addClass(500==i.multiple?"lucky-animation-s2bs":"lucky-animation"),t.on("animationend webkitAnimationEnd MSAnimationEnd oAnimationEnd",function(){t.remove(),a("#lucyGiftAnimation").hide()}),t.on("click",function(){t.remove(),a("#lucyGiftAnimation").hide()})},loginAnimation:function(i){var o=a(".h5_header"),n=o.find(".gold .goldNum"),t=a('<div class="goldNum-animation">+'+i.increasing_gold+"</div>");n.append(t),t.show(),t.animate({top:"10px",opacity:"0"},1e3,function(){n.text(i.total_gold),t.remove()})},run:function(i){e=i,c.on("luckyGiftCC35",function(i){i.toRoom==getConf("roomId")&&(UT.send({type:"others",modId:"luckyGiftHit",multiple:i.body.multiple,goodprice:i.body.goodprice,times:i.body.times}),u.add(i.body,e),i.body.userId==getConf("userId")&&setTimeout(function(){d.balance.setBalance(i.body.total_gold)},500))})}};n.exports=u});
;define("room:widget/newroom/step1/mod-newroom-micconnect/dialog-async.js",function(i,a,t){function o(i,a){var t={download:{head:'<i class="close"></i>',content:'<div class="mic-dialog-content"><div class="mic-dialog-title">'+a.textMap.download.title+'</div><div class="mic-dialog-text">'+a.textMap.download.des+'</div><div class="mic-dialog-op"><span class="mic-dialog-button-op"><a href="'+a.textMap.download.downloadHref+'" target="_blank">'+a.textMap.download.downloadText+'</a></span><span class="mic-dialog-button-def">'+a.textMap.download.cancelText+"</span></div></div>",foot:""},fail:{head:'<i class="close"></i>',content:'<div class="mic-dialog-content"><div class="mic-dialog-title">'+a.textMap.fail.title+'</div><div class="mic-dialog-text">'+a.textMap.fail.des+'</div><div class="mic-dialog-op"><span class="mic-dialog-button-op"><a href="'+a.textMap.download.downloadHref+'" target="_blank">'+a.textMap.fail.opText+'</a></span><span class="mic-dialog-button-def">'+a.textMap.fail.defText+"</span></div></div>",foot:""},archorFail:{head:'<i class="close"></i>',content:'<div class="mic-dialog-content"><div class="mic-dialog-title">'+a.textMap.archorFail.title+'</div><div class="mic-dialog-text">'+a.textMap.archorFail.des+'</div><div class="mic-dialog-op"><span class="mic-dialog-button-mid-def">'+a.textMap.archorFail.opText+"</span></div></div>",foot:""},cServer:{head:'<i class="close"></i>',content:'<div class="mic-dialog-content"><div class="mic-dialog-title">'+a.textMap.cServer.title+'</div><div class="mic-dialog-text">'+a.textMap.cServer.des+'</div><div class="mic-dialog-op"><span class="mic-dialog-button-mid-def">'+a.textMap.cServer.opText+"</span></div></div>",foot:""},repeat:{head:'<i class="close"></i>',content:'<div class="mic-dialog-content"><div class="mic-dialog-title">'+a.textMap.repeat.title+'</div><div class="mic-dialog-text">'+a.textMap.repeat.des+'</div><div class="mic-dialog-op"><span class="mic-dialog-button-mid-def">'+a.textMap.repeat.opText+"</span></div></div>",foot:""}},o={};o=i+""=="fail"?{width:480,height:260,position:"absolute",modal:0,draggable:1,customClass:"mic-download-dialog",initOnce:0,tpl:{},debug:0}:{width:450,height:210,position:"absolute",modal:0,draggable:1,customClass:"mic-download-dialog",initOnce:0,tpl:{},debug:0},d(".mic-download-dialog").remove(),o.tpl=t[i];var e=new l(null,o);d(".mic-dialog-button-def").on("click",function(){e.close()}),d(".mic-dialog-button-mid-def").on("click",function(){e.close()}),d(".mic-dialog-button-op").on("click",function(){e.close()})}var d=i("common:widget/ui/jquery/jquery.js"),l=i("common:widget/ui/dialog/dialog.js");t.exports=o});
;define("room:widget/newroom/step1/mod-newroom-micconnect/hiclub-clock.js",function(o,n,i){var t=o("common:widget/ui/jquery/jquery.js");window.clocks=[],window.intTime=null;var e={startTime:function(o,n){var i=0;window.intTime=window.setInterval(function(){console.log(i),i++;var e=Math.floor(i/60),w=Math.floor(i%60);w=10>w?"0"+w:w,e=10>e?"0"+e:e;var c=e+":"+w;t("#status"+o).text(n.textMap.connecting),t("#time"+o).text(c)},1e3),window.clocks.push(window.intTime)},endTime:function(){for(var o=0,n=window.clocks.length;n>o;o++)window.clearInterval(window.clocks[o]);window.intTime=null}};i.exports=e});
;define("room:widget/newroom/step1/mod-newroom-micconnect/hiclubSDK-async.js",function(e,t,n){var r=e("room:widget/newroom/step1/mod-newroom-micconnect/dialog-async.js"),o=e("common:widget/public/public-tools/public-tools.js"),c={getInstance:function(){return getConf("isMe")?function(){if(o.getBrowserSystem().chrome)return document.getElementById("npHiclubPlugin");if(o.getBrowserSystem().ie)try{return new ActiveXObject("HCPlugin.LiveSHow")}catch(e){return null}else if(o.getBrowserSystem().firefox)return document.getElementById("npHiclubPlugin")}():function(){if(o.getBrowserSystem().chrome)return document.getElementById("npCliponyuPlugin");if(o.getBrowserSystem().ie)try{return new ActiveXObject("CliponyuPlugin.InterAudio")}catch(e){return null}else if(o.getBrowserSystem().firefox)return document.getElementById("npCliponyuPlugin")}()}(),SendCmd:function(e){var t=JSON.stringify(e);try{c.getInstance.SendCmd(t)}catch(n){if(getBrowserSystem().chrome&&getConf("anchorId")===getConf("userId")){var o=document.createElement("a");return o.href="hiclub://assistmsg/?"+t,o.click(),!0}if(getBrowserSystem().chrome){var o=document.createElement("a");return o.href="hiclub://desktopmsg/?"+t,o.click(),!0}r(getConf("anchorId")===getConf("userId")?"archorFail":"fail")}},LoginAndRequestMicro:function(e){var t=JSON.stringify(e);try{c.getInstance.LoginAndRequestMicro(t)}catch(n){if(getBrowserSystem().chrome){var o=document.createElement("a");o.href="hiclub://desktopreq/?"+t,o.click()}else r("fail")}}};n.exports=c});
;define("room:widget/newroom/step1/mod-newroom-micconnect/micConnectobj.js",function(e,t,n){var i,o=e("common:widget/ui/jquery/jquery.js"),a=e("room:widget/newroom/step1/mod-newroom-micconnect/hiclubSDK-async.js"),s=e("room:widget/newroom/step1/mod-newroom-micconnect/hiclub-clock.js"),d=o("#theMicConnect"),m=function(e,t){var n=this;n.id=e.userId,n.time=e.rankTime,n.location=1,n.micStatus=e.micStatus,n.name=e.userNickName;var i=o('<tr id="'+n.id+'" ></tr>'),d=o('<td class="mic-time">'+n.time+"</td>"),m=(o('<td id="status'+n.id+'" class="mic-status">'+t.textMap.wait+"</td>"),o('<td id="time'+n.id+'" class="mic-loadtime"></td>')),c=o('<td class="mic-name"><p class="text-overflow-ellipsis" title="'+n.name+'">'+n.name+"</p></td>"),r=o('<td class="mic-opt Accepted"></td>'),p=o('<span class="op Konek">'+t.textMap.Konek+"</span>"),l=o('<span class="op shutUp">'+t.textMap.Akhir+"</span>"),u=o('<span class="remove"></span>'),f=o('<span class="loacl"></span>');i.on("mouseover",function(){u.addClass("isvisibility"),i.addClass("template-hover")}).on("mouseout",function(){u.removeClass("isvisibility"),i.removeClass("template-hover")}),p.on("click",function(){a.SendCmd({msg:"AcceptCaller",opType:"1",hid:getConf("anchorId")+"",uid:i.attr("id")+"",roomid:getConf("roomId")+""}),p.hide(),l.show(),s.endTime()}),u.on("click",function(){i.remove(),a.SendCmd({msg:"RemoveCaller",opType:"1",hid:getConf("anchorId")+"",uid:i.attr("id")+"",roomid:getConf("roomId")+""})}),l.on("click",function(){i.remove(),a.SendCmd({msg:"AcceptCaller",opType:"0",hid:getConf("anchorId")+"",uid:i.attr("id")+"",roomid:getConf("roomId")+""}),s.endTime(window.intTime)}),1===e.micStatus&&(p.hide(),l.show(),null===window.intTime&&s.startTime(e.userId,t)),r.append(p).append(l).append(u).append(f),n.template=i.append(d).append(c).append(m).append(r)},c=function(e,t){console.log("mod",t);var n=o('<tr class="mic-hover" id="'+e.userId+'"></tr>'),i=o('<td class="mic-time">'+e.rankTime+"</td>"),a=o('<td class="mic-name"><p class="text-overflow-ellipsis" title="'+e.userNickName+'">'+e.userNickName+"</p></td>"),d=o('<td id="time'+e.userId+'"></td>'),m=o('<td id="status'+e.userId+'" class="mic-status">'+t.textMap.wait+"</td>");this.template=n.append(i).append(a).append(m).append(d),1===e.micStatus&&null===window.intTime&&s.startTime(e.userId,t)},r={init:function(){return getConf("isMe")?function(e,t){i=t;for(var n=[],o=0;o<e.length;o++)!function(t){n.push(new m({userId:e[t].userId,rankTime:e[t].rankTime,micStatus:e[t].micStatus,location:t+1,userNickName:e[t].userNickName},i))}(o);r.render(n)}:function(e,t){var n=[];console.log(e),console.log("cmsdata",t);for(var i=0;i<e.length;i++)!function(i){n.push(new c({userId:e[i].userId,rankTime:e[i].rankTime,micStatus:e[i].micStatus,location:i+1,userNickName:e[i].userNickName},t))}(i);r.render(n)}}(),render:function(){return getConf("isMe")?function(e){var t=d.find("#micConnectList");t.html("");var n=o("<tbody></tbody>");t.empty();for(var i=0,a=e.length;a>i;i++)n.append(e[i].template);n.appendTo(t)}:function(e){var t=d.find("#micConnectCustomerList");t.html("");var n=o("<tbody></tbody>");t.empty();for(var i=0,a=e.length;a>i;i++)n.append(e[i].template);t.append(n)}}()};n.exports=r});
;define("room:widget/newroom/step1/mod-newroom-micconnect/hiclubMessage.js",function(o,e,n){var t=o("common:widget/ui/jquery/jquery.js"),r=o("room:widget/newroom/step1/mod-newroom-micconnect/hiclubSDK-async.js"),c=(o("room:widget/newroom/step1/mod-newroom-micconnect/dialog-async.js"),o("room:widget/newroom/step1/mod-newroom-micconnect/micConnectobj.js")),i=(o("room:widget/newroom/step1/mod-newroom-micconnect/hiclubMessage.js"),o("room:widget/newroom/step1/mod-newroom-uitab/mod-newroom-uitab.js")),s=t("#theMicConnect"),m={getArchorList:function(o){t.ajax({post:"GET",url:"/interface/micrank/ranklist/get?roomId="+getConf("roomId")+"&version=1.0"}).done(function(e){console.log("%c update userlist----------","background: blue; color: red"),c.init(e.result.list,o),m.ranklist=e.result.list;try{i.setMessageNum("micchat",m.ranklist.length)}catch(n){console.log(n)}})},updateCustomer:function(){s.find(".customer-on").show(),s.find(".customer-off").hide()},updateOffCustomer:function(){s.find(".customer-on").hide(),s.find(".customer-off").show()},showMessage:function(){t.ajax({type:"GET",url:"/interface/micrank/status/getRoomInfo?roomId="+getConf("roomId")+"&version=1.0"}).done(function(o){o.result.mic_open_status===!0&&getConf("isMe")!==!0&&(console.log("%c get roomstatus----------","background: blue; color: red"),t(".mod-message-connect").show(),window.setTimeout(function(){t(".mod-message-connect").hide()},5e3))})},checkMac:function(o,e){t.ajax({type:"GET",url:"/interface/micrank/status/getRoomInfo?roomId="+getConf("roomId")+"&version=1.0"}).done(function(n){n.result.mic_open_status===!0&&getConf("isMe")!==!0?o&&o():e&&e()})},checkArchorConnect:function(o,e){t.ajax({type:"GET",url:"/interface/micrank/status/getRoomInfo?roomId="+getConf("roomId")+"&version=1.0"}).done(function(n){n.result.mic_open_status===!0?o&&o():e&&e()})},checkArchorLive:function(o,e){t.ajax({type:"GET",url:"/interface/micrank/status/getRoomInfo?roomId="+getConf("roomId")+"&version=1.0"}).done(function(n){n.result.isLive===!0?o&&o():e&&e()})},checkCustomerIsRank:function(o,e){t.ajax({type:"GET",url:"/interface/micrank/ranklist/checkUserRankStatus?roomId="+getConf("roomId")+"&version=1.0"}).done(function(n){n.result.isInRank===!0?o&&o():e&&e()})},checkUserCanApply:function(o,e){t.ajax({type:"GET",url:"/interface/micrank/ranklist/checkUserCanApply?roomId="+getConf("roomId")+"&version=1.0"}).done(function(n){n.result.canApply===!0?o&&o():e&&e()})},userLogin:function(o,e){t.ajax({type:"get",url:"/interface/micrank/token/get?version=1.0&roomId="+getConf("roomId")}).done(function(e){o&&o(),m.updateOffCustomer();var n=e.result.token;r.LoginAndRequestMicro({uid:getConf("userId")+"",hid:getConf("anchorId")+"",loginToken:n+"",nickName:getConf("userId")+"",BDUSS:t.cookie("BDUSS"),roomid:getConf("roomId")+""})}).fail(function(){console.log("èŽ·å–tokenå¤±è´¥"),e&&e()})}};n.exports=m,t.ajax({post:"GET",url:"/interface/micrank/ranklist/get?roomId="+getConf("roomId")+"&version=1.0"}).done(function(o){try{i.setMessageNum("micchat",o.result.list.length)}catch(e){console.log(e)}})});
;define("room:widget/newroom/step1/mod-newroom-micconnect/mod-newroom-micconnect.js",function(o,n,e){function c(o){d("#connectMicStatus").find(".connect-title").text(o.body.nickName),d("#connectMicStatus").find(".connect-title").attr("title",o.body.nickName);var n=s.ranklist;d("#connectMicStatus").fadeIn("fast"),"offline"===h("env")?d("#connectMicStatus").find(".connect-image").attr("src","http://static01.cliponyu.com/resource/defaultImg.jpg"):d("#connectMicStatus").find(".connect-image").attr("src","/resource/defaultImg.jpg");for(var e=0;e<n.length;e++)if(n[e].userId===o.body.userId&&n[e].userIcon.length>2)return void d("#connectMicStatus").find(".connect-image").attr("src",n[e].userIcon)}function i(){d("#connectMicStatus").hide()}function t(o){d(".mod-message-connect").on("click",function(){d(this).hide()}),s.showMessage(),d(".mod-message-connect").find(".ok").on("click",function(){d(".mod-message-connect").hide(),d("#micConnectNav").mousedown().click()}),d(".mod-message-connect").find(".cancel").on("click",function(){d(".mod-message-connect").hide()}),l.one("tab",function(){UT.send({type:"click",sort:"micConnectNav",modId:"MicConnect",value:"Voice chat"}),1==h("isMe")?(l.find(".mic-archor-off").show(),l.find("#micConnectList").scrollable({autoHide:!1}),s.checkArchorConnect(function(){l.find(".mic-archor-on").show().end().find(".mic-archor-off").hide(),s.getArchorList(o)}),d(".on-connect").on("click",function(){s.checkArchorLive(function(){r.SendCmd({msg:"OpenConnMode",opType:"1",hid:h("anchorId")+"",uid:h("userId")+"",roomid:h("roomId")+""}),console.log({msg:"OpenConnMode",opType:"1",hid:h("anchorId")+"",uid:h("userId")+"",roomid:h("roomId")+""})},function(){m("archorFail",o)})}).end().find(".off-connect").on("click",function(){r.SendCmd({msg:"OpenConnMode",opType:"0",uid:h("userId")+"",roomid:h("roomId")+""})})):(s.checkCustomerIsRank(function(){s.updateOffCustomer()},function(){s.updateCustomer()}),s.getArchorList(o),l.find("#micConnectCustomerList").scrollable({autoHide:!1}),l.find(".customer-on").on("click",function(){s.checkMac(function(){s.checkUserCanApply(function(){s.userLogin()},function(){m("repeat",o)})},function(){console.log("ä¸»æ’­æ²¡æœ‰å¼€å¯è¿žéº¦æ¨¡å¼"),m("fail",o)})}).end().find(".customer-off").on("click",function(){s.updateCustomer(),r.SendCmd({msg:"RemoveCaller",opType:"1",nickName:h("userName")+"",hid:h("anchorId")+"",uid:h("userId")+"",roomid:h("roomId")+""}),console.log("%c ç”¨æˆ·å–æ¶ˆåˆ—è¡¨----------ç”¨æˆ·å–æ¶ˆåˆ—è¡¨","background: green; color: red")}).end().find(".customer-shut").on("click",function(){}))}),u.on("micConnectCC26",function(){s.showMessage(),s.getArchorList(o),s.updateCustomer(),l.find(".mic-archor-on").show().end().find(".mic-archor-off").hide()}),u.on("micConnectCC27",function(n){s.getArchorList(o),a.endTime(),console.log(n.body.nickName+"æ­£åœ¨å’Œä¸»æ’­è¿žéº¦"),h("roomId")===n.body.RoomID&&c(n)}),u.on("micConnectCC28",function(n){s.getArchorList(o),"1"==n.body.micStatus&&a.endTime(),h("userId")===n.body.userId&&s.updateCustomer(),h("roomId")===n.body.RoomID&&i(),console.log(n.body.nickName+"å–æ¶ˆå’Œä¸»æ’­è¿žéº¦")}),u.on("micConnectCC29",function(n){a.endTime(window.intTime),s.getArchorList(o),s.updateCustomer(),l.find(".mic-archor-off").show().end().find(".mic-archor-on").hide(),console.log("ä¸»æ’­å…³é—­æœ¬æ¬¡è¿žéº¦ï¼Œä¸‹æ¬¡å†æ¥çŽ©å„¿å§ï¼"),h("roomId")===n.body.RoomID&&i()}),u.on("micConnectCC30",function(){s.getArchorList(o)}),u.on("micConnectCC31",function(n){s.getArchorList(o),"1"==n.body.micStatus&&a.endTime(),h("userId")===n.body.userId&&s.updateCustomer()}),u.on("micConnectCC32",function(n){a.endTime(window.intTime),s.getArchorList(o),h("userId")===n.body.userId&&s.updateCustomer(),h("roomId")===n.body.RoomID&&i(),console.log(n.body.nickName+"å–æ¶ˆå’Œä¸»æ’­è¿žéº¦")}),u.on("micConnectCC33",function(n){h("userId")==n.body.userId&&m("repeat",o),console.log(n.body.nickName+"æ­£åœ¨å…¶ä»–æˆ¿é—´æŽ’éº¦")}),u.on("micConnectCC34",function(){m("cServer",o),a.endTime(window.intTime),s.getArchorList(o),s.updateCustomer(),l.find(".mic-archor-off").show().end().find(".mic-archor-on").hide()}),f.on(function(o){l.css({height:o-151})})}var d=o("common:widget/ui/jquery/jquery.js"),r=(o("common:widget/ui/jquery/widget/jquery.ui.scrollable/jquery.ui.scrollable.js"),o("room:widget/newroom/step1/mod-newroom-micconnect/hiclubSDK-async.js")),m=o("room:widget/newroom/step1/mod-newroom-micconnect/dialog-async.js"),s=o("room:widget/newroom/step1/mod-newroom-micconnect/hiclubMessage.js"),u=o("common:widget/public/public-socket/public-socket.unpack.js"),a=o("room:widget/newroom/step1/mod-newroom-micconnect/hiclub-clock.js"),f=o("room:widget/newroom/newroom.js"),l=d("#theMicConnect"),h=window.getConf;e.exports=t});
;define("room:widget/newroom/step1/mod-newroom-music/mod-newroom-music.js",function(o,i,u){var e=o("common:widget/ui/jquery/jquery.js");o("common:widget/ui/jquery/widget/jquery.ui.popup/jquery.ui.popup.js");var n=(o("common:widget/ui/jquery/widget/jquery.ui.scrollable/jquery.ui.scrollable.js"),o("common:widget/public/public-tools/public-tools.js")),t=o("common:widget/public/public-dialog/public-dialog.js"),c=e("#newroomMusic").popup();u.exports={init:function(){e(document).on("showNewRoomMusic",function(){c.show(),e("form")[0].reset()}),e("#newroomMusic").find(".ul-wrap").scrollable({autoHide:!1})}},e("#newroomMusic").on("click",".btn-submit",function(){{var o=[];e("input")}e("input.form-input").each(function(i){var u={},t=e("input.form-input").eq(i).val();t&&(u.SongNumber=n.escapeToHtml(t.trim()),o.push(u),console.log(o))}),0!==o.length&&e.ajax({type:"post",url:"/hiapi/room/addJasracSongs",data:{data:o}}).done(function(){t.alert({contentText:"ãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯ä½œå“æå‡ºæˆåŠŸï¼",iconShow:"smile"})})})});
;define("room:widget/newroom/step1/mod-newroom-newanchorinfo/mod-newroom-newanchorinfo-checkin.js",function(t,e,n){var i=t("common:widget/ui/jquery/jquery.js"),o=t("common:widget/public/mod-public-login/mod-public-login.js");t("common:widget/ui/jquery/widget/jquery.ui.tip/jquery.ui.tip.js");var c='<div class="wp-tip"><div class="wp-head">#{title}</div><div class="wp-content"><div class="wp-lcal"><div class="month"></div><div class="day"></div></div><div class="wp-text"><p class="hc-t"><i class="yes-icon"></i><i class="check-text"></i></p><p class="hc-n">#{checkinNum}</p></div></div></div>',s=function(t){this.conf=t,this.$elem=i(".checkin-btn",".mod-newroom-newanchorinfo"),this.$content=i(i.replaceTpl(c,this.conf)),this.$month=i(".month",this.$content),this.$day=i(".day",this.$content),this.$checkinNum=i(".checkin-num",this.$content),this.$yes=i(".yes-icon",this.$content),this.$checkText=i(".check-text",this.$content),this.$elem.tip({className:"checkin-tip",content:this.$content,dir:"bottom",showDelay:500,customLocation:!0}),this.init()};s.prototype={constructor:s,init:function(){var t=this;t.getToday(),t.getCheckinInfo().done(function(){t.$elem.tip("show"),t.hid=setTimeout(function(){t.$elem.tip("hide")},t.conf.hoverTime),t.$elem.on("mouseenter jq.tip.mouseenter",function(){clearTimeout(t.hid)})}),i(window).on("mod-newroom-newanchorinfo-checkin.update",function(){t.getCheckinInfo()}),t.$elem.on("click",function(){t.handleClick()}),t.$elem.on("mouseenter",function(){t.getCheckinInfo()})},handleClick:function(){getConf("isLogined")?i(window).trigger("mod-newroom-checkin.show"):o.showDialog()},getToday:function(){var t=new Date,e=t.getMonth(),n=t.getDate();this.$month.text(this.conf.monthList[e]),this.$day.text(n)},getCheckinInfo:function(){var t=this;return i.getJSON("/hiapi/punch/hover",{version:"1.0",country:getConf("country"),hostId:getConf("anchorId")}).done(function(e){if(0===e.errno&&e.data){var n=1===e.data.isPunch,i=e.data.punchNum;n?(t.$yes.show(),t.$checkText.text(t.conf.hasCheckin)):(t.$yes.hide(),t.$checkText.text(t.conf.noCheckin)),t.$checkinNum.text(i)}})},destroy:function(){this.$elem.tip("destroy"),clearInterval(this.timeout)}},n.exports=s});
;define("room:widget/newroom/step1/mod-newroom-snsshare/mod-newroom-snsshare.js",function(e){var t=e("common:widget/ui/jquery/jquery.js");t&&!function(e,i,n,o){var r=555,s=382,a="width=#{width},height=#{height},top=#{top},left=#{left},location=yes,menubar=no,resizable=yes,scrollbars=yes,status=no,toolbar=no",c=function(e,i){var n={};return t.extend(!0,n,e),t.each(i||{},function(e,i){n[e]=i===i+""?i:t.extend(!0,n[e],i)}),n},l=c({ui:{width:r,height:s,top:function(){return(screen.height-s)/2},left:function(){return(screen.width-r)/2},skin:"skin",eventType:"click",tplWrap:'<ul class="sns-share sns-share--#{skin}">#{inner}</ul>',tplLi:'<li class="sns-share_li sns-share_li-#{service}"><a href="#" data-sns-share="#{service}" title="#{service}" hidefocus="true" onclick="return !1"></a></li>'},services:{facebook:{api:"https://www.facebook.com/sharer/sharer.php?s=100&p[title]=#{title}&p[summary]=#{summary}&p[images][0]=#{image}&p[url]=#{url}"},facebook_feed:{api:"https://www.facebook.com/dialog/feed?app_id=#{app_id}&display=popup&caption=#{summary}&link=#{url}&redirect_uri=#{redirect_uri}&name=#{title}&picture=#{image}&description=#{description}",active:!1},twitter:{api:"https://twitter.com/intent/tweet?text=#{input}&url=#{url}"},googleplus:{api:"https://plus.google.com/share?url=#{url}&t=#{title}&hl=#{lang}"},zingme:{api:"http://link.apps.zing.vn/share?url=#{url}&title=#{title}&description=#{description}&screenshot=#{image}"}},service:"facebook",info:{url:e.location.href,title:i.title,summary:t("[name=title]").attr("content")||"",image:e.location.protocol+"//"+e.location.host+"/static/web/common/img/fb-logo.png",description:t("[name=description]").attr("content")||"",input:"",lang:n.browserLanguage||n.language||n.userLanguage||""}},(e.conf||{})[o]),p=t[o]=function(i){i=c(l,i);var n=i.service,o=i.info,r=i.ui;return n?(UT&&UT.send({type:"click",position:"sns",sort:n,modId:"sns"}),t.isFunction(r.top)&&(r.top=r.top()),t.isFunction(r.left)&&(r.left=r.left()),t.each(o,function(e,t){o[e]=encodeURIComponent(t)}),n=i.services[n],n&&(i.ui.winHandle?i.ui.winHandle.location.href=t.replaceTpl(n.api,o):e.open(t.replaceTpl(n.api,o),"",t.replaceTpl(a,r))),!1):!1};t.fn[o]=function(e,i,n){e=c(l,e),t(this).html(t.replaceTpl(e.ui.tplWrap,{skin:e.ui.skin,inner:function(e,i,n){var o=[];return t.each(e||i,function(i,r){0!=r.active&&o.push(t.replaceTpl(n,{service:e?r:i}))}),o.join("")}(i,e.services,e.ui.tplLi)})).on(e.ui.eventType,"[data-sns-share]",function(i){var o=i.target,r=t(o).data("witch");e.service=t(o).data("sns-share"),e.info.url="facebook_feed"===r?window.location.href+"&tn=snsFB_"+getConf("userId"):window.location.href+"&tn=snsTW_"+getConf("userId"),n&&(e=n.call(o,e)),p(e)})}}(window,document,navigator,"snsShare")});
;define("room:widget/newroom/step1/mod-newroom-newanchorinfo/mod-newroom-newanchorinfo.js",function(e,o,n){function i(e){var o=c(e).data("userid"),n=e,i=function(e){1==e?(c(n).removeClass("follow"),c(n).addClass("unfollow"),c(n).text(m.unfollow)):alert(e.message.errMessage)};y.follow(o,i)}function t(e){var o=c(e).data("userid"),n=e,i=function(e){1==e?(c(n).removeClass("unfollow"),c(n).addClass("follow"),c(n).html("<strong>+</strong>"+m.follow)):alert(e.message.errMessage)};y.unfollow(o,i)}function s(){c.ajax({url:"/user/api/medal/getUserMedalList",data:{uid:b("anchorId")},dataType:"json",cache:!1}).done(function(e){try{if(200!==+e.message.errNum&&201!==+e.message.errNum)return void d.alert({iconShow:"upset",contentText:e.message.errMessage});e=e.data;for(var o=0,n=e.length>5?5:e.length,i="";n>o;o++)i+='<a href="javascript:;" class="fireice-icon"><img class="medal" src="'+e[n-o-1].iconSmall+'" title="'+e[n-o-1].name+'"></a>';g.find(".medals").append(i)}catch(t){}})}function a(e){var o,n=g.find("span.medal-icon");w.getUser(e,"base",function(e,i){i.guildMedal&&i.guildId&&(o=h.getGuildIconTpl({guildId:i.guildId,guildName:i.guildMedal,guildLevel:i.guildLevel},i.roleInfo),n.html(o))})}function r(o,n,i){m=o.textMap;var t=g.find(".lv-container");f=new j(t,b("anchorId"),0,m),f.initPage(),i&&c.ajax({url:"/activity/Christmas/anchor",data:{userID:b("anchorId")},type:"GET"}).done(function(e){e&&e.message&&"0"===e.message.errNum&&+e.data.isIcon&&g.find(".newroom-christmas-hat").show()}).fail(),p.on("9",function(e){f.addExperience(e)}),this.textMap=m,s(),a(b("anchorId")),c("#snsShare").snsShare({ui:{top:0,tplLi:'<li class="sns-share_li sns-share_li-#{service}" log-mod="share"><a href="#" log-index="#{service}" data-witch="#{service}" data-sns-share="#{service}" title="'+n.tip+'" hidefocus="true" onclick="return !1"></a></li>'},info:n,services:{twitter:{api:"https://twitter.com/intent/tweet?text="+encodeURIComponent(n.description)+"&url=#{url}"},facebook_feed:{api:"https://www.facebook.com/dialog/feed?app_id="+b("fbAppId")+"&display=popup&caption=#{summary}&link=#{url}&redirect_uri="+n.redirectUrl+"&name=#{title}&picture=#{image}&description=#{description}",active:!1}}},["facebook_feed","twitter"]),c("#snsShare .sns-share_li-facebook_feed").find("a").text(m.faceBook),c("#snsShare .sns-share_li-twitter").find("a").text(m.twitter),c(".head-share-img").on("click",function(){c("#snsShare").toggle()}),c(document).on("click",function(e){c.contains(c("#snsShare")[0],e.target)||c("#snsShare")[0]===e.target||c(".head-share-img")[0]===e.target||c("#snsShare").hide()}),g.on("click",'[href="#about"]',function(){setTimeout(function(){c(document).trigger("hashLocate")},100)}),g.on("click",".setting",function(){c(document).trigger("anchorSetting")}),setTimeout(function(){c(".sns-air").show()},3e3),setTimeout(function(){c(".sns-air").hide()},8e3),p.on("12",function(e){if(+e.body.userId!==b("userId")){var o=g.find(".loveCard-wrap .text"),n=+o.text();o.text(++n)}}),c(document).on("addAnchorLoveCard",function(e,o){var n=g.find(".loveCard-wrap .text"),i=+n.text();n.text(i+(o||1))}),b("isSign")&&(b("userId")!==b("anchorId")?e.async("room:widget/newroom/step1/mod-newroom-newanchorinfo/mod-newroom-newanchorinfo-checkin.js",function(e){new e(o.checkin)}):c(".checkin-btn",".mod-newroom-newanchorinfo").addClass("checkin-disable")),g.on("mouseenter",".userImage",function(){var e=b("anchorId"),o={userId:e,$user:c(this),actionList:{publicChat:!0,whisper:!0,gift:!0,view:!0,follow:!0,addAdmin:!0,kickOut:!0},isVip:c(this).data("vip")};v.require("mod-roompublic-usermenu",function(e){e.showMenu(o)})}),g.on("mouseleave",".userImage",function(){var e=c(this);v.require("mod-roompublic-usermenu",function(o){o.closeMenu(e)})})}var c=e("common:widget/ui/jquery/jquery.js"),u=(e("common:widget/public/public-tools/public-tools.js"),e("common:widget/public/mod-public-login/mod-public-login.js")),l=e("common:widget/public/mod-public-property/mod-public-property.js"),d=e("common:widget/public/public-dialog/public-dialog.js");e("room:widget/newroom/step1/mod-newroom-snsshare/mod-newroom-snsshare.js"),e("common:widget/ui/jquery/widget/jquery.ui.popup/jquery.ui.popup.js");var m,f,p=e("common:widget/public/public-socket/public-socket.unpack.js"),h=e("common:widget/public/public-guildicon/public-guildicon.js"),w=e("common:widget/public/public-userinfo/public-userinfo.js"),g=c(".mod-newroom-newanchorinfo"),v=window.moduleMaster,b=window.getConf,j=e("room:widget/newroom/step1/mod-newroom-experience/experience.async.js");g.on("click",".btn-follow",function(){return b("isLogined")?void(c(this).hasClass("follow")?i(this):t(this)):void u.showDialog()});var y={send:function(e,o,n,i,t,s){if(l.account.checkBDUSS()){var a=1e4;void 0==s?s=!0:a=3e3,c.ajax({url:e,timeout:a,type:o,async:s,dataType:"json",data:n}).done(function(e){i&&"function"==typeof i&&i(e)}).fail(function(e){t&&"function"==typeof t&&t(n),console.log(e)}).always(function(){})}},follow:function(e,o){var n="/anchor?f=addFollow",i="POST",t={anchorId:e};if(o&&"function"==typeof o);else var o=function(e){alert(1==e?"follow success":e.message.errMessage)};this.send(n,i,t,o)},unfollow:function(e,o){var n=this;d.confirm({contentText:m.unfollowPrompt,onConfirm:function(){var i="/anchor?f=delFollow",t="POST",s={anchorId:e};o&&"function"==typeof o||(o=function(e){alert(1==e?"unfollow success":e.message.errMessage)}),n.send(i,t,s,o)}})}};n.exports={run:r}});
;define("room:widget/newroom/step1/mod-newroom-ordersong/mod-newroom-ordersong.js",function(t,e,o){function n(){v.popup({onLoad:function(){r(),l(".songstable").each(function(){l(this).scrollable({autoHide:!1})})}})}function s(){function t(){var t=e.find("tbody input:checked").length;l("#orderSongNum").text(t),l("#selectSongPrice").text(t*o)}l("#orderSongList").scrollable({autoHide:!1}),f.on(function(t){S.find(".resize-fix-hook").each(function(){l(this).hasClass("song-empty")?l(this).css({height:t-192}):l(this).hasClass("order-song-wrap")&&l(this).css({height:t-227})})}),S.on("click",".getOrderSong-button",function(){v.show()}),S.on("tab",function(){if(C=0,!(l("#songRecordContent tbody").find("tr").length>0)||isFirstInit){isFirstInit=!1;var t=function(t){if(t.recordList&&t.recordList.length>0){var e,o,n,s,a=t.recordList,r="";for(i=0;i<a.length;i++){var c=a[i].SongName;switch(""!=a[i].SingerName&&(c+="-"+a[i].SingerName),e=new Date(1e3*parseInt(a[i].CreatedTime,10)),hour=e.getHours()<10?"0"+e.getHours():e.getHours(),minute=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),o=hour+":"+minute,a[i].Status){case"0":n=d.processString,s=g.processStatusClass;break;case"1":n=d.acceptString,s=g.acceptStatusClass;break;case"2":n=d.rejectString,s=g.rejectedStatusClass;break;default:n=d.errorString,s=g.errorStatusClass}var u="";1==getConf("isMe")?"Accepted"==s?u=d.songAccept:"Rejected"==s?u=d.songRefused:"process"==s&&(u='<a href="javascript:;" class="songOption acceptSong"></a><a href="javascript:;" class="songOption refusedSong"></a>'):"process"==s?u=d.watting:"Rejected"==s?u=d.songRefused:"Accepted"==s&&(u=d.songAccept),r=r+'<tr data-recordid="'+a[i].ID+'"><td class="time" width="13%">'+o+'</td><td width="38%"><p class="toe titlet title">'+c+'</p></td><td width="35%"><p class="toe titlet name w81">'+a[i].NickName+'</p></td><td width="17%" class="status '+s+'">'+u+"</td></tr>"}l("#songRecordContent tbody").html(r)}else l(".song-empty").show(),l(".mod-newroom-ordersong ul").hide(),l("#theOrderSong").hide()};T.getAnchorSongRecord(y,b,w,t)}}),l(".orderSong").click(function(){var e=l.trim(l(".orderSongSection .songName").val()),o=l.trim(l(".orderSongSection .singerName").val());if(e=m.escapeToHtml(e),o=m.escapeToHtml(o),e&&e.length>H)return void alert(d.lessthan100);if(o&&o.length>k)return void alert(d.lessthan60);if(""==e)return alert(d.songnamenotbeempty),!1;var n=!0;if(l("#userOrderSongContent tbody").find('input[data-songname="'+m.escapeToHtml(e)+'"]').each(function(){return l(this).data("singername")==o?(n=!1,!1):void 0}),n){var s=e;""!=o&&(s+="-"+o);var a=new Date,i=a.getHours()<10?"0"+a.getHours():a.getHours(),r=a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes(),c=i+":"+r;l('<tr><td><p class="toe titlet">'+s+'</p></td><td><span class="time">'+c+'</span></td><td class="select"><input type="checkbox" class="chec" data-anchorid="'+getConf("anchorId")+'" data-songid="" data-singername="'+m.escapeToHtml(o)+'" data-songname="'+m.escapeToHtml(e)+'" checked="checked"></td></tr>').appendTo("#userOrderSongContent tbody"),l(".orderSongSection .songName").val(""),l(".orderSongSection .singerName").val("")}else alert(d.existinlist);t()}),l(".orderSongSection .submit").click(function(){if(!getConf("isLogined"))return u.showDialog(),!1;var t=[],e=l("#songReceiver").val();l("tbody input[type='checkbox']:checked","#userOrderSongContent").each(function(){var o={};o.AnchorId=m.escapeToHtml(l(this).data("anchorid")),o.RoomId=y,o.SongName=m.escapeToHtml(l(this).data("songname")),o.SingerName=m.escapeToHtml(l(this).data("singername")),o.SongId=m.escapeToHtml(l(this).data("songid")),o.SongReceiver=e,t.push(o)});var o=function(t){1==t?l("#songReceiver").val(""):514==t.message.errNum?alert(d.songNotExist):511==t.message.errNum?(p.balance.showRechargePrompt(),UT.send({type:"others",sort:"balanceLess",modId:"balanceWrap",value:"balanceLessVal"})):alert(d.ordersongfail)};if(t.length>0){if(e&&e.length>k)return void alert(d.lessthan60);T.doSong(t,o)}l(".mod-newroom-ordersong-popup").hide(),l(".modelMask").hide()}),l(".addSong").click(function(){var t=l.trim(l(".addSongSection .songName").val()),e=l.trim(l(".addSongSection .singerName").val());if(t=m.escapeToHtml(t),e=m.escapeToHtml(e),t.length>100||e.length>100)return void alert(d.lessthan100);if(t.length<=0)return void alert(d.songnamenotbeempty);var o=function(o){var n=!0,s="";if(l("#anchorEditSongsList tbody").find('input[data-songname="'+m.escapeToHtml(t)+'"]').each(function(){return l(this).data("singername")==e?(n=!1,!1):void 0}),s=e.length>0?'<td><p class="titlet toe">'+t+"-"+e+"</p></td>":'<td><p class="titlet toe">'+t+"</p></td>",n&&o.data&&o.data.songId){l(".addSongSection .songName").val(""),l(".addSongSection .singerName").val("");var a=new Date,i=a.getHours()<10?"0"+a.getHours():a.getHours(),r=a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes(),c=i+":"+r;l("<tr>"+s+'<td class="time">'+c+'</td><td class="select"><a class="delete"  data-songid="'+o.data.songId+'"></a></td></tr>').prependTo("#anchorEditSongsList tbody")}else alert(d.existinlist)};T.addSong(t,e,y,o)}),l("#batchCheckbox-orderSong").click(function(){"checked"==l(this).attr("checked")?(l("#userOrderSongContent tbody input[type=checkbox]").each(function(){l(this).attr("checked","checked")}),t()):l("#userOrderSongContent tbody input[type=checkbox]").each(function(){l(this).removeAttr("checked")})}),l("#userOrderSongContent tbody").on("click","input[type=checkbox]",function(){"checked"!=l(this).attr("checked")&&l("#batchCheckbox-orderSong").removeAttr("checked")});var e=l("#userOrderSongContent"),o=g.songsPrice;e.on("click","input[type=checkbox]",function(){t()}),l("#anchorBatchOperation .accept").click(function(){c(1)}),l("#anchorBatchOperation .cancel").click(function(){c(2)}),l("#anchorEditSongsList").on("click",".delete",function(){var t=m.escapeToHtml(l(this).data("songid")),e=this,o=function(t){1==t?l(e).parent().parent().remove():alert(d.delsongfail)};T.delSong(t,o)}),l(document).on("click",".acceptSong",function(){var t=m.escapeToHtml(l(this).parent().parent().data("recordid"));c(1,t)}),l(document).on("click",".refusedSong",function(){var t=m.escapeToHtml(l(this).parent().parent().data("recordid"));c(2,t)}),l(".operation li").hover(function(){l(this).addClass("sele")},function(){l(this).removeClass("sele")}),l(".to-process").on("click",function(){"none"==l(".operation").css("display")?l(".operation").show():l(".operation").hide()}),l("body").on("focus",".songName , .singerName",function(){l(this).removeClass("defaultt")})}function a(){h.on("1",function(t){var e=t.body.recordList,n=o.exports;for(i=0;i<e.length;i++){var s=e[i].ID;l(".mod-newroom-ordersong-popup").find("tr[data-recordid="+s+"]").each(function(){l(this).find(".status").attr("class","status"+n.config.acceptStatusClass)}),l("#orderSongList").find("tr[data-recordid="+s+"]").each(function(){l(this).find(".status").addClass("Accepted").html(d.songAccept)})}}),h.on("2",function(t){var e=o.exports,n=t.body.recordList;for(i=0;i<n.length;i++){var s=n[i].ID;l(".mod-newroom-ordersong-popup").find("tr[data-recordid="+s+"]").each(function(){l(this).find(".status").attr("class","status "+e.config.rejectedStatusClass)}),l("#orderSongList").find("tr[data-recordid="+s+"]").each(function(){l(this).find(".status").addClass("Rejected").html(d.songRefused)})}}),h.on("13",function(t){t=t.body,l("#orderSongNav").hasClass("chatSected")||(99>C&&(C+=t.songList.length||0),l("#unReadOrderSongTip").html(C).css("display","inline-block"));var e=t.songList,o=new Date,n=o.getHours()<10?"0"+o.getHours():o.getHours(),s=o.getMinutes()<10?"0"+o.getMinutes():o.getMinutes(),a=n+":"+s,r="";for(i=0;i<e.length;i++){var c=m.escapeToHtml(t.songList[i].SongName);""!=t.songList[i].SingerName&&(c+="-"+m.escapeToHtml(t.songList[i].SingerName)),whoOrdersong=1==getConf("isMe")?'<a href="javascript:;" class="songOption acceptSong"></a><a href="javascript:;" class="songOption refusedSong"></a>':"Waiting",r+='<tr data-recordid="'+t.songList[i].ID+'"><td class="time"  width="13%">'+a+'</td><td width="38%"><p class="toe titlet title">'+c+'</p></td><td width="35%"><p class="toe name w81">'+m.escapeToHtml(t.UserName)+'</p></td><td class="status process" width="17%">'+whoOrdersong+"</td></tr>"}l("#orderSongList tbody").prepend(r);var d=l("#orderSongList tbody").find("tr").size();d>0&&(l(".song-empty").hide(),l(".mod-newroom-ordersong ul").show(),l("#theOrderSong").show())})}function r(){var t=function(t){if(t.songList&&t.songList.length>0){var e,o,n=t.songList,s="";for(i=0;i<n.length;i++){e=new Date(1e3*parseInt(n[i].CreatedTime,10)),hour=e.getHours()<10?"0"+e.getHours():e.getHours(),minute=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),o=hour+":"+minute;var a=n[i].SongName;""!=n[i].SingerName&&(a+="-"+n[i].SingerName),s=p.identity.getIsCurAnchor()?s+'<tr><td><p class="toe titlet">'+a+'</p></td><td><span class="time">'+o+'</span></td><td class="select"><a class="delete" data-anchorid="'+n[i].AnchorId+'" data-songid="'+n[i].ID+'"></a></td></tr>':s+'<tr><td><p class="toe titlet">'+a+'</p></td><td><span class="time">'+o+'</span></td><td class="select"><input type="checkbox" name="items" class="chec" data-songname="'+m.escapeToHtml(n[i].SongName)+'" data-singername="'+m.escapeToHtml(n[i].SingerName)+'" data-anchorid="'+n[i].AnchorId+'" data-songid="'+n[i].ID+'"/></td></tr>'}p.identity.getIsCurAnchor()?l("#anchorEditSongsList tbody").html(s):l("#userOrderSongContent tbody").html(s)}};T.getSong(b,w,t)}function c(t,e){var o=function(e){var o=0;for(var n in e)e[n].result?1==t?l("#orderSongList tbody").find('tr[data-recordid="'+n+'"]').find(".status").html(d.songAccept):l("#orderSongList tbody").find("tr[data-recordid="+n+"]").find(".status").text(d.songRefused):o++;o&&alert(d.updatesongrecordfail)};T.updateSongRecord(e,y,t,o)}var d,g,l=t("common:widget/ui/jquery/jquery.js"),u=t("common:widget/public/mod-public-login/mod-public-login.js"),h=t("common:widget/public/public-socket/public-socket.unpack.js"),p=(t("common:widget/ui/jquery/widget/jquery.ui.scrollable/jquery.ui.scrollable.js"),t("common:widget/public/mod-public-property/mod-public-property.js")),m=t("common:widget/public/public-tools/public-tools.js"),f=t("room:widget/newroom/newroom.js"),S=l(".mod-newroom-ordersong"),v=l(".mod-newroom-ordersong-popup"),b=getConf("anchorId"),y=getConf("roomId"),w=1,k=60,H=100,C=0,T={send:function(t,e,o,n,s,a){if(p.account.checkBDUSS()){var i=1e4;void 0==a?a=!0:i=3e3,l.ajax({url:t,timeout:i,type:e,async:a,dataType:"json",data:o}).done(function(t){n&&"function"==typeof n&&n(t)}).fail(function(){s&&"function"==typeof s&&s(o)}).always(function(){})}},getLiveRooms:function(){var t="/liveroom/call?f=f_01&rt=json",e="POST",o={},n=function(t){0==t.status&&t.data.liveRooms.length>0};this.send(t,e,o,n)},doSong:function(t,e){var o="/anchor?f=doSong",n="POST",t={data:t};this.send(o,n,t,e)},delSong:function(t,e){var o="/anchor?f=delSong",n="POST",s={songId:t};this.send(o,n,s,e)},addSong:function(t,e,o,n){var s="/anchor?f=addSong",a="POST",i={songName:t,singerName:e,roomId:o};this.send(s,a,i,n)},getAnchorSongRecord:function(t,e,o,n){var s="/anchor?f=getAnchorSongRecord",a="GET",i={roomId:t,page:o,anchorId:e};this.send(s,a,i,n)},getSong:function(t,e,o){var n="/anchor?f=getSong",s="GET",a={anchorId:t,page:e};this.send(n,s,a,o)},updateSongRecord:function(t,e,o,n){var s="/anchor?f=updateSongRecord",a="POST",i={id:t,status:o,roomId:e};this.send(s,a,i,n)}};o.exports={run:function(t,e){d=t,g=e,n(),s(),a()}}});
;define("room:widget/newroom/step1/mod-newroom-parking/mod-newroom-parking.js",function(o,i,r){function e(){n.ajax({type:"get",dataType:"json",url:"/anchor/getroomcars?roomId="+getConf("roomId"),success:function(o){o.result.count&&o.result.count>=1&&l.setMessageNum("parking",o.result.count);var i="",r=o.result.list,e='<div class="buy-cart"><img src="'+c.buyCarImg+'"></div><a href="/store/car" data-sort="roomBuyCar" data-val="roomBuyCar" class="cancel-button buy-car">'+c.buyCar+"</a>";if(0===o.result.count)i+="<li></li><li></li><li><div>"+e+"</div></li>";else if(1==o.result.count){for(var n in r)r[n]&&(i+='<li><div><img src="'+r[n].Logo+'" alt="" /></div><p class="toe">'+r[n].UserName+"</p></li>");i+="<li></li><li><div>"+e+"</div></li>"}else for(var n in r)r[n]&&(i+='<li><div><img src="'+r[n].Logo+'" alt="" /></div><p class="toe">'+r[n].UserName+"</p></li>");if(u.html("").append(i),o.result.count>=2){var t=u.children("li");t.eq(1).after("<li><div>"+e+"</div></li>")}}})}var n=o("common:widget/ui/jquery/jquery.js"),t=(o("common:widget/ui/jquery/widget/jquery.ui.scrollable/jquery.ui.scrollable.js"),o("common:widget/public/mod-public-login/mod-public-login.js")),l=o("room:widget/newroom/step1/mod-newroom-uitab/mod-newroom-uitab.js"),a=o("room:widget/newroom/newroom.js"),s=n(".mod-newroom-parking"),u=n("#parkingLotUl"),c={};r.exports={run:function(o){c=o.textMap,a.on(function(o){s.find(".resize-fix-hook").css({height:o-151})}),u.scrollable({autoHide:!1}),e(),n(".buy-car","#parkingLotUl").live("click",function(){return getConf("isLogined")?void 0:(t.showDialog("mod-newroom-parking"),!1)}),n(".mod-newroom-parking").on("tab",function(){e()})}}});
;define("room:widget/newroom/step1/mod-newroom-rank-new/mod-newroom-rank-new.js",function(n,e,a){function t(n,e,a,t){var s="get",r=1e4;l.ajax({url:n,timeout:r,type:s,dataType:"json",data:e}).done(function(n){a&&"function"==typeof a&&a(n)}).fail(function(){t&&"function"==typeof t&&t()}).always(function(){})}function s(n,e){var a="";if(n.errno||n.message&&n.message.errNum)return a='<li><p class="rich-empty">'+e+"</p></li>","/hiapi/ranklist/getUserCloseRank"===n.url&&(a='<span class="rank-ranking contenter-self-ranking">99+</span><span class="rank-name contenter-self-name" data-userid="1"data-username="'+R+'">'+R+'</span><span class="rank-numbers contenter-self-number toe">0</span>'),a;if(n.data===!1)return a='<li><p class="rich-empty">'+e+"</p></li>";var t={},s=n.data,r=1;switch(n.url){case"/api/rank/rankInShow":r=s.length<10?s.length:10;for(var o=0;r>o;o++){var i=s[o].IsVip&&s[o].BadgeImg[0];t.vipAttr=i?"data-vip="+i:"",t.ranking=o+1,t.userId=s[o].UserID,t.userName=f.escapeToHtml(s[o].name),t.score=s[o].likeNum,t.special=3>o?"special"+(o+1):"",a+=l.replaceTpl(j,t)}break;case"/hiapi/ranklist/superFansRankList":r=s.length<10?s.length:10;for(var o=0;r>o;o++)t.ranking=o+1,t.userId=s[o].fromUid,t.userName=f.escapeToHtml(s[o].fromName),t.score=s[o].score,t.special=3>o?"special"+(o+1):"",a+=l.replaceTpl(U,t);break;case"/hiapi/ranklist/getUserCloseRank":if(t.userName=f.escapeToHtml(s.name),-1===s.rank||-2===s.rank){var c='<span class="rank-ranking contenter-self-ranking">99+</span><span class="rank-name contenter-self-name"data-username="#{userName}">#{userName}</span><span class="rank-numbers contenter-self-number toe">0</span>';a+=l.replaceTpl(c,t)}else if(-3===s.rank){t.score=s.score;var c='<span class="rank-ranking contenter-self-ranking">99+</span><span class="rank-name contenter-self-name"data-username="#{userName}">#{userName}</span><span class="rank-numbers contenter-self-number toe">#{score}</span>';a+=l.replaceTpl(c,t)}else t.ranking=s.rank>99?"99+":s.rank,t.userName=f.escapeToHtml(s.name),t.score=s.score,a+=l.replaceTpl(L,t)}return""===a&&(a='<li><p class="rich-empty">'+e+"</p></li>"),a}function r(n,e){var a=s(n,e);"/hiapi/ranklist/getUserCloseRank"===n.url?p.html(a):d.html(a)}function o(n,e){var a={};switch(n){case"/api/rank/rankInShow":a={roomid:I,topk:10,duration:e};break;case"/hiapi/ranklist/superFansRankList":a={version:"1.0",roomId:I,duration:e,start:0,count:10};break;case"/hiapi/ranklist/getUserCloseRank":a={version:"1.0",hostId:N,duration:e}}return a}function i(n,e){var a=k.find(".focus-tab-title").data("sort").split(","),n=n?n:h.find(".focus-contenter-title").data("sort");if(1===a.length){var s=D[a[0]],i=f.formatData(o(s,n));if(H[n])return;H[n]=!0,setTimeout(function(){t(s,i,function(e){if(H[n]=!1,e.url=s,"day"===n){var a=l("#tab-contenter-title").find("a").eq(0);if(!a.hasClass("focus-contenter-title"))return}r(e,M)},function(){H[n]=!1})},e||0)}else{var c=D[a[0]],u=f.formatData(o(c,n));if(getConf("isLogined")){var m=D[a[1]],d=f.formatData(o(m,n));if(A[n])return;A[n]=!0,setTimeout(function(){t(c,u,function(e){if("day"===n){var a=l("#tab-contenter-title").find("a").eq(0);if(!a.hasClass("focus-contenter-title"))return}e.url=c,r(e,F)},function(){A[n]=!1}),t(m,d,function(e){if(A[n]=!1,e.url=m,"day"===n){var a=l("#tab-contenter-title").find("a").eq(0);if(!a.hasClass("focus-contenter-title"))return}r(e,F)},function(){A[n]=!1})},e||0)}else{var b='<span class="rank-ranking contenter-self-ranking">99+</span><span class="rank-name contenter-self-name" data-userid="1"data-username="'+R+'">'+R+'</span><span class="rank-numbers contenter-self-number toe">0</span>';if(p.html(b),A[n])return;A[n]=!0,setTimeout(function(){t(c,u,function(e){if(A[n]=!1,e.url=c,"day"===n){var a=l("#tab-contenter-title").find("a").eq(0);if(!a.hasClass("focus-contenter-title"))return}r(e,F)},function(){A[n]=!1})},e||0)}}}function c(){b.find(".contenter-bottom-arrow").on("click",function(){var n=k.find(".focus-tab-title").data("tab");73===l("ol").height()?(l(this).find("img").attr("src","/static/room/widget/newroom/step1/mod-newroom-rank-new/img/out-up_7c1ced5.png"),l("ol").css("height","250"),"rich"===n?(p.css("display","none"),v.css("display","none"),g.show()):g.show()):(y.removeClass("focus-contenter-title"),C.addClass("focus-contenter-title"),i("day"),l(this).find("img").attr("src","/static/room/widget/newroom/step1/mod-newroom-rank-new/img/out-down_d6bb382.png"),l("ol").css("height","73"),g.hide("fast"),p.css("display","block"),v.css("display","inlineBlock"))}),w.on("click",function(){w.removeClass("focus-tab-title"),l(this).addClass("focus-tab-title");var n=l(this).data("tab");T=l(this).data("sort"),i(),250===l("ol").height()&&("rich"===n?(v.fadeOut("fast"),p.hide("fast")):(v.fadeIn("fast"),p.show("fast")))}),y.on("click",function(){y.removeClass("focus-contenter-title"),l(this).addClass("focus-contenter-title"),i()}),l(".tab-contenter-ranklist").on("click",".rank-name",function(){var n=l(this).data("userid"),e={userId:n,$user:l(this),doChat:!0,actionList:{publicChat:!0,whisper:!0,gift:!0,view:!0,follow:!0,addAdmin:!0,kickOut:!0},isVip:l(this).data("vip")};m.require("mod-roompublic-usermenu",function(n){n.showMenu(e,{dir:"bottom",gap:-30,className:"mod-roompublic-usermenu newroom-rank",customLocation:!0})})}),l(".tab-contenter-ranklist").on("mouseleave",".rank-name",function(){var n=l(this);m.require("mod-roompublic-usermenu",function(e){e.destroyMenu(n)})});var n=l('<div class = "div-tip">'+S+"</div>");l(".rules-help-font").tip({backgroundColor:"#fff",borderColor:"#ccc",className:"fansRank-rule-tip",content:n,dir:"bottom",customLocation:!0})}var l=n("common:widget/ui/jquery/jquery.js"),u=n("common:widget/public/public-socket/public-socket.unpack.js"),f=n("common:widget/public/public-tools/public-tools.js"),m=(n("common:widget/ui/jquery/widget/jquery.ui.tip/jquery.ui.tip.js"),n("common:widget/public/public-dialog/public-dialog.js"),window.moduleMaster),p=l("#tab-contenter-self"),d=l("#tab-contenter-ranklist ol"),k=l("#rank-tab-title"),h=l("#tab-contenter-title"),b=l("#tab-contenter-bottom"),g=l("#rank-tab-fold"),v=h.find(".rules-help-font"),w=k.find("h3"),y=h.find("a"),C=h.find("a:first"),I=getConf("roomId"),N=(getConf("userId"),getConf("anchorId")),q=getConf("isUgc"),T="day",R="",j='<li><span class="rank-ranking #{special}">#{ranking}</span><span class="rank-name toe user-name-hook"data-userid="#{userId}" data-name="#{userName}" #{vipAttr}>#{userName}</span><span class="rank-numbers toe">#{score}</span></li>',U='<li><span class="rank-ranking #{special}">#{ranking}</span><span class="rank-name toe user-name-hook"data-userid="#{userId}" data-name="#{userName}">#{userName}</span><span class="rank-numbers toe rank-numbers-heart">#{score}</span></li>',L='<span class="rank-ranking contenter-self-ranking">#{ranking}</span><span class="rank-name contenter-self-name"data-username="#{userName}">#{userName}</span><span class="rank-numbers contenter-self-number toe">#{score}</span>',D={richRank:"/api/rank/rankInShow",fansRank:"/hiapi/ranklist/superFansRankList",selfRank:"/hiapi/ranklist/getUserCloseRank"},H={day:!1,week:!1,month:!1,all:!1},A={day:!1,week:!1,month:!1,all:!1},F="",M="",S="";a.exports={run:function(n){if(F=n.fansEmptyTip,M=n.richEmptyTip,S=n.rulesTip,R=n.yourself,q){var e=l("#rank-tab-title .focus-tab-title");l(".focus-tab-title").addClass("yes-ugc-tab"),e.css("display","block")}else w.css("display","block");i(),c()}},l(document).on("fansRankUpdate",function(){var n=l("#tab-contenter-title").find("a").eq(0);n.hasClass("focus-contenter-title")&&i("day",2500)}),u.on("1",function(){var n=l("#tab-contenter-title").find("a").eq(0);n.hasClass("focus-contenter-title")&&i("day",2500)}),u.on("3",function(n){var e=l("#tab-contenter-title").find("a").eq(0);e.hasClass("focus-contenter-title")&&n.toRoom===getConf("roomId")+""&&i("day",2500)}),u.on("26",function(){var n=l("#tab-contenter-title").find("a").eq(0);n.hasClass("focus-contenter-title")&&i("day",2500)}),u.on("27",function(n){var e=l("#tab-contenter-title").find("a").eq(0);e.hasClass("focus-contenter-title")&&n.body.RoomID===getConf("roomId")+""&&i("day",2500)})});
;define("room:widget/newroom/step1/mod-newroom-rank/mod-newroom-rank.js",function(n,o,t){function e(){s(".contentContainer .rank-arrow").on("click",function(){73===s("ol").height()?(s(this).find("img").attr("src","/static/room/widget/newroom/step1/mod-newroom-rank/img/out-up_7c1ced5.png"),s("ol").css("height","250")):(s(this).find("img").attr("src","/static/room/widget/newroom/step1/mod-newroom-rank/img/out-down_d6bb382.png"),s("ol").css("height","73"))}),s(".contentContainer").on("click",".rank-user-name",function(){var n=s(this).data("userid"),o={userId:n,$user:s(this),doChat:!0,actionList:{publicChat:!0,whisper:!0,gift:!0,view:!0,follow:!0,addAdmin:!0,kickOut:!0},isVip:s(this).data("vip")};m.require("mod-roompublic-usermenu",function(n){n.showMenu(o,{dir:"bottom",gap:-30,className:"mod-roompublic-usermenu newroom-rank",customLocation:!0})})}),s(".contentContainer").on("mouseleave",".rank-user-name",function(){var n=s(this);m.require("mod-roompublic-usermenu",function(o){o.destroyMenu(n)})})}function a(){s("#rankTitle").on("click","a",function(){var n=s(this),o=n.data("type"),e=n.data("container");s("a","#rankTitle").removeClass("ranking-select"),n.addClass("ranking-select"),s(".gifts-rank-list").hide();var a=s("#"+e);switch(o){case"monthRankNav":a.show(),t.exports.getGiftRank("month");break;case"weekRankNav":a.show(),t.exports.getGiftRank("week");break;case"dayRankNav":a.show(),t.exports.getGiftRank("day");break;case"allRankNav":a.show(),t.exports.getGiftRank("all")}})}function i(n,o,t){var e="/api/rank/rankInShow",a="get",i=1e4,r={roomid:getConf("roomId"),duration:n,topk:10};r=c.formatData(r),s.ajax({url:e,timeout:i,type:a,dataType:"json",data:r}).done(function(n){o&&"function"==typeof o&&o(n)}).fail(function(){t&&"function"==typeof t&&t()}).always(function(){})}{var s=n("common:widget/ui/jquery/jquery.js"),r=n("common:widget/public/public-socket/public-socket.unpack.js"),c=n("common:widget/public/public-tools/public-tools.js"),u=(n("common:widget/public/public-dialog/public-dialog.js"),'<li><span class="rank-number #{special}">#{number}</span><span class="rank-user-name toe user-name-hook" data-userid="#{userId}"data-name="#{userName}" #{vipAttr}>#{userName}</span><span class="rank-consume-icon"></span><span class="rank-consume-number toe">#{consumption}</span></li>'),m=window.moduleMaster;getConf("roomId"),s("#rankTitle").children("a")}t.exports={isUpdating:{day:!1,week:!1,month:!1,all:!1},run:function(){this.getGiftRank("day",300),e(),a()},sucCallback:function(n,o){var t=s("#"+o+"Rank");if(!n.message||n.message.errNum)return void t.find(".rich-empty").show();for(var e=n.data,a=e.length<10?e.length:10,i="",r={},m=0;a>m;m++){var d=e[m].IsVip&&e[m].BadgeImg[0];r.vipAttr=d?"data-vip="+d:"",r.number=m+1,r.userId=e[m].UserID,r.userName=c.escapeToHtml(e[m].name),r.consumption=e[m].likeNum,r.special=m>2?"special":"",i+=s.replaceTpl(u,r)}i?t.find("ol").html(i):t.find(".rich-empty").show()},getGiftRank:function(n,o){var t=this;t.isUpdating[n]||(t.isUpdating[n]=!0,setTimeout(function(){i(n,function(o){t.isUpdating[n]=!1,t.sucCallback(o,n)},function(){t.isUpdating[n]=!1})},o||0))}},r.on("1",function(){t.exports.getGiftRank("day",2500)}),r.on("3",function(n){n.toRoom===getConf("roomId")+""&&t.exports.getGiftRank("day",2500)}),r.on("26",function(){t.exports.getGiftRank("day",2500)}),r.on("27",function(n){n.body.RoomID===getConf("roomId")+""&&t.exports.getGiftRank("day",2500)})});
;define("room:widget/newroom/step1/mod-newroom-roomhot/mod-newroom-roomhot.js",function(o,n,i){function t(o){var n=!1;return function(){if(!u("isLogined"))return void r.showDialog("mod-newroom-roomhot");var i="/hiapi/room/checkAgainst?anchorId="+u("anchorId");e.ajax({type:"get",url:i}).done(function(i){i.result?a.alert({id:"failDialog",iconShow:"amazed",contentText:'<p class="fail1">'+o.fail1+'</p><p class="fail2">'+o.fail2+"</p>",confirmText:o.confirm}):n?e(document).trigger("showInformDialog"):(e(document).trigger("loadWidget","inform"),n=!0)}).fail(function(o){console.log(o)})}}var e=o("common:widget/ui/jquery/jquery.js"),r=o("common:widget/public/mod-public-login/mod-public-login.js"),a=o("common:widget/public/public-dialog/public-dialog.js"),c=o("common:widget/public/public-userinfo/public-userinfo.js"),d=o("room:widget/newroom/newroom.js"),l=e(".mod-newroom-roomhot"),s=650,u=window.getConf;i.exports={run:function(o){var n=l.find(".btn-to-live"),i=l.find(".btn-to-person"),r=!1;d.on(function(o){s=o+15}),l.on("click",".btn-to-live",function(){r=!0,e("body").animate({scrollTop:0},300,function(){r=!1}),e(this).addClass("cur"),i.removeClass("cur"),history&&history.replaceState&&history.replaceState({},document.title,window.location.href.replace(/#.*/,""))}),l.on("click",".btn-to-person",function(){r=!0,e("body").animate({scrollTop:s},300,function(){r=!1}),n.removeClass("cur"),e(this).addClass("cur"),history&&history.replaceState&&history.replaceState({},document.title,window.location.href.replace(/#.*/,""))}),l.on("click",".inform-bg",t(o)),e(document).on("likereportsuc",function(){l.find(".shutup-anchor").text("OPEN").data("status","open")});var a=u("anchorId");c.getUser(a,"base",function(o,n){l.on("click",".shutup-anchor",function(){var o=this;"open"===e(this).data("status")?e.ajax({url:"/hiapi/room/admin/unbanroom?jsonp=?",data:{guildId:n.guildId||0,rid:u("roomId"),userId:u("anchorId")},dataType:"jsonp",type:"POST"}).done(function(n){0===n.status?(e(o).text("CLOSE").data("status","close"),alert("OPEN SUCCESS!")):alert("FAIL! Please try again!")}).fail(function(){alert("FAIL! Please try again!")}):e(document).trigger("likereportshow",{guildId:n.guildId||0,uid:a,act:"bannedAnchor",room:u("roomId"),name:n.NickName,from:"room"})})}),e(window).scroll(function(){return r?void 0:(e(window).scrollTop()<s?(n.addClass("cur"),i.removeClass("cur")):(n.removeClass("cur"),i.addClass("cur")),!1)});var m=l.find(".load-info"),f=l.find("a.load-bg"),p=setTimeout(function(){m.hide()},1e4);f.hover(function(){clearTimeout(p),m.show()},function(){m.hide()}),this.musicLink()},musicLink:function(){l.find(".btn-copyright").on("click",function(){e(document).trigger("showNewRoomMusic")})}}});
;define("room:widget/newroom/step1/mod-newroom-userlist/mod-newroom-userlist.js",function(i,e,t){function o(i,e){var t=e||L[i];s.ajax({url:"/liveroom/studio/getUserlist",type:"GET",dataType:"json",data:{roomid:v("roomId"),start:0,count:t,groupid:v("adminGroupId"),type:j[i],isFirst:1}}).done(function(e){if(!e.errNum&&e.data){e.data.length||T[i].text(0);var o="",a=e.data;T[i].text(e.count);for(var r in a){var s=a[r],l=s.BadgeImg,f="",p="",w="";if(s.WealthLevelIcon&&(p='<span><a href="/helppage/host_level"><img src="'+s.WealthLevelIcon+'" title="'+g("wealthIconTitle")+'"/></a> </span>'),f+=m.getGuildRootIcon(s.roleInfo),l)for(r=0;r<l.length;r++)f+='<span><a href="/store"><img class="bgimg" src="'+l[r]+'" title="VIP"></a></span>';f+=u.getMedalsTpl(s.MedalList||[]),w=s.guildMedal?m.getGuildIconTpl({guildId:s.guildId,guildName:s.guildMedal,guildLevel:s.guildLevel},s.roleInfo):"";var I=s.MobileOs,L="",j="",S="";I&&0===i&&(I==y.userList.ios?(L='<img src="'+y.userList.iosSign+'" class="mobileOs" title="'+y.userList.iosHover+'" >',j="iosSort",S="iosVal"):I===y.userList.android&&(L='<img src="'+y.userList.androidSign+'" class="mobileOs" title="'+y.userList.androidHover+'" >',j="androidSort",S="androidVal"));var k=s.IsVip&&l[0],x=d.escapeToHtml(s.NickName);o+='<li class="cf user-name-hook'+(s.UserID==v("anchorId")?" anchor":"")+(k?" vip":"")+'" data-wealthicon="'+s.WealthLevelIcon+'" data-userid="'+s.UserID+'" data-name="'+x+'" data-menutype="'+("visitor"===i?"userList":"adminList")+'"'+(k?' data-vip="'+k+'"':"")+' log-mod="mobileOSMod"><p class="userNameClass">'+x+'</p><a href="'+y.userList.osLink+'" data-sort="'+j+'" data-val="'+S+'">'+L+'</a><div class="badgeSection"> '+p+n(s.UserID)+f+"</div>"+w+"</li>","admin"===i&&v("userId")===+s.UserID&&c.identity.setIsAdmin(!0,!0)}o="<ul>"+o+"</ul>",t>0&&t<e.count&&(o+='<div class="buttons"><a class="cancel-button btn-load-more" href="javascript:;" data-type="'+i+'" data-count="'+(t+h)+'">'+y.userList.more+"</a></div>"),b[i].html(o)}})}function n(i){var e="";return s.each(r,function(t,o){i+""===o.uid&&(e='<img class="customerIcon" src="'+o.icon+'" title="'+o.title+'" alt="'+o.title+'">')}),e}function a(){w.on("click",".visitor-nav",function(){s(this).addClass("selected"),I.admin.removeClass("selected"),w.find(".list-wrap.visitor").show(),w.find(".list-wrap.admin").hide()}),w.on("click",".admin-nav",function(){s(this).addClass("selected"),I.visitor.removeClass("selected"),w.find(".list-wrap.visitor").hide(),w.find(".list-wrap.admin").show()}),w.on("click",".btn-load-more",function(){var i=s(this).data("type"),e=s(this).data("count");o(i,e)}),b.visitor.scrollable({autoHide:!0}),b.admin.scrollable({autoHide:!0});var i;w.on("mouseenter",".tab-content li",function(){var e=s(this).data("userid"),t=s(this);clearTimeout(i),i=setTimeout(function(){var i={userId:e,$user:t,actionList:{publicChat:!0,whisper:!0,gift:!0,view:!0,follow:!0,kickOut:!0},isVip:s(this).data("vip")};"adminList"===t.data("menutype")?i.actionList.delAdmin=!0:i.actionList.addAdmin=!0,p.require("mod-roompublic-usermenu",function(e){e.showMenu(i,{hideDelay:1,dir:"left",gap:4})})},200)}),w.on("mouseleave",".tab-content li",function(){clearTimeout(i);var e=s(this);p.require("mod-roompublic-usermenu",function(i){i.destroyMenu(e)})}),w.on("click",".tab-content li",function(){var i=s(this).data("userid");p.require("mod-roompublic-usermenu",function(e){e.publicChat(i)})}),window.ccroomPerformance.userlistEndTime=(new Date).getTime()-v("pageStartTime"),setTimeout(function(){var i={type:"others",modId:"roomPerformance",country:v("country"),flashStartTime:window.ccroomPerformance.flashStartTime,flashEndTime:window.ccroomPerformance.flashEndTime,chatStartTime:window.ccroomPerformance.chatStartTime,chatEndTime:window.ccroomPerformance.chatEndTime,giftStartTime:window.ccroomPerformance.giftStartTime,giftEndTime:window.ccroomPerformance.giftEndTime,userlistStartTime:window.ccroomPerformance.userlistStartTime,userlistEndTime:window.ccroomPerformance.userlistEndTime};for(var e in i)if("undefined"==typeof i[e])return!0;UT.send(i)},5e3)}var r,s=i("common:widget/ui/jquery/jquery.js"),d=i("common:widget/public/public-tools/public-tools.js"),l=i("common:widget/public/public-socket/public-socket.unpack.js"),c=(i("common:widget/ui/jquery/widget/jquery.ui.scrollable/jquery.ui.scrollable.js"),i("common:widget/public/mod-public-property/mod-public-property.js")),u=i("common:widget/public/public-medallist/public-medallist.js"),m=i("common:widget/public/public-guildicon/public-guildicon.js"),f=(i("common:widget/public/public-dialog/public-dialog.js"),i("room:widget/newroom/newroom.js")),p=window.moduleMaster,v=window.getConf,g=window.getText,w=s(".mod-newroom-userlist"),h=20,b={visitor:w.find(".visitor-list"),admin:w.find(".admin-list")},I={visitor:w.find(".visitor-nav"),admin:w.find(".admin-nav")},T={visitor:I.visitor.find("span"),admin:I.admin.find("span")},y={};t.exports={run:function(i,e){y=i,r=e,l.on("4",function(i){if(!b.admin.find("li[data-userid="+i.body.userId+"]").length){var e=b.visitor.find("li[data-userid="+i.body.userId+"]");e.length?(b.admin.find("ul").prepend(e.clone(!0).data("menutype","adminList")),T.admin.text(+T.admin.text()+1)):o("admin"),v("userId")===+i.body.userId&&c.identity.setIsAdmin(!0)}}),l.on("5",function(i){var e=b.admin.find("li[data-userid="+i.body.userId+"]");e.length&&(e.remove(),T.admin.text(+T.admin.text()-1)),v("userId")===+i.body.userId&&c.identity.setIsAdmin(!1)}),l.on("11",function(i){var e=b.visitor.find("li[data-userid="+i.body.userId+"]");e.length&&(e.remove(),T.visitor.text(+T.visitor.text()-1))});var t;l.on("15",function(i){"0"!==String(i.body.userId).substr(0,1)&&v("isLogined")&&(t||(t=!0,setTimeout(function(){o("visitor"),t=!1},3e4)))}),f.on(function(i){w.find(".resize-fix-hook").css({height:i-52})}),o("visitor"),o("admin"),a()}};var L={visitor:h,admin:-1},j={visitor:0,admin:1}});
;define("room:widget/newroom/step1/mod-newroom-weekstar/countDown.min.js",function(i,a,l){function n(s,i,d){this.$mod=s,this.cmsData=i.cmsData,this.leftTime=d}function v(){function s(s,i,d){var a=s.querySelector(".fore"),l=s.querySelector(".back"),n=a.querySelectorAll(".inn"),v=l.querySelectorAll(".inn"),o=n[0].innerHTML,e=c(document.body);(c.browser.msie&&("9.0"==c.browser.version||"8.0"==c.browser.version)||o!=i)&&(d=d||o||"8",c.map(v,function(s){s.innerHTML=i}),e.removeClass("play"),a.className="before back",l.className="active fore",e.addClass("play"))}!function(i,d){var a=(c("i.clock"),c("#filpClock .flip")),l=c("#filpCountDown .flip"),n=function(s,i){return i=Math.pow(10,i||2),i>s?(i+s+"").slice(1):s+""},v=function(){var i=c("#filpClock").attr("nowtime"),v=0,o=parseInt(i.substr(0,2),10),e=parseInt(i.substr(2,2),10),t=parseInt(i.substr(4,2),10),r=arguments.callee;console.log(o+":"+e+":"+t),c.map(i.split(""),function(i,d){a[d]&&s(a[d],i)}),0==t&&0==e&&0==o&&0==v||(0==t&&0==e&&0==o?(--v,o=23,e=59,t=59):0==t&&0==e?(--o,e=59,t=59):0==t?(--e,t=59):--t);var p="";p+=n(o,2),p+=n(e,2),p+=n(t,2),c("#filpClock").attr("nowtime",p),c.map(p.split(""),function(i,d){l[d]&&s(l[d],i)}),d(r)};v()}(document,function(s){var i=setTimeout(s,1e3);window.weekstar2clock.push(i)})}var c=i("common:widget/ui/jquery/jquery.js"),o=i("common:widget/ui/helper/helper.js");window.weekstar2clock=[];var e=n.prototype;e.init=function(){this.render().then(function(){v()})},e.render=function(){var s=this;return this.formateTime().then(function(i){s.$mod.html(o.replaceTpl(s.tpl(),{time:i}))})},e.formateTime=function(){var i=this,a=c.Deferred(),l=i.leftTime;return 0>=l?a.resolve("000000"):(d=Math.floor(l/86400),h=Math.floor((l-24*d*60*60)/3600),m=Math.floor((l-24*d*60*60-3600*h)/60),s=Math.floor(l-24*d*60*60-3600*h-60*m),d=d>=10?d:"0"+d,h=h>=10?h:"0"+h,m=m>=10?m:"0"+m,s=s>=10?s:"0"+s,nowTime=""+h+m+s,a.resolve(nowTime))},e.getServerTime=function(){return c.ajax({url:"/operations/AprilFool/getCutDownTime"})},e.tpl=function(){return'<div id="filpClock" class="filp-wrap" nowtime="#{time}"><ul class="flip hour"><li class="fore"><span><div class="up"><div class="shadow"></div><div class="inn">0</div></div><div class="down"><div class="shadow"></div><div class="inn">0</div></div></span></li><li class="back"><span><div class="up"><div class="shadow"></div><div class="inn">0</div></div><div class="down"><div class="shadow"></div><div class="inn">0</div></div></span></li></ul><ul class="flip"><li class="fore"><span><div class="up"><div class="shadow"></div><div class="inn">0</div></div><div class="down"><div class="shadow"></div><div class="inn">0</div></div></span></li><li class="back"><span><div class="up"><div class="shadow"></div><div class="inn">0</div></div><div class="down"><div class="shadow"></div><div class="inn">0</div></div></span></li></ul><ul class="flip-space"><li class="space">:</li></ul><ul class="flip minute"><li class="fore"><span><div class="up"><div class="shadow"></div><div class="inn">0</div></div><div class="down"><div class="shadow"></div><div class="inn">0</div></div></span></li><li class="back"><span><div class="up"><div class="shadow"></div><div class="inn">0</div></div><div class="down"><div class="shadow"></div><div class="inn">0</div></div></span></li></ul><ul class="flip"><li class="fore"><span><div class="up"><div class="shadow"></div><div class="inn">0</div></div><div class="down"><div class="shadow"></div><div class="inn">0</div></div></span></li><li class="back"><span><div class="up"><div class="shadow"></div><div class="inn">0</div></div><div class="down"><div class="shadow"></div><div class="inn">0</div></div></span></li></ul><ul class="flip-space"><li class="space">:</li></ul><ul class="flip"><li class="fore"><span><div class="up"><div class="shadow"></div><div class="inn">0</div></div><div class="down"><div class="shadow"></div><div class="inn">0</div></div></span></li><li class="back"><span><div class="up"><div class="shadow"></div><div class="inn">0</div></div><div class="down"><div class="shadow"></div><div class="inn">0</div></div></span></li></ul><ul class="flip"><li class="fore"><span><div class="up"><div class="shadow"></div><div class="inn">0</div></div><div class="down"><div class="shadow"></div><div class="inn">0</div></div></span></li><li class="back"><span><div class="up"><div class="shadow"></div><div class="inn">0</div></div><div class="down"><div class="shadow"></div><div class="inn">0</div></div></span></li></ul></div>'},l.exports=n});
;define("room:widget/newroom/step1/mod-newroom-weekstar/mod-newroom-weekstar.js",function(e,t,n){function o(e){return(""+e).length<=5&&"defaultHead"in d?d.defaultHead:e}function a(e){for(var t=g.find(".weekstar-rank"),n="",a=0;a<e.length;a++)n+='<div class="sample" data-userid="'+e[a].UserId+'"><div class="num">'+(a+1)+'</div><a href= "/liveroom/'+e[a].RoomID+'" target="_blank" ><img class="head" src= "'+o(e[a].UserIcon)+'"/></a><div class="name">'+e[a].NickName+'</div><div class="time">'+e[a].Num+"</div></div>";t.html(n)}function r(e){for(var t=g.find(".cheststar-rank"),n="",a=0;a<e.length;a++)n+='<div class="sample" data-userid="'+e[a].UserId+'"><div class="num">'+(a+1)+'</div><a href= "/sns/myclips?uid='+e[a].UserId+'" target="_blank" ><img class="head" src= "'+o(e[a].UserIcon)+'"/></a><div class="name">'+e[a].NickName+'</div><div class="time">'+e[a].Num+"</div></div>";t.html(n)}function i(){g.on("click",".weekstar-nav-wrap",function(){g.find(".weekstar-nav-wrap").removeClass("weekstar-nav-current"),m(this).addClass("weekstar-nav-current"),"localStorage"in window&&(localStorage.setItem("weekstar",m(this).data("count")),localStorage.setItem("giftid",m(this).data("giftid"))),c(m(this).data("giftid"))})}function s(e,t){for(var n="",o=0;o<e.length;o++)n+='<div class="weekstar-nav-out"><div class="weekstar-nav-wrap" data-count="'+o+'" data-giftid="'+e[o].ID+'"><div class="center">'+e[o].Name+"</div></div></div>";g.find(".weekstar-nav").html(n),g.find(".weekstar-nav-wrap").removeClass("weekstar-nav-current"),g.find(".weekstar-nav-wrap").eq(t).addClass("weekstar-nav-current")}function l(){var e=localStorage.getItem("giftid");w=localStorage.getItem("giftid"),m.ajax({type:"GET",url:"/weeklystar/getRankInRoom?gift=1&giftId="+e}).done(function(e){g.find(".weekstar-title").addClass("week"===e.type?"weekstar-title-back":"monthstar-title-back"),s(e.gifts,b.i,d.gifts);for(var t in e.result)"revenue"in e.result[t]&&a(e.result[t].revenue),"consume"in e.result[t]&&r(e.result[t].consume);i(),u=new f(m(".count-down",g),{},e.leftTime).init()})}function c(e){m.ajax({type:"GET",url:"/weeklystar/getRankInRoom?giftId="+e}).done(function(t){for(var n in t.result)a(t.result[n].revenue),r(t.result[n].consume),w=e})}var d,u,m=e("common:widget/ui/jquery/jquery.js"),f=(e("common:widget/public/public-tools/public-tools.js"),e("common:widget/public/public-dialog/public-dialog.js"),e("room:widget/newroom/step1/mod-newroom-weekstar/countDown.min.js")),g=(getConf("roomId"),m("#modNewroomWeekstar")),v=e("common:widget/public/public-socket/public-socket.unpack.js"),w="";if(document.documentElement&&document.documentElement.clientHeight&&document.documentElement.clientWidth)var p=document.documentElement.clientHeight,k=document.documentElement.clientWidth;var I={left:0,top:0,currentX:0,currentY:0,flag:!1},h=function(e,t){return e.currentStyle?e.currentStyle[t]:document.defaultView.getComputedStyle(e,!1)[t]},y=function(e,t,n){"auto"!==h(t,"left")&&(I.left=h(t,"left")),"auto"!==h(t,"top")&&(I.top=h(t,"top")),e.onmousedown=function(t){I.flag=!0,t||(t=window.event,e.onselectstart=function(){return!1});var n=t;I.currentX=n.clientX,I.currentY=n.clientY},document.onmouseup=function(){I.flag=!1,"auto"!==h(t,"left")&&(I.left=h(t,"left")),"auto"!==h(t,"top")&&(I.top=h(t,"top"))},document.onmousemove=function(e){var o=e?e:window.event;if(I.flag){var a=o.clientX,r=o.clientY,i=a-I.currentX,s=r-I.currentY;parseInt(I.left,10)+i>0&&parseInt(I.left,10)+i<k-240&&(t.style.left=parseInt(I.left,10)+i+"px"),parseInt(I.top,10)+s>0&&parseInt(I.top,10)+s<p-700&&(t.style.top=parseInt(I.top,10)+s+"px")}"function"==typeof n&&n(parseInt(I.left,10)+i,parseInt(I.top,10)+s)}},b=function(){var e="",t="";if("localStorage"in window)var e=localStorage.getItem("weekstar")?localStorage.getItem("weekstar"):0,t=localStorage.getItem("giftid")?localStorage.getItem("giftid"):0;else e=0,t=0;return{i:e,giftId:t}}();v.on("weekstar2NewroomRank",function(e){if(e.body.giftId+""==w+""){try{a(e.body.revenueRank)}catch(t){console.log("NorevenueRank")}try{r(e.body.consumeRank)}catch(t){console.log("NoconsumeRank")}}}),n.exports={run:function(e){d=e,y(document.getElementById("dragWeekstar"),document.getElementById("modNewroomWeekstar")),l()}}});
