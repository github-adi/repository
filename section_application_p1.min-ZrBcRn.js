window.Box=window.Box||{},Box.Timing=Box.Timing||{execution:[],scripts:{},events:{}},Box.Timing.scripts.application_p1=(new Date).getTime(),Box.Timing.execution.push({name:"js/services/amsterdam/collab-actions.js",time:(new Date).getTime()}),Box.Application.addService("collab-actions",function(e){"use strict";function t(t){var r=s.getGcmCompatibleRm(i),l={itemTypedId:t};e.broadcast("collabrequestsent"),n.post(r,l).then(function(){e.broadcast("collabresponsereceived"),o.redirect("/files")},function(t){var i=t.data||{};e.broadcast("collabresponsereceived"),a.error(i.message||$t("You could not be removed as a collaborator. You may not have permission to perform this action.","remove_current_user_collab_error_notification"))})}var i="remove_current_user_collab",n=e.getService("ajax"),o=e.getService("nav"),a=e.getService("notifications-amsterdam"),r=e.getService("popups-amsterdam"),s=e.getService("url");return{removeCurrentUserFromItem:function(e){var i=$t("Remove Folder","remove_folder_confirmation_popup_title"),n=$t("Are you sure you want to remove yourself as a collaborator? You will no longer have access to content in this folder or its sub-folders and will not be able to complete pending tasks.","task_affected_current_user_removal_warning");r.confirm(n,i).then(function(){t(e)})}}}),Box.Timing.execution.push({name:"js/services/amsterdam/contact-selector-dropdown.js",time:(new Date).getTime()}),Box.Application.addService("contact-selector-dropdown",function(e){"use strict";function t(e,t){if(e&&t){var i=t.offsetHeight,n=t.scrollTop,o=Math.floor(i/5),a=e.offsetTop,r=0;if(r=a+o-(n+i),r>0)return void(t.scrollTop=n+r);r=n-a,r>0&&(t.scrollTop=n-r)}}function i(e,i){e.activeMenuItemEl&&d.removeClass(e.activeMenuItemEl,"hover"),e.activeMenuItemEl=i,e.activeMenuItemEl&&d.addClass(e.activeMenuItemEl,"hover"),t(e.activeMenuItemEl,e.selectorDropdownMenu)}function n(e){return function(t){var n,o,a=t.which||t.keyCode,r=e.activeMenuItemEl,c=e.selectorDropdownMenu;if(!d.hasClass(c,l))return!0;switch(a){case s.DOWN:r?i(e,r.nextSibling):i(e,c.children[0]);break;case s.UP:r?i(e,r.previousSibling):i(e,c.children[e.selectorDropdownMenu.children.length-1]);break;case s.RETURN:case s.TAB:if(!r||d.hasClass(r,"disabled"))break;n=r.getAttribute("data-id"),o=p[n]||{},e.fire("dropdownitemselect",{id:o.id,href:o.href,email:o.email,text:o.text,data:o.data}),d.removeClass(c,l);break;default:return!0}return!1}}function o(e){return function(t){var n=t.target||t.srcElement;n.getAttribute("data-id")?i(e,n):n.parentNode.getAttribute("data-id")&&i(e,n.parentNode)}}function a(e){return function(t){var i=t.target||t.srcElement,n="SPAN"===i.nodeName?i.parentNode:i,o=n.getAttribute("data-id"),a=p[o]||{};return!o||d.hasClass(n,"disabled")?!1:(e.fire("dropdownitemselect",{id:a.id,href:a.href,email:a.email,text:a.text,data:a.data}),void d.removeClass(e.selectorDropdownMenu,l))}}function r(e){var t=document.createElement("div");t.className="contact-selector-dropdown",d.insertAfter(t,e),this.keydownHandlerRef=n(this),this.mousedownHandlerRef=a(this),this.mouseoverHandlerRef=o(this),d.on(e,"keydown",this.keydownHandlerRef),d.on(t,"mouseover",this.mouseoverHandlerRef),d.on(t,"mousedown",this.mousedownHandlerRef),this.inputEl=e,this.selectorDropdownMenu=t,$.extend(this,new Box.EventTarget)}var s={UP:38,DOWN:40,RETURN:13,TAB:9},l="is-visible",c='<a class="<%= className %>" data-id="<%= id %>"><span class="contact-selector-dropdown-text"><%= text %></span><span class="contact-selector-dropdown-email"><%= secondaryText %></span></a>',_='<a class="<%= className %>" data-id="<%= id %>"><span class="contact-selector-dropdown-text"><%= text %></span><span class="contact-selector-dropdown-email"><%= secondaryText %></span><span data-hover="tooltip" aria-label="<%= badgeTooltip %>" class="badge role"><%= badgeTitle %></span></a>',d=e.getService("dom"),u=e.getService("templates"),p={};return r.prototype={setItems:function(e){var t,n,o,a=e.length;if(d.setHTML(this.selectorDropdownMenu,""),p={},a>0){for(t=0;a>t;t++)n=e[t].id,o=e[t].badge?u.createTemplateFragment(_,{id:""+n,text:e[t].text,secondaryText:e[t].email||"",className:e[t].isNotSelectable?"disabled":"",badgeTitle:e[t].badge.title,badgeTooltip:e[t].badge.tooltip}):u.createTemplateFragment(c,{id:""+n,text:e[t].text,secondaryText:e[t].email||"",className:e[t].isNotSelectable?"disabled":""}),this.selectorDropdownMenu.appendChild(o),p[n]=e[t];i(this,this.selectorDropdownMenu.children[0]),d.addClass(this.selectorDropdownMenu,l)}else d.removeClass(this.selectorDropdownMenu,l)},destroy:function(){d.off(this.inputEl,"keydown",this.keydownHandlerRef),d.off(this.selectorDropdownMenu,"mouseover",this.mouseoverHandlerRef),d.off(this.selectorDropdownMenu,"mousedown",this.mousedownHandlerRef)}},{create:function(e){return new r(e)}}}),Box.Timing.execution.push({name:"js/services/amsterdam/contextual-message/tour-modal.js",time:(new Date).getTime()}),Box.Application.addService("tour-modal",function(e){"use strict";function t(e){this.tourEl=e,this.backEl=n.query('[data-action="tour-previous"]',this.tourEl),this.nextEl=n.query('[data-action="tour-next"]',this.tourEl),this.carousel=i.create(this.tourEl)}var i=e.getService("slide-carousel"),n=e.getService("dom"),o="disable_selectable",a="final-slide",r="hidden",s="no_scroll",l=$t("Finish","tour_finish"),c=$t("Next","tour_next");return t.prototype={start:function(){this.carousel.goToSlide(0),this.resetButtons(),n.removeClass(this.tourEl,r),n.addClass(this.tourEl,o),n.addClass(document.body,s)},end:function(){n.addClass(this.tourEl,r),n.removeClass(this.tourEl,o),n.removeClass(document.body,s),this.carousel.destroy()},next:function(){this.carousel.goToNextSlide(),this.resetButtons()},previous:function(){this.carousel.goToPrevSlide(),this.resetButtons()},getCurrentSlideNum:function(){return this.carousel.getCurrentSlideNum()},resetButtons:function(){this.carousel.currentSlideNum===this.carousel.slideEls.length-1?n.addClass(this.tourEl,a):n.removeClass(this.tourEl,a),0===this.carousel.currentSlideNum?n.addClass(this.backEl,r):n.removeClass(this.backEl,r),this.carousel.currentSlideNum===this.carousel.slideEls.length-2?n.setHTML(this.nextEl,l):n.setHTML(this.nextEl,c)}},{create:function(e){return new t(e)}}}),Box.Timing.execution.push({name:"js/services/amsterdam/contextual-message/tour-fullscreen.js",time:(new Date).getTime()}),Box.Application.addService("tour-fullscreen",function(e){"use strict";function t(e,t){for(;e.childNodes.length>0;)t.appendChild(e.childNodes[0])}function i(e,t){return t.appendChild(e)}function n(e){this.carousel=o.create(e),this.tourEl=e,this.fakeBodyEl=null,this.windowResizeHandler=this.resizeFakeBodyEl.bind(this)}var o=e.getService("slide-carousel"),a=e.getService("dom"),r="disable_selectable",s="fullscreen-tour",l="hidden",c="is-active",_="no-transition";return n.prototype={start:function(){function e(){a.off(d.fakeBodyEl,"transitionend",e),d.carousel.goToSlide(0)}var n,o,_;n=document.createElement("div"),n.className="tour-fullscreen-fake-body-container tour-flex-container tour-full-abs-pos",_=document.createElement("div"),_.className="tour-fullscreen-fake-body tour-full-abs-pos "+c,n.appendChild(_),t(document.body,_),o=document.body.appendChild(n),this.fakeBodyEl=o.firstElementChild,this.tourEl=i(this.tourEl,document.body);var d=this;a.on(this.fakeBodyEl,"transitionend",e),a.addClass(document.body,s),a.removeClass(this.tourEl,l),a.addClass(document.body,r),this.resizeFakeBodyEl(null,!0),a.on(window,"resize",this.windowResizeHandler),document.body.focus()},end:function(){t(this.fakeBodyEl,document.body),document.body.removeChild(this.fakeBodyEl.parentNode),this.fakeBodyEl=null,a.removeClass(a.query(".slide.is-active",this.tourEl),c),a.addClass(this.tourEl,l),i(this.tourEl,document.body),this.tourEl=null,a.removeClass(document.body,s),a.removeClass(document.body,r),a.off(window,"resize",this.windowResizeHandler),this.carousel.destroy()},next:function(){this.carousel.goToNextSlide(),this.carousel.currentSlideNum>0&&a.removeClass(this.fakeBodyEl,c)},previous:function(){this.carousel.goToPrevSlide(),this.carousel.currentSlideNum<=0&&a.addClass(this.fakeBodyEl,c)},getCurrentSlideNum:function(){return this.carousel.getCurrentSlideNum()},resizeFakeBodyEl:function(e,t){var i=a.query(".slide .transparent",this.tourEl);if(i){var n=a.getBoundingClientRect(i);if(t||a.addClass(this.fakeBodyEl,_),this.fakeBodyEl.style.left=n.left+"px",this.fakeBodyEl.style.top=n.top+"px",this.fakeBodyEl.style.width=n.width+"px",this.fakeBodyEl.style.height=n.height+"px",!t){var o=this;setTimeout(function(){a.removeClass(o.fakeBodyEl,_)},0)}}}},{create:function(e){return new n(e)}}}),Box.Timing.execution.push({name:"js/services/amsterdam/notifications-amsterdam.js",time:(new Date).getTime()}),Box.Application.addService("notifications-amsterdam",function(e){"use strict";function t(){return n?n:(n=d.createElement("div"),n.className="notifications-wrapper",d.body.appendChild(n),n)}function i(e,t,i){this.type=e,this.title=t,this.button=i||null,this.uniqueID="notification_"+(new Date).getTime(),this.shown=!1,this.elem=null,this.promise=null}var n,o="info",a="warn",r="error",s=27,l=4e3,c=e.getService("dom"),_=e.getService("promises"),d=e.getGlobal("document"),u=0;return i.prototype.show=function(e){if(this.shown)return this.promise;this.shown=!0;var i=this.elem=d.createElement("div");i.className="notification is-hidden notification-type-"+this.type,i.setAttribute("role","alert"),i.setAttribute("aria-labeledby",this.uniqueID+"_label");var n=d.createElement("span");n.id=this.uniqueID+"_label",c.setText(n,this.title),i.appendChild(n);var o=this,a=function(){o.hide()};return this.promise=_.create(function(n,a){if(o.button){var r=d.createElement("button");r.className="btn notification-btn",c.setText(r,o.button),i.appendChild(r),i.className+=" has-btn",c.on(r,"click",n)}var s=d.createElement("button");s.className="notification-close-btn",s.title=$t("Close","notification_close"),i.appendChild(s),c.on(s,"click",a),t().appendChild(i),setTimeout(function(){c.removeClass(i,"is-hidden"),u++},100),-1!==e&&setTimeout(a,e)}),this.promise.then(a,a),c.on(d.body,"keydown",function(e){e.which===s&&o.hide()}),this.promise},i.prototype.hide=function(){if(this.shown){var e=this;this.elem.style.marginTop="-"+(this.elem.clientHeight+10)+"px",c.addClass(this.elem,"is-hidden"),setTimeout(function(){e.elem.parentNode&&e.elem.parentNode.removeChild(e.elem),u--},250)}},{info:function(e,t){return this._show(o,e,t)},confirm:function(e,t){return this.info(e,t)},warn:function(e,t){return this._show(a,e,t)},error:function(e,t){return t=t||{},t.duration=t.duration||-1,this._show(r,e,t)},create:function(e,t,n){return new i(e,t,n)},_show:function(e,t,i){i=i||{},i.duration=i.duration||l;var n=this.create(e,t,i.buttonText||i.actionText||null),o=n.show(i.duration);return i.clickHandler=i.clickHandler||function(){},i.hideHandler=i.hideHandler||function(){},i.onhide=i.onhide||function(){},o.then(i.clickHandler,i.hideHandler),o.then(null,i.onhide),o}}}),Box.Timing.execution.push({name:"js/services/amsterdam/pill-selector.js",time:(new Date).getTime()}),Box.Application.addService("pill-selector",function(e){"use strict";function t(e,t){var i;for(i=0;i<e.length;i++)if(e[i].id===t)return i;return-1}function i(e,t){this.originalInput=e,this.dataProviderMethod=t,this.wrapperElement=null,this.inputElement=null,this.inputWrapperElement=null,this.inputWrapperElementHeight=0,this.pills=[],this.highlightedPill=null,$.extend(this,new Box.EventTarget)}function n(e,t){e&&(t.placeholder=e.getAttribute("data-placeholder")||"")}var o=e.getService("dom"),a=e.getService("promises"),r=e.getService("array-utils"),s=e.getService("contact-selector-dropdown"),l=e.getService("strings"),c=e.getService("tooltips-amsterdam"),_=!1,d="input-has-focus",u="pill-selector-input-wrapper",p="pill-selector-input",h="pill",m="pill-highlighted",f="pill-option-has-focus",g="pill-remover",v="pill-selector",b=$t("Remove","pill_selector_remove_pill_label");return i.prototype.init=function(){this.wrapElement(),this.bindEvents(),n(this.originalInput,this.inputElement)},i.prototype.wrapElement=function(){var e=this.wrapperElement=document.createElement("div");e.className=v;var t=this.inputWrapperElement=document.createElement("div");t.className=u;var i=this.inputElement=document.createElement("input");i.type="text",i.className=p+" "+this.originalInput.className,t.appendChild(i),e.appendChild(t),this.selectorDropdownWidget=s.create(t),this.originalInput.parentNode.insertBefore(e,this.originalInput),o.addClass(this.originalInput,"hidden")},i.prototype.bindEvents=function(){var e=this;o.on(this.inputElement,"focus",function(){e.removeAllErrors(),o.addClass(e.inputWrapperElement,d),e.inputWrapperElementClientHeight=o.getBoundingClientRect(e.inputWrapperElement).height}),o.on(this.inputElement,"blur",function(){_?(e.inputElement.focus(),_=!1):(e.removePillHighlight(),e.selectorDropdownWidget.setItems([]),o.removeClass(e.inputWrapperElement,d))}),o.on(this.inputElement,"keyup",function(t){if(37!==t.keyCode&&38!==t.keyCode&&39!==t.keyCode&&40!==t.keyCode){var i=e.inputElement.value;if(!i)return void e.clearResults();e.removePillHighlight(),e.search(i)}}),o.on(this.wrapperElement,"click",function(t){var i=t.target||t.srcElement;if(o.hasClass(i,g)){var n=o.getNearest(i,"."+h),a=n.getAttribute("data-id");n.parentNode.removeChild(n),e.inputElement.focus(),e.clearResults(),e.removePillById(a),t.preventDefault(),t.stopPropagation()}}),o.on(this.wrapperElement,"keydown",function(t){switch(t=$.event.fix(t),t.keyCode){case 8:e.highlightedPill?e.deleteHighlightedPill():e.isCursorAtBeginning()&&e.highlightLastPill();break;case 37:e.highlightedPill?e.movePillHighlightLeft():e.isCursorAtBeginning()&&e.highlightLastPill();break;case 39:e.highlightedPill&&e.movePillHighlightRight()}}),o.on(this.wrapperElement,"mousedown",function(t){var i=t.target||t.srcElement;o.hasClass(i,u)?_=!1:o.hasClass(i,f)?(e.createPillBeforeInput(i),e.clearResults(),_=!0):o.hasClass(i,h)?(e.movePillHighlight(i),_=!0):(e.inputElement.focus(),_=!1,e.removePillHighlight())}),this.selectorDropdownWidget.on("dropdownitemselect",function(t){e.createPillBeforeInput(t.data),e.selectorDropdownWidget.setItems([])})},i.prototype.search=function(e){var t=this;this.dataProviderMethod(e).then(function(e){var i=r.filter(e,function(e){return r.every(t.pills,function(t){return t.id!==e.id})});t.selectorDropdownWidget.setItems(i)}).caught(function(e){if(!e instanceof a.CancellationError)throw e})},i.prototype.insertArrayOfPills=function(e){var t,i=e.length;for(t=0;i>t;t++)this.createPillBeforeInput(e[t])},i.prototype.createPillBeforeInput=function(e){if(-1!==t(this.pills,e.id))return void(this.inputElement.value="");var i=document.createElement("span");o.addClass(i,g),o.setHTML(i,"&times;"),i.setAttribute("title",b),i.setAttribute("aria-label",b);var n=document.createElement("span");o.addClass(n,h),o.setText(n,e.text),n.setAttribute("data-id",e.id.toString()),n.appendChild(i),e.data&&"group"===e.data.type&&n.setAttribute("data-group",""),this.inputWrapperElement.insertBefore(n,this.inputElement),this.inputElement.value="",this.inputElement.placeholder="",this.pills.push(e),this.fire("updated"),this.calculateResize()},i.prototype.highlightLastPill=function(){var e=o.queryAll("."+h,this.wrapperElement),t=e&&e[e.length-1];t&&(this.highlightedPill=t,o.addClass(t,m))},i.prototype.calculateResize=function(){var e=o.getBoundingClientRect(this.inputWrapperElement);this.inputWrapperElementClientHeight!==e.height&&(this.fire("resize"),this.inputWrapperElementClientHeight=e.height)},i.prototype.deletePills=function(e){if(e&&0!==e.length){var t,i,a,r=e.length;for(a=0;r>a;a++)i=e[a],t=o.query('.pill[data-id="'+i+'"]',this.inputWrapperElement),t&&(this.inputWrapperElement.removeChild(t),this.removePillById(i));0===this.getPills().length&&n(this.originalInput,this.inputElement),this.inputElement.select(0),this.calculateResize()}},i.prototype.deleteHighlightedPill=function(){if(this.highlightedPill){var e=this.highlightedPill.getAttribute("data-id");e&&(this.deletePills([e]),this.highlightedPill=null)}},i.prototype.movePillHighlight=function(e){this.highlightedPill&&o.removeClass(this.highlightedPill,m),this.highlightedPill=e||this.highlightedPill,o.addClass(e,m)},i.prototype.movePillHighlightLeft=function(){var e=this.highlightedPill&&this.highlightedPill.previousSibling;e&&this.movePillHighlight(e)},i.prototype.movePillHighlightRight=function(){var e=this.highlightedPill&&this.highlightedPill.nextSibling;e&&o.hasClass(e,h)?this.movePillHighlight(e):this.removePillHighlight()},i.prototype.removePillHighlight=function(){this.highlightedPill&&o.removeClass(this.highlightedPill,m),this.highlightedPill=null},i.prototype.removePillById=function(e){this.pills.splice(t(this.pills,e),1),this.fire("updated")},i.prototype.clearResults=function(){this.selectorDropdownWidget.setItems([])},i.prototype.isCursorAtBeginning=function(){return"undefined"==typeof this.inputElement.selectionStart?!1:!this.inputElement.selectionStart&&!this.inputElement.selectionEnd},i.prototype.getPills=function(){return this.pills},i.prototype.displayError=function(e,t){t=t||{},o.addClass(this.inputWrapperElement,"has-error"),this.inputWrapperElement.setAttribute("data-tooltip",""),t.tooltipPosition&&this.inputWrapperElement.setAttribute("data-tooltip-position",t.tooltipPosition),t.tooltipRelative&&this.inputWrapperElement.setAttribute("data-tooltip-relative",t.tooltipRelative),this.inputWrapperElement.setAttribute("data-tooltip-theme","error"),this.inputWrapperElement.setAttribute("aria-label",e)},i.prototype.removeAllErrors=function(){o.hasClass(this.inputWrapperElement,"has-error")&&(o.removeClass(this.inputWrapperElement,"has-error"),c&&this.inputWrapperElement.hasAttribute("data-tooltip")&&c.hide(this.inputWrapperElement),this.inputWrapperElement.removeAttribute("data-tooltip"),this.inputWrapperElement.removeAttribute("data-tooltip-position"),this.inputWrapperElement.removeAttribute("data-tooltip-relative"),this.inputWrapperElement.removeAttribute("data-tooltip-theme"),this.inputWrapperElement.removeAttribute("aria-label"),this.inputWrapperElement.removeAttribute("data-hover"))},i.prototype.reset=function(){for(var e=this.inputWrapperElement.querySelectorAll("span[data-id]"),t=e.length,i=0;t>i;i++)this.inputWrapperElement.removeChild(e[i]);this.pills=[],this.highlightedPill=null,this.inputElement.value="",this.selectorDropdownWidget.setItems([]),n(this.originalInput,this.inputElement)},i.prototype.createDataArrayFromString=function(e){var t=[],i=e.split(/;|,| |\t/);if(!i)return t;for(var n,o,a,r,s=0,c=i.length;c>s;s++)n=i[s],o=n.split(":")[0],o=l.trim(o),o&&(n.indexOf(":")>=0&&(a=n.substr(n.indexOf(":")+1)),r={id:o,text:a||o},t.push(r));return t},{create:function(e,t){return new i(e,t)}}}),Box.Timing.execution.push({name:"js/services/amsterdam/provider-enterprise-users.js",time:(new Date).getTime()}),Box.Application.addService("provider-enterprise-users",function(e){"use strict";var t,i=$t("All Users","selector-provider-option-all-users"),n=e.getService("ajax");return{ALL_USERS_DATA:{text:i,id:"all-users",email:"",type:"user"},searchUsers:function(){return function(e){return t&&(t.cancel(),t=null),t=n.get("box_contacts_get_enterprise_users",{query:e,limit:10}),t.then(function(e){t=null;for(var i=[],n=0,o=e.data.length;o>n;n++)i.push({text:e.data[n].contact_name,id:e.data[n].id,email:e.data[n].email,type:e.data[n].type});return i},function(){t=null})}},searchWithAllUsers:function(){var e=this;return function(t){var n=e.searchUsers()(t);return n.then(function(n){return i.match(new RegExp("^"+t,"i"))&&n.unshift(e.ALL_USERS_DATA),n})}}}}),Box.Timing.execution.push({name:"js/services/amsterdam/popups-amsterdam.js",time:(new Date).getTime()}),Box.Application.addService("popups-amsterdam",function(e){"use strict";function t(e,t){var i=new Box.EventTarget;this.on=function(){i.on.apply(i,arguments)},this.fire=function(){i.fire.apply(i,arguments)},setTimeout(function(){f.on(t,"click",function(e){i.fire("close",e)})},500),f.on(e,"click",function(e){e.stopPropagation();var t=f.getNearest(e.target||e.srcElement,"[data-event-type]");t&&i.fire(t.getAttribute("data-event-type"),e)}),f.on(e,"keyup",function(e){27===e.keyCode&&(i.fire("close",e),e.stopPropagation(),e.preventDefault())});var n=this;i.on("close",function(){n.close()})}function i(e,i){var n=this.elem=document.createElement("div");n.className="popup-wrapper disable_selectable",n.setAttribute("data-resin-page","popupsamsterdam"),n.setAttribute("data-resin-component","wrapper"),n.setAttribute("data-resin-feature","interactions"),this.spinnerElem=w.getTemplateFragment("spinner-light-large");var o=this.innerElem=document.createElement("div");o.className="popup "+i,o.setAttribute("tabindex","-1"),e instanceof Element?(o.appendChild(e),n.appendChild(o)):"string"==typeof e?(f.setHTML(o,e),n.appendChild(o)):f.addClass(n,m),t.call(this,o,n)}function n(){o||(o=setTimeout(function(){o=null,v.refresh()},50))}var o,a='<h2 class="simple-popup-heading"><%=heading%></h2><p class="mbn"><%=message%></p><div class="button-bar"><button class="btn btn-primary" data-event-type="close">'+$t("Okay","alert_popup_button_title")+"</button></div>",r='<h2 class="simple-popup-heading"><%=heading%></h2><p><%=message%></p><form><input class="popup-prompt-input" type="text" required placeholder="<%=placeholder%>" value="<%=defaultValue%>" pattern="<%=pattern%>" title="<%=title%>"><div class="button-bar"><button class="btn btn-primary" data-event-type="ok">'+$t("Okay","alert_popup_button_title")+"</button></div></form>",s='<h2 class="simple-popup-heading"><%=heading%></h2><p class="mbn"><%=message%></p><div class="button-bar"><div class="btn-spinner-container"><button class="btn btn-primary popup-confirm-btn" data-event-type="ok"><span class="popup-confirm-btn-text"><%=okBtnText%></span></button></div><button class="btn popup-cancel-btn" data-event-type="cancel"><%=cancelBtnText%></button></div>',l='<button class="btn-plain popup-x-btn" title="<%=closeBtnText%>" data-event-type="close" data-resin-target="closebutton"><span class="accessibility-hidden"><%=closeBtnText%></span>&times;</button><div class="popup-contents"></div>',c=$t("Okay","popup_generic_button_okay"),_=$t("Cancel","popup_generic_button_cancel"),d=$t("Close","popup_generic_button_close"),u=$t("Error","popup_generic_failure_message_title"),p=$t("An error has occurred while loading this feature.","popup_generic_failure_message"),h="is-disabled",m="is-loading",f=e.getService("dom"),g=e.getService("focus"),v=e.getService("nav"),b=e.getService("promises"),w=e.getService("templates"),y=e.getService("tooltips-amsterdam"),x=!1,S=[],k=0;return i.prototype.show=function(){document.body.appendChild(this.elem),y&&y.hideAll(),k++,f.addClass(document.body,"has-active-popup"),S.push(this)},i.prototype.focus=function(){this._focusActivated||(g.wrap(this.elem,!0),this._focusActivated=!0)},i.prototype.resize=function(){for(var e=this.innerElem.childNodes,t=0,i=0;i<e.length;i++)if(e[i].offsetHeight&&!f.hasClass(e[i],"popup-x-btn")){var n=e[i].currentStyle;n||(n=getComputedStyle(e[i])),t+=e[i].offsetHeight+parseInt(n.marginTop,10)+parseInt(n.marginBottom,10)}this.innerElem.style.height=t+"px"},i.prototype.close=function(){if(this.elem.parentNode&&!x){y&&y.hideAll(),this.elem.parentNode.removeChild(this.elem),k--,k||f.removeClass(document.body,"has-active-popup");for(var e=0;e<S.length;e++)if(S[e]===this)return void S.splice(e,1)}},i.prototype.setContent=function(e){f.removeClass(this.innerElem,m);var t=f.query(".popup-contents",this.innerElem);f.setHTML(t,e)},i.prototype.query=function(e){return this.innerElem.querySelector(e)},i.prototype.queryAll=i.prototype.$=function(e){return this.innerElem.querySelectorAll(e)},{_triggerPageReload:n,create:function(e,t){return new i(e,t)},alert:function(e,t){var i=this.create();return b.create(function(n){var o=w.createTemplateFragment(a,{heading:t,message:e});i.innerElem.appendChild(o),i.elem.appendChild(i.innerElem),i.show(),i.focus(),i.resize(),i.on("close",n)})},prompt:function(e){var t=this.create();return b.create(function(i){var n=w.createTemplateFragment(r,e);t.innerElem.appendChild(n),t.elem.appendChild(t.innerElem);var o=f.query("input",t.elem);t.show(),t.focus(),t.resize(),e.defaultValue&&o.select(),t.on("ok",function(){(!o.checkValidity||o.checkValidity())&&(t.close(),i(o.value))}),f.query("form",t.elem).addEventListener("submit",function(e){e.preventDefault(),t.fire("ok")})})},confirm:function(e,t,i){function n(){o.close()}i=i||{};var o=this.create(),a=b.create(function(n,a){var r=w.createTemplateFragment(s,{heading:t,message:e,okBtnText:i.confirmText||c,cancelBtnText:i.cancelText||_});o.innerElem.appendChild(r),o.elem.appendChild(o.innerElem);var l=o.query(".btn-spinner-container"),d=w.getTemplateFragment("spinner");l.appendChild(d),o.show(),o.focus(),o.resize(),o.on("ok",function(){n()}),o.on("cancel",function(){a()})});return i.isBlocking||o.on("ok",n),o.on("cancel",n),a},open:function(t,i){i=i||{};var n=this,o=e.getService("ajax"),a=this.create(),r=w.createTemplateFragment(l,{closeBtnText:d});a.innerElem.appendChild(r),a.elem.appendChild(a.spinnerElem),a.show(),a.hasLoaded=!1,a.on("close",function(){a.hasLoaded&&i.hasUnsafeSideEffects&&n._triggerPageReload()});var s=i.data||{};return s["!popup"]="yesplease",o.get(t,s).then(function(e){a.elem.appendChild(a.innerElem),a.setContent(e.data.html),a.focus(),a.resize(),f.addClass(a.innerElem,"is-active"),a.hasLoaded=!0},function(t){"JSON Parse Error"===t.message&&e.reportError("Popup being retrieved is not configured with $this->setUpPopup();"),a.hasLoaded=!0,a.close();var i=t.data||{};n.alert(i.message||p,u)}),a},resize:function(){var e;if(0!==S.length)for(var t=0;t<S.length;t++)e=S[t],e.hasLoaded&&e.resize()},close:function(e){var t,i=!1;if(e=e||{},!S.length)return void(e.alternateDestination&&v.navigate(e.alternateDestination));e.enableClose&&(x=!1);do t=S.shift(),t.hasLoaded&&(i=!0),t.close();while(S.length);i&&!e.unsafeSkipRefresh&&this._triggerPageReload()},showConfirmBlockingState:function(){if(S.length){var e=S[S.length-1],t=e.query(".btn-spinner-container"),i=e.query(".popup-confirm-btn"),n=e.query(".popup-cancel-btn");t&&f.addClass(t,m),i&&f.addClass(i,h),n&&f.addClass(n,h),x=!0}},anyPopupsOpen:function(){return S.length>0}}}),Box.Timing.execution.push({name:"js/services/amsterdam/slide-carousel.js",time:(new Date).getTime()}),Box.Application.addService("slide-carousel",function(e){"use strict";function t(e){for(e.isNavigable="false"!==e.paginationContainerEl.getAttribute("data-navigable");e.paginationContainerEl.firstChild;)e.paginationContainerEl.removeChild(e.paginationContainerEl.firstChild);for(var t,i=0,n=e.slideEls.length;n>i;i++){var o=e.slideEls[i];o.setAttribute("data-slide-num",i),t=document.createElement("li"),t.setAttribute("data-type","go-to-slide"),t.setAttribute("data-slide-num",i),r.hasClass(o,s)&&(t.className=s,e.currentSlideNum=i),e.paginationContainerEl.appendChild(t)}e.paginationEls=e.paginationContainerEl.childNodes}function i(e){for(var t,i=0,n=e.slideEls.length;n>i;i++)t=e.slideEls[i],r.removeClass(t,c),r.removeClass(t,_),i<e.currentSlideNum&&r.addClass(t,c),i>e.currentSlideNum&&r.addClass(t,_)}function n(e){var t=r.query(".presentation-content",e);if(t){var i,n=r.getComputedCSS(t)["background-image"],o=/url\(['"]?(.+\.gif).*['"]?\)/;null!==(i=o.exec(n))&&(t.style.backgroundImage="url("+i[1]+"?rnd="+Math.random()+")")}}function o(e){return function(t){var i=t.target||t.srcElement,n=i.getAttribute("data-type");if(n&&e.isNavigable)switch(n){case"go-to-slide":e.goToSlide(Number(i.getAttribute("data-slide-num")));break;case"next-slide":e.goToNextSlide();break;case"prev-slide":e.goToPrevSlide();break;default:return}}}function a(e){this.wrapperEl=e,this.currentSlideNum=0,this.isCurrentlyChangingSlides=!1,this.isNavigable=!0,this.slideContainerEl=r.query(".slides",this.wrapperEl),this.slideEls=r.queryAll(".slides > li",this.wrapperEl),this.paginationContainerEl=r.query(".slides-pagination",this.wrapperEl),this.paginationEls=null,t(this),i(this),this.mouseUpHandlerRef=o(this),r.on(this.paginationContainerEl,"mouseup",this.mouseUpHandlerRef)}var r=e.getService("dom"),s="is-active",l=300,c="transition-left",_="transition-right";return a.prototype={goToSlide:function(e){if(!(e>=this.slideEls.length||0>e||this.isCurrentlyChangingSlides)){this.isCurrentlyChangingSlides=!0;var t=this.paginationEls[e],o=this.slideEls[e],a=this.paginationEls[this.currentSlideNum],d=this.slideEls[this.currentSlideNum];r.removeClass(o,c),r.removeClass(o,_);var u=e>this.currentSlideNum?c:_;r.addClass(d,u),r.removeClass(a,s),r.removeClass(d,s),r.addClass(t,s),r.addClass(o,s),this.currentSlideNum=e,i(this),n(o);var p=this;setTimeout(function(){p.isCurrentlyChangingSlides=!1},l)}},goToNextSlide:function(e){var t=this.currentSlideNum+1;this.goToSlide(e?t%this.slideEls.length:t)},goToPrevSlide:function(e){var t=this.currentSlideNum-1;this.goToSlide(e&&0>t?this.slideEls.length-1:t)},getCurrentSlideNum:function(){return this.currentSlideNum},destroy:function(){r.off(this.paginationContainerEl,"mouseup",this.mouseUpHandlerRef)}},{create:function(e){return new a(e)}}}),Box.Timing.execution.push({name:"js/services/amsterdam/session-store.js",time:(new Date).getTime()}),Box.Application.addService("session-store",function(e){"use strict";function t(e){return n+"/"+o+"/"+e}function i(){try{return r.setItem(t("TestKey"),"testValue"),r.removeItem(t("TestKey")),!0}catch(e){return!1}}var n="sessionStore",o="0",a={},r=e.getGlobal("sessionStorage"),s=i();return{setItem:function(e,i){if(s)try{r.setItem(t(e),JSON.stringify(i))}catch(n){}else a[e]=i},getItem:function(e){if(!s)return a[e];try{return JSON.parse(r.getItem(t(e)))}catch(i){return null}},removeItem:function(e){if(s)try{r.removeItem(t(e))}catch(i){}else a[e]&&delete a[e]}}}),Box.Timing.execution.push({name:"js/services/amsterdam/tooltips-amsterdam.js",time:(new Date).getTime()}),Box.Application.addService("tooltips-amsterdam",function(e){"use strict";function t(){}function i(t){var i=e.getGlobal("document"),n=T.createTemplateFragment(S,t),o=$(t.tooltipRelative);if(!o.length)throw new Error("Tooltip relative container does not exist");return $(t.tooltipRelative).append(n),i.getElementById(t.id)}function n(e,t){t=t||"body";var i=$(e),n=$(t),o=$.extend({},i.offset(),{width:i.outerWidth(),height:i.outerHeight()});return"body"!==t&&(o.left=i.offset().left-n.offset().left,o.top=i.offset().top-n.offset().top),o.right=o.left+o.width,o.bottom=o.top+o.height,o}function o(e,t,i){var o=n(e),a=n(t),r=$(document),s=r.height(),l=r.width();switch(i){case"top":return o.top-a.height>0;case"bottom":return o.bottom+a.height<s;case"left":return o.left-a.width>0;case"right":return o.left+o.width+a.width<l;default:return!1}}function a(e,t,i){k.removeClass(e,t),k.addClass(e,i)}function r(t,i,n){var o,a,r=k.getBoundingClientRect(t).width,s=n.left,l=e.getGlobal("document"),c=l.body.clientWidth;("bottom"===i||"top"===i)&&(o=k.query(".tooltip-arrow",t),0>s?(s=r/2+s,n.left=0,o.style.left=s+"px"):s+r>c&&(a=s+r-c,n.left=s-a,o.style.left=r/2+a+"px")),t.style.left=n.left+"px",t.style.top=n.top+"px"}function s(e,t){return e.top+(e.height-t.height)/2}function l(e,t){return e.left+(e.width-t.width)/2}function c(e,t){return{left:e.left+e.width,top:s(e,t)}}function _(e,t){return{left:e.left-t.width,top:s(e,t)}}function d(e,t){return{left:l(e,t),top:e.top-t.height}}function u(e,t){return{left:l(e,t),top:e.top+e.height}}function p(e,t,i,o){var a=n(o,e),r=n(i,e);switch(t){case"right":return c(r,a);case"left":return _(r,a);case"bottom":return u(r,a);case"top":return d(r,a);default:return c(r,a)}}function h(e,t){if(!t.text)return null;if(!$(e).is(":visible"))return null;var n=i(t);if(!o(e,n,t.tooltipPosition)){var s=t.tooltipPosition;t.tooltipPosition=I[t.tooltipPosition],a(n,s,t.tooltipPosition)}return e.setAttribute("aria-describedby",t.id),
r(n,t.tooltipPosition,p(t.tooltipRelative,t.tooltipPosition,e,n)),k.addClass(e,A),$(n).show(),n}function m(e){var t=e.getAttribute("aria-describedby"),i=document.getElementById(t);e.removeAttribute("aria-describedby"),k.removeClass(e,A),$(i).fadeOut("fast").remove()}function f(){$(E).remove()}function g(e){do e+=Math.floor(1e6*Math.random());while(document.getElementById(e));return e}function v(e,t){return $.inArray(e,t)>-1}function b(e,i,n){var o=n.tooltipTrigger.split(" ");return v("click",o)&&"click"===e?C.TOGGLE:"focusin"===e&&v("focus",o)&&!k.hasClass(i,A)?C.SHOW:"focusout"===e&&v("focus",o)&&k.hasClass(i,A)?C.HIDE:"mouseover"===e&&v("hover",o)&&!k.hasClass(i,A)?C.SHOW:"mouseout"===e&&v("hover",o)&&k.hasClass(i,A)?i===document.activeElement&&v("focus")?t():C.HIDE:t()}function w(e){var t=$(e);return{tooltip:t.attr("data-tooltip"),tooltipTrigger:t.attr("data-tooltip-trigger"),tooltipPosition:t.attr("data-tooltip-position"),tooltipTheme:t.attr("data-tooltip-theme"),tooltipText:t.attr("data-tooltip-text"),tooltipRelative:t.attr("data-tooltip-relative")}}function y(e,t){if($(e).is($(t.tooltipRelative)))throw new Error("Tooltip cannot be configured relative to itself")}function x(e,t){var i=$.extend({},j,w(e),t);return i.text=i.tooltipText||e.getAttribute(B+"-text")||e.getAttribute("aria-label"),i.id=e.getAttribute("aria-describedby")||g("tooltip"),y(e,i),i}var S='<div id="<%= id %>" class="tooltip-amsterdam <%= tooltipPosition %> <%= tooltipTheme %>" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"><%= text %></div></div>',k=e.getService("dom"),T=e.getService("templates"),j={tooltipPosition:"right",tooltipTrigger:"hover focus",tooltipRelative:"body"},C={TOGGLE:"toggle",HIDE:"hide",SHOW:"show"},A="tooltip-active",E=".tooltip-amsterdam",B="data-tooltip",I={right:"left",left:"right",top:"bottom",bottom:"top"};return{handleEvent:function(e){var t=k.getNearest(e.target,"["+B+"]");if(t){var i=x(t);switch(b(e.type,t,i)){case C.SHOW:this.show(t,i);break;case C.HIDE:this.hide(t,i);break;case C.TOGGLE:this.toggle(t,i);break;default:return}}},show:function(e,t){return h(e,x(e,t))},hide:function(e,t){m(e,x(e,t))},hideAll:function(){for(var e=k.queryAll("["+B+"]"),t=0;t<e.length;t++)this.hide(e[t]);f()},toggle:function(e,t){k.hasClass(e,A)?this.hide(e,t):this.show(e,t)}}}),Box.Timing.execution.push({name:"js/services/amsterdam/tour.js",time:(new Date).getTime()}),Box.Application.addService("tour",function(e){"use strict";function t(e){$[e.name]=e}function i(e){delete $[e]}function n(e){return e in $}function o(){return null!==A}function a(){return o()?E.getAttribute("data-tour-name"):null}function r(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"")}function s(e,t,i){var n=j.query("[data-resin-application]"),o="undefined"!=typeof n?n.getAttribute("data-resin-application"):"",s="tour_"+a(),l={application:r(o),page:r(s),component:"tour",feature:r(e),target:r(t),action:"programmatic"};"undefined"!=typeof i&&(l.data=i),C.recordAction(l)}function l(){A&&(A.next(),s("slide","next",{slideNum:A.getCurrentSlideNum()}))}function c(){A&&(A.previous(),s("slide","previous",{slideNum:A.getCurrentSlideNum()}))}function _(){A&&A.end(),h(),w&&w(),w=null,A=null,E=null}function d(e){var t=e.target||e.srcElement,i=t.getAttribute("data-action");"tour-previous"===i?c():"tour-next"===i?l():"tour-end"===i&&_()}function u(e){var t=e.keyCode;t===x?c():t===S?l():t===y&&(s("close","esc"),_())}function p(){j.on(document.body,"mouseup",d),j.on(document.body,"keyup",u)}function h(){j.off(document.body,"mouseup",d),j.off(document.body,"keyup",u)}function m(e){T.post(k,{identifier:e.name,type:e.type,context:e.context})}function f(e){var t=$[e];return t.canBeShownMultipleTimes}function g(){p();var e=E.getAttribute("data-tour-type");A=B[e].create(E),A.start();var t=a(),n=$[t];f(t)||i(t),s("tour","loaded"),m(n)}function v(e){return $[e].templateFetchEndpoint}function b(e){var t=v(e),i={identifier:e,type:"tour"};T.get(t,i,{success:function(t){var i=j.createFragmentFromHtml(t.data.html);document.body.appendChild(i),E=j.query('[data-tour-name="'+e+'"][data-tour]'),g()}})}var w,y=27,x=37,S=39,k="contextual_message_mark_as_seen",T=e.getService("ajax"),j=e.getService("dom"),C=e.getService("resin"),$=[],A=null,E=null,B={fullscreen:e.getService("tour-fullscreen"),modal:e.getService("tour-modal")};return{registerTour:t,unregisterTour:i,startTourIfEligible:function(e){return!n(e)||o()?Promise.reject():(E=j.query('[data-tour-name="'+e+'"][data-tour]'),E?g():b(e),new Promise(function(e){w=e}))},endTour:_,next:l,previous:c}}),Box.Timing.execution.push({name:"js/services/amsterdam/widgets/datepicker.js",time:(new Date).getTime()}),Box.Application.addService("datepicker",function(e){"use strict";function t(e){return function(t){var i=t.getTime(),o=t.getTimezoneOffset(),a=o*n,r=i-a,s=e.inputEl.getAttribute("data-epoch-holder");if(s){var l=c.query('input[name="'+s+'"]');l&&(l.value=r)}e.removeError()}}function i(e){if(!l)throw new Error("Missing i18n parameters for the datepicker service");this.inputEl=l.field=e,this.onSelect=l.onSelect=t(this),l.setDefaultDate=!0;var i=e.getAttribute("data-min-date");i=i?parseInt(i,10):0,this.minDate=l.minDate=new Date(i),this.picker=new Pikaday(l)}var n=6e4,o="is-invalid",a="data-tooltip",r="data-tooltip-theme",s="data-tooltip-text",l=e.getGlobalConfig("pikadayI18N"),c=e.getService("dom"),_=e.getService("tooltips-amsterdam");return i.prototype={show:function(){this.picker.show()},hide:function(){this.picker.hide()},getDate:function(){return this.picker.getDate()},destroy:function(){this.picker.destroy()},setError:function(e){c.addClass(this.inputEl,o),this.inputEl.setAttribute(a,""),this.inputEl.setAttribute(r,"error"),this.inputEl.setAttribute(s,e)},removeError:function(){c.hasClass(this.inputEl,o)&&(c.removeClass(this.inputEl,o),_&&_.hide(this.inputEl),this.inputEl.removeAttribute(a),this.inputEl.removeAttribute(r),this.inputEl.removeAttribute(s))}},{create:function(e){return new i(e)}}}),Box.Timing.execution.push({name:"js/services/actionbar.js",time:(new Date).getTime()}),Box.Application.addService("actionbar",function(e){"use strict";var t="actionbar-wrapper";return{switchActionbar:function(e){var i=document.getElementById(t);i&&i.setAttribute("data-actionbar",e)}}}),Box.Timing.execution.push({name:"js/services/promises.js",time:(new Date).getTime()}),Box.Application.addService("promises",function(e){"use strict";return Promise.longStackTraces(),Promise.customUnhandledRejectionHandlerDisabled||Promise.onPossiblyUnhandledRejection(function(t,i){var n=i.reason();"undefined"!=typeof n&&("[object Object]"===t.message&&(t.message="Missing an error or rejection handler for "+(n.data||"a promise")),e.reportError(t))}),{CancellationError:Promise.CancellationError,all:Promise.all,settle:Promise.settle,some:Promise.some,any:Promise.any,create:function(e){return new Promise(e)},createResolved:function(e){return Promise.resolve(e)},createRejected:function(e){return Promise.reject(e)},createCancellable:function(e){return new Promise(e).cancellable()}}}),Box.Timing.execution.push({name:"js/services/ajax.js",time:(new Date).getTime()}),Box.Application.addService("ajax",function(e){"use strict";function t(e){4!==e.readystate&&e.abort()}function i(e,t){return{status:t.status,data:e}}function n(e){var t;try{t=JSON.parse(e.responseText)}catch(i){t=e.responseText}return{status:e.status,data:t}}function o(e){return"parsererror"===e?"JSON Parse Error":"Server Error"}function a(t,i){if($.isEmptyObject(t)&&$.isEmptyObject(i))return l.createResolved();var n=e.getService("assets"),o=l.create(function(e){n.loadJSByHash(t,function(){e()})}),a=l.create(function(e){n.loadCSSByHash(i,function(){e()})});return l.all([o,a])}function r(e){return!("$ver"in e||"data"in e)}function s(s,c,_,d,u){function p(t,s){function l(n,o,l){function c(){"function"==typeof d&&(u.context?d.call(u.context,_):d(_))}var _,d=u.success,p=null===n||"undefined"==typeof n;if(p)n=null;else{if(!$.isPlainObject(n))return void s(new Error("Invalid Response Data. Response data must be a plain object."));if("unidb"===n.type&&"params"in n){var h=e.hasService("unidb")?e.getService("unidb"):null;h&&(n=h.decode(n))}}p||r(n)?(_=i(n,l),c(),t(_)):(_=i(n.data,l),a(n.js||{},n.css||{}).then(function(){c(),t(_)},function(){s(new Error("Assets could not be loaded correctly"))}))}function c(e,t,i){if(0!==e.status||"abort"!==t||"abort"!==i){var a=n(e),r=u.error;"function"==typeof r&&(u.context?r.call(u.context,a):r(a));var l=new Error(o(t));l.status=a.status,l.data=a.data,s(l)}}m=$.ajax(f).done(l).fail(c)}var h,m,f={type:s,dataType:c,url:"/index.php?rm="+_,data:d,dataFilter:function(e){return""===e?null:e}};return h=l.createCancellable(p).caught(l.CancellationError,function(e){throw t(m),e}),("function"==typeof u.success||"function"==typeof u.error)&&h.then(function(){},function(){}),h}var l=e.getService("promises");return{get:function(e,t,i){return i=i||{},s("GET","json",e,t,{success:i.success,error:i.error,context:i.context})},post:function(t,i,n){return n=n||{},i=i||{},i.request_token&&e.reportError(new Error("Request token will be appended automatically and should not passed in manually")),i.request_token=e.getGlobalConfig("requestToken")||e.getGlobal("request_token"),s("POST","json",t,i,{success:n.success,error:n.error,context:n.context})}}}),Box.Timing.execution.push({name:"js/services/aria.js",time:(new Date).getTime()}),Box.Application.addService("aria",function(e){"use strict";return{setRole:function(e,t){e.setAttribute("role",t)},setFocusable:function(e,t){e.tabIndex=t?0:-1},clearState:function(e,t){e.removeAttribute("aria-"+t)},hasState:function(e,t){return e.hasAttribute("aria-"+t)},setState:function(e,t){e.setAttribute("aria-"+t,!0)},hide:function(e){this.setState(e,"hidden")},show:function(e){this.clearState(e,"hidden")}}}),Box.Timing.execution.push({name:"js/services/assets.js",time:(new Date).getTime()}),Box.Application.addService("assets",function(e){"use strict";function t(e){return e?e.replace(/^\//,""):""}function i(){return $('link[rel="stylesheet"], style').length}function n(e){var t=document.createElement("link");return t.rel="stylesheet",t.type="text/css",t.href=e,t}function o(e){var t=$.Deferred(),i=function(){t.resolve()},n=_.isSafari()&&"an unknown version"===_.getVersion();return"onload"in e&&!n?e.onload=i:setTimeout(i,0),t.promise()}function a(e){var t=$.Deferred();return e.readyState?e.onreadystatechange=function(){("loaded"===e.readyState||"complete"===e.readyState)&&(e.onreadystatechange=null,t.resolve())}:e.onload=function(){t.resolve()},t.promise()}function r(e){var t,i,a=document.getElementsByTagName("head")[0],r=[];for(var s in e)e.hasOwnProperty(s)&&(i=e[s],t=n(i),a.appendChild(t),p[s]=o(t),r.push(p[s]));return r}function s(e){var t,i=$('link[rel="stylesheet"]'),n=i[i.length-1],a=$.Deferred(),r=a.promise(),s=0;for(var l in e)e.hasOwnProperty(l)&&(t=e[l],n.styleSheet.addImport(t),p[l]=r,s++);if(s>0){var c=o(n);return c.done(function(){a.resolve()}),[r]}return[$.Deferred().resolve().promise()]}function l(){for(var t=e.getGlobalConfig("initialJSHashes")||[],i=0,n=t.length;n>i;i++)u[t[i]]=$.Deferred().resolve().promise()}function c(){for(var t=e.getGlobalConfig("initialCSSHashes")||[],i=0,n=t.length;n>i;i++)p[t[i]]=$.Deferred().resolve().promise()}var _=e.getService("browser"),d=31,u={},p={};return{boxCachedAssetIndex:{mini:null,full:null},_assetIndex:function(t){if(null===this.boxCachedAssetIndex[t]){var i=null;i=e.getGlobal("mini"==t?"assets_index_mini_file":"assets_index_file");var n=this;$.ajax({type:"GET",url:"/"+i,dataType:"text",cache:!0,async:!1,no_context:!0,success:function(e){if(n.boxCachedAssetIndex[t]={},e)for(var i=e.split("\n"),o=0,a=i.length;a>o;o++){var r=i[o].split("	");2==r.length&&r[0].length>0&&(n.boxCachedAssetIndex[t][r[0]]=r[1])}},error:function(e){$.log("WARN: asset index loading failed with status %s",e.status),n.boxCachedAssetIndex[t]=!1}})}return this.boxCachedAssetIndex[t]},_remoteAssetHash:function(t,i){if("mini"!=i){var n=e.getService("logger"),o={asset:t};n.sendLog("asset_caching","remote_index_load",o)}var a=this._assetIndex(i);return a===!1?!1:a[t]?a[t]:("mini"!=i&&$.log("WARN: unknown asset %s",t),!1)},_assetHash:function(e){return this._remoteAssetHash(e,"mini")||this._remoteAssetHash(e,"full")},_assetPath:function(e){var i=t(e),n=this._assetHash(e);if(n===!1)return!1;var o=i.replace(/(\w+)(\.\w+)?$/,"$1-"+n+"$2");return"/"+o},getFlashAssetURL:function(){var e="/static/flash/";return e},getAssetURL:function(i,n,o){"undefined"==typeof n&&(n=""),"undefined"==typeof o&&(o=!0);var a=t(i+n),r="/"+a,s=e.getService("v5").get("Features");if(s.no_asset_caching)return r;var l=this._assetPath(a);if(l===!1)return r;var c;c=e.getGlobal(s.new_legacy_assets?"assets_legacy_base":"assets_base");var _="/"+c;return _+l},loadJSByHash:function(e,t){var i,n;$.isEmptyObject(u)&&l();var o=[],r=[];for(n in e)u.hasOwnProperty(n)?o.push(u[n]):r.push(n);for(var s=0,c=r.length;c>s;s++){var _=document.createElement("script"),d=a(_);n=r[s],i=e[n],_.src=i,document.body.appendChild(_),u[n]=d,o.push(u[n])}$.when.apply($,o).done(t)},loadCSSByHash:function(e,t){var n,o,a,l=[],u=[];$.isEmptyObject(p)&&c();for(var n in e)p.hasOwnProperty(n)?u.push(p[n]):l.push(n);var h=_.isIE()&&parseFloat(_.getVersion())<10,m={};if(h){var f=i(),g=Math.min(l.length,Math.max(0,d-f)),v=l.length-g,b=l.slice(v);for(o=0,a=b.length;a>o;o++)n=b[o],m[n]=e[n];if($.merge(u,r(m)),v){var w=l.slice(0,v),y={};for(o=0,a=w.length;a>o;o++)n=w[o],y[n]=e[n];$.merge(u,s(y))}}else{for(o=0,a=l.length;a>o;o++)n=l[o],m[n]=e[n];$.merge(u,r(m))}$.when.apply($,u).done(t)}}}),Box.Timing.execution.push({name:"js/services/array-utils.js",time:(new Date).getTime()}),Box.Application.addService("array-utils",function(){"use strict";function e(e,t){for(var i=-1,n=e.length,o=Array(n);++i<n;)o[i]=t(e[i],i,e);return o}function t(e,t){for(var i=-1,n=e.length,o=-1,a=[];++i<n;){var r=e[i];t(r,i,e)&&(a[++o]=r)}return a}function i(e){return function(t,i,n){var o=arguments.length<3;return e(t,i,n,o)}}function n(e,t,i,n){var o=-1,a=e.length;for(n&&a&&(i=e[++o]);++o<a;)i=t(i,e[o],o,e);return i}function o(e,t){for(var i=-1,n=e.length;++i<n;)if(!t(e[i],i,e))return!1;return!0}function a(e,t){for(var i=-1,n=e.length;++i<n&&t(e[i],i,e)!==!1;);return e}function r(e,t){for(var i=-1,n=e.length;++i<n;)if(t(e[i],i,e))return!0;return!1}function s(e,t){return $.inArray(t,e)}return{forEach:a,every:o,some:r,indexOf:s,map:e,filter:t,reduce:i(n)}}),Box.Timing.execution.push({name:"js/services/box-edit.js",time:(new Date).getTime()}),Box.Application.addService("box-edit",function(e){"use strict";function t(){e.getGlobalConfig("isBoxEditAllowed")?E.resolve():E.reject()}function i(){var e=document.getElementById(S);return null===e&&($('<object id=boxedit_object style="position:fixed; bottom:0; left:0" type="application/x-boxedit" width=1 height=1><param name=onload value=pluginLoaded /></object>').appendTo(document.body),e=document.getElementById(S)),e}function n(){if(h.box_edit_two&&C)return!0;var e=i();return A=!(!e||!e.valid)}function o(e){var t=e.toUpperCase();return"."===t.charAt(0)&&(t=t.substr(1)),!!j[t]}function a(e,t,i){return e=e.toString(),JSON.stringify({command_type:"launch_application",file_id:e,auth_token:t,auth_code:i})}function r(e){return JSON.stringify({request_type:"get_default_application",extension:e})}function s(e){var t,i=g.sendRequest(r(e),!0);return i&&i.default_application_name&&(t=i.default_application_name[e],B[e]=t),t}function l(e){if(h.box_edit_two&&!A)return!n()||o(e)?"":f.isIE()&&!f.isMinBrowser("explorer","10")?$t("Box Edit","box_edit_label"):B[e]?B[e]:s(e);var t;return n()?(t=i(),t&&t.valid?t.app("."+e):""):""}function c(e){e&&(m.open("box_edit_launch_app",{data:{typed_id:e.typed_id,application_name:l(e.extension)}}),v.recordAction({application:"files",page:"",component:"",feature:"boxedit",target:"launch",action:"programmatic"}))}var _,d,u,p,h,m,f,g,v,b={live:"openbox_service1338",staging:"openbox_service901",dev:"openbox_service1785"},w="BoxEdit",y="/index.php?rm=create_open_on_desktop_token",x="resolved",S="boxedit_object",k={gdoc:1,gsheet:1},T={ppt:1,pptx:1,doc:1,docx:1,xls:1,xlsx:1},j={A6P:1,AC:1,AS:1,ACR:1,ACTION:1,AIR:1,APP:1,AWK:1,BAT:1,CGI:1,CHM:1,CMD:1,COM:1,CSH:1,DEK:1,DLD:1,DS:1,EBM:1,ESH:1,EXE:1,EZS:1,FKY:1,FRS:1,FXP:1,GADGET:1,HMS:1,HTA:1,ICD:1,INX:1,IPF:1,ISU:1,JAR:1,JS:1,JSE:1,JSX:1,KIX:1,LUA:1,MCR:1,MEM:1,MPX:1,MS:1,MSI:1,MST:1,OBS:1,PAF:1,PEX:1,PIF:1,PL:1,PRC:1,PRG:1,PVD:1,PWC:1,PY:1,PYC:1,PYO:1,QPX:1,RBX:1,REG:1,RGS:1,ROX:1,RPJ:1,SCAR:1,SCR:1,SCRIPT:1,SCPT:1,SCT:1,SH:1,SHB:1,SHS:1,SPR:1,TLB:1,TMS:1,U3P:1,UDF:1,VB:1,VBE:1,VBS:1,VBSCRIPT:1,WCM:1,WPK:1,WS:1,WSF:1,XQT:1},C=!1,A=!1,E=new $.Deferred,B={},I={init:function(){_=e.getService("v5"),d=e.getService("nav-state"),u=_.get("Canvas"),p=_.get("live_site"),m=e.getService("popups"),h=_.get("Features"),f=e.getService("browser"),g=e.getService("com-server").create(w),v=e.getService("resin"),d.isSharedFolderPage()||d.isSharedFilePage()||u&&u.user.is_anonymous()?E.reject():(t(),h.box_edit_two&&e.getGlobalConfig("isBoxEditAllowed")&&this.getInstallationStatus().then(function(){},function(){}))},getInstallationStatus:function(){return g.initLocalInstallationCheck().then(function(){C=!0},function(){C=!1})},isFileExtHandledByOpenbox:function(e){return!!k[e]},runCallbackIfBoxEditIsDisabledByAdmin:function(e){"function"==typeof e&&("pending"===E.state()&&t(),E.fail(e))},isBoxEditDisabledByAdmin:function(){return E.state()!==x},isBoxEditInstalled:n,getNativeApplicationName:l,getBoxEditObject:i,canUserOpenFileOnDesktop:function(e){var t=e.permissions.download&&e.permissions.upload;return h.box_edit_two?t&&!o(e.extension)&&l(e.extension)&&!this.isMacPackage(e):t&&this.getNativeApplicationName(e.extension)&&!this.isMacPackage(e)},isMacPackage:function(e){return e.is_package||e.isPackage},isBoxEditFullyEnabled:function(e){return n()&&this.canUserOpenFileOnDesktop(e)&&E.state()===x},isExtensionSupportedByDefault:function(e){return!!T[e]},isActionIdBoxEdit:function(e){if(p){if(e==b.live)return!0}else if(e==b.staging||e==b.dev)return!0;return!1},executeBoxEdit:function(e,t){if(h.box_edit_two&&!A){var i;$.getJSON(y,{item_typed_id:t}).then(function(t){var n=t.token;return i=_.get("Item").find(e),g.sendCommand(a(e,n,t.auth_code))}).then(function(e){e&&c(i)})}else{var n=this;$.getJSON(y,{item_typed_id:t},function(t){var i,o=t.token,a=n.getBoxEditObject();a&&(i=_.get("Item").find(e),c(i),a.bgp(e+","+o))})}}};return I.init(),I}),Box.Timing.execution.push({name:"js/services/com-server.js",time:(new Date).getTime()}),Box.Application.addService("com-server",function(e){"use strict";function t(i,n,o){var a;try{if(window.XMLHttpRequest&&(a=new XMLHttpRequest,"withCredentials"in a))return a.open(i,n,o),a;if("undefined"!=typeof XDomainRequest)return a=new XDomainRequest,a.open(i,n),a.onprogress=function(){},a.ontimeout=function(){},a}catch(r){3>w&&setTimeout(function(){return w++,t(i,n,o)},500*w),e.reportError(r)}return null}function i(e,i,n){return new Promise(function(o,a){var r=t(e,i,!0);r?(e===u&&"function"==typeof r.setRequestHeader&&r.setRequestHeader(h,m),r.onload=function(){o(r)},r.onerror=function(){a(r)},setTimeout(function(){r.send(n)},0)):a()})}function n(e){return i(p,d+e+"/status").then(function(e){var t=JSON.parse(e.responseText);return t.running?t:Promise.reject()})}function o(){var e=!1,t=!1,i=!1,o=new Promise(function(o,a){n(f).then(function(){i=!0,e=!0,c=f,b.recordAction({application:"files",page:"",component:"",feature:"boxedit",target:"available",action:"programmatic"}),o()},function(){e=!0,t&&!i&&a()}),n(g).then(function(){i=!0,t=!0,c=g,b.recordAction({application:"files",page:"",component:"",feature:"boxedit",target:"available",action:"programmatic"}),o()},function(){t=!0,e&&!i&&a()})});return o}function a(){var e=(new Date).getTime();return"xxxxxxxx".replace(/x/g,function(){var t=Math.floor((e+16*Math.random())%16);return t.toString(16)})}function r(e){return v.get(e+"-bgp-id")}function s(e){var t=r(e)||a(),i="bgp-"+t,n=(new Date).getTime()+_;return v.set(e+"-bgp-id",t,n),v.set("bgp-"+t,"generic",n),i}function l(e){this.appName=e,this.comChannelName=s(e)}var c,_=31536e6,d="https://edit.boxlocalhost.com:",u="POST",p="GET",h="Content-Type",m="text/plain; charset=UTF-8",f=17223,g=17224,v=e.getService("cookies"),b=e.getService("resin"),w=0;return l.prototype={initLocalInstallationCheck:o,sendRequest:function(e,n){var o=d+c+"/application_request?application="+this.appName+"&com="+this.comChannelName;if(!n)return i(u,o,e).then(function(e){var t=JSON.parse(e.responseText);return t.response_type&&"error"===t.response_type?Promise.reject({name:"CommunicationError",message:t.message}):t});var a=t(u,o,!1);return a&&("function"==typeof a.setRequestHeader&&a.setRequestHeader(h,m),a.send(e),4===a.readyState&&2===Math.floor(a.status/100))?JSON.parse(a.responseText):void 0},sendCommand:function(e){var t=d+c+"/application_command?application="+this.appName+"&com="+this.comChannelName;return i(u,t,e)}},{create:function(e){return new l(e)}}}),Box.Timing.execution.push({name:"js/services/office-online.js",time:(new Date).getTime()}),Box.Application.addService("office-online",function(e){"use strict";var t="office_online_edit_window_closed",i="box_api_file_action_lock_delete",n="/index.php?rm=box_api_file_action_lock_create",o=1e4,a={pptx:1,docx:1,xlsx:1},r={live:"openbox_service4881",staging:"openbox_service2313",dev:"openbox_service2961"},s={live:[129383],staging:[38277],dev:[24521]},l={lockId:null},c=new $.Deferred;return l=$.extend(l,new Box.EventTarget),$.extend(l,{init:function(){var t=(e.getService("ajax"),e.getService("nav-state")),i=e.getService("v5"),n=i.get("Canvas");if(t.isSharedFolderPage()||t.isSharedFilePage()||n&&n.user.is_anonymous())return void c.reject();if(e.getGlobalConfig("isOfficeOnlineAllowed")){var o=e.getService("resin");o.recordAction({application:"files",page:"explorer",component:"none",feature:"officeonline",target:"available",action:"programmatic"}),c.resolve()}else c.reject()},showLaunchingModal:function(t){if(t){var i=e.getService("popups");i.open("office_online_launch_app",{data:{typed_id:t.typed_id}})}},isActionIdOfficeOnline:function(e){var t=this.serviceActionId();return e===t},serviceActionId:function(){var t=e.getService("v5"),i=t.get("live_site"),n=t.get("is_staging_env"),o=r;return i?o.live:n?o.staging:o.dev},isServiceIdOfficeOnline:function(t){var i=e.getService("array-utils");return-1!==i.indexOf(this.serviceIds(),t)},serviceIds:function(){var t=e.getGlobal("live_site"),i=e.getGlobal("is_staging_env"),n=s;return t?n.live:i?n.staging:n.dev},isExtensionSupported:function(e){return!!a[e]},isOfficeOnlineEnabled:function(){return"resolved"===c.state()},isOfficeOnlineAvailableAndSupportedForFile:function(e){return this.isExtensionSupported(e.extension)&&this.isOfficeOnlineEnabled()},runCallbackForOfficeOnlineAvailability:function(e,t){"function"==typeof t&&("function"!=typeof e&&t(),"pending"===c.state()&&this.init(),c.done(e),c.fail(t))},launchFileActionForItemWithTypedId:function(t){var i=this,n=e.getService("v5"),o=n.get("Item");if(o){var a=o.find(t);a?this.launchFileActionForItem(a):o.find_async(t).then(function(e){i.launchFileActionForItem(e)})}},launchFileActionForItem:function(t){var i=e.getService("openbox-service-actions"),n={action_name:"Edit with Office Online",uniq_name:"box_for_office_online",skip_popup:!0};this.showLaunchingModal(t),i.loadOpenboxActionOnItemAndExecute(t,n)},onCloseHandler:function(i){var n=this;return function(){if(i){var a=e.getService("v5"),r=t,s=e.getService("ajax"),l=e.getGlobal("ItemTypeTranslation"),c={fileId:i.id},_=$t('The %1 "%2" has been successfully modified by %3',"popup_office_online_successfully_modified_item",l.singular(i.type),i.name,"Office Online"),d=$t('Unable to save back %1 "%2" modified by %3',"popup_office_online_error_modified_item",l.singular(i.type),i.name,"Office Online"),u=a.get("Toaster");u.toggle_cancel_link(!1),u.set_progress(0),u.set_fake_toaster(o),u.set_message($t("Saving %1 to Box...","popup_office_online_saving_back",$.box.escapeHTML(i.name))),u.show({hide_cancel:!0}),s.post(r,c,{success:function(){u.finish_fake_toaster(),e.getService("notifications").confirm(_),n.removeLock()},error:function(){u.finish_fake_toaster(),e.getService("notifications").confirm(d),n.removeLock()}})}}},establishLock:function(t){var i=new Date;i.setMinutes(i.getMinutes()+30);var o="openbox_service",a=e.getService("nav-state"),r=this.serviceActionId().slice(o.length),s=n,l={typed_id:t.typed_id,service_action_id:r,expiration:i},c=this;$.postJSON(s,l,function(t){t.success&&(c.lockId=t.lock_id,a.isPreviewOpen()?e.broadcast("previewlock"):e.navigate("",{},{not_scroll:!0}))})},removeLock:function(){var t=i,n=e.getService("ajax"),o=e.getService("nav-state"),a={lock_id:this.lockId};n.post(t,a,{success:function(){o.isPreviewOpen()?e.broadcast("previewunlock"):e.navigate("",{},{not_scroll:!0})}})}})}),Box.Timing.execution.push({name:"js/services/browser.js",time:(new Date).getTime()}),Box.Application.addService("browser",function(e){"use strict";function t(e){var t,i,n,o=null,a=null;for(t=0,i=e.length;i>t;t++)if(n=e[t].string,v=e[t].versionSearch||e[t].identity,n&&-1!==n.indexOf(e[t].subString)){o=e[t].identity,a=e[t].device;break}return{identity:o,device:a}}function i(e){var t,i=e.indexOf(v);return-1===i?"":(t=e.substring(i+v.length+1).match(/[0-9]+(?:\.[0-9]*)?/),t&&t.length?t[0]:void 0)}function n(){var e=f.userAgent.match(/Mac OS X (([\d]+)_([\d]+)_([\d]+))/i);return e&&e[1]?{version:e[1].replace(/_/g,"."),major:parseInt(e[2],10),minor:parseInt(e[3],10),maintenance:parseInt(e[4],10)}:null}function o(){var e=n();return e?e.version:"Unknown"}function a(){var e,t=f.userAgent.match(/Windows NT (([\d]+).([\d]+))/i);return t&&t[1]?(e=t[1],"5.1"===e||"5.2"===e?"XP":"6.0"===e?"Vista":"6.1"===e?"7":"6.2"===e?"8":"6.3"===e?"8.1":"Unknown"):null}function r(){var e;return"Mac"===d.OS?(e=n(),e.major>10||10===e.major&&e.minor>=7):!1}function s(){var e,t,i,n=f.plugins;if(!n)return!1;for(n.refresh&&n.refresh(!1),e=0,t=n.length;e<n.length;e++)if(i=n[e],i&&i.name.match(/^Java/))return!0;return!1}function l(){var t=e.getGlobal("ActiveXObject"),i=!1;try{t&&(i=!!new t("htmlfile"))}catch(n){i=!1}return i}function c(e,t){var i;if(0===e.indexOf("audio/"))i=g.createElement("audio");else{if(0!==e.indexOf("video/"))return!1;i=g.createElement("video")}return!(!i.canPlayType||i.canPlayType(e).replace(/^no$/,"")!==t)}function _(e){return c(e,"maybe")||c(e,"probably")}var d,u="9",p='video/mp4; codecs="avc1.42E01E"',h='video/mp4; codecs="avc1.4D401E"',m='video/mp4; codecs="avc1.64001E"',f=e.getGlobal("navigator"),g=e.getGlobal("document"),v="",b=[{string:f.userAgent,subString:"Edge",identity:"Edge"},{string:f.userAgent,subString:"Chrome",identity:"Chrome"},{string:f.userAgent,subString:"criOS",identity:"Chrome",versionSearch:"criOS"},{string:f.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:f.userAgent,subString:"Firefox",identity:"Firefox"},{string:f.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:f.userAgent,subString:"Trident",identity:"Explorer",versionSearch:"rv"},{string:f.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"}],w=[{string:f.platform,subString:"Win",identity:"Windows"},{string:f.userAgent,subString:"iPod",identity:"iOS",device:"iPod"},{string:f.userAgent,subString:"iPhone",identity:"iOS",device:"iPhone"},{string:f.userAgent,subString:"iPad",identity:"iOS",device:"iPad"},{string:f.platform,subString:"Mac",identity:"Mac"},{string:f.userAgent,subString:"Android",identity:"Android"},{string:f.platform,subString:"Linux",identity:"Linux"}];return d={init:function(){this.browser=t(b).identity||"an unknown browser",this.version=i(f.userAgent)||i(f.appVersion)||"an unknown version";var e=t(w);this.OS=e.identity||"an unknown OS",this.device=e.device||"an unknown device"},getName:function(){return this.browser},getVersion:function(){return this.version},getOSName:function(){return this.OS},getDeviceName:function(){return this.device},getOSVersionName:function(){switch(this.getOSName()){case"Mac":return o();case"Windows":return a();default:return"Unknown"}},isMinBrowser:function(e,t){return this.browser.toLowerCase()===e.toLowerCase()&&parseFloat(this.version)>=parseFloat(t)},isHtml5EnabledIE:function(){return this.isMinBrowser("explorer","10")&&g.documentMode?parseInt(g.documentMode,10)>=10:!1},isIncompatibleChromeMacCombination:function(){return this.isChrome()&&r()&&!s()},isIncompatibleSafariMacCombination:function(){return"Mac"===d.OS&&this.isSafari()?this.isMinBrowser("safari","6.1"):!1},isMobileOS:function(){return"iOS"===this.getOSName()||"Android"===this.getOSName()},canUseFlash:function(){var t=e.getGlobal("swfobject");return this.isIE()&&t?t.hasFlashPlayerVersion("9.28.0"):!1},canUseHtml5:function(){return this.isMinBrowser("firefox","3.6")||this.isMinBrowser("chrome","5")||this.isHtml5EnabledIE()||this.isMinBrowser("safari","4")},canPlayH264Baseline:function(){return _(p)},canPlayH264Main:function(){return _(h)},canPlayH264High:function(){return _(m)},canPlayMP3:function(){return c("audio/mpeg","maybe")||c("audio/mpeg","probably")},supportsDash:function(){var t=e.getGlobal("MediaSource");return t?"function"==typeof t.isTypeSupported?t.isTypeSupported(m):this.canPlayH264High():!1},supportsMSE:function(){return!!e.getGlobal("MediaSource")},supportsWebGL:function(){var e,t=g.createElement("canvas");try{e=t.getContext("webgl")||t.getContext("experimental-webgl")}catch(i){}return null!==e&&void 0!==e},supportsPdfjs:function(){return this.hasSVGSupport()&&!this.isIE()||this.isMinBrowser("explorer","10")},canUseHtml5Dnd:function(){return this.isMinBrowser("firefox","3.6")||this.isMinBrowser("chrome","10")||this.isHtml5EnabledIE()||this.isEdge()||this.isMinBrowser("safari","5")},canUseSessionStorage:function(){var t=e.getGlobal("sessionStorage");try{return t.setItem("testKey","testValue"),t.removeItem("testKey"),!0}catch(i){return!1}},isSafari:function(){return"Safari"===this.browser},isFirefox:function(){return"Firefox"===this.browser},isChrome:function(){return"Chrome"===this.browser},isIE:function(){return"Explorer"===this.browser},isEdge:function(){return"Edge"===this.browser},isBrowserPluginsSupported:function(){return f&&"object"==typeof f.plugins&&f.plugins.length>0||this.isIE()&&l()},isTransformSupported:function(){return!this.isIE()||this.isMinBrowser("explorer","9")},canFolderUpload:function(){return this.isMinBrowser("chrome","21")},hasMinimumFlashVersion:function(){var t=e.getGlobal("swfobject"),i=t.getFlashPlayerVersion();return i.major>=parseInt(u,10)},hasSVGSupport:function(){return g.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")},getMinimumFlashVersion:function(){return u}},d.init(),d}),Box.Timing.execution.push({name:"js/services/colorpicker.js",time:(new Date).getTime()}),Box.Application.addService("colorpicker",function(e){"use strict";function t(e){this.$element=$(e)}var i=$t("Please enter a valid hex color code.","invalid_hex_code_error_message");return t.prototype={init:function(t){var n,o=this.$element,a=o.find(".color-input:first"),r=o.find(".color-sample:first");o.ColorPicker({onSubmit:function(e,i,n){a.val(i.toUpperCase()),r.css("background-color","#"+i.toUpperCase()),o.ColorPickerHide(),t&&t()},onBeforeShow:function(){n=a.val(),o.ColorPickerSetColor(n)}}),a.on("change.colorpicker",function(){var t=a.val(),s=/(^[0-9A-F]{6}$)/i.test(t);if(s)n=t;else{var l=e.getService("notifications");l&&l.error(i,{})}o.ColorPickerSetColor(n),a.val(n),r.css("background-color","#"+n)})},destroy:function(){var e=this.$element.find(".color-input:first");e.off(".colorpicker")}},{create:function(e){return new t(e)}}}),Box.Timing.execution.push({name:"js/services/connection.js",time:(new Date).getTime()}),Box.Application.addService("connection",function(e){"use strict";var t=e.getService("popups"),i=!0,n=$t("Box is unable to establish a connection to the Internet. Please wait until your computer reconnects, or press Okay to continue now.","js_no_connection_message"),o=new Box.EventTarget;

return $(window).on("offline",function(){i&&t.alert(n),i=!1,o.fire("offline")}).on("online",function(){i=!0,o.fire("online"),t.close()}),o.isOnline=function(){return i},o}),Loader.t3Loaded.done(function(){Box.Application.getService("connection")}),Box.Timing.execution.push({name:"js/services/cookies.js",time:(new Date).getTime()}),Box.Application.addService("cookies",function(e){"use strict";var t=e.getGlobal("document");return{get:function(e){var i,n,o,a=t.cookie.split("; ");for(n=0,o=a.length;o>n;n++)if(i=a[n].split("="),i[0]===e)return i[1]?decodeURIComponent(i[1]):"";return""},remove:function(e){this.set(e,"",new Date(0))},set:function(i,n,o,a,r){var s,l=new Date;"undefined"==typeof o&&(o=l.getTime()+5184e6),l.setTime(o),a=a||"/";var c=e.getGlobalConfig("cookieDomain");!r&&c?r=c:r||"undefined"==typeof e.getGlobal("cookie_domain")||("undefined"!=typeof Tombstone&&Tombstone.marker("./js/services/cookies.js:82","2014-02-10","need to weed out usage of cookie_domain and move it over to globalconfig"),r=e.getGlobal("cookie_domain")),s=i+"="+encodeURIComponent(n)+"; expires="+l.toGMTString()+"; path="+a,r&&(s+="; domain="+r),s+="; secure",t.cookie=s},isEnabled:function(){return!!(t.cookie&&t.cookie.length>0)},setOnRootDomain:function(t,i,n,o,a){var r=e.getGlobalConfig("cookieRootDomain");this.set(t,i,n,o,r,a)}}}),Box.Timing.execution.push({name:"js/services/datetime.js",time:(new Date).getTime()}),Box.Application.addService("datetime",function(e){"use strict";function t(e){var t=new Date;return t.getDate()==e.getDate()&&t.getMonth()==e.getMonth()&&t.getFullYear()==e.getFullYear()}function i(e){return t(new Date(e.getTime()+864e5))}function n(e){return 1e3*e}function o(e){return parseInt(e/1e3,10)}function a(e){if("object"==typeof e)return e;switch(e){case"M d, yy":return g.MEDIUM_DATE;default:return g.SHORT_DATE}}function r(){if(!f){var e=document.getElementsByTagName("html"),t=e.length>0?e[0]:null;t&&(f=t.getAttribute("lang")),f||(f="en-US","undefined"!=typeof Tombstone&&Tombstone.marker("./js/services/datetime.js:184","2014-05-12","Language should always be defined as html tag attribute. Please let the Moji team know: moji@box.com."))}return f}function s(t,i){var o=e.getService("v5"),a=new Date;isNaN(parseInt(i,10))&&(i=o.get("user_timezone_offset"));var r=60*a.getTimezoneOffset(),s=i+r,l=n(s+parseInt(t,10));return new Date(l)}function l(){var e=new Date;return 60*e.getTimezoneOffset()}function c(e){var t=-l();return s(e,t)}function _(t){var i=e.getService("v5"),n=i.get("user_timezone_offset"),o=s(t,n);return o}function d(e){var t={};return void 0!==e.hour&&(t.hour=e.hour),void 0!==e.minute&&(t.minute=e.minute),void 0!==e.second&&(t.second=e.second),void 0!==e.timeZoneName&&(t.timeZoneName=e.timeZoneName),t}function u(e,t){var i="",n=r(),o=window.Intl&&"object"==typeof Intl,a=o&&"function"==typeof Intl.DateTimeFormat;if(!o||!a)throw new Error("Internationalization API is missing");return i=new Intl.DateTimeFormat(n,t).format(e)}function p(t,i){var n=(e.getService("v5"),"");i=i||g.MEDIUM_DATE;try{n=u(t,a(i))}catch(o){n=$.datepicker.formatDate($.datepicker._defaults.dateFormat,t)}return n}function h(e,n){var o="",a=!1;if(t(e)?(o=$t("today","item_date_today"),a=!0):i(e)?(o=$t("yesterday","item_date_yesterday"),a=!0):o=p(e,n),a&&n){var r=d(n),s=m(r);if(!s){var l=p(e,r);l&&(o+=", "+l)}}return o}function m(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var f=null,g={SHORT_DATE:{year:"numeric",month:"2-digit",day:"2-digit"},MEDIUM_DATE:{year:"numeric",month:"short",day:"numeric"},LONG_DATE:{year:"numeric",month:"long",day:"numeric"},FULL_DATE:{weekday:"short",year:"numeric",month:"long",day:"numeric"},MONTH_DAY:{month:"short",day:"numeric"},MONTH_DAY_TIME:{month:"short",day:"numeric",hour:"numeric",minute:"numeric"},MEDIUM_DATE_TIME:{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"},FULL_DATE_TIME:{weekday:"short",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}},v=864e5;return"en-US"===r()&&(g.SHORT_DATE={year:"2-digit",month:"numeric",day:"numeric"}),{FORMAT_TYPES:g,setTimeToEOD:function(e){return e.setHours(23),e.setMinutes(59),e.setSeconds(0),e},setTimeToBOD:function(e){return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e},getTimestampInSecondsFromDate:function(e){return Math.floor(e.getTime()/1e3)},getDateFromTimestampInSeconds:function(e){return new Date(n(e))},getCurrentTimestampInSeconds:function(){return Math.floor((new Date).getTime()/1e3)},getTomorrowDate:function(){return new Date((new Date).getTime()+v)},parseShortDate:function(e){try{return $.datepicker.parseDate($.datepicker._defaults.dateFormat,e)}catch(t){return null}},parseShortDateToTimestampInSeconds:function(e){var t=this.parseShortDate(e);return t?this.getTimestampInSecondsFromDate(t):null},parseRfc3339Date:function(e){var t=/\d\d\d\d-\d\d-\d\d/;if(!t.test(e))return null;var i=new Date(e.replace(/\-/g,"/"));return isNaN(i.getTime())?null:i},parseRfc3339DateToSeconds:function(e){var t=this.parseRfc3339Date(e);return t?this.getTimestampInSecondsFromDate(t):null},getUserSystemTimeZoneOffsetInSeconds:function(){return l()},convertSecondsToMilliseconds:function(e){return n(e)},convertMillisecondsToSeconds:function(e){return o(e)},formatInUserTimezone:function(e,t){return p(_(e),t)},formatRelativeDateInUserTimezone:function(e,t){return h(_(e),t)},formatWithoutApplyingTimezoneOffset:function(e,t){return p(c(e),t)},formatRelativeDateWithoutApplyingTimezoneOffset:function(e,t){return h(c(e),t)}}}),Box.Timing.execution.push({name:"js/services/dom.js",time:(new Date).getTime()}),Box.Application.addService("dom",function(e){"use strict";function t(e,t,i,n){n=n||{},$(e).on(t,n,i)}function i(e,t,i){$(e).off(t,i)}function n(e,t){return function(i){window.setTimeout(function(){t(e),i.data.detachHandler()},0)}}function o(e,t){return function(){for(var n=0,o=d.length;o>n;n++)i(e,d[n],t)}}function a(e,i){for(var a=n(e,i),r=o(e,a),s=0,l=d.length;l>s;s++)t(e,d[s],a,{detachHandler:r})}function r(){var e,t=document.createElement("fakeelement");for(e in _)"undefined"!=typeof t.style[e]&&d.push(_[e]);u=!0}function s(e,t,i){"add"===i?$(e).addClass(t):"remove"===i&&$(e).removeClass(t)}function l(e,t,i){var n,o,a,r=/\s+/;if(p&&"string"==typeof t)if(Array.isArray(e))for(n=0,o=e.length;o>n;n++)l(e[n],t,i);else if(e instanceof HTMLElement)for(a=t.split(r),n=0,o=a.length;o>n;n++)e.classList[i](a[n].trim());else s(e,t,i);else s(e,t,i)}function c(e,t,i,n){d.length>0?(a(e,n),l(e,t,i)):(l(e,t,i),window.setTimeout(function(){n(e)},0))}var _={transition:"transitionend",WebkitTransition:"webkitTransitionEnd",animation:"animationend",WebkitAnimation:"webkitAnimationEnd"},d=[],u=!1,p="undefined"!=typeof document&&"classList"in document.documentElement;return{query:function(e,t){return $(t||document).find(e)[0]},queryAll:function(e,t){return $(t||document).find(e).get()},setHTML:function(t,i){t&&1===t.nodeType?(e.stopAll(t),$(t).html(i),e.startAll(t)):e.reportError(new Error("setHTML() requires a valid DOM element"))},setText:function(e,t){"textContent"in e?e.textContent=t:e.innerText=t},insertAfter:function(e,t){t.parentNode.insertBefore(e,t.nextSibling)},remove:function(e){e.parentNode.removeChild(e)},addClass:function(e,t,i){u||r(),"function"==typeof i?c(e,t,"add",i):l(e,t,"add")},hasClass:function(e,t){return p&&e instanceof HTMLElement?e.classList.contains(t):$(e).hasClass(t)},removeClass:function(e,t,i){u||r(),"function"==typeof i?c(e,t,"remove",i):l(e,t,"remove")},getNearest:function(e,t){for(var i=$(e),n=i.is(t);!n&&i.length&&!i.is("[data-module]");)i=i.parent(),n=i.is(t);return n?i[0]:null},getNearestTypeElement:function(e){return this.getNearest(e,"[data-type]")},getData:function(e,t){return $(e).data(t)},isVisible:function(e){return $(e).is(":visible")},on:t,off:i,createFragmentFromHtml:function(e){var t=document.createElement("div"),i=document.createDocumentFragment();for($(t).html(e);t.firstChild;)i.appendChild(t.firstChild);return i},getComputedCSS:function(t){var i,n,o={},a=$(t),r=e.getGlobal("getComputedStyle");if(r&&(i=r(t,null))){if(i.length)for(var s=0,l=i.length;l>s;s++)n=i[s],o[n]=a.css(n);else for(n in i)i.hasOwnProperty(n)&&(o[n]=a.css(n));return o}if(t.currentStyle){i=t.currentStyle;for(n in i)o[n]=a.css(n);return o}if(t.style){i=t.style;for(n in i)"function"!=typeof i[n]&&(o[n]=a.css(n))}return o},getBoundingClientRect:function(e){var t=e.getBoundingClientRect();if("number"==typeof t.width)return t;var i={left:t.left,top:t.top,right:t.right,bottom:t.bottom},n=$(e);return i.width=n.outerWidth(),i.height=n.outerHeight(),i},getFirstElementChild:function(e){for(var t=3,i=e.firstChild;i&&i.nodeType===t;)i=i.nextSibling;return i}}}),Box.Timing.execution.push({name:"js/services/download.js",time:(new Date).getTime()}),Box.Application.addService("download",function(e){"use strict";function t(t,i){var n,o,a,r=e.getService("v5"),s=r.get("additional_context"),l=r.get("request_token");i=i||{},a=$("#file_download_iframe"),0===a.length&&(a=$('<iframe id="file_download_iframe" name="box-download-target" style="display:none;"></iframe>').appendTo("body")),o=$('<form method="POST" style="display:none;" />').attr({action:t,id:"file_download_form",target:"box-download-target"}).appendTo("body"),s&&(i.additional_context=s),i.request_token=l;for(n in i)$('<input type="hidden">').attr({name:n,value:i[n]}).appendTo(o);return o}function i(t){var i=e.getService("url");i.goToUrl(t)}function n(e,t){return d.getHostValue(e,t,u)}function o(e,t,i){d.setHostValue(e,t,i,u)}function a(e,t,n,a,r,s,_){$.ajax({type:"HEAD",timeout:_,url:n,success:function(){o(r,s,c.getCurrentTimestampInSeconds()),i(n)},error:function(){o(r,s,-1*c.getCurrentTimestampInSeconds());var i=a.concat([s]);l(e,t,i)},xhrFields:{withCredentials:!0}})}function r(e,t,o,r,s){if("object"!=typeof r)return void _.alert($t("Sorry, we couldn't download that file for you. Please try again.","determine_reachable_download_hosts_and_download"));var d=r.retest_seconds,u=r.external_ip,p=r.download_host_suggested,h=n(u,p),m=r.timeout_ms;if(!h||Math.abs(h)<c.getCurrentTimestampInSeconds()-d)a(e,t,o,s,u,p,m);else if(0>h){var f=s.concat([p]);l(e,t,f)}else i(o)}function s(t,i){var n,o=e.getService("v5"),a=o.get("additional_context"),r=o.get("request_token");t=t||{},a&&(t.additional_context=a),t.request_token=r;for(n in i)t["hosts_to_exclude[]"]=i[n];return t}function l(e,t,n){var o=s(t,n);$.ajax({type:"POST",url:e,data:o,success:function(o){var a=$.parseJSON(o),s=a.box_location;a.reachability_test?r(e,t,s,a,n):i(s)},error:function(){_.alert($t("There was an error with this file download, please try again.","download_via_post"))}})}var c=e.getService("datetime"),_=e.getService("popups"),d=e.getService("reachability"),u="download_host_info";return{downloadViaPostWithReachabilityTest:l,downloadViaPost:function(e,i){var n=t(e,i);n.submit()},downloadViaGet:function(t){var i=e.getService("url");i.goToUrlInBackground(t)}}}),Box.Timing.execution.push({name:"js/services/reachability.js",time:(new Date).getTime()}),Box.Application.addService("reachability",function(e){"use strict";var t={},i=e.getService("cookies");return{getHostValue:function(e,n,o){if(!t[o]){var a=i.get(o);t[o]=a?JSON.parse(a):null}return null===t[o]||null===t[o][e]||null===t[o][e][n]?null:t[o][e][n]},setHostValue:function(e,n,o,a){if(!t[a]){var r=i.get(a);t[a]=r?JSON.parse(r):null}t[a]||(t[a]={}),t[a][e]||(t[a][e]={}),t[a][e][n]=o;var s=JSON.stringify(t[a]);i.set(a,s,(new Date).getTime()+6048e5)},getHostInfo:function(e){return t[e]}}}),Box.Timing.execution.push({name:"js/services/eloqua.js",time:(new Date).getTime()}),Box.Application.addService("eloqua",function(e){"use strict";return{sendEloquaWith:function(e,t,i,n){var o={form_name:e,contact_method:t,referrer_hash:i,additional_form_details:n};$.get("/gen204/_send_eloqua",o)},waitForEloquaGUIDAndSet:function(){var e=null,t=5,i=function(){if(e){if(0===t)return;if("function"==typeof this.GetElqCustomerGUID)return void $('input[name="elqCustomerGUID"]').val(GetElqCustomerGUID());t-=1}e=setTimeout(i,500)};i(),_elqQ.push(["elqGetCustomerGUID"])}}}),Box.Timing.execution.push({name:"js/services/focus.js",time:(new Date).getTime()}),Box.Application.addService("focus",function(e){"use strict";function t(e){for(var t=r.queryAll(a,e),i=[],n=0;n<t.length;n++)r.isVisible(t[n])&&i.push(t[n]);return i}function i(e){return function(i){var o=t(e);o.length>0&&i&&i.data&&i.data.field&&(i.data.field===n?o[0].focus():o[o.length-1].focus())}}var n="after",o="before",a="a[href], button:not(.popup-x-btn), input, select, textarea",r=e.getService("dom");return{wrap:function(e,a){if(!e.isFocusWrapped){e.isFocusWrapped=!0;var s=document.createElement("i");s.setAttribute("tabindex","0");var l=document.createElement("i");if(l.setAttribute("tabindex","0"),r.on(s,"focusin",i(e),{field:o}),r.on(l,"focusin",i(e),{field:n}),e.children.length>0&&(e.insertBefore(s,e.firstChild),e.appendChild(l)),"undefined"==typeof a||a===!0){var c=t(e);a=c[0]}a&&a.focus&&a.focus()}}}}),Box.Timing.execution.push({name:"js/services/form-validator.js",time:(new Date).getTime()}),Box.Application.addService("form-validator",function(e){"use strict";function t(){return"function"==typeof A.createElement("input").checkValidity}function i(e){return e.tagName&&"form"===e.tagName.toLowerCase()}function n(e){var t=e.tagName?e.tagName.toLowerCase():"";return"input"===t||"textarea"===t||"select"===t}function o(e){var t=e.nodeName?e.nodeName.toLowerCase():"",i=E.getNearest(e,$);"select"===t&&i?E.addClass(i,x):E.addClass(e,x)}function a(e){var t=e.nodeName?e.nodeName.toLowerCase():"",i=E.getNearest(e,$);"select"===t&&i?E.removeClass(i,x):E.removeClass(e,x)}function r(e){var t=v?e.validationMessage:e.getAttribute(b);o(e),e.setAttribute(T,""),e.setAttribute(S,"tooltip"),e.setAttribute(k,t),e.setAttribute(j,C)}function s(t){a(t),t.removeAttribute(T),t.removeAttribute(S),t.removeAttribute(k),t.removeAttribute(j),e.broadcast("formvalidatorerrorcleared",t)}function l(e){for(var t=0,i=B.length;i>t;t++)if(e.name===B[t].name)return!0;return!1}function c(e){var t,i=e.validity;i.valueMissing?t=$t("Field Required.","form_error_required"):i.typeMismatch&&"email"===e.type?t=$t("Email Address not valid.","form_email_not_valid"):i.typeMismatch&&"url"===e.type?t=$t("URL not valid.","form_url_not_valid"):i.tooLong?t=$t("Input must be no more than %1 characters.","form_error_too_long",e.maxLength):(i.rangeOverflow||i.rangeUnderflow)&&""!==e.min&&""!==e.max?t=$t("Value must be between %1 and %2.","form_error_between_values",e.min,e.max):i.rangeUnderflow?t=$t("Value must be greater than or equal to %1.","form_error_under_min",e.min):i.rangeOverflow?t=$t("Value must be less than or equal to %1.","form_error_over_max",e.max):(i.stepMismatch||i.typeMismatch||i.patternMismatch||i.badInput)&&(t=$t("Input not valid.","form_error_not_valid")),t&&e.setCustomValidity(t)}function _(e){return n(e)?e.disabled||E.getNearest(e,".disabled")?!1:v&&!e.willValidate?!1:!0:!1}function d(e,t){var i=e.getAttribute(y);if(i)for(var n=i.split(" "),o=0,a=n.length;a>o;o++)if(n[o]===t)return!0;return!1}function u(e){for(var t,i=E.queryAll("input, select, textarea",e),n=[],o=0,a=i.length;a>o;o++)t=i[o],_(t)&&n.push(t);return n}function p(e,t){v?(e.setCustomValidity(t),e.removeAttribute(b)):""===t?e.removeAttribute(b):e.setAttribute(b,t)}function h(e,t){p(e,t),e.setAttribute(w,!0),r(e)}function m(){return{setCustomValidity:p,hasValidatorAttribute:d}}function f(e){var t;if(v){if(e.setCustomValidity(""),e.removeAttribute(w),e.checkValidity(),!e.validity.valid)return c(e),r(e),!1;for(var i=E.getNearest(e,"form"),n=m(),o=0,a=B.length;a>o;o++)if(t=B[o],t.shouldValidate(n,i,e)&&!t.validate(n,i,e))return r(e),!1;return s(e),!0}return!e.hasAttribute(b)}function g(e){function t(e){var t=e.target;n(t)&&t.hasAttribute(w)&&(t.removeAttribute(w),p(t,""),s(t))}E.on(e,"input",t),E.on(e,"change",t)}var v,b="data-form-error",w="data-temp-error",y="data-validator",x="is-invalid",S="data-focus",k="aria-label",T="data-tooltip",j="data-tooltip-theme",C="error",$=".select-container",A=e.getGlobal("document"),E=e.getService("dom"),B=[];v=t();var I={initForm:function(e){e.setAttribute("novalidate","novalidate");for(var t=u(e),i=0,n=t.length;n>i;i++){var o=t[i],a=o.getAttribute(b);a&&h(o,a)}g(e)},canValidate:_,checkValidity:function(e){if(i(e)){for(var t=u(e),o=!0,a=0,r=t.length;r>a;a++)f(t[a])||(o=!1);return o}if(n(e))return _(e)?f(e):!0;throw new Error("checkValidity() requires a form, input, select, or textarea element!")},setCustomError:h,addValidationRule:function(e){if("function"!=typeof e.shouldValidate||"function"!=typeof e.validate)throw new Error("Validation rules must have a shouldValidate() function and a validate() function");if("string"!=typeof e.name)throw new Error("Validation rules must have a unique `name` property");l(e)||B.push(e)}};return I}),Box.Timing.execution.push({name:"js/services/fullscreen.js",time:(new Date).getTime()}),Box.Application.addService("fullscreen",function(e){"use strict";function t(){return document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled}function i(){return document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled?document.fullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement:r.hasClass(l,s)}function n(){i()?(a.fire("enter"),r.addClass(l,s)):(a.fire("exit"),r.removeClass(l,s))}function o(e){i()?(r.removeClass(l,s),document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()):(document.documentElement.requestFullscreen?document.documentElement.requestFullscreen(e):document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen(e):document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen(e):document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen(e):document.documentElement.webkitRequestFullScreen&&document.documentElement.webkitRequestFullScreen(e),r.addClass(l,s))}var a=$.extend({},new Box.EventTarget),r=e.getService("dom"),s="is-fullscreen",l=document.body;return $(document).on("webkitfullscreenchange mozfullscreenchange MSFullscreenChange fullscreenchange",n),$.extend(a,{isSupported:t,enter:o,exit:o,isFullScreen:i})}),Box.Timing.execution.push({name:"js/services/function-utils.js",time:(new Date).getTime()}),Box.Application.addService("function-utils",function(){"use strict";function e(e,t,i){var n,o,a,r,s,l=function(){var c=(new Date).getTime()-r;t>c&&c>0?n=setTimeout(l,t-c):(n=null,i||(s=e.apply(a,o),n||(a=o=null)))};return function(){var c=i&&!n;return a=this,o=arguments,r=(new Date).getTime(),n||(n=setTimeout(l,t)),c&&(s=e.apply(a,o),a=o=null),s}}function t(e,t){var i,n,o,a=null,r=0,s=function(){r=(new Date).getTime(),a=null,o=e.apply(i,n),a||(i=n=null)};return function(){var l=(new Date).getTime(),c=t-(l-r);return i=this,n=arguments,0>=c||c>t?(clearTimeout(a),a=null,r=l,o=e.apply(i,n),a||(i=n=null)):a||(a=setTimeout(s,c)),o}}return{debounce:e,throttle:t}}),Box.Timing.execution.push({name:"js/services/growl-notifications.js",time:(new Date).getTime()}),Box.Application.addService("growl-notifications",function(e){"use strict";function t(e,t){var i=r.createElement("div");i.className="growl_notification",i.style.display="none",i.setAttribute("data-resin-feature","realtime"),i.setAttribute("data-resin-component","notification");var n=r.createElement("a");n.className="inner media",i.appendChild(n);var a=r.createElement("span");a.className="img icon sprite_32x32",-1===e.indexOf("/")?a.className+=" "+e:a.style.backgroundImage="url("+e+")",n.appendChild(a),n.setAttribute("data-resin-target","notification");var s=r.createElement("div");return s.className="growl_text ellipsis ellipsis_190",o.setHTML(s,t),n.appendChild(s),i}var i=2e4,n=3,o=e.getService("dom"),a=e.getService("promises"),r=e.getGlobal("document"),s=(e.getService("v5"),e.getGlobalConfig("showAmsterdamCollabSharing")),l=0,c=r.createElement("div");return c.className="growl_notification_container",c.setAttribute("data-resin-page","none"),r.body.appendChild(c),{display:function(e,o){if(s)return a.createRejected();if(l>=n)return a.createRejected();l++;var r=t(e,o);c.appendChild(r),$(r).animate({height:"show",opacity:"show"},"slow");var _=a.create(function(e,t){$(r).on("click",e),setTimeout(t,i)}),d=function(){l--,$(r).animate({height:"hide",opacity:"hide"},"fast",function(){c.removeChild(r)})};return _.then(d,d),_}}}),Box.Timing.execution.push({name:"js/services/hotkeys.js",time:(new Date).getTime()}),Box.Application.addService("hotkeys",function(e){"use strict";function t(e){var t={key:e};g.sendBatchLog("hotkeys",S,t)}function i(e){return e.comboKey?e.comboKey+e.key:e.key}function n(e){return function(i){h&&h.anyPopupsOpen()||p&&p.isPopupShowing()||(e.comboKey?v===e.comboKey&&(e.handler(i),t(e.comboKey+"+"+e.key)):v||(e.handler(i),t(e.key)))}}function o(e){var t=i(e),n=y[S][t],o=n?n.wrappedHandler:null;o&&(T.off("keydown.hotkeys",o),y[S][t].wrappedHandler=null)}function a(e){var t=i(e),a=n(e),r=y[S];r&&r[t]&&"function"==typeof r[t].wrappedHandler&&o(e),y[S]||(y[S]={}),y[S][t]={keyConfig:e,wrappedHandler:a},T.on("keydown.hotkeys",null,e.key,a)}function r(e){return function(){v=e,clearTimeout(b),b=setTimeout(function(){v===e&&(v=null)},j)}}function s(){var e=m&&m.isSharedFilePage()||f&&f.isSharedFilePageOrSharedFileEmbed();p&&!e&&p.open("hotkeys_legend",{data:{hotkeyConfigId:S}})}function l(){p=e.getService("popups"),h=e.getService("popups-amsterdam"),m=e.getService("nav-state"),g=e.getService("logger"),f=e.getService("preview-nav"),w=!0}function c(e){var t,i=y[e];for(t in i)i.hasOwnProperty(t)&&o(i[t].keyConfig);x={},S=null,e!==k&&delete y[e]}function _(e,t){var i,n=t.comboKey;n&&!x[n]&&(i={key:n,handler:r(n)},e(i),x[n]=!0),e(t)}function d(){var e,t=y[k];S=k,a({key:"shift+/",handler:s});for(e in t)t.hasOwnProperty(e)&&_(a,t[e].keyConfig)}function u(e,t){var i,n=t.length;for(S!==e&&(a({key:"shift+/",handler:s}),S=e),i=0;n>i;i++)_(a,t[i])}var p,h,m,f,g,v,b,w=!1,y={},x={},S=null,k=null,T=$(e.getGlobal("document")),j=1e3;return{setConfig:function(e,t,i){w||l(),S&&t!==S&&c(S),i=!!i,i&&(k=t),u(t,e)},unsetConfig:function(e){y[e]&&S===e&&(c(S),k&&d())},setHotkeyForConfig:function(e,t){y[t]&&S===t&&a(e)},unsetHotkeyForConfig:function(e,t){y[t]&&S===t&&o({key:e})}}}),Box.Timing.execution.push({name:"js/services/imageloader.js",time:(new Date).getTime()}),Box.Application.addService("imageloader",function(e){"use strict";return{loadImages:function(e,t){setTimeout(function(){$(e).find("div, span").filter("[data-background-image]").each(function(e,i){var n=$(i);"none"!==n.css("display")&&n.attr("data-background-image")&&(n.css("background-image","url("+n.attr("data-background-image")+")"),t&&n.css("background-size","100%"),n.removeAttr("data-background-image"))})},0)}}}),Box.Timing.execution.push({name:"js/services/loading.js",time:(new Date).getTime()}),Box.Application.addService("loading",function(){"use strict";function e(){a||(a=document.createElement("div"),a.id=i)}function t(){r||(r=document.createElement("div"),r.id=n,r.className="ur_corner badge update large_badge",r.innerHTML=o)}var i="global_blocker",n="right_loading_message",o=$t("Loading...","js_loading"),a=document.getElementById(i),r=document.getElementById(n),s=!!a||!!r;return s&&t(),{isBlocking:function(){return s},set:function(i){e(),t(),i&&!s?(document.body.appendChild(a),document.body.appendChild(r),s=!0):!i&&s&&(a.parentNode&&a.parentNode.removeChild(a),r.parentNode&&r.parentNode.removeChild(r),s=!1)}}}),Box.Timing.execution.push({name:"js/services/logger.js",time:(new Date).getTime()}),Box.Application.addService("logger",function(e){"use strict";function t(){var t=e.getGlobal("XMLHttpRequest"),i=e.getGlobal("ActiveXObject");return t?new t:i?new i("Microsoft.XMLHTTP"):null}function i(e,i,n){var o=l+"?"+$.param(e),a=t();null!==a&&("function"==typeof i&&(a.onreadystatechange=function(){4==a.readyState&&(200===a.status||204===a.status||1223===a.status)&&i()}),a.open("GET",o,!n),a.send())}function n(e,i){var n=t();null!==n&&(n.open("POST",e,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),n.send("data="+JSON.stringify(i)))}function o(e){var t=u.getItem(d)||[];t.push(e),u.setItem(d,t)}function a(){var e=u.getItem(d);u.removeItem(d),clearTimeout(s),n(c,e),s=null}function r(t,i,n){var o=[];return o.push("experiment="+encodeURIComponent(t)),o.push("event="+encodeURIComponent(i)),n&&o.push("additional_params="+encodeURIComponent(JSON.stringify(n))),o.push("request_token="+encodeURIComponent(e.getGlobal("request_token"))),o.join("&")}var s,l="/gen204",c="/index.php?rm=box_gen204_batch_record",_=5e3,d="LOGGER_SERVICE_QUEUE",u=e.getService("session-store");return{sendLog:function(e,t,n,o,a,r){n=n||{},a=a||{};var s={category:e,event_type:t,keys_and_values:n,runmode_options:a};i(s,o,r)},sendBatchLog:function(e,t,i,n){i.client_ds=Math.floor((new Date).getTime()/1e3),o({event_type:t,category:e,events:[i]}),n?a():s||(s=setTimeout(a,_))},sendMetric:function(e,t){t=t||{};var n={category:"metrics",event_type:"metrics",keysAndValues:{name:e,value:"+1",type:"counter",tags:t}};i(n)},sendSplitTestLog:function(e,t,n){var o={category:"experiment",event_type:t,keys_and_values:{experiment:e,additional_params:n}};i(o)},sendSplitTestConversion:function(e,i,n){var o=t();if(null!==o){var a=r(e,i,n);o.open("POST","/index.php?rm=experiment_convert",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),o.send(a)}}}}),Box.Timing.execution.push({name:"js/services/menus.js",time:(new Date).getTime()}),Box.Application.addService("menus",function(e){"use strict";function t(e){var t=e.indexOf("top")>-1;return t?"top":"bottom"}function i(e){var t=e.indexOf("right")>-1;return t?"right":"left"}function n(e,t){return t>0?e+="+"+t:0>t&&(e+=t),e}function o(){d||(d=!0,$("body").on("mousedown.menus",function(e){var t=$(e.target);t.is(".ignore_mousedown")||t.closest("[aria-haspopup]").length&&!t.closest("[data-legacy-popup]").length||t.closest(".ui-menu").length||!_||!_.isOpen()||_.hide()}))}function a(){d&&($("body").off("mousedown.menus"),d=!1)}function r(e){this.$menu=$(e),this.isCheckboxMenu=this.$menu.find('input[type="checkbox"]').length?!0:!1,$.extend(this,new Box.EventTarget)}var s,l='<div class="menu-beak"></div>',c=8,_=null,d=!1;return r.prototype={init:function(){var t=this;s=e.getService("dom"),this.$menu.menu(),this.$menu.on("menuselect",function(e,i){e.stopPropagation(),e.preventDefault();var n=i.item[0];if(t.isCheckboxMenu){var o=s.query("[type=checkbox]",n);o&&(o.checked=!o.checked)}else t.isOpen()&&t.$menu.menu("focus",e,i.item);t.fire("menuselect",{targetElement:n})}),this.isCheckboxMenu&&this.$menu.find("[type=checkbox]").on("click",function(e){var i=$(e.target).parents(".ui-menu-item")[0];t.fire("menuselect",{targetElement:i}),e.stopPropagation()})},setSelectedCheckboxes:function(e){if(this.isCheckboxMenu&&e)for(var t=0,i=e.length;i>t;t++)s.query('[data-value="'+e[t]+'"] [type=checkbox]',this.$menu).checked=!0},destroy:function(){_==this&&(_=null),this.$menu.off("menuselect"),this.$menu.menu("destroy")},show:function(e,a,r,s){a=a||"",r=r||{},s=s||"auto";var l=parseInt(r.x||0,10),c=parseInt(r.y||0,10),d=$(e),u=d.offset();_&&_.hide(),$("body").trigger("close.menus");var p=i(a),h=t(a),m=n(p,l),f=n("top"===h?"bottom":"top",c);this.$menu.show(),this.$menu.width(s),this.$menu.position({my:m+" "+f,at:p+" "+h,of:e,collision:"flipfit"}),this.$menu.focus();var g=d.offset(),v=g.left!=u.left||g.top!=u.top;v&&this.$menu.position({my:m+" "+f,at:p+" "+h,of:e,collision:"flipfit"}),this.fire("menushow"),_=this,o()},showWithBeak:function(e,t,i,n,o){o=o||0,this.show(e,t,i,n),this.willBeakHitPositionEl(e)||$(l).prependTo(this.$menu).css("left",o)},hide:function(){_==this&&(_=null),this.fire("menuhide"),this.$menu.hide(),a()},isOpen:function(){return this.$menu.is(":visible")},willBeakHitPositionEl:function(e){var t=e.getBoundingClientRect(),i=t.top+t.height,n=this.$menu.get(0).getBoundingClientRect().top;return i>=n-c}},{create:function(e){return new r(e)},close:function(){_&&_.hide()}}}),Box.Timing.execution.push({name:"js/services/menu-toggle.js",time:(new Date).getTime()}),Box.Application.addService("menu-toggle",function(e){"use strict";function t(){if(d){var e=d,t=s.getNearest(d,".menu-wrapper");s.removeClass(t,_),setTimeout(function(){e.style.display=""},100),d=null}}function i(e){var i=e.nextSibling;if(i){for(;i.nodeType===u;)if(i=i.nextSibling,!i)return;if("MENU"!==i.nodeName&&(i=s.queryAll(".menu",i)),i){var n=s.getNearest(i,".menu-wrapper");if(s.hasClass(n,_))return void t();d&&t(),d=i,n=s.getNearest(d,".menu-wrapper"),l.wrap(n),i.style.display="block",setTimeout(function(){s.addClass(n,_)},100)}}}function n(e){var t=e.target||e.srcElement;if(!t)return null;if(t.getAttribute("data-type")===c)return t;for(;;){if(t=t.parentNode,!t||t===document.body||!t.getAttribute)return null;if(t.getAttribute("data-type")===c)return t}}function o(e){var t=e.target||e.srcElement;return!!s.getNearest(t,".menu")}function a(e,t){return function(){e.apply(t,arguments)}}function r(e){this.shouldCloseMenuOnBlur="undefined"!=typeof e?e:!0}var s,l,c="menu-toggle-button",_="is-visible",d=null,u=3;return r.prototype={init:function(){s=e.getService("dom"),l=e.getService("focus"),this.shouldCloseMenuOnBlur&&s.on(document.body,"mousedown",a(this.globalClickHandler,this))},destroy:function(){this.shouldCloseMenuOnBlur&&s.off(document.body,"mousedown",a(this.globalClickHandler,this))},showMenu:i,closeMenu:t,globalClickHandler:function(e){if(d){var t=n(e);if(t){for(var i=t.nextSibling;i.nodeType===u;)if(i=i.nextSibling,!i)return;if(i===d)return}o(e)||this.closeMenu()}}},{create:function(e){return new r(e)}}}),Box.Timing.execution.push({name:"js/services/metadata-search-filter.js",time:(new Date).getTime()}),Box.Application.addService("metadata-search-filter",function(e){"use strict";function t(e,t){e.setAttribute("data-hover","tooltip"),e.setAttribute("aria-label",t),T.addClass(e,"error")}function i(e){T.removeClass(e,"error"),e.removeAttribute("aria-label"),e.removeAttribute("data-hover")}function n(t){T=e.getService("dom"),j=e.getService("datetime"),C=t}function o(){var e=T.query("select.search-filters-metadata-type :selected",C);return e?e.getAttribute(A):""}function a(){var e=T.query("select.search-filters-metadata-type :selected",C);return e?e.getAttribute(E):""}function r(){var e=[];return $(C).find('input[data-metadata-widget="text"]').each(function(t,i){if(""!==i.value){var n={key:i.getAttribute(B),format:i.getAttribute(I),value:{"enum":[i.value]}};void 0!==i.getAttribute(P)&&(n.isText="true"===i.getAttribute(P)),e.push(n)}}),e}function s(e){$(C).find('input[data-metadata-widget="text"]').each(function(t,i){var n=i.getAttribute(B),o=i.getAttribute(I),a=e[n];a&&n===a.key&&o===a.format&&(i.value=a.value["enum"][0])})}function l(){var e=[];return $(C).find('select[data-metadata-widget="dropdown"]').each(function(t,i){var n=T.query("option:selected",i);if(null===n.getAttribute("data-null-option")){var o={key:i.getAttribute(B),format:i.getAttribute(I),value:{"enum":[n.value]}};void 0!==i.getAttribute(P)&&(o.isText="true"===i.getAttribute(P)),e.push(o)}}),e}function c(e){$(C).find('select[data-metadata-widget="dropdown"]').each(function(t,i){var n=i.getAttribute(B),o=i.getAttribute(I),a=e[n];if(a&&n===a.key&&o===a.format){var r=a.value["enum"][0],s=T.query('option[value="'+r+'"]',i);s&&(s.selected=!0)}})}function _(e){return/^(\-|\+)?([0-9]+)$/.test(e)?Number(e):null}function d(e){return/^(\-|\+)?([0-9]+)(.[0-9]+)?$/.test(e)?Number(e):null}function u(e,t){return"integer"===t?_(e):"float"===t?d(e):"date"===t||"date-time"===t?j.parseShortDate(e):null;

}function p(e,t){return"integer"===t||"float"===t?e:"date"===t||"date-time"===t?$.datepicker.formatDate($.datepicker._defaults.dateFormat,e):""}function h(e,t){return"integer"===t||"float"===t?e:"date"===t||"date-time"===t?$.datepicker.parseDate("yy-mm-ddT00:00:00.000Z",e):null}function m(e,t){return"integer"===t||"float"===t?e:"date"===t||"date-time"===t?$.datepicker.formatDate("yy-mm-ddT00:00:00.000Z",e):null}function f(e){return"integer"===e?M:"float"===e?N:"date"===e||"date-time"===e?F:""}function g(e){return"integer"===e?O:"float"===e?R:"date"===e||"date-time"===e?D:""}function v(e){var n=[];return $(C).find(e).each(function(e,o){var a={},r=T.query('[data-name="from"]',o),s=T.query('[data-name="to"]',o),l=null,c=null,_=o.getAttribute(I);i(r),i(s),""!==r.value&&(l=u(r.value,_),null!==l&&(a.gt=m(l,_))),""!==s.value&&(c=u(s.value,_),null!==c&&(a.lt=m(c,_)));var d=[],p=null,h=f(_),v=g(_);""!==r.value&&null===l&&(d.push(r),p=h),""!==s.value&&null===c&&(d.push(s),p=h),null!==l&&null!==c&&l>c&&(a={},d=[r,s],p=v);for(var b=0,w=d.length;w>b;b++)t(d[b],p);$.isEmptyObject(a)||n.push({key:o.getAttribute(B),format:o.getAttribute(I),value:{range:a}})}),n}function b(e,t){$(C).find(e).each(function(e,i){var n=i.getAttribute(B),o=i.getAttribute(I),a=T.query('[data-name="from"]',i),r=T.query('[data-name="to"]',i),s=t[n];if(s&&n===s.key&&o===s.format){var l=s.value.range;if("gt"in l){var c=h(l.gt,o);null!==c&&(a.value=p(c,o))}if("lt"in l){var _=h(l.lt,o);null!==_&&(r.value=p(_,o))}}})}function w(){return v('[data-metadata-widget="numericRange"]')}function y(e){b('[data-metadata-widget="numericRange"]',e)}function x(){return v('[data-metadata-widget="datetimeRange"]')}function S(e){b('[data-metadata-widget="datetimeRange"]',e)}function k(){var e='[data-metadata-widget="datetimeRange"] input';$(C).off("focus",e).on("focus",e,function(){$(this).datepicker()})}var T,j,C,A="data-metadata-template",E="data-metadata-scope",B="data-metadata-key",I="data-metadata-format",P="data-metadata-istext",F=$t("Invalid date format","search_filter_invalid_date_format"),D=$t("Invalid date range","search_filter_invalid_date_range"),M=$t("Invalid integer value","search_filter_invalid_integer_value"),O=$t("Invalid integer range","search_filter_invalid_integer_range"),N=$t("Invalid float value","search_filter_invalid_float_value"),R=$t("Invalid float range","search_filter_invalid_float_range");return n.prototype={init:function(){k()},getMetadataFilters:function(){var e=[];return e.push.apply(e,r()),e.push.apply(e,l()),e.push.apply(e,x()),e.push.apply(e,w()),{template:o(),scope:a(),fields:e}},setMetadataFilters:function(e){for(var t={},i=e.fields||[],n=null,o=0,a=i.length;a>o;o++)n=i[o],t[n.key]=n;s(t),c(t),S(t),y(t)}},{createMetadataSearchFilter:function(e){var t=new n(e);return t.init(),t}}}),Box.Timing.execution.push({name:"js/services/nav.js",time:(new Date).getTime()}),Box.Application.addService("nav",function(e){"use strict";function t(e,t){return{url:e,data:t}}function i(e){h.href=e}function n(e){for(var t=0;t<f.length;t++)if(f[t].regex.test(e))return f[t];return null}function o(t){for(var i,n,o,a=_.createFragmentFromHtml(t),r=a.querySelectorAll("[data-content-for]"),s=0,l=r.length;l>s;s++){if(o=r[s],i=o.getAttribute("data-content-for"),n=_.query(i),!n)return void e.reportError("Could not find "+i);if(e.stopAll(n),d&&d.hideAll(),c(n).empty(),"TITLE"===n.tagName)u.title=o.firstChild.nodeValue;else for(;o.firstChild;)n.appendChild(o.firstChild);e.startAll(n)}}function a(){var e=p.getState()||{},t={url:e.hash?e.hash.replace(/[?&]_suid=\d+/,""):h.pathname+h.search,data:e.data?e.data.data:null};t.url=t.url.replace(/\?$/,""),m.setItem(l,JSON.stringify(t))}function r(){var e=m.getItem(l);return e?JSON.parse(e):null}function s(t){a(),e.broadcast("navigationend",t)}var l="nav:state",c=e.getGlobal("$"),_=e.getService("dom"),d=e.getService("tooltips-amsterdam"),u=e.getGlobal("document"),p=e.getGlobal("History"),h=e.getGlobal("location"),m=e.getGlobal("sessionStorage"),f=[],g=!1;return{_coreNavigate:function(t,a){var r=t.url,l=n(r),_=a.url,d=n(_),u=!0,p={from:a,to:t};e.broadcast("navigationstart",p),d&&d.exit&&(u=d.exit(t,a)),l&&l.enter&&(u=l.enter(t,a)&&u),u?c.ajax({method:"get",url:r,dataFilter:function(e){return e}}).done(function(e,t,i){o(i.responseText),s(p)}).fail(function(){i(r)}):s(p)},init:function(){if(!g){var e=this;p.Adapter.bind(window,"statechange",function(){var t=p.getState(),i=t.data,n=r();e._coreNavigate(i,n)}),a(),g=!0}},destroy:function(){c(window).unbind("statechange"),g=!1},getState:function(){var e=p.getState();return e&&e.data?e.data.data:null},intercept:function(t,i){i.enter||i.exit||e.reportError(new TypeError("Second argument missing enter and exit methods.")),f.push({regex:t,enter:i.enter,exit:i.exit})},navigate:function(e,i){if(!e)throw new TypeError("Invalid URL provided for Ajax navigation.");var n=t(e,i);p.pushState(n,null,e)},redirect:function(e){i(e)},replace:function(e,i){if(!e)throw new TypeError("Invalid URL provided for Ajax navigation.");var n=t(e,i);p.replaceState(n,null,e)},refresh:function(){var e=r();this._coreNavigate(e,e)},reload:function(e){h.reload(e)},navigateOrRefresh:function(e,t){var i=r();i&&i.url===e?this._coreNavigate(i,i):this.navigate(e,t)}}}),Box.Timing.execution.push({name:"js/services/navigation.js",time:(new Date).getTime()}),Box.Application.addService("navigation",function(e){"use strict";function t(t){var i,n,o,a,r=e.getService("v5"),s=r.get("box").hist_name,l=B[s],c=t.indexOf("?");for(o=c>-1?t.substring(0,c):t,i=0,n=l.length;n>i;i++)if(a=o.match(l[i].pattern))return{name:l[i].name,match:a};return{}}function i(i){var n,o=e.getService("v5"),a=e.getService("url"),r=o.get("start_item"),s=(o.get("startPage"),o.get("box").hist_name),l=t(i),c=l.name,_=l.match,d=a.getQueryParams(i);if("files"===s)switch(c){case"favorites":n={type:"favorites",page:_[1]};break;case"filesPreview":n={type:"f",isGallery:!0,galleryId:_[3],id:_[2],page:_[1]};break;case"folder":n={type:"f",page:_[1],id:_[2],folderName:_[3]};break;case"search":n={type:"s",page:_[2],searchString:a.decodePathComponent(_[1]),searchFilters:_[3]?a.decodePathComponent(_[3]):"",mdfilters:d.mdfilters||""};break;case"searchPreview":n={type:"s",isGallery:!0,galleryId:_[3],page:_[1],searchString:a.decodePathComponent(_[2]),searchFilters:"",mdfilters:d.mdfilters||""};break;case"tagPreview":n={type:"t",page:_[1],tags:a.decodePathComponent(_[2]),id:a.decodePathComponent(_[2]),isGallery:!0,galleryId:_[3]};break;case"tag":n={type:"t",page:_[1],tags:a.decodePathComponent(_[2]),id:a.decodePathComponent(_[2])};break;case"weblink":n={redirect:i};break;default:n={type:"f",id:0}}else if("shared_folder"===s)switch(c){case"sharedSingleItem":case"vanitySingleItem":n=_[5]?{page:_[2],id:_[3],isGallery:!0,galleryId:_[4]}:{page:_[2]};break;case"sharedFolderView":case"vanityFolderView":n={page:_[2],id:_[3]};break;case"sharedRoot":case"vanityRoot":n={page:"1",id:r.substr(2)};break;case"weblink":}else if("collab"===s)switch(d=a.getQueryParams(i),c){case"collaboratorsWithPage":n={page:_[1],type:"contacts"};break;case"collaboratorsRoot":n={page:"1",type:"contacts"};break;case"searchWithPage":n={page:_[1],type:"contacts",searchString:d.search?d.search:null};break;case"search":n={page:"1",type:"contacts",searchString:d.search?d.search:null}}else if("gcm"===s)switch(c){case"gcmFiles":n={type:"gcm_files",gcmUserId:_[1],id:_[2],page:_[3]};break;case"gcmPreviewer":n={type:"gcm_files",gcmUserId:_[1],id:_[2],page:_[3],galleryId:_[4],isGallery:!0};break;case"gcmSearch":n={type:"gcm_search",page:_[2],searchString:a.decodePathComponent(_[1]),searchFilters:_[3]?a.decodePathComponent(_[3]):""};break;case"gcmSearchFile":n={type:"gcm_search",page:_[2],searchString:a.decodePathComponent(_[1]),galleryId:_[3],isGallery:!0};break;case"gcmQuarantinePreview":d=a.getQueryParams(i),n={type:"gcm_quarantine_preview",fileVersionId:_[1],policyId:d.policy_id||0,gcmUserId:d.user_id||0,before_id:d.before_id||0,after_id:d.after_id||0,isGallery:!0};break;case"gcmQuarantine":d=a.getQueryParams(i),n={type:"gcm_quarantine",page:_[1],policyId:d.policy_id||0,gcmUserId:d.user_id||0,before_id:d.before_id||0,after_id:d.after_id||0};break;case"weblink":n={redirect:i};break;case"gcmLanding":default:n={type:"gcm_users",id:0,page:0}}if(n){var u=e.getService("nav-state"),p=u.createNavObject(n);return p.galleryId&&"f_"!=p.galleryId.substr(0,2)&&(p.galleryId="f_"+p.galleryId),p}return null}function n(t){var i=e.getService("nav-state");t.action="show",t.referrerUrl=i.getLastNonGalleryUrl(),t.referrerType=i.getLastType(),e.broadcast("previewaction",t)}function o(e,t,i){var o,a=e.typed_id,r=e.id;e.collection&&(o=e.collection.items),n({itemTypedID:a,fileId:r,allItems:o,searchFilters:t,sidebar:i})}function a(t,i){var o=e.getService("v5"),a=e.getService("loading"),r=o.get("Item"),s=r.find_async(t);s.then(function(e){a.set(!1),n({fileId:e.id,itemTypedID:t,allItems:[e],sidebar:i})})}function r(e,t,i){n({itemTypedID:e,fileId:e,allItems:[],searchFilters:t,sidebar:i})}function s(){var t=e.getService("nav-state"),i=e.getService("notifications"),n=!0;i.hide(n),t.isShowingFiles()?$("#select_all").show():$("#select_all").hide(),$("#jquery_editable_input").blur()}function l(t,i){var n=e.getService("v5"),o=n.get("box");"undefined"!=typeof i&&j>i||(o.load(t),e.broadcast("x-folderchangeafter",{json:t}),T&&(T(t),T=null))}function c(t,i){var n,o=e.getService("v5"),a=e.getService("nav-state"),r=e.getService("resin"),c=e.getService("search"),_=o.get("box"),d=(o.get("Canvas"),o.get("theme_id")),u=(new Date).getTime();t.searchString&&(s(),e.broadcast("x-folderchangebefore"),j=u,_.after_search_callback=function(e){l(e,u)}),n={runmode:"box_v2_search_item_list",query:t.searchString,page_num:t.page,theme_id:d,sort:t.sort||"relevance",direction:t.sortDirection||"ASC",filters:a.getSearchFiltersFromString(t.searchFilters),mdfilters:t.mdfilters||"",callback:$.proxy(_,"after_search_callback"),preloadedResults:i||null,resin_session_id:r.getSessionId()},"relevance"===n.sort&&(n.direction="DESC"),c.execute(n)}function _(t,i){var n,o=e.getService("v5"),a=e.getService("nav-state"),r=o.get("Canvas"),s=o.get("theme_id"),l={},c=null,_=new $.Deferred;return i=i||{},(a.isSearch()||!a.isSortedBy("relevance")||a.isTag())&&(l.sort=t.sort,l.direction=t.sortDirection),a.isFiles()?(0!=t.id&&$(".body").removeClass("disable_48x48_sprites"),l.id="d_"+t.id,a.isTrash()?l.filter=t.trashFilter:"deleted"===l.sort&&(delete l.sort,delete l.direction),t.isGallery&&(l.sub_id=t.galleryId,l.sub_type="1")):a.isTag()?l.id="t_"+t.id:a.isSearch()&&(l.to_search=t.id),l.page_num=null!==i.page&&""!==i.page&&"undefined"!=typeof i.page?i.page:t.page,r.page_size&&(l.page_size=r.page_size),s&&(l.theme_id=s),n=r.collections.length,l.collection_id=n>0?n-1:n,i.display_on_top_typed_ids&&(l.display_on_top_typed_ids=i.display_on_top_typed_ids),a.isFiles()?c="/index.php?rm=box_item_list":a.isTag()&&(c="/index.php?rm=box_tag_item_list"),i.preloadedResults?(i.preloadedResults.first_load=!0,_.resolve(i.preloadedResults).promise()):$.getJSON(c,$.box.formatQuery(l))}function d(t){var i=e.getService("loading"),n=(e.getService("v5"),e.getService("nav-state"),".collaborators");i.set(!0),$(".tabular_nav a").removeClass("current"),$(".tabular_nav "+n).addClass("current")}function u(e){var t,i,n;return t="/index.php?rm=box_collaborators_get_data",i={page:e.page,sort:e.sort,sort_direction:e.sortDirection,search:e.searchString,collab_tab:1,ajax:!0},n=e.preloadedResults?$.Deferred().resolve(e.preloadedResults).promise():$.getJSON(t,$.box.formatQuery(i))}function p(t,i){var n=(e.getService("v5"),e.getService("nav-state"),t.gcmUserId),o=t.id,a=t.galleryId,r=t.page,s=t.searchString,l=t.searchFilters,c=t.policyId,_=!1;return i.reload_current_page_if_gcm&&(i.track_event=s?"search_item_click":"middle_pane_click",_=o>0?!1:n>0?!1:!0),i=$.extend({folder_id:o,file_id:a,page_num:r,user_id:n,search:s,filter_list:l,policy_id:c,no_load_folder_tree:_,no_loading:!1},i)}function h(t,i){var n,o=e.getService("v5"),a=e.getService("loading"),r=e.getService("search"),s=o.get("box"),l=o.get("Canvas"),c=o.get("theme_id"),_=!!i,d=e.getService("nav-state"),u=e.getService("scroll");_?s.load({}):(a.set(!0),u.scrollToTop(),s.hide_user_folder_tree(),$(".body").removeClass("view-gcm view-quarantine").addClass("view-gcm-search")),n={runmode:"box_master_content_folder_list",query:t.searchString,page_num:t.page,page_size:l.page_size,theme_id:c,sort:t.sort,direction:t.sortDirection,filters:d.getSearchFiltersFromString(t.searchFilters),view:"search",callback:$.proxy(s,"after_search_callback"),preloadedResults:i||null},r.execute(n)}function m(t){var i={search:t.search,filter_list:t.filter_list,user_id:t.user_id,page_num:t.page_num,track_event:t.track_event},n=e.getService("nav-state");return i.view=n.isGcmQuarantine()?"quarantine":n.isGcmSearch()?"search":"item",i.folder_id=t.folder_id||"0",i.user_id=t.user_id||"0",i.policy_id=t.policy_id||"0",t.after_id&&(i.after_id=t.after_id),t.before_id&&(i.before_id=t.before_id),$.box.formatQuery(i)}function f(t,i){var n,o,a,r=e.getService("v5"),s=r.get("box"),l=p(t,i),c=i.preloadedResults,_=$.Deferred(),d=e.getService("nav-state");return c?(delete c.html,delete c.path_html,n=_.resolve(c).promise()):(e.broadcast("x-folderchangebefore"),$(".body").removeClass("view-gcm view-gcm-search view-quarantine"),d.isGcmQuarantine()?($(".body").addClass("view-quarantine"),o="/index.php?rm=box_master_quarantine_json"):($(".body").addClass("view-gcm"),o="/index.php?rm=box_master_content_folder_list"),$("#search").val("").trigger("change"),s.show_user_folder_tree(),a=m(l),n=$.getJSON(o,a)),n}function g(t){var i=e.getService("url"),n=i.getQueryParams(t);return n.sidebar}function v(t,i){var n,o,a=e.getService("v5"),r=a.get("box"),s=a.get("Canvas"),l=r.hist_name;switch(l){case"files":o=_(t,i);break;case"collab":o=u({page:t.page,sort:t.sort,sortDirection:t.sortDirection,searchString:t.searchString,preloadedResults:i.preloadedResults});break;case"shared_folder":n=e.getService("shared-items"),o=n.getItemsList({folderTypedId:"d_"+t.id,sharedName:a.get("shared_name"),page:t.page>0?t.page:1,page_size:s.page_size,sort:t.sort,sortDirection:t.sortDirection,view:"icon"==s.view?"icon":"expanded",preloadedResults:i.preloadedResults});break;case"gcm":o=f(t,i);break;default:o=$.Deferred().promise()}return o}function b(t,i){var n=e.getService("v5"),o=n.get("box"),a=o.hist_name;switch(a){case"files":c(t,i);break;case"gcm":h(t,i)}}function w(t){var i=e.getService("v5"),n=i.get("box"),o=n.hist_name,a=(new Date).getTime(),r=e.getService("scroll");return j=a,function(e){t||r.scrollToTop(),"files"===o?l(e,a):n.load(e)}}function y(t){var i=e.getService("v5"),n=i.get("box"),o=n.hist_name;switch(o){case"files":s(),e.broadcast("x-folderchangebefore");break;case"collab":d(t)}}function x(t){t=t||{};var i,n,o=e.getService("v5"),a=e.getService("url"),r=o.get("box"),s=r.hist_name,l=o.get("path_prefix")?"/"+o.get("path_prefix"):"/",c=o.get("shared_name"),_=o.get("vanity_name"),d=o.get("start_item"),u=t?t.before_id:null,p=t?t.after_id:null,h=e.getService("nav-url"),m=e.getService("nav-state");if("files"===s){var f=m.getTypeSpecificId(t.type);if(t.isGallery)if(n=l+"files/"+t.page,"s"===t.type){var g=a.encodePathComponent(t.searchString),v={};t.mdfilters&&(v.mdfilters=t.mdfilters),n=a.createUrl(n+"/s/"+g+"/1/"+t.galleryId,v)}else"t"===t.type?(i=a.encodePathComponent(t.tags),n+="/t/"+i+"/1/"+t.galleryId):n+="/"+t.type+"/"+t.id+"/1/"+t.galleryId;else if(m.isSearch())n=h.getSearchUrl(t.searchString,t.page,t.searchFilters,t.mdfilters);else if(n=l+"files/"+t.page+"/"+t.type+"/"+a.encodePathComponent(f),t.folderName){var b=t.folderName.replace(/([\s\:\/#])+/g,"_");try{b=decodeURIComponent(b)}catch(w){b=b.replace(/%/g,"_")}n+="/"+a.encodePathComponent(b)}}else if("shared_folder"===s){if(n=c&&!_?10===c.length?l+"shared/"+c:l+"s/"+c:l+_,(t.isGallery||t.id!=d.substr(2)||1!=t.page)&&(n+="/"+t.page+"/"+t.id),t.isGallery){var y=t.galleryId,x=0===y.indexOf("f_")?y.substr(2):y;n+="/"+x+"/1"}}else"collab"===s?(n="/contacts",t.searchString&&(n+="/search"),t.page&&(n+="/"+t.page),t.searchString&&(n=h.getSearchUrlForCollaboratorsPage(t.searchString,t.page))):"gcm"===s&&(n=m.isGcmQuarantine()?h.getGcmUrlForQuarantine(t.page,t.policyId,t.gcmUserId,u,p):m.isGcmQuarantinePreview()?h.getGcmUrlForQuarantinePreview(t.fileVersionId):m.isGcmSearch()?t.isGallery?h.getGcmUrlForSearchPreview(t.searchString,t.page,t.galleryId.substr(2)):h.getGcmUrlForSearch(t.searchString,t.page,t.searchFilters):t.isGallery?h.getGcmUrlForPreview(t.gcmUserId,t.id,t.page,t.galleryId.substr(2)):h.getGcmUrlForFiles(t.gcmUserId,t.id,t.page));k(n)}function S(){var t=e.getService("v5"),i=t.get("window");return i.location.protocol+"//"+i.location.hostname}function k(e){{var t=S();History.getState().cleanUrl.substr(t.length)}A||(C[e]=!0,History.pushState(null,document.title,e))}var T,j,C={},A=!1,E="",B={collab:[{name:"collaboratorsWithPage",pattern:new RegExp("/contacts/(\\d+)$")},{name:"collaboratorsRoot",pattern:new RegExp("/contacts(/collaborators)?$")},{name:"searchWithPage",pattern:new RegExp("/contacts/search/(\\d+)")},{name:"search",pattern:new RegExp("/contacts/search")}],files:[{name:"favorites",pattern:new RegExp("/files/(\\d+)/favorites$")},{name:"filesPreview",pattern:new RegExp("/files(?:/email/[^/]+)?/(\\d+)/f/(\\d+)/1/(\\w+)")},{name:"folder",pattern:new RegExp("/files(?:/email/[^/]+)?/(\\d+)/f/(\\d+)(?:/([^/]+))?")},{name:"search",pattern:new RegExp("/files/search/([^/]+)/(\\d+)(?:/([^/^\\?]+))?")},{name:"searchPreview",pattern:new RegExp("/files/(\\d+)/s/([^/]+)/1/(\\w+)")},{name:"tagPreview",pattern:new RegExp("/files/(\\d+)/t/([^/]+)/1/(\\w+)")},{name:"tag",pattern:new RegExp("/files/(\\d+)/t/([^/]+)")},{name:"weblink",pattern:new RegExp("/web_links/\\d+")},{name:"rootFolder",pattern:new RegExp("/files$")}],gcm:[{name:"gcmLanding",pattern:new RegExp("/master/content(/0){0,2}$")},{name:"gcmPreviewer",pattern:new RegExp("/master/content/(\\d+)/(\\d+)/(\\d+)/(\\d+)")},{name:"gcmFiles",pattern:new RegExp("/master/content/(\\d+)/(\\d+)/(\\d+)")},{name:"gcmSearchFile",pattern:new RegExp("/master/content/search/([^/]+)/(\\d+)/(\\d+)$")},{name:"gcmSearch",pattern:new RegExp("/master/content/search/([^/]+)/(\\d+)(?:/([^/]+))?")},{name:"gcmQuarantine",pattern:new RegExp("/master/content/quarantine/(\\d+)")},{name:"gcmQuarantinePreview",pattern:new RegExp("/master/content/quarantine/preview/(\\w+)")},{name:"weblink",pattern:new RegExp("/web_links/\\d+")}],shared_folder:[{name:"weblink",pattern:new RegExp("/web_links/\\d+")},{name:"sharedSingleItem",pattern:new RegExp("/s(?:hared)?/(\\w+)/(\\d+)/(\\d+)/(\\d+)/(1)?")},{name:"sharedFolderView",pattern:new RegExp("/s(?:hared)?/(\\w+)/(\\d+)/(\\d+)")},{name:"sharedRoot",pattern:new RegExp("/s(?:hared)?/(\\w+)")},{name:"vanitySingleItem",pattern:new RegExp("^/([^/]+)/(\\d+)/(\\d+)/(\\d+)/(1)?")},{name:"vanityFolderView",pattern:new RegExp("^/([^/]+)/(\\d+)/(\\d+)")},{name:"vanityRoot",pattern:new RegExp("^/([^/]+)")}]},I={navigate:function(t,n,s){var l,c,_,d=e.getService("v5"),u=d.get("box"),p=e.getService("loading"),h=e.getService("notifications"),m=e.getService("url"),f=(d.get("Features"),d.get("Item")),S=e.getService("nav-state"),k=d.get("Canvas"),j=!1,C=!1,$=!1,A=g(t);if(s=s||{},j=!!s.preloadedResults,(!u||!u.hist_name)&&t)return void m.goToUrl(t);T=s.callback||u.after_load_callback,u.after_load_callback=null,"gcm"!==u.hist_name||s.no_load_folder_tree||S.isPreviewOpen()||u.load_folder_tree();var E,B=S.get();if(t){if(E=i(t),j?C=!0:E&&(C=E.id||B.id?E.id==B.id:!0),!E)return void m.goToUrl(t);if(E.redirect)return void m.goToUrl(E.redirect);E.wasGallery=B.isGallery,(E.isGallery||B.isGallery)&&(E.sort=B.sort,E.sortDirection=B.sortDirection),E.lastNonGalleryUrl=E.isGallery?B.lastNonGalleryUrl||null:t,S.setNav(E)}else S.setPrevious(),E=S.get(),E.isGallery&&E.wasGallery&&(C=!0);(S.isMovingIntoSearch()||S.isMovingOutOfSearch())&&(S.resetSort(),E.sort=null,E.sortDirection=null),c=f.find(E.galleryId),k&&(k.target_item=c),_=w(s.not_scroll),$="1"===m.getQueryParams(t).single,S.setSingleFilePreview($);var I=E.isGallery&&c&&C||S.isGcmQuarantinePreview()||$;s.switchUnderlyingPage&&(I=!1),S.isMovingOutOfPreview()&&!s.reload_page_after_preview?e.broadcast("previewaction",{action:"close"}):!S.isSearch()&&!S.isGcmSearch()||E.isGallery?I?(s.preloadedResults&&(e.broadcast("x-folderchangebefore"),_(s.preloadedResults)),S.isGcmQuarantinePreview()?r(E.fileVersionId,B.searchFilters,A):$&&E.galleryId?(c||p.set(!0),a(E.galleryId,A)):o(c,B.searchFilters,A),T&&(T({}),T=null)):(E.wasGallery&&e.broadcast("previewaction",{action:"close"}),h.hide(),p.set(!0),y(E),l=v(E,s),l.done(_).done(T),E.isGallery&&l.done(function(e){var t=f.find(E.galleryId);t&&o(t,B.searchFilters,A)})):b(E,s.preloadedResults),T=null,s.preloadedResults||x(E)}};return History.Adapter.bind(window,"statechange",function(){var e=S(),t=History.getState(),i=t.cleanUrl.substr(e.length);return"undefined"!=typeof C[i]&&C[i]?void delete C[i]:(A=!0,I.navigate(i||t.url,{},{no_load_folder_tree:!0}),E=i,void(A=!1))}),I}),Box.Application.navigate=function(){"use strict";var e=Box.Application.getService("navigation");e.navigate.apply(e,arguments)},Box.Timing.execution.push({name:"js/services/notifications.js",time:(new Date).getTime()}),Box.Application.addService("notifications",function(e){"use strict";function t(e){if(m&&!e){var t=$(m);if(t[0])return t}return h||(h=document.getElementById(b)),h}function i(e){e.preventDefault(),E&&E.clickHandler&&E.clickHandler()}function n(e){e.preventDefault(),s()}function o(e){var o=$(t(e));o.delegate(y,"click",i),o.delegate(x,"click",n)}function a(e){var i=$(t(e));i.undelegate(y,"click"),i.undelegate(x,"click")}function r(){var i=$(t()),n=e.hasService("nav-state")?e.getService("nav-state"):null,r="undefined"!=typeof $.fn.stalker&&n&&!n.isEmbedWidget();P=e.getService("dom"),B=e.getService("v5").get("Box_Confirmation_Message"),o(!0),r&&i.stalker({offset:k,stopCallback:function(){a(!0),h=null,o(!0)}}),A=!0}function s(e){var i,n;A||r(),B&&B.hide(F),e&&E&&e!==E.notificationId||(E&&E.timeoutId&&window.clearTimeout(E.timeoutId),i=$(t()),m&&(a(),m=null),n=i.find(w),P.removeClass(n,T,function(){n.remove()}),E&&E.hideHandler&&(E.hideHandler(),E.hideHandler=null),E=null)}function l(){return{type:E.type,title:E.title,description:E.description,descriptionClass:E.description?"":"hidden",actionClass:E.hasAction?"":"hidden",actionText:E.actionText}}function c(e,t,i,n){E={type:e,title:i,description:n?n.description:"",hasAction:n&&n.action,actionText:n&&n.action?n.action.text:"",clickHandler:n&&n.action?n.action.onclick:null,hideHandler:n?n.onhide:null,notificationId:t,timeoutId:null}}function _(){return I++}function d(e){E.timeoutId=window.setTimeout(function(){s(e)},j)}function u(){return E.type===f&&!E.hasAction}function p(i,n,a){var p,h,f,g,v,b=e.hasService("nav-state")?e.getService("nav-state"):null,w=e.hasService("fullscreen")?e.getService("fullscreen"):null;A||r(),s(),m=a&&a.containerNode?a.containerNode:b&&b.isPreviewOpen()&&w&&!w.isFullScreen()?C:null,g=_(),c(i,g,n,a),p=e.getService("templates"),h=p.getTemplateFragment("notification",l()),f=$(t()),f.prepend(h),v=f.find(S),window.setTimeout(function(){P.addClass(v,T)},0),u()&&d(g),m&&o()}var h,m,f="confirm",g="warn",v="error",b="top_notification",w=".notification_container",y=".notification_action",x=".notification_close",S=w+":first-child",k=93,T="is-open",j=5e3,C=".preview-notification",A=!1,E=null,B=null,I=0,P=null,F=!0;return{confirm:function(e,t){p(f,e,t)},warn:function(e,t){p(g,e,t)},error:function(e,t){p(v,e,t)},hide:function(){s()},destroy:function(){this.hide(),a()},displayServerNotification:function(){var e,i,n,o;if(A||r(),e=t(),i=P.query(".pre_rendered",e)){n=_();var a;switch(i.getAttribute("data-type")){case"warn":a=g;break;case"error":a=v;break;default:a=f}c(a,n),o=P.query(w,e),P.addClass(o,T),u()&&d(n)}}}}),Box.Timing.execution.push({name:"js/services/openbox-service-actions.js",time:(new Date).getTime()}),Box.Application.addService("openbox-service-actions",function(e){"use strict";var t=e.getService("v5"),i=t.get("OpenboxAction");return{init:function(){var n=t.get("Canvas");n.logged_in&&(i.load(e.getGlobalConfig("vitalOpenboxActions")),this.getActionsFromServer())},getActionsFromServer:function(){var n=e.getService("ajax"),o=e.getService("dom");n.get("get_openbox_service_actions",{}).then(function(e){var n=t.get("Create_Item_Menu"),a=t.get("Box_Menus"),r=o.createFragmentFromHtml(e.data.create_item_menu_html),s=document.getElementById("create_item_button").parentNode;s.appendChild(r),a.create_item_menu=new n,a.map_menu_id_to_menu_object.dd_menu_create_item=a.create_item_menu,i.load(e.data.openbox_actions)})},loadOpenboxActionOnItemAndExecute:function(t,n){n=n||{};for(var o=this.getActions(t,{type:"openbox"}),a=null,r=this,s=null,l=0,c=o.length;c>l;l++)if(s=o[l],s.name===n.action_name){a=s;break}if(null!==a)a.execute(n);else{var _="/index.php?rm=box_add_service",d={uniq_name:n.uniq_name,return_actions:!0},u=$.box.formatQuery(d);$.postJSON(_,u,function(t){if("success"!==t.result)e.getService("popups").alert($t("This action could not be performed because you do not have permission to use Openbox.","js_services_js_popup_error_no_permission_to_post"));else{var o=t.actions;i.incrementalLoad(o),a=r.createAction("openbox_service"+o[0].id),a.execute(n)}})}},getDefaultOpenboxAction:function(e,t){for(var i=this.getActions(e,{executed_by_default:!0,type:"openbox",options:t}),n=null,o=0,a=i.length;a>o;o++)if(n=i[o],n.can_execute())return n;return null},createAction:function(e,i,n,o){var a=t.get("ItemAction"),r=new a({id:i,item:e,options:n,sync:o});return r},getActions:function(e,n){n=n||{};var o=n.type||"all",a=[],r=this,s=t.get("Item"),l=[];if(!e){if(!s)return l;if(e=s.find(n.itemTypedId),!e)return l}("all"===o||"default"===o)&&(a=a.concat(s.actions)),("all"===o||"openbox"===o)&&(a=a.concat(i.actions));for(var c=0,_=a.length;_>c;c++){var d=a[c],u=null;u="object"==typeof d?r.createAction(e,d.id,n.options,d.sync):r.createAction(e,d,n.options),(!n.executed_by_default||u.executed_by_default)&&l.push(u)}return l}}}),Box.Timing.execution.push({name:"js/services/overlay.js",time:(new Date).getTime()}),Box.Application.addService("overlay",function(e){"use strict";function t(t){var i=e.getService("dom"),n=document.createElement("div");return i.addClass(n,"overlay"),i.addClass(n,"hidden"),i.addClass(n,t),document.body.appendChild(n),n}function i(e,i){if("string"==typeof e)throw new Error("HTML strings not allowed for Overlays - use an HTMLElement or DocumentFragment instead.");this.element=e,this.initialized=!1,this.overlay=t(i.className)}var n=null;return i.prototype={_open:function(t,i,o,a){var r=e.getService("dom");o=o||0,a=a||0,n&&n.close(),n=this,this.initialized?e.startAll(this.overlay):(this.initialized=!0,r.setHTML(this.overlay,this.element));var s={of:t,collision:"none"};"below"===i?(s.my="center top",s.at="center+"+o+" bottom+"+a):"left"===i&&(s.my="right center",s.at="left+"+o+" center+"+a),r.removeClass(this.overlay,"hidden"),$(this.overlay).position(s),this.positionParams=$.extend({},s)},openBelow:function(e,t,i){this._open(e,"below",t,i)},openToLeft:function(e,t,i){this._open(e,"left",t,i)},freezePosition:function(e){this.overlay.style.position="fixed",this.overlay.style.top=e+"px"},unfreezePosition:function(){this.overlay.style.position="absolute",$(this.overlay).position(this.positionParams)},focusFirst:function(e){$(this.overlay).find(e).first().focus()},isOpen:function(){var t=e.getService("dom");return!t.hasClass(this.overlay,"hidden")},close:function(){if(n==this&&(n=null),this.isOpen()){var t=e.getService("dom");e.stopAll(this.overlay),t.addClass(this.overlay,"hidden")}},destroy:function(){n==this&&(n=null),this.overlay.parentNode.removeChild(this.overlay)}},{create:function(e,t){return new i(e,t||{})},close:function(){n&&n.close()}}}),Box.Timing.execution.push({name:"js/services/popups.js",time:(new Date).getTime()}),Box.Application.addService("popups",function(e){"use strict";function t(){x=document.getElementById("popup-container"),S=document.getElementById("popup-overlay")}function i(){P.isBlocking=!0}function n(){var e=$(x).find(".popup-title h2");return!!e.text().length}function o(){$(x).find(".popup-title").hide()}function a(t){var i=e.getService("dom");i.setHTML(x,t),n()||o()}function r(){var t=e.getService("dom");t.setHTML(x,"")}function s(){$(x).find("input, textarea, button, select").not(".popup-close-btn").first().focus()}function l(){$(x).find("input, textarea, button, select").not(".popup-close-btn").last().focus()}function c(){var e=$(x),t=$(document).width(),i=e.width(),n=(t-i)/2,o=($(window).height()-e.height())/2;5>o?o=5:o>150&&(o=150);var a=window.pageYOffset||document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop;o+=a,e.css({top:o,left:n})}function _(){$(x.parentElement).off("keyup.popup"),$(x).off("click.popup"),$(S).off("click.popup")}function d(){x.style.display="block",S.style.display="block";var t=e.getService("dom");t.addClass(document.body,E),c(),s()}function u(){x.style.display="none",S.style.display="none";var t=e.getService("dom");t.removeClass(document.body,E),r(),"function"==typeof P.onclose&&(P.onclose(),P.onclose=null),_()}function p(){$(x).addClass(B)}function h(){$(x).removeClass(B)}function m(){$(x).on("click.popup",'[data-type="confirm-btn"]',function(){"function"==typeof P.onconfirm&&P.onconfirm(),P.isBlocking?p():u()})}function f(){$(x).on("click.popup",'[data-type="cancel-btn"]',function(){"function"==typeof P.oncancel&&P.oncancel(),u()})}function g(){$(x).on("click.popup",'[data-type="close-btn"]',u),$(S).on("click.popup",u)}function v(){$(x.parentElement).on("keyup.popup",function(e){27==e.keyCode&&(u(),e.stopPropagation(),e.preventDefault())})}function b(){var e=$(x).find(".popup-accessibility-top-helper"),t=$(x).find(".popup-accessibility-bottom-helper");e.off("focusin.popup").on("focusin.popup",l),t.off("focusin.popup").on("focusin.popup",s)}function w(){x||t(),r(),h(),_(),u(),$.popup&&"function"==typeof $.popup.close&&$.popup.close(),$("body").trigger("popup.open"),P={}}function y(t){var i=e.getService("nav-state");return i.isGcm()&&$.inArray(t,I)>-1?A+"_"+t:C+"_"+t}var x,S,k=$t("Okay","js_popup_button_okay"),T=$t("Cancel","js_popup_button_cancel"),j=$t("An error has occurred while loading this feature","js_popup_failure_message"),C="box_popup",A="box_popup_gcm",E="is-showing-popup",B="is-blocked",I=["quarantined_file","collaborate","show_share_properties_for_item","show_multi_items_share","show_collabs_by_folder","show_collab_details_popup","mail_all_collaborators"],P={};return{alert:function(t,i){var n,o=e.getService("templates");i=i||{},w(),n=o.getTemplateFragment("popup-alert",{title:i.title,message:t}),a(n),P.onclose=i.onclose,b(),g(),v(),d()},confirm:function(t,n){var o,r=e.getService("templates");if(n=n||{},!n.onconfirm&&!n.oncancel)throw new Error("No action specified for confirm dialog");w(),o=r.getTemplateFragment("popup-confirm",{title:n.title,message:t,confirmText:n.confirmText||k,cancelText:n.cancelText||T}),a(o),P.onconfirm=n.onconfirm,P.oncancel=n.oncancel,P.onclose=n.onclose,n.isBlocking&&i(),b(),m(),f(),d()},open:function(t,i){var n,o,r=e.getService("ajax");i=i||{},n=i.data||{},o=y(t),w(),r.get(o,n,{success:function(e){a(e.data.html),P.onclose=i.onclose,b(),g(),v(),d()},error:function(e){this.alert(e.data||j)},context:this})},close:function(){t(),u()},block:function(){t(),p()},unblock:function(){h()},wait:function(t){var i,n=e.getService("templates");w(),i=n.getTemplateFragment("popup-wait",{message:t}),a(i),b(),d(),this.block()},isPopupShowing:function(){var t=e.getService("dom");return!!t.query("."+E)}}}),Box.Timing.execution.push({name:"js/services/postload.js",time:(new Date).getTime()}),Box.Application.addService("postload",function(e){"use strict";function t(){o||e.getService("resin")}var i,n=e.getService("promises"),o=!1,a=n.create(function(n){
i=setInterval(function(){e.hasService("postload-done")&&(clearInterval(i),n(),t(),o=!0)},100)});return{getCompletionPromise:function(){return o||e.hasService("postload-done")?(t(),o=!0,clearInterval(i),n.createResolved()):a}}}),Box.Timing.execution.push({name:"js/services/resin.js",time:(new Date).getTime()}),Box.Application.addService("resin",function(e){"use strict";function t(){if(o=e.getService("browser"),!r&&(!o.isIE()||o.isMinBrowser("explorer","10"))){var t=e.getGlobalConfig("showResinTagTracker");i=e.getGlobal("Resin"),a=e.getService("logger"),t?(n=e.getService("resin-tag-tracker"),n.trackTags()):i.start(function(e){var t=e.data.client;delete e.data.client,a.sendBatchLog("resin",t,e.data)},{events:{click:"mouseup",keypress:"keydown"}}),r=!0}}var i,n,o,a,r=!1,s={recordAction:function(e){r&&i&&(e.client="web",i.recordAction(e))},getSessionId:function(){return sessionStorage.getItem("resin-session-id")}};return t(),s}),Box.Timing.execution.push({name:"js/services/resin-tag-tracker.js",time:(new Date).getTime()}),Box.Application.addService("resin-tag-tracker",function(e){"use strict";function t(e){return null===e.offsetParent}function i(e){var t=e.split("").reduce(function(e,t){return("string"==typeof e?e.charCodeAt(0):e)+t.charCodeAt(0)})%h.length;return h[t]}function n(e){if(!t(e)){var n=u.show(e,{tooltipText:"x",tooltipPosition:"bottom"});n&&(n.style.cursor="pointer",d.query(".tooltip-inner",n).style.backgroundColor=i(e.getAttribute("data-resin-target")),d.on(n,"contextmenu",function(t){t.preventDefault(),u.hide(e)}),d.on(n,"click",function(t){t.preventDefault();var i=new CustomEvent("tagtracker",{bubbles:!0});e.dispatchEvent(i)}))}}function o(e){var t=e.keyCode||e.which;114===t&&(e.preventDefault(),e.stopPropagation(),r())}function a(){var e=p.createTemplateFragment(m);c.body.appendChild(e),s=d.query(".tag-tracker-events",c.body),d.on(c.body,"keypress",o),_.start(function(e){var t=$.extend(e.data,{color:i(e.data.target)}),n=p.createTemplateFragment(f,t);s.insertBefore(n,s.firstChild)},{events:{click:"tagtracker"}}),g=!0}function r(){g||a(),u.hideAll(),l=d.queryAll("[data-resin-target]",c),[].forEach.call(l,n)}var s,l,c=e.getGlobal("document"),_=e.getGlobal("Resin"),d=e.getService("dom"),u=e.getService("tooltips-amsterdam"),p=e.getService("templates"),h=["#26C281","#22A7F0","#DF6CE2","#FFDA04","#0EA5F3","#F03354"],m='<div class="tag-tracker-hud"><ul class="tag-tracker-events"><li>Press \'r\' to refresh tags</li><li>Left click a tag to trigger the event</li><li>Right click a tag to hide it</li></ul></div>',f='<li style="color: <%= color %>"><div>Application: <%= application %></div><div>Page: <%= page %></div><div>Component: <%= component %></div><div>Feature: <%= feature %></div><div>Target: <%= target %></div></li>',g=!1;return{trackTags:r,destroy:function(){g&&(d.off(c.body,"keypress",o),_.stop())}}}),Box.Timing.execution.push({name:"js/services/strings.js",time:(new Date).getTime()}),Box.Application.addService("strings",function(e){"use strict";function t(e){var t=$("<div />").css({display:"block",left:0,position:"absolute",top:0,visibility:"hidden",whiteSpace:"nowrap"}).appendTo("body");if(e){var i=$(e);t.css({fontFamily:i.css("font-family"),fontSize:i.css("font-size"),fontWeight:i.css("font-weight")})}return t[0]}function i(e,t,i){return"undefined"!=typeof i.innerText?i.innerText=e:i.textContent=e,i.offsetWidth<=t}function n(e,t,n){for(var o=e.length,a=0,r=o,s=o,l=e;r-a>1;)i(l,t,n)?a=s:r=s,s=Math.floor((a+r)/2),a!==o&&(l=e.substr(0,s)+"...");return l}function o(e,t){for(var i,n,o="",a=0;a<e.length;a++){if("a"===e[a]){o+="(?!/?"+e[a]+"[^>]*>)";var r=new RegExp('<a\\s[^>]*(href="[^"]*")[^>]*>',"g");t=t.replace(r,'<a $1 target="_blank">'),r=new RegExp("<a\\s[^h][^>]*>","g"),t=t.replace(r,"&lt;a>")}else o+="(?!/?"+e[a]+">)",n=new RegExp("<"+e[a]+"\\s[^>]*>","g"),t=t.replace(n,"<"+e[a]+">");n=new RegExp("</"+e[a]+"\\s[^>]*>"),t=t.replace(n,"</"+e[a]+">")}try{i=new RegExp("<"+o,"gi")}catch(s){return $.log(s),""}return t=t.replace(i,"&lt;").replace(new RegExp("\n","g"),"<br>").replace(new RegExp("\r","g"),"<br>")}var a=/\b(ht|f)tps?:\/\/[\w\._\-]+(:\d+)?(\/[\w\-_\.~\+\/#\?&%=:\[\]@!\$'\(\)\*;,]*)?/gim,r=["B","KB","MB","GB","TB"],s=["b","strong","i","em","u","a","span"];return{getFastShortString:function(e,t){return e&&0!==e.length?e.length<=t?e:e.substring(0,t-3)+"...":""},getShortString:function(e,i,o){if(!e||0===e.length)return e;var a,r;return r=t(o),a=n(e,i,r),$(r).remove(),a},getHyperlinkedString:function(e){return e.replace(a,function(e){return'<a href="'+e+'" target="_blank">'+e+"</a>"})},getHumanReadableSize:function(e,t){var i,n;return"undefined"==typeof t&&(t=1),e=parseInt(e,10),0>=e?"0 "+r[0]:(i=Math.floor(Math.log(e)/Math.log(1024)),i=Math.min(Math.max(i,0),r.length-1),n=e/Math.pow(1024,i),i>0&&(n=n.toFixed(t)),n+" "+r[i])},capitalize:function(e){return(e+"").replace(/^([a-z])|\s+([a-z])|_([a-z])/g,function(e){return e.toUpperCase()})},escapeMarkupTags:function(e){return o(s,e)},removeInvisibleCharacters:function(e){return(e+"").replace(/\u200e/g,"")},trim:function(e){var t=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;return e.replace(t,"")},isEmail:function(e){var t=/^[^\s<>@,]+@[^\s<>@,\/\\]+\.[^\s<>@,]+$/i;return null!==t.exec(e)},getEmail:function(e){var t=/[^\s<>@,]+@[^\s<>@,]+\.[^\s<>@,]+/i,i=t.exec(e);return i?i[0]:""}}}),Box.Timing.execution.push({name:"js/services/scroll.js",time:(new Date).getTime()}),Box.Application.addService("scroll",function(){"use strict";function e(e){return function(){e&&e(),o.length&&o.unshift()()}}function t(t,r){function s(){a.animate({scrollTop:t},{duration:i,complete:e(r)})}n?o.push(s):s()}var i=250,n=!1,o=[],a=$("html, body");return{scrollToTop:function(e){t(0,e)},scrollToPosition:t}}),Box.Timing.execution.push({name:"js/services/tabview.js",time:(new Date).getTime()}),Box.Application.addService("tabview",function(e){"use strict";function t(){c||(c=e.getService("dom"),_=e.getService("aria"))}function i(e){return parseInt(e.getAttribute(g),10)}function n(e,t){e.setAttribute(g,t)}function o(e){var t=c.query(d,e),i=c.query(u,e);return{tabs:t?$(t).children(".btn, .btn-plain").toArray():null,panels:i?$(i).children(p).toArray():null}}function a(e,t,a){var r,s=e.element,l=o(s),d=l.tabs,u=l.panels,p=i(s),m=d[t],f=u[t];isNaN(p)||(r=d[p],c.removeClass([d[p],u[p]],h),_.hide(u[p])),c.addClass([m,f],h),_.show(u[t]),a||m.focus(),n(s,t),e.fire("tabchange",{tab:f.getAttribute("data-tab-name"),isInit:a})}function r(e){var t=e.element,i=o(t),n=i.tabs,r=i.panels,s=-1;_.setRole(n[0].parentNode,"tablist");for(var l=0,d=n.length;d>l;l++){var u=n[l],p=r[l],g=u.id,v=c.hasClass(u,h);g||(u.id=m+b++,g=u.id),v&&(s=l),u.setAttribute(f,l),_.setRole(u,"tab"),u.removeAttribute("href"),_.setRole(p,"tabpanel"),p.setAttribute("aria-labelledby",g)}a(e,s,!0)}function s(e){var t,i=e.target;c.getNearest(i,d)&&(e.preventDefault(),t=c.getNearest(i,v),t&&!c.hasClass(t,"is-disabled")&&a(this,parseInt(t.getAttribute(f),10),!1))}function l(e){this.element=e,$.extend(this,new Box.EventTarget)}var c,_,d=".box-ui-tabs",u=".box-ui-tabpanels",p=".box-ui-tabpanel",h="is-selected",m="box-ui-tab-id-",f="data-box-ui-index",g="data-box-ui-selected-index",v="["+f+"]",b=0;return l.prototype.init=function(){r(this),$(this.element).on("click.tabview",$.proxy(s,this))},l.prototype.destroy=function(){$(this.element).off(".tabview")},l.prototype.nextTab=function(){var e=o(),t=i(this.element);t<e.tabs.length-1&&a(this,t+1,!1)},l.prototype.previousTab=function(){var e=i(this.element);e>0&&a(this,e-1,!1)},l.prototype.goToTab=function(e){var t=c.query('[data-tab-btn-name="'+e+'"]',this.element);if(t){var n=parseInt(t.getAttribute(f),10);n!==i(this.element)&&a(this,n,!1)}},{create:function(e){return t(),new l(e)}}}),Box.Timing.execution.push({name:"js/services/templates.js",time:(new Date).getTime()}),Box.Application.addService("templates",function(e){"use strict";function t(e){return e.replace(n,function(e){return o[e]})}function i(e,i){return i?e.replace(/<%=\s*(\w+)\s*%>/g,function(e,n){var o=i[n]||"";return o?t(o):""}):e}var n=/[<>"&'\/`]/g,o={"<":"&lt;",">":"&gt;",'"':"&quot;","&":"&amp;","'":"&#x27;","/":"&#x2f;","`":"&#x60;"},a=document;return{escapeHTML:t,getTemplateHTML:function(e,t){var n=a.getElementById("jst-"+e),o="";if(n){if(o=n.text.replace(/^\s+|\s+$/g,""))return i(o,t);throw new Error('Template "'+e+'" is an empty string.')}throw new Error('Template "'+e+'" not found.')},createTemplateFragment:function(t,n){if("string"!=typeof t)throw new TypeError("Template text must be a string.");var o=e.getService("dom"),a=i(t,n);return o.createFragmentFromHtml(a)},getTemplateFragment:function(t,i){var n=e.getService("dom"),o=this.getTemplateHTML(t,i);return n.createFragmentFromHtml(o)}}}),Box.Timing.execution.push({name:"js/services/thumbnail.js",time:(new Date).getTime()}),Box.Application.addService("thumbnail",function(e){"use strict";function t(e){var t=e.lastIndexOf(".");return-1===t?"":e.slice(t+1).toLowerCase()}function i(e,t){return"sprite_doc_"+e+"_"+e+"-"+t}var n=$();return{getFileTypeIcon:function(e,n){var o=t(e);return i(n,o)},showThumbnail:function(e,t){var i,o,a,r,s=$(t),l=s.offset();n.length||(n=$('<div id="thumbnail" class="bubble square_bubble"><div class="arrow"></div></div>'),n.appendTo($("body"))),n.css("left","-99999px").show(),i=n.outerWidth(),o=n.outerHeight(),a=l.top-o/4,r=l.left-10-i,1>r||s.hasClass("locked")||s.hasClass("has_task_to_complete")?(r=l.left,a=l.top-10-o,n.find(".arrow").removeClass("arrow").addClass("arrow_down")):n.find(".arrow_down").removeClass("arrow_down").addClass("arrow"),n.css({top:a,left:r,background:"#fff url("+e+") center center no-repeat",display:"block"})},hideThumbnail:function(){n.hide()}}}),Box.Timing.execution.push({name:"js/services/tooltips.js",time:(new Date).getTime()}),Box.Application.addService("tooltips",function(e){"use strict";function t(){clearTimeout(m),m=null}function i(e,i){var n=$("#tooltip");return m?void t():(e?n.fadeOut("fast",function(){$(this).remove()}):n.remove(),i&&i.hide_event_type&&g&&g.unbind(i.hide_event_type),g=null,void(f=null))}function n(e){return e===document.body||!e||e===window}function o(e){return"tooltip"===e.attr("data-hover")||e.attr("data-tooltipid")||e.attr("data-htmltooltip")?!0:!1}function a(t){var i,n="tooltip"===t.attr("data-hover")?t.attr("aria-label"):null;return n?n:(n=t.attr("data-tooltipid"))?(i=e.getService("templates"),n="html:"+i.getTemplateHTML(n)):(n=t.attr("data-htmltooltip"),n?n="html:"+n:void 0)}function r(e){for(;!n(e);){if(o($(e)))return e;e=e.parentNode}return null}function s(n,o){t(),$("#tooltip").remove();var a,r,s=n.indexOf("|"),m=-1!==s,v=e.getService("templates"),b=$(v.getTemplateHTML("tooltip_prototype")),w=b.attr("id","tooltip").hide().appendTo(document.body),y=w.find(".tooltip"),x=w.find(".tooltip-beak"),S=y.find("h4"),k=y.find(".tooltip-content");if(m){var T=n.substring(0,s);0===T.indexOf("html:")&&(T=T.substring(5)),S.text(T).show(),r=n.substr(s+1),a=T.length+r.length}else S.hide(),r=n,a=r.length;0===n.indexOf("html:")?k.html(n.substring(m?s+1:5)):k.text(r),y.addClass(k.find(".tooltip-table").length?_:a>h?c:l);var j=g.outerHeight(),C=g.outerWidth(),A=g.offset();0===A.top&&0===A.left&&o.event&&(A.top=o.event.pageY,A.left=o.event.pageX);var E=$(window),B=parseInt(g.css("padding-top"),10),I=Math.max(5-B,0),P=w.height()+10+I,F=w.css("left","-99999px").appendTo($("body")).outerWidth();w.hasClass(_)&&F>p?F=w.css("width",p+"px").outerWidth():w.hasClass(c)&&F>u?F=w.css("width",u+"px").outerWidth():w.hasClass(l)&&F>d&&(F=w.css("width",d+"px").outerWidth());var D=Math.floor(F/2),M=Math.floor(w.height()/2),O=g.parents().andSelf();if(O.hasClass("dark_background")&&w.addClass("tooltip-light"),O.hasClass("use_sideways_tooltip")){x.css("top",M),A.top-=M;var N=13;A.left-F<E.scrollLeft()?(y.addClass("tooltip-left"),A.left+=C+N):(y.addClass("tooltip-right"),A.left-=F+N)}else x.css("left",D-9),A.left+=C/2,A.left=Math.floor(A.left),A.left-=D,A.left+F>E.width()?(A.left=A.left+g.outerWidth()-D+20,A.left+F>E.width()&&(A.left=E.width()-F-5),x.css({left:F-30+"px"})):A.left<E.scrollLeft()&&(A.left=E.scrollLeft(),x.css({left:E.scrollLeft()+g.offset().left+g.outerWidth()/2-10+"px"})),A.top-P>=E.scrollTop()?(y.addClass("tooltip-top"),A.top-=P):(y.addClass("tooltip-bottom"),A.top+=j);w.css({left:A.left+"px",top:A.top+"px"});var R=function(){f&&setTimeout(function(){i(!0,o)},f)};f=o.duration,w.fadeIn(0,R)}var l="tooltip-small",c="tooltip-medium",_="tooltip-large",d=200,u=350,p=500,h=250,m=null,f=null,g=null;return{triggerTooltips:function(e){if(!e.target.tagName||"object"!=e.target.tagName.toLowerCase()){var t="mouseleave.tooltip",i=$(e.target).closest("button, a").get(0);i&&!$(i).is(":disabled")&&(t+=", click.tooltip"),this.showTooltips({hide_event_type:t,element:e.target,delay:200,event:e})}},showTooltips:function(e){var n=r(e.element);if(!n)return void i(!0,e);if(!g||g.get(0)!=n){var o=$(n),l=a(o);if(l){i(!1),g=o,e.hide_event_type&&g.bind(e.hide_event_type,function(){i(!0,e)});var c=e.delay||0;c?(t(),m=setTimeout(function(){s(l,e)},c)):s(l,e)}}},hideTooltips:function(){f||i(!1)}}}),Box.Timing.execution.push({name:"js/services/tours.js",time:(new Date).getTime()}),Box.Application.addService("tours",function(e){"use strict";function t(){var t=e.getService("dom");return t.query(M)}function i(){var e=t();return e?e.getAttribute("data-module"):null}function n(){var i=e.getService("lollipops"),n=e.getService("backdrops"),o=e.getService("dom");i.erase(),n.erase();var a=o.queryAll(".tour-slide.displayed",t());o.removeClass(a,"displayed")}function o(){var e=t();return parseInt(e.getAttribute(L),10)}function a(t){var n=e.getService("logger");n.sendLog("tours",t,{tour_name:i(),step:o()})}function r(e){return P+e}function s(){return o()>0}function l(){var t=e.getService("dom"),i=t.query(M),n=parseInt(i.getAttribute(q),10);return o()<n-1}function c(){var t=e.getService("dom"),i=t.query(D),n=t.query(O,i),o=t.query(N,i);s()?t.removeClass(n,"hidden"):t.addClass(n,"hidden"),l()?t.removeClass(o,"hidden"):t.addClass(o,"hidden")}function _(e){var i=t();i.setAttribute(L,e)}function d(){var t,i=e.getService("dom"),n=o(),a=i.query('.tour-slide[data-slide-index="'+n+'"]'),r={};r.maskItemSelector=a.getAttribute("data-masked-item-selector"),r.fakeLayerTemplateId=a.getAttribute("data-fake-layer-template-id"),r.fakeLayerAnchorSelector=a.getAttribute("data-fake-layer-anchor-selector");var s=i.queryAll(".lollipop-description",a);if(r.highlightItems=[],s.length>0)for(var l,c=0;c<s.length;++c)l=s[c],t=l.getAttribute("data-size-factor"),r.highlightItems.push({descSelector:l.getAttribute("data-desc-selector"),anchorSelector:l.getAttribute("data-anchor-selector"),highlightMode:l.getAttribute("data-highlight-mode"),textPosition:l.getAttribute("data-text-position"),sizeFactor:t?parseFloat(t):1,drawCircle:"false"!==l.getAttribute("data-circle")});return r}function u(t){var i=e.getService("backdrops");i.mask(t)}function p(t,i){var n=e.getService("backdrops");n.drawFakeLayer(t,i)}function h(){var t=e.getService("dom"),i=o();t.addClass(t.query('.tour-slide[data-slide-index="'+i+'"]'),"displayed")}function m(i){var n=e.getService("dom");return n.query('[data-selector="'+i+'"]',t())}function f(t){for(var i,n,o,a=e.getService("dom"),r=e.getService("lollipops"),s=0;s<t.length;s++)o=t[s],n=a.query(o.anchorSelector),i=m(o.descSelector),n?r.draw(o.anchorSelector,o.highlightMode,i,o.textPosition,o.sizeFactor,o.drawCircle):a.addClass(i,"hidden")}function g(){var t=e.getService("dom"),i=t.query(D);return t.query(R,i)}function v(){var i=e.getService("dom"),n=t(),o=g(),a=n.getAttribute("data-hide-progress"),r=i.queryAll(".tour-slide",n).length;if(!(a||1>=r)){var s=document.createElement("li");i.addClass(s,"progress-indicator mhs");for(var l=0;r>l;l++)o.appendChild(s.cloneNode(!1))}}function b(){var i=e.getService("dom"),n=t(),a=g(),r=n.getAttribute("data-hide-progress"),s=o();if(!r){var l=i.queryAll(".progress-indicator",a);i.removeClass(l,"full"),i.addClass(l[s],"full")}}function w(){var e=d();a("SHOW_SLIDE"),n(),e.maskItemSelector&&u(e.maskItemSelector),e.fakeLayerTemplateId&&p(e.fakeLayerTemplateId,e.fakeLayerAnchorSelector),h(),b(),e.highlightItems&&window.setTimeout(function(){f(e.highlightItems)},0),c()}function y(){var e=o();_(e+1),w()}function x(){var e=o();_(e-1),w()}function S(i,n){var o,a,r=e.getService("dom"),s=document.createElement("div"),l=$(s);document.body.appendChild(s),r.addClass(s,F),r.addClass(s,n+"-tour"),r.setHTML(s,i),l.on("click",O,x),l.on("click",N,y),o=t(),a=r.queryAll(".tour-slide",o).length,_(0),o.setAttribute(q,a),v()}function k(){var t=e.getService("dom"),i=t.query(D);a("STOP_TOUR"),n(),$(i).off("click",O,x),$(i).off("click",N,y),t.setHTML(i,""),i.parentNode.removeChild(i)}function T(e,t){S(e,t),a("START_TOUR"),w()}function j(e){27===e.keyCode&&(a("ESCAPE_KEY_PRESSED"),I.stop())}function C(){$(window).on("keydown.tours",j)}function A(){$(window).off("keydown.tours",j)}function E(){var t=e.getService("backdrops");t.showCurtain(i())}function B(){var t=e.getService("backdrops");t.removeCurtain()}var I,P="box_tour_",F="tour-container",D="."+F,M=D+" [data-module]",O=".previous-button",N=".next-button",R=".tour-progress",L="data-current-slide",q="data-total-slide-count";return I={start:function(t,i){var n=r(t),o=e.getService("ajax");i=i||{},o.get(n,i,{success:function(e){T(e.data.html,t),E(),C()},error:function(e){},context:this})},stop:function(){A(),k(),B()},goToSlide:function(e){_(e),w()},logEvent:a,getCurrentTourName:i}}),Box.Timing.execution.push({name:"js/services/unidb.js",time:(new Date).getTime()}),Box.Application.addService("unidb",function(e){"use strict";function t(e){return"object"===$.type(e)&&"unidb"in e}function i(n){var o=e.getService("v5"),a=o.get("Box_Object");if(t(n))return a.find_or_create(n.unidb);if($.isArray(n)||$.isPlainObject(n)){for(var r in n)n[r]=i(n[r]);return n}return n}return{decode:function(t){if(t){var n=e.getService("v5"),o=n.get("Box_Object"),a=t.db;for(var r in a){var s=i(a[r]);o.find_or_create(s)}var l=i(t.params);return l}},isUniDB:function(e){return"object"===$.type(e)&&"unidb"===e.type},loadTagsFromDocument:function(){var e,t,i=$(".unidb_data");for(e=0,t=i.length;t>e;e++)this.loadTagsFromElement(i[e])},loadTagsFromElement:function(e){var t=$(e);this.decode($.parseJSON(t.text())),t.remove()}}}),Box.Timing.execution.push({name:"js/services/url.js",time:(new Date).getTime()}),Box.Application.addService("url",function(e){"use strict";function t(e){return decodeURIComponent(e.replace(o," "))}function i(){return n.location.pathname&&0===n.location.pathname.indexOf("/master/content")}var n=e.getGlobal("window"),o=/\+/g,a=/([^&=]+)=?([^&]*)/g,r=/\?(.*)/;return{getCurrentWindowUrl:function(){return n.location.hash||n.location.href},getHostDomain:function(){var e=n.location.hostname.split("."),t=e.length;return e[t-2]+"."+e[t-1]},getGcmCompatibleRm:function(e){return i()&&(e="box_master_gcm_"+e),e},getGcmCompatibleRmUrl:function(e){return"/index.php?rm="+this.getGcmCompatibleRm(e)},updateQueryStringParameter:function(e,t,i){var n=new RegExp("([?&])"+t+"=.*?(&|$)","i"),o=-1!==e.indexOf("?")?"&":"?",a=!i&&"number"!=typeof i,r=e.match(n),s=encodeURIComponent(t),l=encodeURIComponent(i);return a&&r?e.replace(n,""):a?e:r?e.replace(n,"$1"+s+"="+l+"$2"):e+o+s+"="+l},createUrl:function(e,t){var i,n;"?"===e[e.length-1]&&(e=e.slice(0,e.length-1));for(n in t)t.hasOwnProperty(n)&&(i=t[n],e=this.updateQueryStringParameter(e,n,i));return e},goToUrl:function(t){var i=e.getGlobal("open_link_in_new_window"),o=e.getGlobal("path_prefix");return t=this.addAdditionalContext(t),i&&t&&o&&t.indexOf(o)<0?void n.open(t):void(n.location.href=t)},goToUrlInBackground:function(t){var i=e.getService("dom"),n=e.getGlobal("document"),o=i.query("#downloadiframe"),a=!1;o||(o=n.createElement("iframe"),a=!0),t=this.addAdditionalContext(t),o.src=t,o.style.display="none",o.setAttribute("id","downloadiframe"),a&&n.body.appendChild(o)},openWindow:function(e,t,i,o){return e?(t=t||"",i=i||"",o=o||!1,e=this.addAdditionalContext(e),n.open(e,t,i,o)):null},addAdditionalContext:function(t){var i=e.getGlobal("additional_context");if(i&&t.indexOf("additional_context")<0){var n="additional_context="+encodeURIComponent(i);t+=(t.indexOf("?")>0?"&":"?")+n}return t},formatLegacyQueryParams:function(e){function t(e){for(var i in e)e.hasOwnProperty(i)&&("object"==typeof e[i]?t(e[i]):"boolean"==typeof e[i]&&(e[i]=e[i]?1:0))}return t(e),{q:e}},encodePathComponent:function(e){return e=encodeURIComponent(e).replace(/%2F/g,"%252F").replace(/%23/g,"%2523").replace(/%26/g,"%2526")},decodePathComponent:function(e){return e=e.replace(/%2526/g,"%26").replace(/%2523/g,"%23").replace(/%252F/g,"%2F"),t(e)},getQueryParams:function(e){var i,n,o=e.match(r),s={};if(o)for(n=o[1];i=a.exec(n);)s[t(i[1])]=t(i[2]);return s},getQueryParamString:function(e){var t=e.match(r);return t?t[1]:""}}}),Box.Timing.execution.push({name:"js/services/v5.js",time:(new Date).getTime()}),Box.Application.addService("v5",function(e){"use strict";return{get:function(t){var i=null;return i=e.getGlobal(t),i&&"function"==typeof i.get&&(i=i.get()),i}}}),Box.Timing.execution.push({name:"js/services/v5popups.js",time:(new Date).getTime()}),Box.Application.addService("v5popups",function(e){"use strict";function t(t,i,n){var o=e.getService("logger");o.sendLog(t,i,n)}function i(e){var t="/index.php?rm=box_load_upgrade_popup";$.ajax({url:t,dataType:"html",success:e})}function n(i,n,o){var r,s,l,c,_={},d=$("#upgrade_"+i);return 0===d.length?null:(r=d.attr("title").split(" : "),_.title=r[0],_.subtitle=r[1],_.html=d.html(),_.favicon="sprite_24x24 "+(a[i]||""),s=o?"/ref/"+o:"/ref/upsell_"+i,-1!==$.inArray(i,["shared_link_download","virtual_user_login"])?(l="virtual_user_login"==i?$t("Upgrade now","popup_action_upgrade_now"):$t("Sign up now","popup_action_sign_up_now"),c={upgrade:{value:l,click:function(){t("marketing","SHARED_DOWNLOAD_CLICK_POPUP_SIGNUP");var i=e.getService("url");i.openWindow(s),$.popup.close(n)}},learn_more:{value:$t("Learn more","js_popup_button_learn_more"),click:function(){t("marketing","SHARED_DOWNLOAD_CLICK_POPUP_LEARN_MORE");var i=e.getService("url");i.openWindow(s+"_learn_more"),$.popup.close(n)}}}):c={tour:{value:$t("Take feature tour","popup_action_take_feature_tour"),click:function(){t("marketing","UPGRADE_POPUP_CLICK_TOUR");var i=e.getService("v5popups");i.showUpgradeTourPopup($("#upgrade_id").val())}},upgrade:{value:$t("Upgrade","popup_action_upgrade"),classes:"btn-primary",click:function(i,n){t("marketing","UPGRADE_POPUP_CLICK_UPGRADE");var o=e.getService("url");o.goToUrl(s),$.popup.revert()}}},_.buttons=c,_)}function o(e){var t="/index.php?rm=box_log_upgrade_popup_view",i={type:e},n=$.box.formatQuery(i);$.postJSON(t,n)}var a={password_protect:"sprite_24x24_master_settings",direct_link:"sprite_24x24_link",version_history:"sprite_24x24_version_history",larger_file:"sprite_24x24_upload",full_text:"sprite_24x24_search",file_lock:"sprite_24x24_master_settings",collab_manage:"sprite_24x24_collab_manage",new_folder_collab_manage:"sprite_24x24_collab_manage",virtual_user_login:"sprite_24x24_upload",security:"sprite_24x24_ssl",apps:"sprite_24x24_master_apps",group_management:" ",bulk_add:" ",bulk_edit:" ",set_due_dates:" "};return{showUpgradePopup:function(e,a,r){var s,l=this,c="";return 0===$("#upgrade_messages").length?void i(function(t){$("body").append(t),l.showUpgradePopup(e,a,r)}):(s=n(e,a,r),void(s&&("shared_link_download"===e?t("marketing","SHARED_DOWNLOAD_VIEW_POPUP"):o(e),$.popup.close(null,!0),-1===$.inArray(e,["virtual_user_login","set_due_dates","shared_link_download"])&&(c=' <span class="badge upgrade txt_t mts">'+$t("UPGRADE","js_upgrade_badge")+"</span>"),$.popup.form(s.title+c,[{type:"html",data:"<h3>"+s.subtitle+"</h3>"+s.html,class_name:"upgrade_popup_main_text background_upgrade_"+e},{type:"buttons",items:s.buttons,wide:!0},{type:"html",data:$(".question_contact_us:first").clone(),class_name:"upgrade_content_question_contact_us"},{type:"hidden",name:"upgrade_id",id:"upgrade_id",value:e}],{favicon_class:s.favicon||""}))))},showUpgradeTourPopup:function(o,a,r){var s=this,l=e.getService("eloqua"),c=[],_=["password_protect","security","full_text","collab_manage","version_history"],d=$.inArray(o,_);if(0===$("#upgrade_messages").length)return void i(function(e){$("body").append(e),s.showUpgradeTourPopup(o,a,r)});l.sendEloquaWith("ToastUpgrade","Toast Upgrade","upgradetour"),-1!==d&&_.splice(d,1);var u,p;for(u in _)if(_.hasOwnProperty(u)){p=_[u];var h,m,f,g="upsell_popup_tour_"+p,v=n(p,a,g);h="",-1===$.inArray(p,["virtual_user_login","set_due_dates","shared_link_download"])&&(h=' <span class="badge upgrade txt_t mts">'+$t("UPGRADE","js_upgrade_badge")+"</span>"),m=0===c.length,delete v.buttons.tour,f={type:"slide",label:v.title+h,height:275,selected:m,id:"slide_"+p,favicon:v.favicon,contents:[{type:"html",data:"<h3>"+v.subtitle+"</h3>"+v.html,class_name:"upgrade_popup_main_text background_upgrade_"+o},{type:"buttons",items:v.buttons,wide:!0},{type:"html",data:$(".question_contact_us:first").clone(),class_name:"upgrade_content_question_contact_us"}]},c.push(f)}$.popup.form("",c,{close_popup_on_click_outside:!1,prev_slide_callback:function(){t("marketing","UPGRADE_TOUR_PREV",{from:$.popup.selected_tab.id})},next_slide_callback:function(){t("marketing","UPGRADE_TOUR_NEXT",{from:$.popup.selected_tab.id})}})},showTooManyFilesUseFolderPopup:function(t){var i,n,o=e.getService("v5").get("Upload_Process");i=$t("Please use the %1Upload Folders%2 option to upload more than %3 files at a time.","js_show_too_many_files__use_chrome_popup_message",'<button class="lnk upload_folder_via_chrome">',"</button>",t),$.popup.alert($t("Error","js_show_too_many_files_popup_title"),i),n=$(".upload_folder_via_chrome"),o.add_trigger({element:n,directory_upload:!0,handle_change:function(e,t){o.handle_change(e,t),$.popup.close()}})},showTooManyFilesUseJavaPopup:function(t){var i,n=e.getService("v5").get("Upload_Process");i=$t("Please use the %1Folder Uploader%2 to upload more than %3 files at a time.","js_show_too_many_files_popup_message",'<button class="lnk bulk_upload_link">',"</button>",t),$.popup.alert($t("Error","js_show_too_many_files_popup_title"),i,{click_handlers:{".bulk_upload_link":function(){return n.popup_upload_java_open(),!1}}})}}}),Box.Timing.execution.push({name:"js/services/window-popup.js",time:(new Date).getTime()}),Box.Application.addService("window-popup",function(e){"use strict";function t(e,t){var i;i=setInterval(function(){try{(null===e||e.closed)&&(clearInterval(i),t())}catch(n){}},n)}function i(e,t){t=t||{},this.url=e,this.options=$.extend(!0,{},o,t)}var n=1e3,o={popupName:"BoxPopup",queryParams:{},width:270,height:320,left:500,top:200,toolbar:0,scrollbars:1,status:0,resizable:1,location:1,menuBar:0};return i.prototype={popup:null,url:null,options:null,closeCallback:null,closeIntervalId:null,_getPopupUrl:function(){return this.url+($.isEmptyObject(this.options.queryParams)?"":"?"+$.box.formatQuery(this.options.queryParams))},_getPopupConfiguration:function(){var t,i=e.getGlobal("screen");return t={width:this.options.width,height:this.options.height,toolbar:this.options.toolbar,scrollbars:this.options.scrollbars,status:this.options.status,resizable:this.options.resizable,location:this.options.location,menuBar:this.options.menuBar,left:i?(i.availWidth-this.options.width)/2:this.options.left,top:i?(i.availHeight-this.options.height)/2:this.options.top},$.param(t).replace(/&/g,",")},setCloseCallback:function(e){this.closeCallback=e},show:function(){var i=e.getService("url"),n=this._getPopupUrl(),o=this._getPopupConfiguration();this.popup&&!this.popup.closed?this.popup.focus():(this.popup=i.openWindow(n,this.options.popupName,o),this.closeCallback&&t(this.popup,this.closeCallback))},hide:function(){this.popup&&this.popup.close()}},{create:function(e,t){return new i(e,t)}}}),Box.Timing.execution.push({name:"js/behaviors/amsterdam/amsterdam-survey.js",time:(new Date).getTime()}),Box.Application.addBehavior("amsterdam-survey",function(e){"use strict";function t(t){var i=e.getGlobal("location");i&&(i.href=t)}function i(){c.removeClass(u,g)}function n(){c.removeClass(d,g)}function o(){n(),c.addClass(u,g)}function a(){i(),c.addClass(d,g)}function r(){var t=c.query(".department-menu",_),i=c.queryAll(".experience-metrics li",_),n=c.query(".feedback-text",_).value,o=t.options[t.selectedIndex].value,a={},r=e.getService("array-utils");return r.forEach(i,function(e){var t=e.getAttribute("data-id"),i='input[name="'+t+'"]:checked',n=c.query(i);a[t]=n.value}),{department:o,"experience-metrics":a,feedback:n}}function s(e){var t=!0;return""===e.feedback.trim()&&(t=!1),t}function l(t){var i=e.getService("resin");i.recordAction({application:"amsterdam",page:"files",component:"guide",target:"survey",action:"click",data:t}),o(),v=!0}var c,_,d,u,p="try-amsterdam",h="leave-amsterdam",m="submit-survey",f="feedback-action",g="is-visible",v=!1;return{init:function(){c=e.getService("dom"),_=e.getElement(),u=c.query(".message-text",_),d=c.query(".warning-text",_)},onclick:function(e,i,n){switch(n){case h:return e.stopPropagation(),void(v?t(i.getAttribute("data-href")):a());case p:return e.stopPropagation(),void t(i.getAttribute("data-href"));case m:e.stopPropagation();var o=r();return void(s(o)?l(o):a())}},onchange:function(e,t,o){switch(o){case f:i(),n()}}}}),Box.Timing.execution.push({name:"js/behaviors/amsterdam/datepicker.js",time:(new Date).getTime()}),Box.Application.addBehavior("datepicker",function(e){"use strict";var t,i;return{init:function(){t=e.getService("datepicker"),i=e.element;for(var n=i.querySelectorAll("input.datepicker"),o=0,a=n.length;a>o;o++)t.create(n[o])}}}),Box.Timing.execution.push({name:"js/behaviors/amsterdam/popup-default-close.js",time:(new Date).getTime()}),Box.Application.addBehavior("popup-default-close",function(e){"use strict";var t;return{init:function(){t=e.getService("popups-amsterdam")},onclick:function(e,t,i){"close-popup"===i&&(this.closePopup(),e.preventDefault(),e.stopPropagation())},closePopup:function(){t.close({unsafeSkipRefresh:!0})}}}),Box.Timing.execution.push({name:"js/behaviors/item.js",time:(new Date).getTime()}),Box.Application.addBehavior("item",function(e){"use strict";function t(e,t){u.target_item=e,e.show_menu({target:t})}function i(e){return $(e).closest(".item, .mini_item")}function n(e){var t=l.get("Item");return t.find(e.closest("[data-typed-id]").attr("data-typed-id"))}function o(e){if(!e||"undefined"!=typeof e.element){var t=c.query(".favorite, .unfavorite",e.element),i=c.query("a",t);c.hasClass(t,"favorite")?(c.removeClass(t,"favorite"),c.addClass(t,"unfavorite"),c.removeClass(i,"sprite_item_list_favorite"),c.addClass(i,"sprite_item_list_unfavorite"),i.setAttribute("data-type","favorite-btn"),i.setAttribute("aria-label",g)):(c.removeClass(t,"unfavorite"),c.addClass(t,"favorite"),c.removeClass(i,"sprite_item_list_unfavorite"),c.addClass(i,"sprite_item_list_favorite"),i.setAttribute("data-type","unfavorite-btn"),i.setAttribute("aria-label",b))}}function a(e){o(e),h.add(e.typed_id,!1,"favorite"+e.type+"itemlist")}function r(e){o(e),h.remove(e.typed_id,!1,"unfavorite"+e.type+"itemlist")}function s(e){if(!e||!e.parentNode)return-1;for(var t=0;t<e.parentNode.children.length;t++)if(e===e.parentNode.children[t])return t;return-1}var l,c,_,d,u,p,h,m,f=$t("There was an error adding your item to favorites.","add_item_to_favorites_error"),g=$t("Add to favorites","add_to_favorites"),v=$t("There was an error removing your item from favorites.","remove_item_from_favorites_error"),b=$t("Remove from favorites","remove_from_favorites");return{messages:["favoritetoggled","favoritesuccess","favoriteerror","unfavoritesuccess","unfavoriteerror"],init:function(){l=e.getService("v5"),c=e.getService("dom"),_=e.getService("ajax"),u=l.get("Canvas"),p=e.getService("nav-state"),h=e.getService("fileop-favorites"),m=e.getService("notifications"),d=e.getService("resin")},onclick:function(o,_,h){
var m,f,g,v=e.getService("logger"),b=e.getService("url"),w=e.getService("navigation"),y=e.getService("popups"),x=e.getService("popups-amsterdam"),S=l.get("box"),k=(l.get("Features"),i(o.target)),T=n(k),j=k.find(".action_list"),C=$(o.target).closest("li.item").index(),A=o.originalEvent&&o.originalEvent.pageX||0,E="";if(T){if(p.isGcm()&&T.is_hidden_external_collab)return o.stopPropagation(),void o.preventDefault();if(p.isSearch()&&-1!=C){g=p.get();var B=(new Date).getTime(),I={result_num:C+1,page_num:g.page,page_size:u.page_size,item_id:T.id,item_type:T.type,search_string:g.searchString,total_results:S.search_total_results_count,sort_type:g.sort,sort_direction:g.sortDirection,created_at:B};p.isFirstResultClick()?(p.setFirstResultClick(!1),v.sendLog("search","SEARCH_FIRST_RESULT_CLICK",I)):v.sendLog("search","SEARCH_RESULT_CLICK",I)}if("description-link"!=h&&"partner-tag-btn"!=h){switch(h){case"version-btn":T.version_history();break;case"context-menu-btn":var P=l.get("Box_Menus").menu;P.visible&&P.item==T?P.hide():t(T,o.target);break;case"select-checkbox":$(_).find("input[type=checkbox]").is(":checked")?T.unselect():T.select();break;case"path-anchor":w.navigate(_.href);break;case"retention-extension":x.open("getExtendRetentionExpirationPopup",{data:{fileId:T.id,itemTypedId:T.typed_id,retainedUntil:_.getAttribute("data-retained-until")}});break;case"stats-btn":T.edit_properties({selected_tab:"stats"});break;case"expiration-unshare-btn":case"expiration-btn":e.getGlobalConfig("showAmsterdamCollabSharing")?x.open("item_share_settings",{data:{itemTypedId:T.typed_id}}):y.open("show_share_properties_for_item",{data:{itemTypedId:T.typed_id,selectedTab:"share",expandExpirationSetting:!0}});break;case"expiration-delete-btn":T.set_expirations();break;case"share-btn":e.getGlobalConfig("showAmsterdamCollabSharing")?x.open("item_share",{data:{itemTypedId:T.typed_id}}):y.open("show_share_properties_for_item",{data:{itemTypedId:T.typed_id,selectedTab:"share"}}),T.refresh();break;case"download-btn":T.download();break;case"play-btn":T.click();break;case"send-btn":T.sharebar({selected_tab:"send",source:"expansion"});break;case"tag-btn":var F=_.id.substr(2);u.tag_collection.apply_tags([F]);break;case"add-tag-btn":T.tag();break;case"profile-link":b.openWindow(_.href);break;case"select_text_when_clicked":return;case"share-settings-btn":_&&!c.hasClass(_,"disabled")&&(e.getGlobalConfig("showAmsterdamCollabSharing")?x.open("item_share_settings",{data:{itemTypedId:T.typed_id}}):y.open("show_share_properties_for_item",{data:{itemTypedId:T.typed_id,selectedTab:"share"}}));break;case"favorite-btn":a(T);break;case"unfavorite-btn":r(T);break;case"item-feed-btn":case"item-row":if(T.is_quarantined&&!c.getNearest(o.target,".action_list"))return y.open("quarantined_file",{data:{typed_id:T.typed_id}}),o.stopPropagation(),void o.preventDefault();if(!c.hasClass(o.target,"item_feed_menu")&&(j.is(":visible")&&A>j.offset().left||c.getNearest(o.target,"input, .item_expansion, .item-tray")))return o.stopPropagation(),void o.preventDefault();if(p.isGcm())m=k.find("a.item_link").attr("href"),m&&(E=m),T.is_deleted||(f={no_load_folder_tree:!0},"folder"===T.type&&(p.isGcmSearch()?(g=p.get(),f.search=g.searchString,f.filter_list=g.searchFilters,f.track_event="search_item_click"):f.track_event="middle_pane_click"),w.navigate(E,{},f));else{var D=p.isSearch()?"search":"explorer",M=_.getAttribute("data-typed-id"),O=s(_);T.is_file()?d.recordAction({application:"files",page:D,component:"content",feature:"filelist",target:"showpreview",action:"click",data:{index:O,typedId:M}}):T.is_folder()?d.recordAction({application:"files",page:D,component:"content",feature:"filelist",target:"openfolder",action:"click",data:{index:O,typedId:M}}):T.is_boxnote()&&d.recordAction({application:"files",page:D,component:"content",feature:"filelist",target:"openboxnote",action:"click",data:{index:O,typedId:M}}),o.ctrlKey||o.metaKey?(E=T.build_url(),b.openWindow(E)):T.click({evtTarget:o.target})}break;default:return}o.stopPropagation(),o.preventDefault()}}},onmessage:function(e,t){var i,n=l.get("Item"),a=t.itemTypedId;switch(a&&(i=n.find(a)),e){case"favoritetoggled":o(t.item);break;case"favoritesuccess":i&&i.set_params({is_favorited:!0});break;case"favoriteerror":i&&(o(i),m.error(f));break;case"unfavoritesuccess":i&&i.set_params({is_favorited:!1});break;case"unfavoriteerror":i&&(o(i),m.error(v))}},oncontextmenu:function(e,t,o){var a=l.get("accessor_can_edit_global_content"),r=i(e.target),s=n(r);s&&"select_text_when_clicked"!==o&&(u.target_item=s,(!p.isGcm()||a)&&(s.show_menu({event:e,type:"right_click"}),e.stopPropagation(),e.preventDefault()))},onmousedown:function(e,t,o){var a=i(e.target),r=n(a);r&&(u.target_item=r)},onmouseover:function(t,o,a){var r=e.getService("thumbnail"),s=l.get("shared_name"),c=l.get("Item"),_=i(t.target),d=$(t.target),h=n(_),m="";if(h)if(_.addClass("hover"),"expanded"!=h.collection.view||d.hasClass("file_properties")||d.closest(".file_properties").length||p.isEmbedWidget()||(c.update_preview_tooltip=function(){h.has_pic_x&&(s&&!h.pic_x.match("shared_name")&&(h.pic_x=h.pic_x+"&shared_name="+s),r.showThumbnail(h.pic_x,_[0]),delete c.update_preview_tooltip)},c.update_preview_tooltip()),h.concurrently_locked)m=h.lock&&null!==h.lock.service_id?$t("This file is being edited using %1. You can still edit this file at the same time.","item_tooltip_concurrently_locked_by_app",h.lock.service_name):h.locked_key?$t("You are currently editing this file. Other people can still edit the file simultaneously.","item_tooltip_concurrently_locked_by_me"):$t("Other people are currently editing this file. You can still edit this file simultaneously","item_tooltip_concurrently_locked"),_.find(".concurrent_lock").attr({"data-hover":"tooltip","aria-label":$t("Currently being edited","currently_being_edited")+"|"+m});else if(h.lock){var f=h.lock.service_name;if(f&&"Locking"!==f&&"Locking (beta)"!==f){var g="<strong>"+$.box.escapeHTML(f)+"</strong>",v="<strong>"+h.lock.user_display_name+"</strong>";m=h.lock.user_id==u.user.id?$t("This file is automatically locked while being edited using the %1 service. It will be unlocked when you close the editor.","item_tooltip_lock_edited_by_you",g)+"<br>":$t("This file is automatically locked while being edited using the %1 service. It will be unlocked when %2 closes the editor.","item_tooltip_lock_edited_by_you2",g,v)+"<br>"}h.locked_key?(m+=h.generate_lock_info_html(),_.find(".locked_key").attr("data-htmltooltip",m)):(m+="Locking"===f||"Locking (beta)"===f?h.generate_lock_info_html():$t("You cannot overwrite this file","item_tooltip_lock_cannot_overwrite"),_.find(".lock").attr("data-htmltooltip",m))}},onmouseout:function(t,o,a){var r=e.getService("thumbnail"),s=l.get("Box_Menus"),c=i(t.target),_=n(c);!_||s.menu&&s.menu.item==_||c.hasClass("ignore_mouseout")||(c.removeClass("hover"),r.hideThumbnail())}}}),Box.Timing.execution.push({name:"js/behaviors/current-user-menu.js",time:(new Date).getTime()}),Box.Application.addBehavior("current-user-menu",function(e){"use strict";function t(e){var t=$('[data-option-type="end-user"]',l),i=$('[data-option-type="admin"]',l);if(e)t.remove();else{i.remove();var n=s.logged_in,o=s.user.is_free_user;n||t.remove(),o||($("#current_user_business_solutions",l).remove(),$("#current_user_upgrade",l).remove())}}function i(){r&&(r.destroy(),r=null),l&&l.parentNode.removeChild(l),l=null}function n(n,o){r&&i();var s=e.getService("templates"),c=s.getTemplateFragment("current-user-menu");l=a.getFirstElementChild(c),t(o),n.parentNode.appendChild(c),r=e.getService("menus").create(l),r.init()}var o,a,r,s,l,c,_,d,u="bottom left",p={x:-194,y:9},h=223,m=200,f=203;return{init:function(){o=e.getService("v5"),a=e.getService("dom"),s=o.get("Canvas"),c=e.getService("url"),d=e.getService("nav-state"),_=e.getService("logger")},destroy:function(){i(),o=null,a=null,s=null,c=null,d=null},onclick:function(e,t,i){if(t&&!a.hasClass(t,"disabled")){var n=!!a.getData(t,"admin-view");switch(i){case"user-menu-btn":r&&r.isOpen()?this.hideMenu():this.showMenu(t,n);break;default:return}e.preventDefault(),e.stopPropagation()}},handleMenuClick:function(e){if(e&&!a.hasClass(e,"disabled")){var t=a.query("a",e);if(t){var i=t.getAttribute("href"),n="_blank"===t.getAttribute("target");this.hideMenu(),"get-training"===e.getAttribute("data-option-type")&&_.sendLog("web_clicks","GET_TRAINING_CLICKED"),n?c.openWindow(i):c.goToUrl(i)}}},bindMenuSelectEvent:function(){var e=this;r.on("menuselect",function(t){var i=t.data.targetElement;e.handleMenuClick(i)})},unbindMenuSelectEvent:function(){r.off("menuselect")},showMenu:function(e,t){n(e,t),this.bindMenuSelectEvent();var i;i=d.isEmbedWidget()?f:m,r.showWithBeak(e,u,p,h,i)},hideMenu:function(){r.hide(),this.unbindMenuSelectEvent(),i()}}}),Box.Timing.execution.push({name:"js/behaviors/pagination.js",time:(new Date).getTime()}),Box.Application.addBehavior("pagination",function(e){"use strict";function t(t){var i,n,o=e.getService("nav-state"),a=e.getService("logger");o.isSearch()&&(i=t.getAttribute("data-page_num")||"",n=t.id,n&&a.sendLog("search_navigation","NAVIGATION",{navigation_type:n,jump_to_num:i}))}function i(e){var t=n.get("Canvas");t.update_page(e)}var n,o,a;return{init:function(){n=e.getService("v5"),o=e.getService("dom"),a=n.get("Box_Menus")},destroy:function(){n=null,o=null,a=null},onclick:function(e,n,r){if(n&&!o.hasClass(n,"disabled")){switch(r){case"paging-btn":case"paging-link":t(n),i(n.getAttribute("data-page_num"));break;case"paging-menu-btn":t(n),a.paging_menu.show({target:n});break;default:return}e.preventDefault(),e.stopPropagation()}}}}),Box.Timing.execution.push({name:"js/modules/amsterdam/files-page-collab-sidebar.js",time:(new Date).getTime()}),Box.Application.addModule("files-page-collab-sidebar",function(e){"use strict";function t(){a.addClass(l,"is-loading")}function i(){a.removeClass(l,"is-loading")}function n(){t();var e=s.getGcmCompatibleRm(_),n={folderId:c};o.get(e,n).then(function(e){i(),a.setHTML(l,e.data.html);var t=a.query(".sidebar-collab-spinner-container");t&&(a.removeClass(t,"is-displayed"),a.addClass(t,"hidden"))},function(e){var t=e.data||{},n=$t("There was a problem loading the collaborators sidebar. Try refreshing the page.","collab_sidebar_refresh_error");i(),"folderNotFound"===t.code&&(n=t.message),r.error(n)})}var o,a,r,s,l,c,_="get_collab_sidebar",d="show_collabs_by_folder";return{behaviors:["menu-toggle","collab-invite","collab-menu-remove","collab-menu-resend-invite","collab-role-menu","tooltips-amsterdam"],messages:["x-collabchange","collabchangeinitiated","collabchangecanceled","collabremoveerror","collabrequestsent","collabresponsereceived"],init:function(){o=e.getService("ajax"),a=e.getService("dom"),r=e.getService("notifications-amsterdam"),s=e.getService("url"),l=e.getElement();var t=l.getAttribute("data-item-typed-id");c=t.substr(2)},onclick:function(e,t,i){"open-collabs-popup"===i&&(this.openCollaboratorsPopup(),e.preventDefault(),e.stopPropagation())},onmessage:function(e,n){switch(e){case"x-collabchange":this.refresh();break;case"collabrequestsent":case"collabchangeinitiated":t();break;case"collabresponsereceived":case"collabchangecanceled":case"collabremoveerror":i()}},openCollaboratorsPopup:function(){var t=e.getService("popups");t.open(d,{data:{folderId:c,collabId:"-1",collabType:"inherited"}})},refresh:n}}),Box.Timing.execution.push({name:"js/modules/amsterdam/files-page-share-sidebar.js",time:(new Date).getTime()}),Box.Application.addModule("files-page-share-sidebar",function(e){"use strict";function t(){var e=r.query(".share-sidebar-link-input",p),t=r.query(".module-share-spinner",p);r.addClass(e,g),r.addClass(t,v)}function i(){var e=r.query(".share-sidebar-link-input",p),t=r.query(".module-share-spinner",p);r.removeClass(e,g),r.removeClass(t,v)}function n(){c.error($t("There was a problem loading the share sidebar. Try refreshing the page.","share_sidebar_refresh_error"))}function o(){var e=s.getGcmCompatibleRm(m),o={itemTypedId:u};d.hideAll(),t(),l.get(e,o).then(function(e){var t,i=e.data;t=r.query(".share-sidebar-content",p),r.setHTML(t,i.html)},function(e){var t=e.data||{};i(),"itemNotFound"===t.code?c.error(t.message):n()})}function a(){var e=s.getGcmCompatibleRm(h),t={itemTypedId:u},i=r.query(".generate-share-spinner",p);r.addClass(i,v),l.post(e,t).then(function(e){var t,i=e.data;t=r.query(".share-sidebar-content",p),r.setHTML(t,i.html);var n=$(p).find(".share-sidebar-link-input");n.length&&(n.focus(),n.select())},function(e){var t=e.data||{};switch(r.removeClass(i,v),t.code){case"itemNotFound":case"noSharePermission":c.error(t.message);break;default:n()}})}var r,s,l,c,_,d,u,p,h="share_and_get_sidebar",m="get_share_sidebar",f="item_share_settings",g="is-disabled",v="is-loading";return{behaviors:["menu-toggle","share-access-menu-amsterdam","tooltips-amsterdam"],messages:["sharedlinkcreated","sharedlinkchanged","sharedlinkremoved"],init:function(){r=e.getService("dom"),s=e.getService("url"),l=e.getService("ajax"),c=e.getService("notifications-amsterdam"),_=e.getService("popups-amsterdam"),d=e.getService("tooltips-amsterdam"),p=e.getElement(),u=p.getAttribute("data-item-typed-id")},onclick:function(e,t,i){if(t){switch(i){case"generate-share-link":this.shareItem();break;case"select-text-when-clicked":this.selectText(t);break;case"share-settings-btn":this.openSharedLinkSettingsPopup();break;default:return}e.preventDefault(),e.stopPropagation()}},shareItem:a,openSharedLinkSettingsPopup:function(){var e=s.getGcmCompatibleRm(f);_.open(e,{data:{itemTypedId:u}})},selectText:function(e){e.focus(),e.select()},onmessage:function(e,t){if(t&&t.itemTypedId===u)switch(e){case"sharedlinkchanged":case"sharedlinkremoved":case"sharedlinkcreated":o()}}}}),Box.Timing.execution.push({name:"js/modules/amsterdam/guide.js",time:(new Date).getTime()}),Box.Application.addModule("guide",function(e){"use strict";function t(e){e.title&&n.setHTML(r,e.title),e.body&&n.setHTML(a,e.body),e.tour&&s.setAttribute("data-tour",e.tour)}function i(){var e=n.query("button[data-type="+l+"]");o.showMenu(e)}var n,o,a,r,s,l="menu-toggle-button",c="close-menu",_="launch-tour";return{messages:["setguide","showguide"],behaviors:["amsterdam-survey"],init:function(){n=e.getService("dom");var t=e.getService("menu-toggle"),i=!0;o=t.create(i),o.init();var l=e.getElement();r=n.query(".contextual-guide-title",l),a=n.query(".contextual-guide-body",l),s=n.query(".launch-tour",l)},destroy:function(){o.destroy()},onclick:function(t,i,a){switch(a){case _:var r=i.getAttribute("data-tour");if(r){var s=e.getService("tour");s.startTourIfEligible(r)}break;case l:o.showMenu(i),t.preventDefault(),t.stopPropagation();break;case c:return o.closeMenu(),void t.stopPropagation()}n.getNearest(t.target,".menu-option")&&o.closeMenu()},onmessage:function(e,n){switch(e){case"setguide":t(n);break;case"showguide":i()}}}}),Box.Timing.execution.push({name:"js/modules/amsterdam/popup-embed-settings.js",time:(new Date).getTime()}),Box.Application.addModule("popup-embed-settings",function(e){"use strict";function t(){var e=y.query(".widget-view-dropdown .select",w);return e?e.value:null}function i(){var e=y.query(".widget-sort-dropdown .select",w);return e?e.value:null}function n(){return y.query(".widget-theme-dropdown .select",w).value}function o(){return y.query(".widget-size-dropdown .select",w).value}function a(){return y.query(".widget-width-input",w)}function r(){return y.query(".widget-height-input",w)}function s(){return w.getAttribute("data-item-shared-name")}function l(){var e=g;return"audio"===S?e=v:"video"===S&&(e=b),e}function c(){var e=a().value,t=r().value,i=parseInt(e,10),n=parseInt(t,10),o=l(),s=o[p],c=s.width,_=s.height;return isFinite(e)&&i>=c&&isFinite(t)&&n>=_}function _(){var e=l(),t=o(),i={};switch(t){case p:case h:case m:i=e[t];break;case f:return}var n=a(),s=r();n.value=i.width,s.value=i.height}function d(){var e=o()===f,t=a(),i=r(),n=[t,i];e?(y.removeClass(n,"is-disabled"),t.removeAttribute("readonly"),i.removeAttribute("readonly")):(y.addClass(n,"is-disabled"),t.setAttribute("readonly","readonly"),i.setAttribute("readonly","readonly"))}function u(e,t,i){return'<iframe src="'+e+'" width="'+t+'" height="'+i+'" frameborder="0" allowfullscreen webkitallowfullscreen msallowfullscreen> </iframe>'}var p="small",h="medium",m="large",f="custom",g={};g[p]={height:400,width:330},g[h]={height:400,width:500},g[m]={height:550,width:800};var v={};v[p]={height:88,width:330},v[h]={height:88,width:500},v[m]={height:88,width:800};var b={};b[p]={height:270,width:480},b[h]={height:360,width:640},b[m]={height:450,width:800};var w,y,x,S;return{behaviors:["popup-default-close"],init:function(){w=e.getElement(),y=e.getService("dom"),x=e.getService("url"),S=w.getAttribute("data-file-type")},onclick:function(e,t,i){switch(i){case"embed-preview-link":y.hasClass(t,"is-disabled")||this.previewEmbedWidget();break;default:return}e.preventDefault(),e.stopPropagation()},onchange:function(e,t,i){if(i&&t)switch(i){case"widget-size-dropdown":this.makeWidgetSizeUpdates();break;case"widget-width-input":case"widget-height-input":case"widget-view-dropdown":case"widget-sort-dropdown":case"widget-theme-dropdown":this.regenerateEmbedCode()}},makeWidgetSizeUpdates:function(){_(),d(),this.regenerateEmbedCode()},previewEmbedWidget:function(){var e={shared_name:s(),view:t(),sort:i(),direction:"ASC",theme:n(),width:a().value,height:r().value},o=x.createUrl("/embed_widget_preview",e);x.openWindow(o,"embed_widget_preview")},regenerateEmbedCode:function(){var o,s,_,d="",h=y.query(".embed-html-code",w),m=y.query(".embed-preview-link",w);c()?(o=x.createUrl(e.getConfig("embedUrlPrefix"),{view:t(),sort:i(),direction:"ASC",theme:n()}),d=u(o,a().value,r().value),y.removeClass(m,"is-disabled")):(s=l(),_=s[p],d=$t("Please specify the dimension of your widget to be at least %1 x %2 in size.","embed_widget_size_restriction_info",_.width,_.height),y.addClass(m,"is-disabled")),h.value=d}}}),Box.Timing.execution.push({name:"js/modules/amsterdam/popup-invite-collaborators.js",time:(new Date).getTime()}),Box.Application.addModule("popup-invite-collaborators",function(e){"use strict";function t(){d.addClass(S,I),d.addClass(S,P),S.disabled=!0}function i(){S.disabled=!1,d.removeClass(S,P),d.removeClass(S,I)}function n(){var e,t,i,n=d.queryAll(".pill",b),o=n.length,a=!0;for(i=0;o>i;i++)e=n[i],t=e.getAttribute("data-id"),m.isEmail(t)||e.hasAttribute("data-group")?d.removeClass(e,"is-invalid"):(d.addClass(e,"is-invalid"),a=!1);return a}function o(){if(x=g.getAttribute("data-typed-id")){var e=d.query(".invite-selector-input",g),t=_.searchAllContactsExcludingItemCollaborators(x,{includeSelf:!1,includeGroups:!0});y=p.create(e,t),y.init()}}function a(e){if(e){var t=y.createDataArrayFromString(e);y.insertArrayOfPills(t)}}function r(e){var t,i,n=[],o=[],a=null;for(t=0,i=e.length;i>t;t++)a=e[t],a.data&&"group"===a.data.type?o.push(a.id):n.push(a.id);return{unrestrictedCollabEmails:n,groupIDs:o}}function s(e){var t={tooltipRelative:".popup-wrapper"};d.hasClass(w,$)&&(t.tooltipPosition="left"),y.displayError(e,t),d.hasClass(k,B)||(d.addClass(k,B),h.resize())}function l(){var e=d.queryAll(".pill",b);d.addClass(e,"is-invalid")}var c,_,d,u,p,h,m,f,g,v,b,w,y,x,S,k,T=13,j=188,C=2500,$="is-active",A=".permissions-matrix-flyout",E=".collaboration-warning",B="inline-alert-visible",I="is-loading",P="is-disabled",F="box_collaborate_invite_amsterdam";return{behaviors:["menu-toggle","popup-default-close","tooltips-amsterdam"],init:function(){g=e.getElement(),c=e.getService("ajax"),_=e.getService("provider-contacts"),d=e.getService("dom"),u=e.getService("notifications-amsterdam"),p=e.getService("pill-selector"),h=e.getService("popups-amsterdam"),m=e.getService("strings"),f=e.getService("url"),v=d.query(A,g),w=d.query(E,g),S=d.query('.btn[data-type="collab-popup-submit"]',g),b=d.query(".pill-selector",g),k=d.query(".inline-alert",g),o()},sendEmailInvites:function(n){var o=d.query(".personal-message-wrapper textarea").value||"",a=d.query(".invite-permission-type .select").value||"",s=r(n),_=this,p=f.getGcmCompatibleRm(F),m={email:s.unrestrictedCollabEmails.join(","),groupIds:s.groupIDs.join(","),emailMessage:o,nodeId:x,notify:1,permissions:a};t(),c.post(p,m).then(function(t){if(i(),t.error)return void u.error(t.message,{duration:C});var n=t.data.message;if("warning"===n.type){var o=n.title.error,a=n.title.success+n.description,r=t.data.invited_users;return y.deletePills(r),l(),_.showInviteError(o),void u.confirm(a)}if("error"===n.type&&""!==n.title.error)return _.showInviteError(n.title.error),void l();if("success"===n.type&&""!==n.title.success){var s=n.title.success+n.description;u.confirm(s)}e.broadcast("x-collabchange"),e.broadcast("itemupdated",{itemTypedId:x}),h.close({unsafeSkipRefresh:!0})},function(e){var t,n=e.data||{};i(),t=n.message?n.message:$t("Something went wrong with your request. Please try again.","invite_popup_send_invites_error_message"),u.error(t,{duration:C})})},onkeydown:function(e,t,i){if("email-invite-input"===i){var n=e.which||e.keyCode;if(n===T||n===j){var o=d.query(".pill-selector-input",g);a(o.value),this.validatePills(),e.stopPropagation(),e.preventDefault()}}},onclick:function(e,t,i){if(t&&!t.disabled){switch(i){case"permissions-matrix-toggle-btn":this.togglePermissionsMatrixFlyout();break;case"collab-popup-submit":this.validateAndSubmit();break;case"permissions-dropdown":return;default:return void this.hidePermissionsMatrixFlyout()}e.preventDefault(),e.stopPropagation()}},validateAndSubmit:function(){var e,t,i;e=d.query(".pill-selector-input",g),a(e.value),t=y.getPills(),this.hidePermissionsMatrixFlyout(),t.length>0?this.validatePills()?this.sendEmailInvites(t):(i=$t("One or more of the email addresses is invalid.","atleast_one_invalid_email_invite_collab_popup"),this.showInviteError(i)):(i=$t("Please enter at least one email address.","collab_popup_atleast_one_email_error"),this.showInviteError(i))},showPermissionsMatrixFlyout:function(){d.addClass(v,$)},hidePermissionsMatrixFlyout:function(){d.removeClass(v,$)},togglePermissionsMatrixFlyout:function(){d.hasClass(v,$)?this.hidePermissionsMatrixFlyout():this.showPermissionsMatrixFlyout()},onchange:function(e,t,i){"permissions-dropdown"===i&&this.hidePermissionsMatrixFlyout()},validatePills:n,onsubmit:function(e,t,i){"popup-collab-form"===i&&(e.stopPropagation(),e.preventDefault())},showInviteError:s}}),Box.Timing.execution.push({name:"js/modules/amsterdam/popup-mail-all-collaborators.js",time:(new Date).getTime()}),Box.Application.addModule("popup-mail-all-collaborators",function(e){"use strict";function t(){var e=o.query(".loading-btn",c);o.addClass(e,d),o.addClass(e,u),e.disabled=!0}function i(e){var i={itemId:c.getAttribute("data-item-id"),message:e};t(),n.post(_,i).then(function(e){for(var t,i=o.queryAll(".pending-collab-menu"),n=[],a=0,l=i.length;l>a;a++)t=i[a].getAttribute("data-display-name"),t&&n.push(t);if(s.close({unsafeSkipRefresh:!0}),n.length>0){var c=$t("Your message was successfully sent to all active collaborators. The following pending collaborators did not receive your message: %1","collab_mail_all_success_w_exception",n.join(", "));r.info(c,{duration:-1})}else r.info(e.data.message)},function(e){var t,i=e.data||{};switch(s.close(),i.code){case"invalidEmails":r.warn(i.message);break;case"folderNotFound":case"noCollabs":r.error(i.message);break;default:t=$t("There was a problem sending your message to collaborators. Please refresh the page and try again.","collab_mail_all_failure_try_again"),r.error(t)}})}var n,o,a,r,s,l,c,_="mail_all_collabs",d="is-loading",u="is-disabled";return{behaviors:["popup-default-close","tooltips-amsterdam"],init:function(){n=e.getService("ajax"),o=e.getService("dom"),a=e.getService("form-validator"),r=e.getService("notifications-amsterdam"),s=e.getService("popups-amsterdam"),l=e.getService("strings"),c=e.getElement(),a.initForm(c)},onclick:function(e,t,i){"send-btn"!==i||t.disabled||(this.validateAndSubmitMessageForm(),e.preventDefault(),e.stopPropagation())},validateAndSubmitMessageForm:function(){var e=o.query(".mail-all-message",c),t=l.trim(e.value);if(!t){var n=$t("Please enter a message.","mail_all_collab_error_enter_message");return void a.setCustomError(e,n)}i(t)}}}),Box.Timing.execution.push({name:"js/modules/amsterdam/popup-share-link.js",time:(new Date).getTime()}),Box.Application.addModule("popup-share-link",function(e){"use strict";function t(){m.addClass(x,M),m.addClass(x,D)}function i(){m.removeClass(x,D),m.removeClass(x,M)}function n(){m.addClass(k,D),m.addClass(k,M),k.disabled=!0}function o(){k.disabled=!1,m.removeClass(k,M),m.removeClass(k,D)}function a(){setTimeout(function(){x.select()},0)}function r(){var e=m.query(".contact-selector-input",S),t=h.searchAllContacts({includeSelf:!0,includeGroups:!1});T=g.create(e,t),T.init()}function s(e){if(e){var t=T.createDataArrayFromString(e);T.insertArrayOfPills(t)}}function l(e){var t,i,n=e.length,o=[],a=[];for(t=0;n>t;t++)i=e[t].id,b.isEmail(i)?o.push(i):a.push(i);return{validEmails:o,invalidEmails:a}}function c(e){if(!e||!e.length)return"";var t,i=e.length,n=[],o=e[0].item_name;for(t=0;i>t;t++)n.push(e[t].email);return $t("The link to %1 was sent to %2.","share_link_popup_success_message",o,n.join(", "))}function _(e,t){if(!e||!e.length)return t.length?$t("The link was not sent to the following invalid email(s): %1.","share_link_popup_invalid_emails",t.join(", ")):"";var i,n,o,a=e.length,r=[],s=0,l="",c=e[0].item_name;for(i=0;a>i;i++)n=e[i],r.push(n.email),s=Math.max(s,n.access);switch(o=r.join(", "),s){case B:l=t.length?$t("The link to %1 was not sent to %2 because at least one user is not a user in the folder owner's enterprise. The link was also not sent to the following invalid email(s): %3.","share_link_popup_send_link_not_in_enterprise_failure_with_invalid_emails",c,o,t.join(", ")):$t("The link to %1 was not sent to %2 because at least one user is not a user in the folder owner's enterprise.","share_link_popup_send_link_not_in_enterprise_failure",c,o);break;case I:l=t.length?$t("The link to %1 was not sent to %2 because at least one user is not a collaborator in this folder. The link was also not sent to the following invalid email(s): %3.","share_link_popup_send_link_not_in_folder_failure_with_invalid_emails",c,o,t.join(", ")):$t("The link to %1 was not sent to %2 because at least one user is not a collaborator in this folder.","share_link_popup_send_link_not_in_folder_failure",c,o);break;default:l=t.length?$t("Sorry, there was an error and the link to %1 was not sent to %2. Please try again. The link was also not sent to the following invalid email(s): %3.","share_link_popup_send_link_generic_failure_with_invalid_emails",c,o,t.join(", ")):$t("Sorry, there was an error and the link to %1 was not sent to %2. Please try again.","share_link_popup_send_link_generic_failure",c,o)}return l}function d(e,t){var i=c(e.successful_emails_items),n=_(e.failed_emails_items,t);i&&n?f.warn(i+" "+n):n?f.error(n):i&&f.info(i)}function u(e,t,i){var a=w.getGcmCompatibleRm(C),r={itemTypedId:e,emails:t.validEmails,message:i};n(),p.post(a,r).then(function(e){v.close({unsafeSkipRefresh:!0}),d(e.data,t.invalidEmails)},function(){o();var e=$t("There was a problem emailing the link. Please try again or refresh the page.","email_share_link_error_message");v.alert(e)})}var p,h,m,f,g,v,b,w,y,x,S,k,T,j="isEmbedWidget",C="email_share_link",$="item_share_access_menu",A="item_share",E="item_share_settings",B=1,I=2,P=13,F=188,D="is-loading",M="is-disabled",O=".popup-wrapper";return{behaviors:["menu-toggle","popup-default-close","share-access-menu-amsterdam","tooltips-amsterdam"],messages:["sharedlinkchanged","sharedlinkremoved"],init:function(){p=e.getService("ajax"),h=e.getService("provider-contacts"),m=e.getService("dom"),f=e.getService("notifications-amsterdam"),g=e.getService("pill-selector"),v=e.getService("popups-amsterdam"),b=e.getService("strings"),w=e.getService("url"),S=e.getElement(),x=m.query(".share-link-input",S),a(),r(),y=m.query(".pill-selector-input",S),k=m.query('.btn[data-type="send-btn"]',S)},onclick:function(e,t,i){if(t&&!t.disabled){switch(i){case"share-link-input":this.focusAndSelectText(t);break;case"send-btn":var n=t.getAttribute("data-item-typed-id");this.emailShareLink(n);break;case"share-settings-btn":this.openSharedLinkSettingsPopup();break;default:return}e.preventDefault(),e.stopPropagation()}},onfocusin:function(e,t,i){var n=m.query(".email-fieldset",S);"contact-selector-input"!==i||m.hasClass(n,"is-email-expanded")||(m.addClass(n,"is-email-expanded"),v.resize())},onmessage:function(e,t){switch(e){case"sharedlinkchanged":this.updateMenuHTML(t.itemTypedId);break;case"sharedlinkremoved":v.close({unsafeSkipRefresh:!0})}},onkeydown:function(e,t,i){var n=e.which||e.keyCode;if(t&&i&&(n===P||n===F)&&"contact-selector-input"===i){var o=m.query(".pill-selector-input",S).value;s(o),e.preventDefault(),e.stopPropagation()}},focusAndSelectText:function(e){e.focus(),e.select()},openSharedLinkSettingsPopup:function(){v.close({unsafeSkipRefresh:!0});var e=S.getAttribute("data-item-typed-id"),t=w.getGcmCompatibleRm(E);v.open(t,{data:{itemTypedId:e,openBasicSettingsOnClose:!0}})},emailShareLink:function(t){var i,n,o,a,r;return s(y.value),a=T.getPills(),i=l(a),i.validEmails.length?(o=m.query(".message-textarea",S).value,void u(t,i,o)):(n=$t("Enter at least one valid email","share_properties_popup_no_emails"),r=e.getConfig(j)?"top":"",void T.displayError(n,{tooltipPosition:r,tooltipRelative:O}))},updateMenuHTML:function(e){var n=w.getGcmCompatibleRm($),o={itemTypedId:e};t(),p.get(n,o).then(function(e){i();var t=m.query(".share-menu-container",S);m.setHTML(t,e.data.html);var n=m.query('[data-type="menu-toggle-button"]',t);n&&n.focus()},function(){v.close({unsafeSkipRefresh:!0});var t=w.getGcmCompatibleRm(A);v.open(t,{data:{itemTypedId:e}})})}}}),Box.Timing.execution.push({name:"js/modules/amsterdam/popup-share-settings.js",time:(new Date).getTime()}),Box.Application.addModule("popup-share-settings",function(e){"use strict";function t(){var e;P=[],h&&!h.disabled&&P.push({params:{itemTypedId:B,vanityName:h.value},runmode:D}),b&&w&&!b.disabled&&(b.checked&&w.value||!b.checked)&&P.push({params:{itemTypedId:B,newPassword:b.checked?w.value:""},runmode:O}),v&&!v.disabled&&(e=T.query('input[name="shared-expiration-val"]',p),P.push({params:{itemTypedId:B,expiration:v.checked?e.value:0},runmode:M})),u&&!u.disabled&&P.push({params:{itemTypedId:B,enabled:u.checked},runmode:F})}function i(e){e?(T.removeClass(y,L),y.removeAttribute("disabled")):(T.addClass(y,L),y.setAttribute("disabled","disabled"))}function n(e,t){A.hideAll(),e.checked&&T.hasClass(t,R)?T.removeClass(t,R):e.checked||T.hasClass(t,R)||T.addClass(t,R)}function o(e,t){T.hasClass(e,"datepicker")?k.setError(t):j.setCustomError(e,t),N&&e.setAttribute("data-tooltip-position",N),e.setAttribute("data-tooltip-relative",U),A.show(e,{})}function a(t){C.close({unsafeSkipRefresh:!0}),t||e.broadcast("sharedlinkchanged",{itemTypedId:B,context:"popup"}),e.getConfig("openBasicSettingsOnClose")&&C.open(E.getGcmCompatibleRm(Y),{data:{itemTypedId:B}})}function r(e){for(var t,i,n,r=!1,s=0,l=e.length;l>s;s++)if(t=e[s],t.isRejected()){switch(i=t.reason(),n="object"==typeof i.data&&i.data.hasOwnProperty("message")?i.data.message:$t("Something went wrong. Please try again","unknown_server_error"),P[s].runmode){case D:o(h,n);break;case O:o(w,n);break;case M:o(g,n);break;case F:o(u,n)}r||(r=!0)}T.removeClass(p.parentElement,q),r||a(!1)}function s(){var e={name:"SharedCustomURLRule",shouldValidate:function(e,t,i){return e.hasValidatorAttribute(i,"popup-share-settings-customurl")&&""!==i.value&&!i.disabled},validate:function(e,t,i){var n=i.value,a=n.length>=H&&n.length<=V&&W.test(n);return a||o(i,$t("Custom URL must be an alphanumeric value between 3-30 characters.","custom_url_must_be_alphanumeric_between_3_and_30")),a}},t={name:"CustomPasswordValidationRule",shouldValidate:function(e,t,i){
return e.hasValidatorAttribute(i,"popup-share-settings-password")&&!i.disabled},validate:function(e,t,i){var n="",a=!0,r=i.value;return 0===r.length&&(n=$t("You must enter a password.","password_must_be_entered_when_required"),a=!1),a||o(i,n),a}};j.addValidationRule(e),j.addValidationRule(t)}function l(){A.hideAll();var e=j.checkValidity(p);return v.checked&&!g.value?(k.setError($t("Please select a date.","date_required_error")),e=!1):k.removeError(),i(e),e}function c(e){n(e,w),C.resize(),e.checked?w.setAttribute("data-validator","popup-share-settings-password"):(w.value="",w.removeAttribute("data-validator"),l())}function _(e){n(e,g),C.resize(),e.checked||(l(),g.value="")}function d(e){n(e,f),C.resize()}var u,p,h,m,f,g,v,b,w,y,x,S,k,T,j,C,$,A,E,B,I,P,F,D,M,O,N,R="hidden",L="is-disabled",q="is-loading",U=".popup-wrapper",G="isEmbedWidget",H=3,V=30,W=/^[a-z0-9-]+$/i,Y="item_share",z=300;return{behaviors:["tooltips-amsterdam"],init:function(){p=e.getElement(),B=p.getAttribute("data-typed-id"),x=e.getService("ajax"),S=e.getService("datepicker"),T=e.getService("dom"),j=e.getService("form-validator"),C=e.getService("popups-amsterdam"),$=e.getService("promises"),A=e.getService("tooltips-amsterdam"),E=e.getService("url"),u=T.query(".restrict-download input",p),h=T.query(".custom-url-input",p),m=T.query(".custom-url-slug",p),f=T.query(".direct-link",p),g=T.query(".datepicker",p),v=T.query(".link-expiry-enable input",p),w=T.query(".custom-url-password input",p),b=T.query(".custom-url-password-enable input",p),y=T.query(".save-settings-btn",p),F=E.getGcmCompatibleRm("share_item_toggle_direct_download"),D=E.getGcmCompatibleRm("share_item_change_vanity_name"),M=E.getGcmCompatibleRm("share_item_change_expiration"),O=E.getGcmCompatibleRm("box_share_item_change_password"),N=e.getConfig(G)?"top":"",j.initForm(p),s(),this.registerExternalEvents(),k=S.create(g)},onchange:function(e,t,i){switch(i){case"password-checkbox":c(t);break;case"expiration-checkbox":_(t);break;case"allow-download-checkbox":d(t);break;default:return}e.stopPropagation()},onclick:function(e,t,i){switch(i){case"close-popup":a(!0);break;case"direct-link":t.select();break;default:return}e.stopPropagation()},onfocusout:function(e,t,i){switch(i){case"custom-url-input":case"password-input":case"expiration-input":this.validateForm();break;default:return}e.stopPropagation()},onkeyup:function(e,t,i){switch(i){case"custom-url-input":this.updateCustomURLPreview(),clearTimeout(I),I=setTimeout(function(){j.checkValidity(t)},z);break;case"password-input":""!==t.value?w.setAttribute("data-validator","popup-share-settings-password"):w.removeAttribute("data-validator");break;default:return}e.stopPropagation()},onsubmit:function(e){var n,o=[];if(e.preventDefault(),e.stopPropagation(),this.validateForm()){i(!1),T.addClass(p.parentElement,q),t();for(var a=0,s=P.length;s>a;a++)n=P[a],o.push(x.post(n.runmode,n.params));$.settle(o).then(r)}},updateCustomURLPreview:function(){"string"==typeof m.innerText?m.innerText=h.value:m.textContent=h.value},validateForm:l,onclose:function(e){("keyup"!==e.type||27===e.keyCode)&&(a(!0),e.stopPropagation())},registerExternalEvents:function(){var e=T.query(".popup-x-btn"),t=T.query(".popup");T.on(e,"click",this.onclose),T.on(t,"keyup",this.onclose)}}}),Box.Timing.execution.push({name:"js/modules/amsterdam/popup-account-upgrade.js",time:(new Date).getTime()}),Box.Application.addModule("popup-account-upgrade",function(){"use strict";return{behaviors:["popup-default-close"],onclick:function(e,t,i){e.preventDefault(),e.stopPropagation()}}}),Box.Timing.execution.push({name:"js/modules/amsterdam/popup-upgrade.js",time:(new Date).getTime()}),Box.Application.addModule("popup-upgrade",function(e){"use strict";var t,i;return{behaviors:["popup-default-close"],init:function(){t=e.getService("popups-amsterdam"),i=e.getService("url");var n=e.getElement(),o=n.getAttribute("data-resin-page"),a=e.getService("logger");a.sendLog("user_event","DISPLAY_UPGRADE_POPUP_"+o)},onclick:function(e,n,o){"paywall-upgrade-btn"===o&&(t.close({unsafeSkipRefresh:!0}),i.openWindow("/upgrade/up"))}}}),Box.Timing.execution.push({name:"js/modules/amsterdam/popup-retention-extension.js",time:(new Date).getTime()}),Box.Application.addModule("popup-retention-extension",function(e){"use strict";var t,i,n,o,a,r="ok-popup",s="close-popup",l="retention-extension-time",c="week",_="month",d="year",u="custom",p=".date_picker",h="extendRetentionExpiration";return{behaviors:["datepicker","popup-default-close"],init:function(){t=e.getElement(),i=e.getService("dom"),n=e.getService("ajax"),o=e.getService("popups-amsterdam"),a=e.getService("notifications-amsterdam")},onclick:function(e,t,i){switch(i){case r:var n=this.getTimeToExtendTo();this.extendRetentionPeriod(n);break;case s:this.closePopup();break;default:return}e.preventDefault(),e.stopPropagation()},onchange:function(e,n,a){var r=i.query(p,t);switch(a){case l:n.value===u?(i.removeClass(r,"hidden"),o.resize()):i.addClass(r,"hidden")}},getTimeToExtendTo:function(){var e=i.query('[name="retention_extension_retained_until"]',t).value,n=i.query('[name="retention_extension_time"]',t),o=n.options[n.selectedIndex].value,a=new Date(1e3*e);switch(o){case c:a.setDate(a.getDate()+7);break;case _:a.setMonth(a.getMonth()+1);break;case d:a.setFullYear(a.getFullYear()+1);break;case u:a=new Date(i.query('[name="retention_extension_custom_date"]',t).value);break;default:a=null}return a&&(a=Math.floor(a.getTime()/1e3)),a},extendRetentionPeriod:function(r){var s=$t("There was an error extending the retention period of this file.","retention_extension_error_notification");if(!r)return void a.error(s);var l=i.query('[name="retention_extension_file_id"]',t).value,c=i.query('[name="retention_extension_item_typed_id"]',t).value;n.post(h,{fileId:l,timestamp:r}).then(function(){e.broadcast("retentionextended",{itemTypedId:c}),o.close({unsafeSkipRefresh:!0})},function(){a.error(s)})},closePopup:function(){o.close({unsafeSkipRefresh:!0})}}}),Box.Timing.execution.push({name:"js/modules/amsterdam/popup-watermark.js",time:(new Date).getTime()}),Box.Application.addModule("popup-watermark",function(e){"use strict";function t(e,t){t&&s.confirm($t("Watermark enabled for %1","popup_action_enable_watermark_notification",e))}function i(e,t){s.error(t?$t("There was a problem enabling the watermark for %1. Please try again or refresh the page.","popup_action_error_while_enabling_watermark",e):$t("There was a problem disabling the watermark for %1. Please try again or refresh the page.","popup_action_error_while_disabling_watermark",e))}function n(){s.error($t("There was a problem accessing the watermark. Please try again or refresh the page.","popup_action_generic_error_watermarking"))}function o(){var e=r.query(".watermark-enable-checkbox",c);e.disabled||a.post("watermark_label",{typedId:c.getAttribute("data-typed-id"),hasWatermarkLabel:e.checked}).then(function(e){var n=e.data.request.hasWatermarkLabel,o=e.data.success,a=e.data.info.name;o?t(a,n):i(a,n)},function(){n()})}var a,r,s,l,c;return{behaviors:["popup-default-close"],init:function(){a=e.getService("ajax"),r=e.getService("dom"),s=e.getService("notifications-amsterdam"),l=e.getService("popups-amsterdam"),c=e.getElement()},onsubmit:function(e){o(),l.close({unsafeSkipRefresh:!0}),e.preventDefault(),e.stopPropagation()}}}),Box.Timing.execution.push({name:"js/modules/common/admin-header.js",time:(new Date).getTime()}),Box.Application.addModule("admin-header",function(e){"use strict";var t,i,n,o,a,r,s="box_master_users_remove_instant_login_session",l="box_master_users_turn_silent_mode_off";return{init:function(){var s=e.getConfig();t=e.getElement(),n=e.getService("loading"),i=e.getService("ajax");var l=e.getService("dom");if(l.query("#trial_end_alert_badge",t)){var c=e.getService("resin");c.recordAction({application:"files",page:"header",component:"adminheader",feature:"alertbadge",target:"trialenddaysalert",action:"programmatic"})}o=s.isEnterpriseSettingsPage,a=s.isViewSwitchEnabled,r=s.isLogoutRequiredUponUserClose},onclick:function(e,t,i){if(t){switch(i){case"silent-mode-off-btn":this.disableSilentMode();break;case"close-user-btn":this.closeUserTab(t)}e.stopPropagation(),e.preventDefault()}},disableSilentMode:function(){var r=this;n.set(!0),i.post(l).then(function(){n.set(!1),r.hideAlertBadge(),a||$(t).hide(),o&&e.getGlobal("window").location.reload()},function(){n.set(!1)})},hideAlertBadge:function(){$(t).find("#alert_badge").hide()},removeInstantLoginSession:function(){return i.post(s)},closeUserTab:function(t){var i=this.removeInstantLoginSession();i.done(r?function(){var t=e.getService("url");t.goToUrl("/logout")}:function(){$(t).closest("li").remove()})}}}),Box.Timing.execution.push({name:"js/modules/common/header.js",time:(new Date).getTime()}),Box.Application.addModule("header",function(e){"use strict";function t(e){var t,i,n=o.get_menu_group("header");if(f=e,n)for(t=n.length-1;t>=0;t--)i=n[t],i.stalking=e,i.redraw()}function i(e){l&&(l.openBelow(e,16,0),l.focusFirst("input, select"),f&&l.freezePosition("40"))}var n,o,a,r,s,l,c,_,d,u,p,h="/index.php?rm=notifications_page_get_unread_count",m=!1,f=!1,g=[{key:"/",handler:function(e){$(s).focus().select(),e.preventDefault()}},{key:"f",comboKey:"g",handler:function(){p.goToUrl("/files")}},{key:"c",comboKey:"g",handler:function(){p.goToUrl("/contacts")}},{key:"p",comboKey:"g",handler:function(){p.goToUrl("/profile")}},{key:"u",comboKey:"g",handler:function(){p.goToUrl("/updates")}},{key:"s",comboKey:"g",handler:function(){p.goToUrl("/settings")}},{key:"a",comboKey:"g",handler:function(){p.goToUrl("/services")}}];return{messages:["x-folderchangebefore","x-legacysearchfilterremove","x-legacysearchfilterchange","x-advancedsearchfilterchange","x-advancedsearchfilterreset","x-searchfilterapply","x-searchbefore","globalsearchreset","itemchange","pendingitemcompleted"],behaviors:["current-user-menu","menu-toggle"],init:function(){n=e.getService("v5"),o=n.get("Box_Menus"),a=e.getService("dom"),d=e.getService("hotkeys"),_=e.getService("overlay"),u=e.getService("strings"),c=e.getService("ajax"),r=$(e.getElement()),s=a.query("#search",r[0]),p=e.getService("url"),d.setConfig(g,"files",!0),this.initSearchPlaceholder(),this.initNotificationsBadge(),$("#header-container.header_stalking").length||($("#header-container").stalker({stalkerStyle:"header_stalking",startCallback:function(){t(!0)},stopCallback:function(){t(!1)}}),s&&s.value&&e.broadcast("searchkeywordchange",{keyword:s.value}))},onmessage:function(t,i){var n,o;switch(t){case"x-folderchangebefore":this.handleFolderChangeBefore();break;case"x-legacysearchfilterchange":case"x-legacysearchfilterremove":case"x-advancedsearchfilterchange":this.updateSearchFilters(i.filters);break;case"x-advancedsearchfilterreset":this.resetSearchFilters();break;case"x-searchfilterapply":r.find("#search_files_form").submit();break;case"x-searchbefore":this.resetSearchFilters(),this.updateSearchTerm(i.query),n=e.getService("nav-state"),i.filters&&n.isGcm()&&this.updateSearchFilters(i.filters);break;case"globalsearchreset":this.updateSearchTerm("");break;case"itemchange":o=e.getService("search"),o&&o.clearCache();break;case"pendingitemcompleted":this.incrementNotificationsBadgeCount(i?-i:-1)}},onchange:function(t,i,n){if(i)switch(n){case"search-keyword-input":e.broadcast("searchkeywordchange",{keyword:i.value})}},onclick:function(t,i,n){if(i){switch(n){case"search-btn":return;case"advanced-search-btn":return this.toggleAdvancedSearchOverlay(a.query(".search_field",e.getElement())),void t.preventDefault();default:return}t.preventDefault(),t.stopPropagation()}},onkeyup:function(e,t,i){t&&"search-form"===i&&13===e.which&&(r.find("#search_files_form").submit(),e.preventDefault(),e.stopPropagation()),27===e.keyCode&&($(s).blur(),$("body").focus())},onsubmit:function(t,i,n){if(i&&"search-form"===n){var o=s.value||"";o=u.trim(o)||"",o.length?(this.performSearch(),l&&l.close()):e.broadcast("searchwithoutkeyword"),t.preventDefault(),t.stopPropagation()}},handleFolderChangeBefore:function(){var t=e.getService("nav-state");t.isMovingOutOfSearch()&&this.initSearchPlaceholder()},initSearchPlaceholder:function(){var e=$(s);e.placeholderize({forceBlock:!0,extraMarginTop:3,extraMarginTopIE:2})},performSearch:function(){{var t,i,n=s.value||"",o={},a=e.getService("nav-state"),r=e.getService("nav-url"),l=e.getService("v5");l.get("Features")}n=u.trim(n)||"",n.length&&(a.setFirstResultClick(!0),a.isGcm()?(o.no_load_folder_tree=!0,t=r.getGcmUrlForSearch(n,0,a.getSearchStringFromFilters(this.getSearchFilters()))):(i="",t=r.getSearchUrl(n,0,i)),e.broadcast("newglobalsearch"),e.getService("navigation").navigate(t))},resetSearchFilters:function(){r.find('[data-type="search-filter"]').val("")},updateSearchTerm:function(e){$(s).val(e).trigger("change").trigger("blur")},updateSearchFilters:function(e){var t,i,n,o,s=$(a.queryAll('input[data-type="search-filter"]',r));for(n=0,o=e.length;o>n;n++)t=e[n].type,i=e[n].value,s.filter('[name="'+t+'"]').val(i)},getSearchFilters:function(){var e,t=[];return e=r.find('[data-type="search-filter"]').filter('[value!=""]'),e.each(function(e,i){var n=$(i);t.push({type:n.attr("name"),value:n.val()})}),t},toggleAdvancedSearchOverlay:function(t){e.getService("tooltips").hideTooltips(!0),m||(l?l.isOpen()?l.close():i(t):(m=!0,c.get("box_advanced_search_get_module",{},{success:function(e){var n=a.createFragmentFromHtml(e.data.html);l=_.create(n),i(t),m=!1},error:function(){e.getService("popups").alert($t("An error has occurred while loading this feature.","popups_default_exception_message")),m=!1}})))},incrementNotificationsBadgeCount:function(e){var t=$("#tasks_tab .badge"),i=parseInt(t.html(),10)+e;this.updateNotificationsBadgeCount(i)},updateNotificationsBadgeCount:function(e){var t=$("#tasks_tab .badge");t.html(e),e>0?t.show():t.hide()},initNotificationsBadge:function(){var e=$.box.formatQuery({sort_method:"date",sort_direction:"DESC",dont_log:!0}),t=n.get("box"),i=this;t&&"files"==t.hist_name&&$.getJSON(h,e,function(e){i.updateNotificationsBadgeCount(e.unreadCount)})}}}),Box.Timing.execution.push({name:"js/modules/common/paging-bottom.js",time:(new Date).getTime()}),Box.Application.addModule("paging-bottom",function(e){"use strict";var t,i;return{messages:["x-searchbefore","x-searchafter","x-folderchangeafter"],behaviors:["pagination"],init:function(){t=e.getService("dom"),i=$(e.getElement())},destroy:function(){t=null,i=null},onmessage:function(e,t){switch(e){case"x-searchbefore":t.isPreloaded||i.empty();break;case"x-searchafter":case"x-folderchangeafter":t.json&&"paging_html"in t.json&&this.setPagingHTML(t.json.paging_html)}},setPagingHTML:function(e){var t;t=$(e).filter("#paging_data").attr("id","paging_data_bottom"),i.html(t)}}}),Box.Timing.execution.push({name:"js/modules/common/legacy-footer.js",time:(new Date).getTime()}),Box.Application.addModule("legacy-footer",function(e){"use strict";var t,i;return{init:function(){t=e.getService("dom"),i=$(e.getElement())},onclick:function(e,i,n){var o;if(i){switch(n){case"legal-link":o=t.getData(i,"url"),o&&this.openLegalPopup(o)}e.preventDefault(),e.stopPropagation()}},openLegalPopup:function(t){var i,n=e.getService("window-popup");i=n.create(t,{width:700,height:400}),i.show()}}}),Box.Timing.execution.push({name:"js/modules/main/tag-filters.js",time:(new Date).getTime()}),Box.Application.addModule("tag-filters",function(e){"use strict";var t,i;return{messages:["x-folderchangebefore"],init:function(){t=e.getService("v5"),i=$(e.getElement())},onmessage:function(t,n){var o=e.getService("nav-state");"x-folderchangebefore"===t&&(o.isTag()?(this.renderTagFilters(),i.show()):i.hide())},onclick:function(i,n,o){var a,r=e.getService("dom"),s=t.get("Canvas");n&&("remove-tag-btn"===o?(a=r.getData(n,"tag-name"),s.tag_collection.remove(a)):"remove-all-tags-btn"===o&&s.tag_collection.remove(),i.preventDefault(),i.stopPropagation())},renderTagFilters:function(){var t,n,o,a,r,s,l=e.getService("nav-state"),c=l.get();for(a=i.find(".inline_list").empty(),o=$("<li />").html("<strong />").text($t("Filter by","filter_by")),o.appendTo(a),s=c.id.split(","),t=0,n=s.length;n>t;t++)r=this.renderTagFilterBadge(s[t],"remove-tag-btn"),r.appendTo(a);a.show()},renderTagFilterBadge:function(e,t){var i=$('<span class="badge filter mhs" />').text(e);return $('<a href="#" />').addClass("mls img_ext sprite_16x16_x_white").attr("data-tag-name",e).attr("data-type",t).appendTo(i).show(),i}}}),Box.Timing.execution.push({name:"js/modules/main/subheader-breadcrumb.js",time:(new Date).getTime()}),Box.Application.addModule("subheader-breadcrumb",function(e){"use strict";function t(e,t,i){$(e).show().position({my:"left top",at:i,of:t})}function i(t,i){var n=t?t.substr(2):0;if(n===r)e.getService("nav").redirect("/trash");else{var o=e.getService("nav-url"),a=o.getFolderUrl(n,0,i);e.getService("navigation").navigate(a)}}var n,o,a,r="1";return{messages:["x-folderchangeafter"],init:function(){n=e.getService("v5"),o=e.getService("dom"),a=n.get("Canvas")},destroy:function(){n=null,o=null,a=null},onclick:function(i,n,a){if(n&&!o.hasClass(n,"disabled")){switch(a){case"jump-to-folder-link":this.showJumpToFolderMenu(n);break;case"path-link":e.getService("navigation").navigate($(n).attr("href"));break;case"breadcrumb-ellipses-btn":t("#breadcrumb_ellipses_menu",n,"left+12 bottom")}i.preventDefault(),i.stopPropagation()}},onmessage:function(e,t){switch(e){case"x-folderchangeafter":t.json&&t.json.path_html&&this.setPathHTML(t.json.path_html)}},setPathHTML:function(t){var i=e.getService("nav-state");i.isSearch()||o.setHTML(o.query("#main_path"),t)},showJumpToFolderMenu:function(e){var t,o,r=n.get("root_folder_id");o=a.current_folder&&a.current_folder.typed_id?a.current_folder.typed_id:r,t=n.get("Box_Menus").folder_picker_menu,t.show({target:e,opened_item_id:o,callback:i})}}}),Box.Timing.execution.push({name:"js/modules/main/actionbar-files.js",time:(new Date).getTime()}),Box.Application.addModule("actionbar-files",function(e){"use strict";function t(e){var t,i,n=e.length;for(t=0;n>t;t++)i=e[t],s.removeClass(i,"disabled")}function i(e){var t,i,n=e.length;for(t=0;n>t;t++)i=e[t],s.addClass(i,"disabled")}function n(e,t){e&&(e.setAttribute("data-tooltip",""),e.setAttribute("aria-label",t))}function o(e){e&&(e.removeAttribute("data-tooltip"),e.removeAttribute("aria-label"))}function a(e){var t=e.permissions;return t.preview&&t.upload&&t.download&&t.share||e.is_root_folder()}var r,s,l,c,_,d,u,p,h,m,f,g,v,b=$t("You do not have permission to create new items in this folder","files_page_new_items_button_disabled_tip"),w=$t("You do not have permission to create new Box Note in this folder","files_page_new_box_note_button_disabled_tip"),y=$t("You do not have permission to upload to this folder","files_page_upload_button_disabled_tip"),x=$t("Write a quick note","actionbar_write_a_box_note_button"),S="search",k="tags",T="trash",j=[{key:"b",handler:function(){m.open("new_web_link",{data:{folder_id:l.current_folder.id}})}},{key:"n",handler:function(e){l.current_folder.new_folder(),e.preventDefault()}}];return{behaviors:["upload-menu","create-box-note","tooltips-amsterdam"],messages:["x-folderchangeafter","x-newversionupload"],init:function(){r=e.getService("v5"),s=e.getService("dom"),l=r.get("Canvas"),c=e.getService("hotkeys"),_=e.getElement(),d=r.get("Features"),u=r.get("Box_Menus"),p=$(_),h=e.getService("notifications"),m=e.getService("popups"),f=e.getService("nav-state"),g=e.getService("actionbar"),v=e.getService("openbox-service-actions"),v.init(),f.isEmbedWidget()||c.setConfig(j,"files",!0)},destroy:function(){v=null},onclick:function(e,t,i){if(t&&!s.hasClass(t,"disabled")){var n=l.current_folder;switch(i){case"create-item-menu-btn":var o=u.create_item_menu;o&&o.visible?o.hide():o&&o.show({target:t}),this.loadDeferredImages();break;case"folder-options-btn":var a=u.menu;a&&a.visible&&a.item==n?a.hide():n&&n.show_menu({target:t,type:"containing_folder",displayedByMoreButton:!0});break;default:return}e.preventDefault(),e.stopPropagation()}},onmessage:function(e,t){switch(e){case"x-folderchangeafter":f.isSearch()?g.switchActionbar(S):f.isTrash()?g.switchActionbar(T):f.isTag()&&g.switchActionbar(k),this.updateButtons();break;case"x-newversionupload":this.updateButtons()}},updateButtons:function(){var e=l.current_folder,r=s.query("#create_item_button",_),c=s.query("#new_box_note_button",_),d=s.query("#upload_button",_),u=s.query("#folder_options_button",_);if(f.isRootFolder()?s.addClass(u,"hidden"):s.removeClass(u,"hidden"),e&&e.permissions&&e.permissions.upload){if(t([r,d]),o(r),o(d),a(e)?(t([c]),n(c,x)):(i([c]),n(c,w)),e.free_space_amount<=0){var p=e.user_is_owner?$t("You cannot upload because your account is out of space","js_upload_disable_out_of_space"):$t("You cannot upload because the owner of this folder is out of space","js_upload_disable_owner_out_of_space");i([d]),n(d,p)}}else i([r,d,c]),n(d,y),n(r,b),n(c,b)},loadDeferredImages:function(){var t=e.getService("imageloader");t.loadImages(s.query("#actionbar-multiple-selection"))}}}),Box.Timing.execution.push({name:"js/modules/main/actionbar-search.js",time:(new Date).getTime()}),Box.Application.addModule("actionbar-search",function(e){"use strict";var t,i,n,o="files",a="trash",r="tags";return{messages:["x-searchbefore","x-searchafter","x-folderchangeafter"],init:function(){t=e.getService("dom"),i=e.getService("templates"),n=e.getService("actionbar")},destroy:function(){t=null,i=null,n=null},onmessage:function(t,i){var s=e.getService("nav-state");switch(t){case"x-searchbefore":i.isPreloaded||(s.isMovingIntoSearch()&&(this.hideActionbar(),this.hideViewOptions()),this.showSearchPlaceholders());break;case"x-searchafter":this.showViewOptions();break;case"x-folderchangeafter":s.isTrash()?n.switchActionbar(a):s.isFiles()?n.switchActionbar(o):s.isSearch()?this.setSearchTitle(i.json.path_html):s.isTag()&&n.switchActionbar(r)}},hideActionbar:function(){n.switchActionbar("none")},showViewOptions:function(){var e=t.query(".view_options");t.removeClass(e,"hidden")},hideViewOptions:function(){var e=t.query(".view_options");t.addClass(e,"hidden")},showSearchPlaceholders:function(){var e=i.getTemplateFragment("search-page-title-placeholder");$(t.query("#main_path")).html(e).show()},setSearchTitle:function(e){$(t.query("#main_path")).html(e).show()}}}),Box.Timing.execution.push({name:"js/modules/main/actionbar-trash.js",time:(new Date).getTime()}),Box.Application.addModule("actionbar-trash",function(e){"use strict";var t,i,n,o,a,r="files",s="search",l="tags",c=$t("There are no items in the trash to delete.","actionbar_trash_button_nothing_to_delete_tooltip"),_=$t("There are no items in the trash to restore.","actionbar_trash_button_nothing_to_restore_tooltip"),d=$t("You do not have permission to delete these items.","actionbar_trash_button_no_delete_permission_tooltip"),u=$t("Restore all the items in the trash","actionbar_trash_button_restore_all_tooltip"),p=$t("Delete all the items in the trash","actionbar_trash_button_delete_all_tooltip");return{messages:["x-folderchangeafter"],init:function(){t=e.getService("v5"),i=e.getService("dom"),n=t.get("Canvas"),o=e.getElement(),a=e.getService("actionbar")},destroy:function(){t=null,i=null,n=null,o=null,a=null},onclick:function(e,t,o){if(t&&!i.hasClass(t,"disabled")){switch(o){case"trash-restore":n.current_folder.restore();break;case"trash-delete":n.current_folder.delete_from_trash();break;default:return}e.preventDefault(),e.stopPropagation()}},onmessage:function(t,i){var n=e.getService("nav-state");switch(t){case"x-folderchangeafter":n.isSearch()?a.switchActionbar(s):n.isTag()?a.switchActionbar(l):n.isTrash()||a.switchActionbar(r),this.updateButtons()}},updateButtons:function(){var t=e.getService("nav-state");if(t.isTrash()){var a=i.query("#delete_button",o),r=i.query("#restore_button",o),s=n.collections[n.collections.length-1];0===s.size()?(a.setAttribute("data-hover","tooltip"),a.setAttribute("aria-label",c),r.setAttribute("data-hover","tooltip"),r.setAttribute("aria-label",_),i.addClass(a,"disabled"),i.addClass(r,"disabled")):s.can_delete_from_trash()?(a.setAttribute("data-hover","tooltip"),a.setAttribute("aria-label",p),r.setAttribute("data-hover","tooltip"),r.setAttribute("aria-label",u),i.removeClass(a,"disabled"),i.removeClass(r,"disabled")):(a.setAttribute("data-hover","tooltip"),a.setAttribute("aria-label",d),r.setAttribute("data-hover","tooltip"),r.setAttribute("aria-label",u),i.addClass(a,"disabled"),i.removeClass(r,"disabled"))}}}}),Box.Timing.execution.push({name:"js/modules/main/view-options.js",time:(new Date).getTime()}),Box.Application.addModule("view-options",function(e){"use strict";function t(){var e=s.querySelector(".select_all");r.removeClass(e,"disabled")}function i(){var e=s.querySelector(".select_all");r.addClass(e,"disabled")}function n(e,n){var o=e&&e.length>0,a=n&&n.length>0,r=!o&&!a;r?i():t()}function o(){var e=s.querySelector("#tags_button"),t=r.getNearest(e,".actionbar_button_wrapper");r.removeClass(t,"hidden")}var a,r,s,l,c,_,d=[{key:"[",handler:function(){var e,t=a.get("Canvas"),i=s.querySelector("#paging_prev_link");i&&(e=i.getAttribute("data-page_num"),t.update_page(e))}},{key:"]",handler:function(){var e,t=a.get("Canvas"),i=s.querySelector("#paging_next_link");i&&(e=i.getAttribute("data-page_num"),t.update_page(e))}}];return e.getGlobalConfig().shouldHideIconView||d.push({key:"Shift+v",handler:function(){var e=a.get("Canvas");e.change_view()}}),{messages:["x-folderchangeafter","x-newversionupload"],behaviors:["pagination","toggle-item-list-selection","view-options-menu","tooltips-amsterdam"],init:function(){a=e.getService("v5"),r=e.getService("dom"),l=e.getService("nav-state"),_=e.getService("hotkeys"),c=a.get("Box_Menus"),s=e.getElement(),_.setConfig(d,"files",!0)},onclick:function(e,t,i){if(t&&!r.hasClass(t,"disabled")){switch(i){case"tags-menu-btn":var n=c.tags_menu;n&&n.visible?n.hide():n.show({target:t});break;default:return}e.preventDefault(),e.stopPropagation()}},onmessage:function(e,i){switch(e){case"x-folderchangeafter":n(i.json.nodes,i.json.items),o();break;case"x-newversionupload":t()}}}}),Box.Timing.execution.push({name:"js/modules/download-apps.js",time:(new Date).getTime()}),Box.Application.addModule("download-apps",function(e){"use strict";function t(e,t){n.sendLog("sidebar_buttons",e,t)}var i,n,o,a;return{onclick:function(e,i,n){switch(n){case"sync-button":t("sync_download_cta_button_clicked"),this.downloadSyncAndShowPopup();break;case"mobile-button":t("mobile_download_cta_button_clicked"),this.showMobilePopup()}e.preventDefault(),e.stopPropagation()},init:function(){i=e.getService("browser"),n=e.getService("logger"),o=e.getService("popups"),a=e.getService("v5")},downloadSyncAndShowPopup:function(){var n=e.getService("download"),o=a.get("sync4_download_url_base"),r=i.getOSName(),s="Mac"===r;o+=a.get(s?"sync4_download_filename_mac":"sync4_download_filename_win"),n.downloadViaGet(o),this.showSyncPopup(),t("download_sync",{os_name:r})},showSyncPopup:function(){o.open("download_sync"),t("show_sync_popup")},showMobilePopup:function(){o.open("download_mobile_app"),t("show_mobile_popup")}}}),Box.Timing.execution.push({name:"js/modules/common/notifications.js",time:(new Date).getTime()}),Box.Application.addModule("notifications",function(e){"use strict";var t,i,n,o;return{messages:["x-folderchangeafter"],init:function(){t=e.getService("v5"),i=e.getService("dom"),n=$(e.getElement()),o=e.getService("notifications"),o.displayServerNotification()},onmessage:function(e,t){"x-folderchangeafter"===e&&this.handleFolderChangeAfter(t.json)},handleFolderChangeAfter:function(e){e.is_from_instant_login&&o.confirm($t("Results owned by external collaborators have been omitted.","external_collab_content_omitted"))}}}),Box.Timing.execution.push({name:"js/modules/common/legacy-confirmations.js",time:(new Date).getTime()}),Box.Application.addModule("legacy-confirmations",function(e){"use strict";var t,i,n="/index.php?rm=box_services_accept_app_folder",o="/index.php?rm=box_services_reject_app_folder";return{messages:[],init:function(){t=e.getService("dom"),i=e.getService("notifications")},onclick:function(e,i,n){var o,a,r,s;if(i){switch(n){case"accept-app-invite-link":r=$(t.getNearest(i,"form")),s=t.getNearest(i,".app_folder_invite_row"),o=r.find('[name="service_id"]').val(),this.acceptAppFolderInvite(o,s);break;case"reject-app-invite-link":r=$(t.getNearest(i,"form")),s=t.getNearest(i,".app_folder_invite_row"),o=r.find('[name="service_id"]').val(),a=r.find('[name="service_name"]').val(),this.rejectAppFolderInvite(o,a,s)}e.preventDefault(),e.stopPropagation()}},acceptAppFolderInvite:function(e,t){$.postJSON(n,{service_id:e},function(e){"success"===e.result&&$(t).find(".app_folder_invite_actions").html(e.html)})},rejectAppFolderInvite:function(e,t,n){$.popup.confirm($t("Revoke app access to Box","revoke_app_access_to_box_title"),$t("After revoking access, %1 will no longer have access to your Box account. Are you sure you want to continue?","revoke_app_access_confirmation_message",t),{okay_button:$t("Revoke access","revoke_app_access_button")},function(t){t&&$.postJSON(o,{service_id:e},function(e){if("success"===e.result){var t=$(n).parent();$(n).remove(),t.find(".app_folder_invite_row").length||i.hide()}})})}}}),Box.Timing.execution.push({name:"js/modules/common/page.js",time:(new Date).getTime()}),Box.Application.addModule("page",function(e){"use strict";return{init:function(){}}}),Box.Timing.execution.push({name:"js/modules/sidebar/favorites.js",time:(new Date).getTime()}),Box.Application.addModule("favorites",function(e){"use strict";function t(e){c.showLoadingForSidebarFavoritesModule(),l.remove(e,!0)}var i,n,o,a,r,s,l,c,_,d=($t("There was an error removing your item from favorites.","remove_item_from_favorites_error"),"?single=1");return{behaviors:["tooltips-amsterdam"],messages:["favoritestarted","favoritesuccess","favoriteerror","unfavoritestarted","unfavoritesuccess","unfavoriteerror"],init:function(){i=e.getService("v5"),n=e.getService("dom"),o=e.getService("url"),a=e.getService("resin"),r=e.getService("nav-state"),s=e.getService("tooltips-amsterdam"),l=e.getService("fileop-favorites"),c=i.get("Box_Sidebar_View"),_=e.getService("notifications")},onclick:function(i,r,l){var c,_,u,p,h;switch(l&&s.hideAll(),l){case"item":_=n.query(".item-link",r),u=_.getAttribute("href"),p=r.getAttribute("data-typed-id"),h="true"===r.getAttribute("data-new-tab"),"f"===p.charAt(0)&&(u+=d),h?o.openWindow(u):e.getService("navigation").navigate(u),i.preventDefault();break;case"link":a.recordAction({application:"files",page:"explorer",component:"sidebar",feature:"favorites",target:"navigatetopage",action:"click"});break;case"unfavorite-btn":c=n.getNearest(r,".sidebar-item"),p=c.getAttribute("data-typed-id"),t(p)}},onmessage:function(e){if(r.isRootFolder())switch(e){case"favoritestarted":case"unfavoritestarted":c.showLoadingForSidebarFavoritesModule();break;case"favoritesuccess":case"unfavoritesuccess":c.getAndShowSidebarFavoritesModule();break;case"favoriteerror":case"unfavoriterror":c.hideLoadingForSidebarFavoritesModule()}},oncontextmenu:function(e,t,i){"item"===i&&(e.preventDefault(),e.stopPropagation())}}}),Box.Timing.execution.push({name:"js/modules/common/embed-warning-prompt.js",time:(new Date).getTime()}),Box.Application.addModule("embed-warning-prompt",function(e){"use strict";var t=$t("We're sorry, but access to Box from this page will expire on April 30, 2014. Please contact the site admin or update the embedded Box view to continue accessing Box from this page. For more information, go %1here%2.","js_popup_iframe_warning",'<a target="_blank" href="https://support.box.com/hc/en-us/articles/201992828">',"</a>"),i=$t("Warning","js_popup_iframe_warning_title"),n=!1,o=!1;return{messages:["previewloaded"],onmessage:function(e,t){if("previewloaded"===e){if(o||!this.isInIframe())return;this.showWarningPrompt(),o=!0}},init:function(){if(!n&&this.isInIframe()){
var t=e.getService("nav-state");t&&t.isGallery||this.showWarningPrompt()}},showWarningPrompt:function(){var e=[{type:"html",data:[$("<p />").html(t)]},{type:"buttons",items:[{value:$t("Okay","popup_okay"),click:function(e){$.popup.close()}}]}];$.popup.form(i,e,{favicon_class:"sprite_24x24_master_settings",required:!0}),n=!0},isInIframe:function(){try{return window.self!==window.top}catch(e){return!0}}}}),Box.Timing.execution.push({name:"js/modules/menus/breadcrumb-ellipses-menu.js",time:(new Date).getTime()}),Box.Application.addModule("breadcrumb-ellipses-menu",function(e){"use strict";var t,i,n,o,a;return{messages:["x-folderchangeafter"],init:function(){t=e.getService("v5"),i=e.getService("dom"),n=$("#breadcrumb_ellipses_menu"),o=n[0],n.menu(),this.setupHoverBehavior()},destroy:function(){n.menu("destroy"),t=null,i=null,n=null,o=null,a=null},onclick:function(t,i,o){if(i){switch(o){case"path-link":e.getService("navigation").navigate(i.href),window.setTimeout(function(){n.hide()},500)}t.preventDefault(),t.stopPropagation()}},onmessage:function(e,t){switch(e){case"x-folderchangeafter":var i=t.json.sub_path_html,n=t.json.is_scrollable_ellipses_menu;i&&this.updateMenuItems(i,n)}},setupHoverBehavior:function(){var e=$("#breadcrumb_ellipses_menu, .breadcrumb_item_link");e.mouseleave(function(){a=window.setTimeout(function(){n.hide()},100)}),e.mouseenter(function(){a&&window.clearInterval(a)})},updateMenuItems:function(e,t){n.menu("destroy"),n.empty().append(e),t?(i.addClass(n,"scrollable"),n.css("height","350px"),n.css("max-width","400px")):(i.removeClass(n,"scrollable"),n.css("height","auto")),n.menu().hide()}}}),Box.Timing.execution.push({name:"js/modules/contentworkflow/automation-info-message.js",time:(new Date).getTime()}),Box.Application.addModule("automation-info-message",function(e){"use strict";var t;return{element:null,automationDetails:null,automationShowDetails:null,automationHideDetails:null,init:function(){t=e.getService("dom"),this.element=e.getElement(),this.automationDetails=t.query(".details",this.element),this.automationShowDetails=t.query(".show-details",this.element),this.automationHideDetails=t.query(".hide-details",this.element)},onclick:function(e,t,i){if(t)switch(i){case"show-details":return void this.expandAutomations();case"hide-details":return void this.hideAutomations()}},hideAutomations:function(){t.addClass(this.automationDetails,"hidden"),t.addClass(this.automationHideDetails,"hidden"),t.removeClass(this.automationShowDetails,"hidden")},expandAutomations:function(){t.removeClass(this.automationDetails,"hidden"),t.removeClass(this.automationHideDetails,"hidden"),t.addClass(this.automationShowDetails,"hidden")}}}),Box.Timing.execution.push({name:"js/box_base.js",time:(new Date).getTime()});var Box_Base=Base.extend({constructor:function(e){this.set_params(e)},set_params:function(e){e=e||{};for(var t in e)this[t]=e[t];return this}},{});Box.Timing.execution.push({name:"js/filters/box_abstract_filter.js",time:(new Date).getTime()});var Box_Abstract_Filter=Box_Base.extend({_query:null,_filtered_options:{},_load_all_results:{},_on_complete_callback:null,_load_all_completed:!1,constructor:function(e){this._filtered_options={},this._load_all_results={},this.base(e)},set_on_complete_callback:function(e){this._on_complete_callback=e},run:function(e){if(this._filtered_options[e])this._complete_filter(e,this._filtered_options[e]);else{if(!$.isFunction(this._filter_callback))return;this._filter_callback(e)}},load_all:function(){this._load_all_completed?this._complete_load_all(this._load_all_results):this._load_all_callback()},_complete_load_all:function(e){this._load_all_completed||(this._load_all_completed=!0,this._load_all_results=e),$.isFunction(this._on_complete_callback)&&this._on_complete_callback("",e),this._query=""},_complete_filter:function(e,t){this._cache_filtered_results(e,t),$.isFunction(this._on_complete_callback)&&this._on_complete_callback(e,t),this._query=e},_cache_filtered_results:function(e,t){this._filtered_options[e]={};for(var i in t)this._filtered_options[e][i]=t[i]},_filter_callback:function(e){},_load_all_callback:function(){}},{});Box.Timing.execution.push({name:"js/filters/box_abstract_contact_filter.js",time:(new Date).getTime()});var Box_Abstract_Contact_Filter=Box_Abstract_Filter.extend({folder_typed_id:null,item_typed_id:null,filter_request:null,constructor:function(e){this.base(e)},run:function(e){this._clear_filter_request(),this.base(e)},_load_all_callback:function(){var e=this;this._get_contacts("",function(t,i){e._complete_load_all(i)})},_filter_callback:function(e){if(e!==!1){var t=this;this._get_contacts(e,function(e,i){t._complete_filter(e,i)})}},_clear_filter_request:function(){this.filter_request&&clearTimeout(this.filter_request)},_get_contacts:function(e,t){this.filter_request&&clearTimeout(this.filter_request);var i=Box_Abstract_Contact_Filter.REQUEST_MAX_DELAY-(e.length-1)*Box_Abstract_Contact_Filter.REQUEST_DELAY_BACKOFF;i=Math.max(Box_Abstract_Contact_Filter.REQUEST_MIN_DELAY,i);var n=this,o=this._create_params_callback(e);this.filter_request=setTimeout(function(){$j.getJSON("/index.php?rm="+n.rm,o,function(i){var o=n._process_results_callback(i);t(e,o)})},i)}},{REQUEST_MAX_DELAY:1e3,REQUEST_MIN_DELAY:250,REQUEST_DELAY_BACKOFF:250});Box.Timing.execution.push({name:"js/filters/box_item_contact_filter.js",time:(new Date).getTime()});var Box_Item_Contact_Filter=Box_Abstract_Contact_Filter.extend({item_typed_id:null,include_pending_collabs:!1,rm:"box_contacts_get_for_item",constructor:function(e){this.base(e)},_create_params_callback:function(e){var t={search_string:e,item_typed_id:this.item_typed_id,include_pending_collabs:this.include_pending_collabs?1:0,include_self:this.include_self?1:0};return t},_process_results_callback:function(e){var t=e.contacts,i=e.is_uploader,n=this._process_results_list(t,"id","contact_name","email",i,!0),o=this._process_results_list(e.pending_collabs,"email","email","email");return $.extend(n,o)},_process_results_list:function(e,t,i,n,o,a){var r={};if(e)for(var s=0,l=e.length;l>s;s++){var c=e[s];if(c[t]){var _=c[t],d=o&&o[_],u=c.is_edit_disabled_in_enterprise;r[_]={name:c[i],email:c[n],is_uploader:d,is_edit_disabled_in_enterprise:u,not_selectable:a&&(u||d)}}}return r}},{});Box.Timing.execution.push({name:"js/filters/box_all_contact_filter.js",time:(new Date).getTime()});var Box_All_Contact_Filter=Box_Abstract_Contact_Filter.extend({rm:"box_contacts_get",item_typed_id:null,include_self:!1,include_collabs_without_account:!0,include_groups:!1,constructor:function(e){var t=Box.Application.getService("url");this.rm=t.getGcmCompatibleRm("box_contacts_get"),this.include_groups=e.include_groups,this.include_collabs_without_account=e.include_collabs_without_account,this.base(e)},_create_params_callback:function(e){return{search_string:e,item_typed_id:this.item_typed_id,include_self:this.include_self?1:0,include_groups:this.include_groups?1:0,include_collabs_without_account:this.include_collabs_without_account?1:0}},_process_results_callback:function(e){var t,i,n={},o=e.contacts,a=null;for(t=0,i=o.length;i>t;t++)a=o[t],n[a.id]={name:a.contact_name,email:a.email,contact_id:a.id,type:"user"};if(this.include_collabs_without_account!==!1){for(o=e.collabs_without_account,t=0,i=o.length;i>t;t++)a=o[t],n[a.email]={name:a.email,email:a.email,contact_id:a.email,type:"collab_without_account"};for(o=e.friends_without_account,t=0,i=o.length;i>t;t++)a=o[t],n[a.email]={name:a.contact_name,email:a.email,contact_id:a.email,type:"friend_without_account"}}if(e.hasOwnProperty("groups"))for(o=e.groups,t=0,i=o.length;i>t;t++)a=o[t],n[a.contact_name]={name:a.contact_name,email:"",contact_id:a.id,type:"group"};return n}},{});Box.Timing.execution.push({name:"js/filters/box_folder_tree_search_filter.js",time:(new Date).getTime()});var Box_Folder_Tree_Search_Filter=Box_Abstract_Filter.extend({constructor:function(e){this.base(e)},load_all:function(){},_filter_callback:function(e){var t=this,i="/index.php?rm=box_quick_search",n=$j.box.formatQuery({search_string:e,folder_tree_search:!0,search_type:"folder",sort:"relevance"});$j.getJSON(i,n,function(i){t._complete_filter(e,i.items)})}},{});Box.Timing.execution.push({name:"js/selectors/box_abstract_selector.js",time:(new Date).getTime()});var Box_Abstract_Selector=Box_Base.extend({_j_component:null,_j_container:null,_filter:null,_dropdown:null,_state_machine:{},_mouse_state_machine:{},create_container:!1,dropdown_toggler_sprite:"sprite_16x16_contacts",show_dropdown_toggler:!0,placeholder_text:"",placeholder_offset:{},allow_empty_query:!1,on_first_focus_callback:null,use_commas_to_select:!0,_first_focus:!1,z_index:2,constructor:function(e,t,i){i=i||{};var n=this;this.base(i),"z_index"in i&&(this.z_index=i.z_index),this._init_state_machine(),this._options={},$.isFunction(this._init_callback)&&this._init_callback(),this._filter=e,this._dropdown=t,this._filter.set_on_complete_callback(function(e,t){n._complete_filter(e,t)}),this._dropdown.set_on_select_callback(function(e){n._state_machine.dispatch(Box_Abstract_Selector.EVENTS.MOUSE_SELECT,e),n._j_input.trigger("change")}),this._create_ui_components(i)},_init_state_machine:function(){var e=this,t=Box_Abstract_Selector.STATES,i=Box_Abstract_Selector.EVENTS;this._state_machine=new Box_State_Machine(t.IDLE),this._state_machine.add_state({id:t.IDLE,transitions:{FOCUS:t.TYPING,KEYUP:t.TYPING,TOGGLE_DROPDOWN:t.DROPDOWN_LOCKED,MOUSE_SELECT:t.DROPDOWN_LOCKED},callbacks:{ON_ENTER:function(){e._hide_dropdown(!0)}}}),this._state_machine.add_state({id:t.DROPDOWN_LOCKED,transitions:{FOCUS:t.TYPING,MOUSE_SELECT:this.show_dropdown_toggler?t.IDLE:t.DROPDOWN_LOCKED,TOGGLE_DROPDOWN:t.IDLE},callbacks:{ON_ENTER:function(){e._load_all()}}}),this._state_machine.add_state({id:t.TYPING,transitions:{DOWN:t.SELECTING,UP:t.SELECTING,KEYUP:t.TYPING,BLUR:t.IDLE,MOUSE_SELECT:t.TYPING,TOGGLE_DROPDOWN:t.DROPDOWN_LOCKED,KEY_SELECT:t.TYPING,TEXT_SELECT:t.TYPING},callbacks:{ON_ENTER:function(){e._j_input.trigger("focus",{triggered:!0}),e._dropdown.reset_highlight_index(),e._search()}}}),this._state_machine.add_state({id:t.SELECTING,transitions:{DOWN:t.SELECTING,UP:t.SELECTING,KEYUP:t.TYPING,BLUR:t.IDLE,MOUSE_SELECT:t.TYPING,KEY_SELECT:t.TYPING}}),this._state_machine.on_transition(i.DOWN,function(){e._dropdown.highlight_next_option(!0)}),this._state_machine.on_transition(i.UP,function(){e._dropdown.highlight_previous_option(!0)}),this._state_machine.on_transition(i.MOUSE_SELECT,function(t,i){e._on_select_callback(t,i)}),this._state_machine.on_transition(i.KEY_SELECT,function(t){e._select_by_index(t)}),this._state_machine.on_transition(i.TEXT_SELECT,function(t){e._select_by_text(t)}),this._mouse_state_machine=new Box_State_Machine(t.MOUSEOUT),this._mouse_state_machine.add_state({id:t.MOUSEOUT,transitions:{MOUSEOVER:t.MOUSEOVER}}),this._mouse_state_machine.add_state({id:t.MOUSEOVER,transitions:{MOUSEOUT:t.MOUSEOUT}})},_create_ui_components:function(e){var t=this;this._j_component=e.j_component?e.j_component:$j("#"+e.component_id),this._j_input=e.j_input?e.j_input:$j('<input type="text" />'),this._j_component.hide().addClass("option_selector").css({position:"relative","z-index":this.z_index}).on("mouseover",function(e){t._event_mouseover(e)}).on("mouseleave",function(e){t._event_mouseout(e)}),this._j_input.attr({autocomplete:"off"}).addClass("input_filter_transparent").on("keyup",function(e,i){return t._event_keyup(e,i)}).on("keydown",function(e){return t._event_keydown(e)}).on("keypress",function(e){return t._event_keypress(e)}).on("blur",function(e){t._event_blur(e)}).on("focus",function(e,i){t.on_first_focus_callback&&!t._first_focus&&(t.on_first_focus_callback(),t._first_focus=!0),t._event_focus(e,i&&i.triggered)});var i=this._j_component;if(Canvas.get().register_body_click_handler(this),(this.create_container||this.show_dropdown_toggler)&&(this._j_container=$j('<div class="input full_width_input selector_input_box"/>').on("click",function(e){return t._event_click(e),!1}),this._j_container.appendTo(this._j_component),i=this._j_container),this.show_dropdown_toggler&&$('<a id="dropdown_toggler" class="dropdown_toggler_icon img_ext" href="#" />').addClass(this.dropdown_toggler_sprite).prependTo(this._j_container).click(function(e){t._event_toggle_dropdown(),t._j_input.focus()}),this._j_input.appendTo(i),this._dropdown.get_ui_component().appendTo(this._j_component),this.ui_elements_to_append)for(var n=this.ui_elements_to_append,o=0,a=n.length;a>o;o++)this._j_component.append(n[o]);this._j_component.show()},body_click_handler:function(e){this.clear_input_on_hide_dropdown&&this._clear_input(),this._hide_dropdown()},_add_placeholder_text:function(){this.placeholder_text?this._j_input.attr("placeholder",this.placeholder_text):this.placeholder_text=this._j_input.attr("placeholder");var e,t,i,n,o;this.placeholder_offset&&(e=this.placeholder_offset.top_IE||4,t=this.placeholder_offset.left_IE||0,i=this.placeholder_offset.top||0,n=this.placeholder_offset.left||0,o=this.placeholder_offset.force_block||!1),this._j_input.placeholderize({extraMarginTopIE:e,extraMarginLeftIE:t,extraMarginTop:i,extraMarginLeft:n,forceBlock:o})},_event_focus:function(e,t){if(!t){var i=Box_Abstract_Selector.STATES,n=this._state_machine.is_in_state(i.TYPING)||this._state_machine.is_in_state(i.SELECTING);n&&this._dropdown._j_dropdown.is(":visible")?this._hide_dropdown():(this._show_dropdown(),this._state_machine.dispatch(Box_Abstract_Selector.EVENTS.FOCUS))}},_event_click:function(e){return"dropdown_toggler"==e.target.id||$j(e.target).hasClass("delete_badge")||this._j_input.focus(),!1},_event_keyup:function(e){var t=Box_Abstract_Selector.EVENTS,i=Box_Abstract_Selector.STATES;if(e.keyCode==Box_Abstract_Selector.KEY.ESCAPE)return!1;var n=this._state_machine.is_in_state(i.TYPING)||this._state_machine.is_in_state(i.SELECTING);return(e.keyCode!=Box_Abstract_Selector.KEY.DOWN&&e.keyCode!=Box_Abstract_Selector.KEY.UP&&e.keyCode!=Box_Abstract_Selector.KEY.BACKSPACE||e.keyCode==Box_Abstract_Selector.KEY.BACKSPACE&&n)&&this._state_machine.dispatch(t.KEYUP),!0},_event_keydown:function(e){var t=!1;if(e.keyCode==Box_Abstract_Selector.KEY.DOWN||e.keyCode==Box_Abstract_Selector.KEY.UP){if(t=this._dropdown._j_dropdown.is(":visible")){var i=e.keyCode==Box_Abstract_Selector.KEY.DOWN?Box_Abstract_Selector.EVENTS.DOWN:Box_Abstract_Selector.EVENTS.UP;return this._state_machine.dispatch(i),!1}}else{if(e.keyCode==Box_Abstract_Selector.KEY.ESCAPE)return this._hide_dropdown(),!1;if(e.keyCode==Box_Abstract_Selector.KEY.BACKSPACE&&this._query_is_empty()&&this._dropdown._j_dropdown.is(":visible"))this._state_machine.dispatch(Box_Abstract_Selector.EVENTS.KEYUP);else if(this._can_autocomplete_with_tab_or_enter_key(e)){var n=this._dropdown.get_highlighted_option_index();return null!=n?this._state_machine.dispatch(Box_Abstract_Selector.EVENTS.KEY_SELECT,n):this._state_machine.dispatch(Box_Abstract_Selector.EVENTS.TEXT_SELECT,$j.trim(this._query())),!1}}return!0},_event_keypress:function(e){var t=e.charCode||e.keyCode;return this.use_commas_to_select&&t==Box_Abstract_Selector.CHARCODE.COMMA?(this._state_machine.dispatch(Box_Abstract_Selector.EVENTS.TEXT_SELECT,$j.trim(this._query())),!1):!0},_can_autocomplete_with_tab_or_enter_key:function(e){var t=e.keyCode==Box_Abstract_Selector.KEY.TAB||e.keyCode==Box_Abstract_Selector.KEY.ENTER,i=this._dropdown._j_dropdown.is(":visible"),n=this._query_is_valid()&&!this.ignore_tab_and_enter_keys_for_valid_query;return t&&(i||n)},_event_mouseout:function(e){$j(e.relatedTarget).parents().hasClass("option_selector")||this._mouse_state_machine.dispatch(Box_Abstract_Selector.EVENTS.MOUSEOUT)},_event_mouseover:function(e){this._mouse_state_machine.dispatch(Box_Abstract_Selector.EVENTS.MOUSEOVER)},_event_blur:function(e){this._mouse_state_machine.is_in_state(Box_Abstract_Selector.STATES.MOUSEOUT)&&this._state_machine.dispatch(Box_Abstract_Selector.EVENTS.BLUR)},_event_toggle_dropdown:function(){this._j_component.attr("disabled")||this._state_machine.dispatch(Box_Abstract_Selector.EVENTS.TOGGLE_DROPDOWN)},_search:function(){this._filter_options(this._query())},_complete_filter:function(e,t,i){if(this._state_machine.is_in_state(Box_Abstract_Selector.STATES.DROPDOWN_LOCKED)||this._query()==e){var n=(this.show_dropdown_toggler||this.allow_empty_query)&&""==e?!1:this._filter._query==e;this._dropdown.highlight_and_populate(e,t,n,i),this._position_dropdown()}},_filter_options:function(e){this._query_is_valid()?this._filter.run(e):this._hide_dropdown()},_load_all:function(){this._filter.load_all()},_position_dropdown:function(){var e=this._j_container?this._j_container:this._j_input;this._dropdown.position(e.outerHeight(),e.outerWidth())},_query:function(){return $j.trim(this._j_input.val())},_query_is_empty:function(){return""==this._query()},_query_is_valid:function(){return this.allow_empty_query||!this._query_is_empty()},_clear_input:function(){this._j_input.val("")},_show_dropdown:function(){this._dropdown.show()},_hide_dropdown:function(){this._dropdown.hide()},_on_select_callback:function(e){},_select_by_text:function(e){},_load_all_options_callback:function(){}},{KEY:{BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,UP:38,DOWN:40},CHARCODE:{COMMA:44},STATES:{IDLE:"IDLE",TYPING:"TYPING",SELECTING:"SELECTING",MOUSEOUT:"MOUSEOUT",MOUSEOVER:"MOUSEOVER",DROPDOWN_LOCKED:"DROPDOWN_LOCKED"},EVENTS:{UP:"UP",DOWN:"DOWN",BLUR:"BLUR",FOCUS:"FOCUS",KEYUP:"KEYUP",MOUSEOVER:"MOUSEOVER",MOUSEOUT:"MOUSEOUT",MOUSE_SELECT:"MOUSE_SELECT",KEY_SELECT:"KEY_SELECT",TEXT_SELECT:"TEXT_SELECT",TOGGLE_DROPDOWN:"TOGGLE_DROPDOWN",NOOP:"NOOP"}});Box.Timing.execution.push({name:"js/selectors/box_option_selector.js",time:(new Date).getTime()});var Box_Option_Selector=Box_Abstract_Selector.extend({_options:{},_option_is_selected:{},_selection_count:0,allow_not_selectable_items:!1,allow_item_not_in_list:!0,_on_option_added:null,_on_option_removed:null,constructor:function(e,t,i){var n=i.default_selections;delete i.default_selections,this._options={},this._option_is_selected={},i.callbacks&&(this._on_option_added=i.callbacks._on_option_added||null,this._on_option_removed=i.callbacks._on_option_removed||null),this.base(e,t,i);for(var o in n)this._add_option(o,n[o]),this._on_select_callback(o)},_is_selected:function(e){return this._option_is_selected[e]},_select_by_index:function(e){var t=this._dropdown.get_key_from_index(e);t&&this._on_select_callback(t)},_select_by_text:function(e){if(e){var t=null;for(var i in this._options)if(this._option_is_match_callback&&this._option_is_match_callback(this._options[i],e)&&(t=[i],!this._option_is_selected[i]))break;if(!t&&this._add_option_from_text_callback&&this.allow_item_not_in_list){if(this._validate_text_callback&&!this._validate_text_callback(e))return!1;t=this._add_option_from_text_callback(e)}if(t)for(var n=0,o=t.length;o>n;n++){var a=t[n];a&&!this._option_is_selected[a]&&this._on_select_callback(a)}}},_create_unique_key:function(e){return e+jQuery.now()},_deselect:function(e){this._remove_from_selected_options(e),this._repopulate_dropdown(),this._position_dropdown()},_has_option_selected:function(){var e;for(e in this._option_is_selected)return!0;return!1},_add_to_selected_options:function(e){this._selection_count++,this._option_is_selected[e]=!0,this._on_option_added&&this._on_option_added(this._selection_count,e)},_remove_from_selected_options:function(e){this._selection_count--,delete this._option_is_selected[e],this._on_option_removed&&this._on_option_removed(this._selection_count)},_repopulate_dropdown:function(){var e={};for(var t in this._dropdown._available_options)this._option_is_selected[t]||(e[t]=this._dropdown._available_options[t]);this._dropdown._populate(e)},_get_selected_keys:function(){var e=[],t=this._option_is_selected;return $j.each(t,function(t,i){e.push(t)}),e},_complete_filter:function(e,t,i){var n={},o=!1;for(var a in t)this._add_option(a,t[a]),this._is_selected(a)||(n[a]=t[a],o=!0);o&&i&&i.hide_no_results&&(i.hide_no_results=!1),this.base(e,n,i)},_add_option:function(e,t){return this._options[e]=t,t},value:function(){return this._query()},get_full_selected_options:function(){var e={};for(var t in this._option_is_selected)e[t]=this._options[t];return e},_on_select_callback:function(e){if(!(this._is_selected(e)||this.allow_not_selectable_items&&this._options[e].not_selectable)){this._add_to_selected_options(e),this._dropdown.remove(e);var t=this;return window.setTimeout(function(){t._hide_dropdown()},0),$j.isFunction(this._filter._clear_filter_request)&&this._filter._clear_filter_request(),!0}return!1}},{});Box.Timing.execution.push({name:"js/selectors/box_badge_selector.js",time:(new Date).getTime()});var Box_Badge_Selector=Box_Option_Selector.extend({_j_badges:{},_badge_keys:[],_j_input_container:null,_j_input:null,constructor:function(e,t,i){this.reset_badges(),i.create_container=!0,this.base(e,t,i)},_init_state_machine:function(){var e=this;this.base();var t=Box_Abstract_Selector.STATES,i=Box_Badge_Selector.STATES,n=Box_Badge_Selector.EVENTS;this._state_machine.add_state({id:i.BACKSPACE_ONCE,transitions:{BACKSPACE:i.BACKSPACE_TWICE,KEYUP:t.TYPING,TOGGLE_DROPDOWN:t.DROPDOWN_LOCKED},callbacks:{ON_ENTER:function(){e._hide_dropdown()}}}),this._state_machine.add_state({id:i.BACKSPACE_TWICE,transitions:{BACKSPACE:i.BACKSPACE_ONCE,KEYUP:t.TYPING,TOGGLE_DROPDOWN:t.DROPDOWN_LOCKED},callbacks:{ON_ENTER:function(){e._remove_last()}}}),this._state_machine.add_transition(n.REMOVE_BADGE,t.DROPDOWN_LOCKED,t.DROPDOWN_LOCKED),this._state_machine.add_transition(n.REMOVE_BADGE,t.TYPING,t.TYPING),this._state_machine.add_transition(n.REMOVE_BADGE,t.SELECTING,t.TYPING),this._state_machine.add_transition(n.REMOVE_BADGE,t.IDLE,t.TYPING),this._state_machine.add_transition(n.BACKSPACE,t.TYPING,i.BACKSPACE_ONCE),this._state_machine.add_transition(n.REMOVE_BADGE,i.BACKSPACE_ONCE,t.TYPING),this._state_machine.on_transition(n.REMOVE_BADGE,function(t){e._deselect(t)})},_create_ui_components:function(e){this.base(e),this._j_input_container=$('<ul class="inline_list mbn mtn"></ul>'),this._j_input_item=$('<li class="pan badge_selector_input_item"></li>'),this._j_input_container.appendTo(this._j_container),this._j_input_item.appendTo(this._j_input_container),this._j_input.appendTo(this._j_input_item),this._add_placeholder_text()},_add_placeholder_text:function(){var e={elementToCheck:this._j_component,elementToCheckSelector:".pill",fontSize:"12px",skipModernBrowsers:!1,delayInitialTextUpdate:!0};this.placeholder_text&&this._j_input.attr("placeholder",this.placeholder_text),this._j_input.placeholderize(e)},_event_keydown:function(e){return e.keyCode==Box_Abstract_Selector.KEY.BACKSPACE&&this._query_is_empty()&&this._has_option_selected()?(this._state_machine.dispatch(Box_Badge_Selector.EVENTS.BACKSPACE),!0):this.base(e)},_remove_last:function(){var e=this._badge_keys.length;e>0&&this._deselect(this._badge_keys[e-1])},_remove_badge:function(e){this._j_badges[e]&&(this._badge_keys.splice($.inArray(e,this._badge_keys),1),this._badge_values.splice($.inArray(this._options[e],this._badge_values),1),this._j_badges[e].hide(),this._j_input.change())},remove_all_badges:function(){for(var e=this._badge_keys.length;e>0;)this._deselect(this._badge_keys[e-1]),e--;return this.reset_badges(),!0},reset_badges:function(){this._j_badges={},this._badge_keys=[],this._badge_values=[]},_add_badge:function(e){var t=this,i=this._options[e];if("undefined"!=typeof i&&(i.id=e),!this._j_badges[e]){this._j_badges[e]=$('<li class="pan mbs mrs"><span></span></li>'),i&&i.hasOwnProperty("type")&&i.hasOwnProperty("id")&&(this._j_badges[e].attr("data-type",i.type),this._j_badges[e].attr("invitee-id",i.id));var n=this._j_badges[e].find("span");n.addClass(this._create_badge_style(this._options[e])).text(this._create_badge_label(this._options[e])).append('<div class="delete_badge_container"><a href="#" class="mls delete_badge">&#215;</a></div>'),$j.isFunction(this._update_badge_color)&&this._update_badge_color(e)}this._j_badges[e].find("a").click(function(i){return t._state_machine.dispatch(Box_Badge_Selector.EVENTS.REMOVE_BADGE,e),!1}),this._j_badges[e].show().insertBefore(this._j_input_item),this._j_badges[e].css({display:"inline-block"}),this._badge_values.push(i),this._badge_keys.push(e)},_deselect:function(e){this._remove_badge(e),this.base(e)},_on_select_callback:function(e){this.base(e)&&(this._clear_input(),this._add_badge(e))},_create_badge_label:function(e){return e},_create_badge_style:function(e){return Box_Badge_Selector.DEFAULT_PILL_CLASS}},{STATES:{BACKSPACE_ONCE:6,BACKSPACE_TWICE:7},EVENTS:{BACKSPACE:"BACKSPACE",REMOVE_BADGE:"REMOVE_BADGE"},DEFAULT_PILL_CLASS:"pill"});Box.Timing.execution.push({name:"js/selectors/box_folder_tree_search_selector.js",time:(new Date).getTime()});var Box_Folder_Tree_Search_Selector=Box_Option_Selector.extend({_j_component:null,_hide_after_select:!1,_select_callback_passed_from_caller:function(){},constructor:function(e){e=e||{};var t=this;$.extend(e,{allow_empty_query:!1,use_commas_to_select:!1,show_dropdown_toggler:!1,create_container:!0,placeholder_text:$t("Type a folder name to search","folder_tree_search_box_placeholder"),no_results_label:$t("No matching folders","folder_tree_search_no_results_label")}),this._j_component=e.j_component?e.j_component:e.j_component=this._create_selector_container(),this._hide_after_select=e.hide_after_select||!1;var i=new Box_Folder_Tree_Search_Dropdown,n=new Box_Folder_Tree_Search_Filter;this.base(n,i,e);var o=this._j_component.find(".selector_input_box");o.addClass("tab_header"),o.find("input").addClass("needs_hover center pas ram"),n.set_on_complete_callback(function(e,i,n){t._dropdown.hide_loading(),t._complete_filter(e,i,n)}),this._select_callback_passed_from_caller=e.select_callback||null,this._dropdown.set_on_select_callback(function(e,i){var n=i.closest(".fts_result"),o=n?n.attr("data-item_name"):"";t._state_machine.dispatch(Box_Abstract_Selector.EVENTS.MOUSE_SELECT,e,o)})},_init_state_machine:function(){this.base();var e=this,t=Box_Abstract_Selector.STATES,i=Box_Abstract_Selector.EVENTS;this._state_machine.add_state({id:t.TYPING,transitions:{DOWN:t.SELECTING,UP:t.SELECTING,KEYUP:t.TYPING,BLUR:t.IDLE,MOUSE_SELECT:t.IDLE,TOGGLE_DROPDOWN:t.DROPDOWN_LOCKED,KEY_SELECT:t.IDLE},callbacks:{ON_ENTER:function(t){e._dropdown.reset_highlight_index(),t==i.KEY_SELECT||t==i.TEXT_SELECT?e._clear_input():(e._j_input.trigger("focus",{triggered:!0}),e._search())}}}),this._state_machine.add_state({id:t.SELECTING,transitions:{DOWN:t.SELECTING,UP:t.SELECTING,KEYUP:t.TYPING,BLUR:t.IDLE,MOUSE_SELECT:t.TYPING,KEY_SELECT:t.IDLE}})},_on_select_callback:function(e,t){this._hide_after_select?this.hide():(Box.Application.getService("tooltips").hideTooltips(!0),this._j_input.trigger("change"),this._j_input.blur(),this._j_input.focus(),this._reload_folder_tree_to_item(e,!0),this._hide_dropdown(),$("#folder_tree").show()),"function"==typeof this._select_callback_passed_from_caller&&this._select_callback_passed_from_caller(e,t)},_on_folder_tree_item_select_callback:function(e,t){"function"==typeof this._select_callback_passed_from_caller&&this._select_callback_passed_from_caller(e,t)},_select_by_index:function(e){var t=this._dropdown.get_key_from_index(e);if(t){var i=this._dropdown.get_folder_name(t);this._on_select_callback(t,i)}},body_click_handler:function(e){return!0},_event_blur:function(e){},_create_selector_container:function(){var e=$j("#fts_component");return e.length||(e=$j('<div id="fts_component" class="fts_component" style="overflow:hidden;"></div>'),e.appendTo(document.body)),e},_create_ui_components:function(e){var t=this;this.base(e),this._add_placeholder_text(),this._j_clear_search_btn=$j('<a class="img_ext mls sprite_16x16_close" id="fts_clear_search_btn" href="#"></a>'),this._j_clear_search_btn.attr({"data-hover":"tooltip","aria-label":$t("Clear Search","fts_clear_search_button_label")}),this._j_clear_search_btn.off("click").on("click",function(e){return t.handle_clear_search_btn(),!1}),this._j_input.parent().append(this._j_clear_search_btn.hide()),this._tree_open_item_id=e.opened_item_id||0,this._show_trash=e.show_trash||!1,this._skip_no_invite_collab=e.skip_no_invite_collab||!1,this._check_permission=e.check_permission||!1,this._init_folder_tree()},_add_placeholder_text:function(){this.placeholder_offset={force_block:!0,left:4},this.base()},_init_folder_tree:function(){var e=this,t=function(t,i,n,o){e._on_folder_tree_item_select_callback(t,i)},i={append:!0,hide_callback:function(){e.hide()},behavior:"selector",skip_no_invite_collab:this._skip_no_invite_collab,show_trash:this._show_trash,check_permission:this._check_permission,cache_identifier:"fts_component_first_load",force_open:!0};folder_tree.show(this._j_component,t,this._tree_open_item_id,"auto",i)},_reload_folder_tree_to_item:function(e,t){var i={selected_item_id:e,show_trash:this._show_trash,skip_no_invite_collab:this._skip_no_invite_collab,check_permission:this._check_permission,has_parents:!0};i.ancestors_only="undefined"==typeof t?!0:t,folder_tree.load_folder_into_container(null,e,null,null,i)},hide:function(){folder_tree.hide(),this._dropdown.hide(),this._j_component.remove()},_filter_options:function(e){this._query_is_empty()?(this._dropdown.hide_loading(),this._hide_dropdown(),this._j_clear_search_btn.hide(),this._init_folder_tree()):($("#folder_tree").hide(),this._dropdown.show_loading(),this._filter.run(e),this._j_clear_search_btn.show())},handle_clear_search_btn:function(){Box.Application.getService("tooltips").hideTooltips(!0),this._clear_input(),this._j_input.trigger("change"),this._filter_options("")},attachTo:function(e){return this._j_component.detach().appendTo(e)},component:function(){return this._j_component},_event_focus:function(e,t){if(!t){var i=Box_Abstract_Selector.STATES,n=this._state_machine.is_in_state(i.TYPING)||this._state_machine.is_in_state(i.SELECTING);n&&this._dropdown._j_dropdown.is(":visible")||(this._query_is_empty()||this._show_dropdown(),this._state_machine.dispatch(Box_Abstract_Selector.EVENTS.FOCUS))}},_event_keyup:function(e){13!=e.keyCode?this.base(e):(e.stopPropagation(),e.preventDefault())}},{});Box.Timing.execution.push({name:"js/selectors/box_contact_selector.js",time:(new Date).getTime()});var Box_Contact_Selector=Box_Badge_Selector.extend({constructor:function(e){e=e||{},$.extend(e,{placeholder_text:$t("Names or email addresses","contact_selector_placeholder_text")});var t=e.dropdown_params||{};e.no_results_label&&(t.no_results_label=e.no_results_label),t.hide_no_results_item=e.hide_no_results_item,this.on_select_callback=e.on_select_callback;var i=e.dropdown||new Box_Contact_Dropdown(t);this.base(e.filter,i,e)},_filter_options:function(e){var t=$j.box.isEmail(e);if(t)this.base(e);else{var i=this._get_emails_from_input_string(e);if(i.length>0)return void this._hide_dropdown();this._query_is_valid()&&this._filter.run(e)}},_on_select_callback:function(e){this.base(e),"function"==typeof this.on_select_callback&&this.on_select_callback()},contact_names:function(){var e=this.value();this._select_by_text(e);for(var t=[],i=0,n=this._badge_values.length;n>i;i++)t.push(this._badge_values[i].name);return t},contact_ids:function(){var e=this.value();this._select_by_text(e);for(var t=[],i=0,n=this._badge_values.length;n>i;i++)t.push(this._badge_values[i].id);return t},get_selected_options:function(e){var t,i,n,o=this._get_selected_keys(),a=[],r=this._options;for(i in o)o.hasOwnProperty(i)&&(n=o[i],t=r[n],a.push(t.email));if(!e){var s=this._get_emails_from_input_string(this.value());s.length>0&&(a=a.concat(s))}return a},_option_is_match_callback:function(e,t){var i=t.toLowerCase();return i==e.email.toLowerCase()||i==e.name.toLowerCase()},_validate_text_callback:function(e){var t=this._get_emails_from_input_string(e);return t.length>0},_create_badge_label:function(e){return e.name?e.name.replace(/\s+/g," "):null},_add_option_from_text_callback:function(e){for(var t=this._get_emails_from_input_string(e),i=[],n=0,o=t.length;o>n;n++){
var a=t[n];if(a){var r=this._create_unique_key(a);this._add_option(r,this._get_option_by_email(a)),i.push(r)}}return i},_get_option_by_email:function(e){return{name:e,email:e}},_get_emails_from_input_string:function(e){for(var t=e.split(/,|;|\s/),i=[],n=0,o=t.length;o>n;n++){var a=t[n],r=null;r=$j.box.isEmail(a)?a:this._get_email_in_angle_brackets(a),r&&i.push(r)}return i},_get_email_in_angle_brackets:function(e){var t=/<([^>]*)>/g,i=t.exec(e);if(i){var n=i[1];if($j.box.isEmail(n))return i[1]}return null}},{});Box.Timing.execution.push({name:"js/selectors/box_item_contact_selector.js",time:(new Date).getTime()});var Box_Item_Contact_Selector=Box_Contact_Selector.extend({constructor:function(e){var t={};"placeholder_text"in e&&(t.default_item_text=e.default_item_text),e.filter=new Box_Item_Contact_Filter({item_typed_id:e.item_typed_id,include_pending_collabs:e.include_pending_collabs,include_self:e.include_self}),e.dropdown=new Box_Item_Contact_Dropdown($j.extend(t,e)),this.base(e)}},{});Box.Timing.execution.push({name:"js/selectors/box_all_contact_selector.js",time:(new Date).getTime()});var Box_All_Contact_Selector=Box_Contact_Selector.extend({item_typed_id:null,include_self:!1,show_advanced_options:!1,is_external_collab_restricted_for_folder_owner:!1,constructor:function(e){e&&this._fetch_item_owner_data(e.item_typed_id),e.filter=new Box_All_Contact_Filter({item_typed_id:e.item_typed_id,include_self:e.include_self,include_groups:e.include_groups,include_collabs_without_account:e.include_collabs_without_account}),e.allow_empty_query=!1,this.base(e)},_fetch_item_owner_data:function(e){var t=Item.find(e);t&&User.find_item_owner_data_by_item_typed_id(t.user_id,e)},_update_badge_color:function(e){var t=this._options[e],i=this._j_badges[e],n=Box.Application.getService("url"),o=n.getGcmCompatibleRmUrl(Box_All_Contact_Selector.GET_EXTERNAL_COLLAB_STATUS_RM),a={contact_email:t.email||"",item_typed_id:this.item_typed_id},r=this;$j.getJSON(o,a,function(t){var n=t.is_external_collab_restricted,o=i.find("span");n?(r._options[e].is_external_collab_restricted=!0,o.removeClass(Box_Badge_Selector.DEFAULT_PILL_CLASS),o.addClass(Box_All_Contact_Selector.RESTRICTED_PILL_STYLE)):(r._options[e].is_external_collab_restricted=!1,o.removeClass(Box_All_Contact_Selector.RESTRICTED_PILL_STYLE),o.addClass(Box_Badge_Selector.DEFAULT_PILL_CLASS))})},_add_option:function(e,t){return this._options[e]||(this._options[e]=t),t},get_item_typed_id:function(){return this.item_typed_id},get_restricted_unrestricted_and_group_keys:function(){var e,t,i=this.get_restricted_unrestricted_and_group_contacts(),n=[],o=[],a=[],r=i.restricted_collab_contacts,s=i.unrestricted_collab_contacts,l=i.group_contacts,c=null;for(e=0,t=r.length;t>e;e++)c=r[e],n.push(c.email);for(e=0,t=s.length;t>e;e++)c=s[e],o.push(c.email);for(e=0,t=l.length;t>e;e++)c=l[e],a.push(c.contact_id);return{restricted_collab_emails:n,unrestricted_collab_emails:o,group_ids:a}},get_restricted_unrestricted_and_group_contacts:function(){var e=this.value();this._select_by_text(e);var t,i,n,o=this._get_selected_keys(),a=this._options,r=[],s=[],l=[];for(t in o)o.hasOwnProperty(t)&&(i=o[t],n=a[i],"group"===n.type?l.push(n):n.is_external_collab_restricted?r.push(n):s.push(n));return{restricted_collab_contacts:r,unrestricted_collab_contacts:s,group_contacts:l}},_get_option_by_email:function(e){return{name:e,email:e}},update_selector_item:function(e){if(e){this.item_typed_id=e,this.filter.item_typed_id=e;var t=Item.find(e),i=this;t&&"user_id"in t&&User.find_item_owner_data_by_item_typed_id(t.user_id,e,function(){i._reinsert_selected_badages(t.user_id)})}},_reinsert_selected_badages:function(e){var t=this._get_selected_keys();this.remove_all_badges(),this._j_badges={};for(var i=0,n=t.length;n>i;i++){var o=t[i];this._add_to_selected_options(o),this._add_badge(o)}}},{RESTRICTED_PILL_STYLE:"pill pill-error",GET_EXTERNAL_COLLAB_STATUS_RM:"box_collaborate_is_external_collab_restriction_for_contact"});Box.Timing.execution.push({name:"js/behaviors/amsterdam/collab-invite.js",time:(new Date).getTime()}),Box.Application.addBehavior("collab-invite",function(e){"use strict";var t,i,n="collab_invite_popup";return{init:function(){t=e.getService("popups-amsterdam"),i=e.getService("url")},onclick:function(e,t,i){if("open-invite-collab-popup"===i){var n=t.getAttribute("data-item-typed-id");this.openInvitePopup(n),e.preventDefault(),e.stopPropagation()}},openInvitePopup:function(e){var o=i.getGcmCompatibleRm(n);t.open(o,{data:{itemTypedId:e}})}}}),Box.Timing.execution.push({name:"js/behaviors/amsterdam/collab-menu-remove.js",time:(new Date).getTime()}),Box.Application.addBehavior("collab-menu-remove",function(e){"use strict";function t(e,t,i){var o=$t("Remove From Parent Folder","remove_inherited_collab_confirmation_popup_title"),a=$t('%1 will be removed from the parent folder "%2" because collaboration is inherited from it. Are you sure you want to continue?',"remove_inherited_collab_popup_message",t,i);c.confirm(a,o).then(function(){n(e,t,{ignoreInheritanceCheck:!0,ignoreTaskWarning:!1})})}function i(e,t,i){var o=$t("Overwrite Pending Tasks","pending_tasks_confirm_popup_title"),a=$t("Are you sure you want to remove %1 as a collaborator? %1 will no longer be able to complete pending tasks in this folder.","pending_tasks_confirm_popup_message",t);c.confirm(a,o).then(function(){n(e,t,{ignoreInheritanceCheck:!1,collabedFolderName:i,ignoreTaskWarning:!0})})}function n(n,a,r){r=r||{};var c,d=_.getGcmCompatibleRm(p),f={itemTypedId:u,collabId:n,ignoreInheritanceCheck:r.ignoreInheritanceCheck||!1,ignoreTaskWarning:r.ignoreTaskWarning||!1};e.broadcast("collabrequestsent"),o.post(d,f).then(function(t){e.broadcast("collabresponsereceived"),t.data.isCurrentUserGroupCollab?(c=$t("You have removed your group from the folder.","collab_remove_user_group_collab"),l.info(c),s.redirect("/files")):(c=$t("You have removed %1 as a collaborator on this folder.","collaborate_confirmation_remove_collab",a),l.info(c),e.broadcast("x-collabchange"))},function(o){var s=o.data||{};if(e.broadcast("collabresponsereceived"),s.code===h)t(n,a,r.collabedFolderName);else if(s.code===m)i(n,a,r.collabedFolderName);else if(s.message)l.error(s.message);else{var c=$t("Something went wrong with your request. Please try again.","remove_collab_request_generic_error_message");l.error(c)}})}var o,a,r,s,l,c,_,d,u,p="remove_collab_from_item",h="inheritedCollab",m="taskAffected";return{init:function(){o=e.getService("ajax"),a=e.getService("collab-actions"),r=e.getService("dom"),s=e.getService("nav"),l=e.getService("notifications-amsterdam"),c=e.getService("popups-amsterdam"),_=e.getService("url"),d=e.getElement(),u=d.getAttribute("data-item-typed-id")},onclick:function(e,t,i){if("remove-collab"===i){var n=r.getNearest(t,".menu-wrapper"),o=n.hasAttribute("data-is-current-user");if(o)a.removeCurrentUserFromItem(u);else{var s=n.getAttribute("data-collab-id"),l=n.getAttribute("data-display-name"),c=n.getAttribute("data-collabed-folder-name");this.removeCollab(s,l,c)}e.preventDefault(),e.stopPropagation()}},removeCollab:function(e,t,i){n(e,t,{ignoreInheritanceCheck:!1,collabedFolderName:i,ignoreTaskWarning:!1})}}}),Box.Timing.execution.push({name:"js/behaviors/amsterdam/collab-menu-resend-invite.js",time:(new Date).getTime()}),Box.Application.addBehavior("collab-menu-resend-invite",function(e){"use strict";var t,i,n,o,a="collab_resend_invite_email";return{init:function(){t=e.getService("ajax"),i=e.getService("dom"),n=e.getService("notifications-amsterdam"),o=e.getService("url")},onclick:function(e,t,n){if("resend-invite"===n){var o=i.getNearest(t,".menu-wrapper"),a=o.getAttribute("data-collab-id"),r=o.getAttribute("data-display-name");this.resendInvite(a,r),e.preventDefault(),e.stopPropagation()}},resendInvite:function(i,r){var s,l=o.getGcmCompatibleRm(a),c={collabId:i};e.broadcast("collabrequestsent"),t.post(l,c).then(function(){e.broadcast("collabresponsereceived"),s=$t("You resent a collaboration invite to %1","collaborate_resend_invite_success",r),n.info(s)},function(){e.broadcast("collabresponsereceived"),s=$t("There was an error resending the collaboration invite.","collaborate_resend_invite_error"),n.error(s)})}}}),Box.Timing.execution.push({name:"js/behaviors/amsterdam/collab-role-menu.js",time:(new Date).getTime()}),Box.Application.addBehavior("collab-role-menu",function(e){"use strict";function t(t){e.broadcast("collabrequestsent");var i=l.getGcmCompatibleRm(h),o={itemTypedId:_,newRoleId:t};n.post(i,o).then(function(){e.broadcast("collabresponsereceived"),a.reload()},function(i){var n,o=i.data||{};e.broadcast("collabresponsereceived"),n=o.message?o.message:$t("There was a problem changing your role to %1. Please try again or refresh the page.","change_current_user_collab_role_generic_error",v[t]),r.error(n)})}function i(e,t,i){var n=$t("You have changed %1 to %2 role.","changed_collab_role_success",e,v[t]);i&&(n=$t("You have changed your group to %1 role.","changed_user_group_role_success",v[t])),r.info(n)}var n,o,a,r,s,l,c,_,d="owner",u="collab_get_owner_transfer_confirm_message",p="collab_transfer_item_ownership",h="collab_change_current_user_role",m="collab_change_role",f="collab_get_role_menu",g="inheritedCollab",v={15:$t("Co-owner","co_owner"),7:$t("Editor","editor"),17:$t("Viewer Uploader","viewer_uploader"),13:$t("Previewer Uploader","previewer_uploader"),3:$t("Viewer","viewer"),9:$t("Previewer","previewer"),11:$t("Uploader","uploader")};return v[d]=$t("Owner","owner"),{init:function(){n=e.getService("ajax"),o=e.getService("dom"),a=e.getService("nav"),r=e.getService("notifications-amsterdam"),s=e.getService("popups-amsterdam"),l=e.getService("url"),c=e.getElement(),_=c.getAttribute("data-item-typed-id")},onclick:function(e,t,i){if("collab-role-menu-option"===i&&!o.hasClass(t,"is-selected")){var n=t.getAttribute("data-role-id"),a=o.getNearest(t,".menu-wrapper"),r=a.getAttribute("data-display-name"),s=a.hasAttribute("data-is-current-user"),l=a.getAttribute("data-collab-id"),c=a.getAttribute("data-collabed-folder-name");switch(n){case d:this.getFolderChangeWarning(r);break;default:s?this.changeCurrentUserRole(n):this.changeCollabRole(l,r,n,t,c)}e.preventDefault(),e.stopPropagation()}},getFolderChangeWarning:function(t){var i=l.getGcmCompatibleRm(u),o={itemTypedId:_,newOwnerEmail:t},a=this;e.broadcast("collabrequestsent"),n.get(i,o).then(function(i){var n=i.data,o=$t("Change Folder Owner","change_folder_owner_popup_title");e.broadcast("collabresponsereceived"),s.confirm(n.message,o).then(function(){a.transferFolderOwnership(t)})},function(){e.broadcast("collabresponsereceived"),r.error($t("There was a problem making %1 the owner of the folder. Please try again or refresh the page.","transfer_folder_ownership_generic_error",t))})},transferFolderOwnership:function(t){var i=l.getGcmCompatibleRm(p),o={itemTypedId:_,newOwnerEmail:t};e.broadcast("collabrequestsent"),n.post(i,o).then(function(){e.broadcast("collabresponsereceived"),a.reload()},function(i){var n,o=i.data||{};e.broadcast("collabresponsereceived"),n=o.message?o.message:$t("There was a problem making %1 the owner of the folder. Please try again or refresh the page.","transfer_folder_ownership_generic_error",t),r.error(n)})},changeCurrentUserRole:function(e){s.confirm($t("Are you sure you want to change your role? If changing to uploader, you may no longer be able to complete pending tasks in this folder.","uploader_task_affected_current_user_warning"),$t("Change Collaboration Role","change_collab_role_popup_title")).then(function(){t(e)})},changeCollabRole:function(e,t,i,n,o){this.sendChangeCollabRoleRequest(e,t,i,!1,n,o)},sendChangeCollabRoleRequest:function(t,o,s,c,d,u){var p=l.getGcmCompatibleRm(m),h={itemTypedId:_,collabId:t,newRoleId:s,ignoreInheritanceCheck:c},f=this;e.broadcast("collabrequestsent"),n.post(p,h).then(function(n){e.broadcast("collabresponsereceived"),n.data.isCurrentUserGroupCollab?(i(o,s,!0),a.reload()):(i(o,s),f.updateCollabRoleMenu(t,d))},function(i){var n,a=i.data||{};return e.broadcast("collabresponsereceived"),a.code===g?void f.showChangeInheritedCollabRolePopup(t,o,s,d,u):(n=a.message?a.message:$t("There was a problem changing %1 to %2 role. Please try again or refresh the page.","change_collab_role_generic_error",o,v[s]),void r.error(n))})},updateCollabRoleMenu:function(t,i){var r=l.getGcmCompatibleRm(f),s={collabId:t,itemId:_.substr(2)};e.broadcast("collabrequestsent"),n.get(r,s).then(function(t){var n=o.getNearest(i,".collab-role-container");e.broadcast("collabresponsereceived"),o.setHTML(n,t.data.html)},function(){a.refresh()})},showChangeInheritedCollabRolePopup:function(e,t,i,n,o){var a=$t("Change Role for Parent Folder","change_inherited_collab_role_popup_title"),r=$t('%1 will be changed to %2 role for the parent folder "%3" because collaboration is inherited from it. Are you sure you want to continue?',"change_inherited_collab_role_popup_message",t,v[i],o),l=this;s.confirm(r,a).then(function(){l.sendChangeCollabRoleRequest(e,t,i,!0,n)})}}}),Box.Timing.execution.push({name:"js/behaviors/amsterdam/share-access-menu-amsterdam.js",time:(new Date).getTime()}),Box.Application.addBehavior("share-access-menu-amsterdam",function(e){"use strict";function t(t){var i=r.getGcmCompatibleRm(c),o={itemTypedId:s,accessLevel:t};e.broadcast("sharedlinkchangeinitiated",{itemTypedId:s,context:l}),n.post(i,o).then(function(){e.broadcast("sharedlinkchanged",{newAccessLevel:t,itemTypedId:s,context:l})},function(){e.broadcast("sharedlinkchangeerror",{itemTypedId:s,context:l})})}function i(){var t=r.getGcmCompatibleRm(_),i={itemTypedId:s};e.broadcast("sharedlinkchangeinitiated",{itemTypedId:s,context:l}),n.post(t,i).then(function(){e.broadcast("sharedlinkremoved",{itemTypedId:s,context:l})},function(){e.broadcast("sharedlinkchangeerror",{itemTypedId:s,context:l})})}var n,o,a,r,s,l,c="share_change_access_level",_="share_remove_link",d="0",u="1",p="2",h="remove";return{init:function(){n=e.getService("ajax"),o=e.getService("dom"),a=e.getService("popups-amsterdam"),r=e.getService("url");var t=e.getElement();s=t.getAttribute("data-item-typed-id"),e.getConfig()&&(l=e.getConfig().context)},onclick:function(e,t,i){var n;switch(i){case"share-access-menu-option":if(!o.hasClass(t,"is-selected"))switch(n=t.getAttribute("data-access-id")){case d:case u:case p:this.changeAccessLevel(n);break;case h:this.showRemoveSharedLinkPopup()}break;default:return}e.preventDefault(),e.stopPropagation()},changeAccessLevel:t,showRemoveSharedLinkPopup:function(){a.confirm($t("This will permanently remove the shared link. If this item is embedded on other sites it will also become inaccessible. Any custom properties, settings and expirations will be removed as well. Do you want to continue?","share_access_menu_remove_link_message"),$t("Remove Share Link","share_access_menu_remove_popup_title")).then(i)}}}),Box.Timing.execution.push({name:"js/behaviors/amsterdam/tooltips-amsterdam.js",time:(new Date).getTime()}),Box.Application.addBehavior("tooltips-amsterdam",function(e){"use strict";function t(){return null}var i;return{messages:["formvalidatorerrorcleared"],onmessage:function(e,n){switch(e){case"formvalidatorerrorcleared":i.hide(n);break;default:t()}},init:function(){i=e.getService("tooltips-amsterdam")},onfocusin:function(e,t,n){i.handleEvent(e,t,n)},onfocusout:function(e,t,n){i.handleEvent(e,t,n)},onmouseover:function(e,t,n){i.handleEvent(e,t,n)},onmouseout:function(e,t,n){i.handleEvent(e,t,n)},onclick:function(e,t,n){i.handleEvent(e,t,n)}}}),Box.Timing.execution.push({name:"js/behaviors/menu-toggle.js",time:(new Date).getTime()}),Box.Application.addBehavior("menu-toggle",function(e){"use strict";function t(e){var t=e.target||e.srcElement;if(!t)return null;if(t.getAttribute("data-type")===o)return t;for(;;){if(t=t.parentNode,!t||t===document.body||!t.getAttribute)return null;if(t.getAttribute("data-type")===o)return t}}var i,n,o="menu-toggle-button",a="is-visible",r={init:function(){var t=e.getService("menu-toggle");i=e.getService("dom"),n=t.create(),n.init(),i.on(document.body,"keyup",this.keyupHandler)},destroy:function(){i.off(document.body,"keyup",this.keyupHandler),n.destroy()},keyupHandler:function(e){27===e.keyCode&&r.closeMenu()},onclick:function(e,t,n){n===o?(this.showMenu(t),e.preventDefault(),e.stopPropagation()):!i.getNearest(e.target,".menu-option")||null!==t&&t.disabled||this.closeMenu()},onkeyup:function(e){if(32===e.keyCode){var n=t(e);if(n)return r.showMenu(n),void e.preventDefault();var o=(e.target||e.srcElement).parentNode;do{if("MENU"===o.nodeName){e.stopPropagation();var s=i.getNearest(o,".menu-wrapper");return i.removeClass(s,a),void setTimeout(r.closeMenu,100)}o=o.parentNode}while(o&&o!==document.body)}},showMenu:function(e){n.showMenu(e)},closeMenu:function(){n.closeMenu()}};return r}),Box.Timing.execution.push({name:"js/behaviors/create-box-note.js",time:(new Date).getTime()}),Box.Application.addBehavior("create-box-note",function(e){"use strict";var t,i,n,o,a="new_document",r="boxnote";return{init:function(){t=e.getService("v5"),i=e.getService("dom"),n=e.getService("popups"),o=t.get("Canvas")},destroy:function(){},onclick:function(e,t,n){if(t&&!i.hasClass(t,"disabled")){switch(n){case"new-box-note-btn":this.showBoxNotesCreationPopup();break;case"zero-state-new-box-note-btn":this.showBoxNotesCreationPopup();break;default:return}e.preventDefault(),e.stopPropagation()}},showBoxNotesCreationPopup:function(e){n.open(a,{data:{folder_id:o.current_folder.id,type:r},onclose:e})}}}),Box.Timing.execution.push({name:"js/behaviors/toggle-item-list-selection.js",time:(new Date).getTime()}),Box.Application.addBehavior("toggle-item-list-selection",function(e){"use strict";var t,i;return{init:function(){t=e.getService("v5"),i=t.get("Canvas")},destroy:function(){t=null,i=null},onclick:function(e,t,n){switch(n){case"toggle-item-list-selection":i.selection.toggle_all();break;default:return}e.preventDefault(),e.stopPropagation()}}}),Box.Timing.execution.push({name:"js/behaviors/upload-menu.js",time:(new Date).getTime()}),Box.Application.addBehavior("upload-menu",function(e){"use strict";function t(){var t=e.getService("templates"),i=t.getTemplateFragment("upload-menu");h=l.getFirstElementChild(i),$(m).after(i),p=e.getService("menus").create(h),p.init()}function i(){p.destroy(),$(e.getElement()).find(h).remove(),h=null,p=null}function n(e,t){var i=d.current_folder;return u.add_trigger({element:$(e),folder:i,shouldLogToResin:!0,resinParams:{feature:"actionbar",target:t?"uploadfolder":"uploadfile"},directory_upload:t,handle_change:function(e,t){p.hide(),u.handle_change(e,t)}})}function o(){var t=l.query('[data-type="upload-files-option"]',e.getElement());f=n(t,!1)}function a(){f&&(f.destroy(),f=null)}function r(){var t=l.query('[data-type="upload-directory-option"]',e.getElement());t&&_.canFolderUpload()&&(g=n(t,!0))}function s(){g&&(g.destroy(),g=null)}var l,c,_,d,u,p,h,m,f,g;return{init:function(){l=e.getService("dom"),c=e.getService("v5"),_=e.getService("browser"),d=c.get("Canvas"),u=c.get("Upload_Process"),m=l.query('[data-type="upload-menu-btn"]',e.getElement()),t(),this.bindMenuSelectEvent()},destroy:function(){this.unbindMenuSelectEvent(),i()},onclick:function(t,i,n){if(i&&!l.hasClass(i,"disabled")){switch(n){case"upload-menu-btn":if(p.isOpen())this.hideMenu();else{var o=e.getGlobalConfig("showAmsterdamCollabSharing");o?this.showMenu(i,{x:0,y:4}):this.showMenu(i)}break;default:return}t.preventDefault(),t.stopPropagation()}},handleMenuClick:function(e,t){switch(t){case"upload-files-option":f&&f.open();break;case"upload-directory-option":g?g.open():(u.popup_upload_java_open(),this.hideMenu())}},bindMenuSelectEvent:function(){var e=this;p.on("menuselect",function(t){var i=t.data.targetElement;e.handleMenuClick(i,i.getAttribute("data-type"))})},unbindMenuSelectEvent:function(){p.off("menuselect")},showMenu:function(e,t){a(),s(),o(),r(),p.show(e,null,t)},hideMenu:function(){p.hide()}}}),Box.Timing.execution.push({name:"js/behaviors/view-options-menu.js",time:(new Date).getTime()}),Box.Application.addBehavior("view-options-menu",function(e){"use strict";function t(e){w.addClass(e,"selected")}function i(e){w.removeClass(e,"selected")}function n(e){return e.getAttribute("data-sort")}function o(e){return e.getAttribute("data-display")}function a(e){return e.getAttribute("data-filter")}function r(e){return B[e]}function s(e,t){for(var i="[data-"+e+"]",n=$(x).find(i),o=0,a=t.length;a>o;o++)n=n.not("[data-"+e+'="'+t[o]+'"]');n.remove()}function l(e){var t="[data-"+e+"]",i=$(x).find(t);i.remove(),$(x).find("."+e+"-divider").remove(),$(x).find("."+e+"-label").remove()}function c(){var e=w.query(".menu_arrow_up, .menu_arrow_down",x);w.removeClass(e,"menu_arrow_up"),w.removeClass(e,"menu_arrow_down")}function _(e){c(),w.addClass(e,"menu_arrow_up")}function d(e){c(),w.addClass(e,"menu_arrow_down")}function u(){var e=S.get(),i=e.sort,n=e.sortDirection;if(i){var o=w.query('[data-sort="'+$.box.escapeHTML(i)+'"]',x);t(o),C=o;var r=w.query(".arrow",o,x);"ASC"===n?_(r):d(r)}k=k||b.get("Canvas");var s=k.view;if(s){s="expanded"===s?"list":"icon";var l=w.query('[data-display="'+$.box.escapeHTML(s)+'"]',x);t(l),E=l}if(S.isTrash()){var c;c=A?a(A):I;var u=w.query('[data-filter="'+$.box.escapeHTML(c)+'"]',x);t(u),A=u}}function p(){var e=S.get();j?s("sort",["name","email","folders"]):"s"===e.type?s("sort",["relevance","date","size"]):S.isTrash()?s("sort",["deleted","name","size"]):s("sort",["name","date","size"])}function h(){j?l("display"):s("display",["list","icon"])}function m(){S.isTrash()?s("filter",["deleted","owned"]):l("filter")}function f(){p(),h(),m(),u()}function g(){y&&(y.destroy(),y=null),x&&($(T).parent().get(0).removeChild(x),x=null)}function v(){y&&g();var t=e.getService("templates"),i=t.getTemplateFragment("view-options-menu");x=w.getFirstElementChild(i),f(),$(T).after(x),y=e.getService("menus").create(x),y.init(),$(x).css("maxWidth","250px")}var b,w,y,x,S,k,T,j,C,A,E,B={name:"ASC",size:"DESC",date:"DESC"},I="deleted";return{init:function(){b=e.getService("v5"),w=e.getService("dom"),S=e.getService("nav-state"),j=b.get("collab_page"),T=w.query('[data-type="view-options-menu-btn"]',e.getElement())},destroy:function(){y&&this.hideMenu(),b=null,w=null,k=null,S=null},onclick:function(e,t,i){if(t&&!w.hasClass(t,"disabled")){switch(i){case"view-options-menu-btn":y&&y.isOpen()?this.hideMenu():this.showMenu(t);break;default:return}e.preventDefault(),e.stopPropagation()}},handleMenuClick:function(e,t){if(e&&!w.hasClass(e,"disabled")){switch(t){case"sort":w.hasClass(e,"selected")?this.toggleSortDirection(e):this.changeSortType(e);break;case"display":this.changeDisplayType(e);break;case"filter":this.changeFilterType(e)}var i=this;setTimeout(function(){i.hideMenu()},200)}},showMenu:function(t){v(),this.bindMenuSelectEvent();var i=e.getGlobalConfig("showAmsterdamCollabSharing");i?y.show(t,null,{x:0,y:4}):y.show(t)},hideMenu:function(){y.hide(),this.unbindMenuSelectEvent(),g()},bindMenuSelectEvent:function(){var e=this;y.on("menuselect",function(t){var i=t.data.targetElement;e.handleMenuClick(i,i.getAttribute("data-type"))})},unbindMenuSelectEvent:function(){y.off("menuselect")},sort:function(t,i){S.set({sort:t,sortDirection:i}),e.getService("navigation").navigate("")},display:function(e){k=k||b.get("Canvas"),k.change_view("list"===e?"expanded":"icon")},filter:function(t){S.set({trashFilter:t,page:0}),e.getService("navigation").navigate("")},changeSortType:function(e){i(C),C=e;var o=n(e),a=r(o),s=w.query(".arrow",e);t(C),"ASC"===a?_(s):d(s),this.sort(o,a)},changeDisplayType:function(e){i(E),E=e,t(E);var n=o(e);this.display(n)},changeFilterType:function(e){i(A),A=e,t(A);var n=a(e);this.filter(n)},toggleSortDirection:function(e){var t=S.get(),i="ASC"===t.sortDirection?"DESC":"ASC",o=w.query(".arrow",e);"ASC"===i?_(o):d(o);var a=n(e);this.sort(a,i)}}}),Box.Timing.execution.push({name:"js/behaviors/policy-action-menu.js",time:(new Date).getTime()}),Box.Application.addBehavior("policy-action-menu",function(e){"use strict";function t(e){var t=$('[data-option-type="delete-policy"]',r),i=$('[data-option-type="retire-policy"]',r),n=$('[data-option-type="view-quarantine"]',r);switch(e){case"dlp_download":case"dlp_sharing":i.remove(),n.remove();break;case"dlp_upload":i.remove();break;case"data_retention":t.remove(),n.remove()}}function i(){a&&a.destroy(),r&&r.parentNode.removeChild(r),a=null,r=null}function n(n){a&&i();var s=e.getService("templates"),l=s.getTemplateFragment("policy-action-menu"),c=$(n).attr("data-policy-type");r=o.getFirstElementChild(l),t(c),n.parentNode.appendChild(l),a=e.getService("menus").create(r),a.init()}var o,a,r,s="bottom right",l={x:0,y:0},c=223;return{messages:["content-workflow-policy-list-clicked"],onmessage:function(e,i){switch(e){case"content-workflow-policy-list-clicked":if("policy"===i.elementType){var n=o.getData(i.element,"policy-type");t(n)}}},init:function(){o=e.getService("dom")},destroy:function(){i()},onclick:function(e,t,i){if(t&&!o.hasClass(t,"disabled")){switch(i){case"policy-action-btn":a&&a.isOpen()?this.hideMenu():this.showMenu(t);break;default:return}e.preventDefault(),e.stopPropagation()}},handleMenuClick:function(t){if(t&&!o.hasClass(t,"disabled")){var i=t.querySelector("a").getAttribute("data-policy-id"),n=t.querySelector("a").getAttribute("data-policy-type"),a={policyId:i,policyType:n},r=t.querySelector("a").getAttribute("data-type"),s=r.concat("-clicked");this.hideMenu(),e.broadcast(s,a)}},bindMenuSelectEvent:function(){var e=this;a.on("menuselect",function(t){var i=t.data.targetElement;e.handleMenuClick(i)})},unbindMenuSelectEvent:function(){a.off("menuselect")},showMenu:function(e){n(e),this.bindMenuSelectEvent(),a.showWithBeak(e,s,l,c)},hideMenu:function(){a.hide(),this.unbindMenuSelectEvent(),i()}}}),Box.Timing.execution.push({name:"js/menus/box_menus.js",time:(new Date).getTime()});var Box_Menus=Base.extend({map_menu_id_to_menu_object:{},menu_groups:{},constructor:function(){if(Box_Menus._initializing)throw new Error("Circular reference in initializing Box_Menus");Box_Menus._initializing=!0,this._initialize_default_menus(),this._bind_click_handler(),this._bind_close_on_event_handler("popup.open.menus"),this._bind_close_on_event_handler("close.menus"),this._bind_mousedown_close_event_handler(),Box_Menus._initializing=!1},_bind_click_handler:function(){var e=this;$("body").on("click.menus",".handle_menu_events",function(t){var i=e.get_menu_by_element_id($(this).attr("id"));return i&&i.event_click?i.event_click(t):void 0})},_bind_close_on_event_handler:function(e){var t=this;$("body").on(e,function(){t.hide_all()})},_bind_mousedown_close_event_handler:function(){var e=this;$("body").on("mousedown.legacymenus",function(t){var i=$(t.target);i.is(".ignore_mousedown")||i.closest("[aria-haspopup]").length||i.closest(".box-menu").length||e.hide_all()})},hide_all:function(){var e,t,i=this.map_menu_id_to_menu_object;for(e in i)i.hasOwnProperty(e)&&(t=i[e],t&&t.visible&&t.hide())},_initialize_default_menus:function(){"undefined"!=typeof Action_Types_Selector_Menu&&(this.action_types_selector_menu=new Action_Types_Selector_Menu),"undefined"!=typeof App_Category_Filter_Menu&&(this.app_category_filter_menu=new App_Category_Filter_Menu),"undefined"!=typeof App_View_Filter_Menu&&(this.app_view_filter_menu=new App_View_Filter_Menu),"undefined"!=typeof Add_Account_Menu&&(this.add_account_menu=new Add_Account_Menu),"undefined"!=typeof Collab_Folder_Role_Menu&&(this.collab_folder_role_menu=new Collab_Folder_Role_Menu),"undefined"!=typeof Corporate_Network_Menu&&(this.corporate_network_menu=new Corporate_Network_Menu),"undefined"!=typeof Enterprise_Action_Menu&&(this.enterprise_action_menu=new Enterprise_Action_Menu),"undefined"!=typeof External_User_Menu&&(this.external_user_menu=new External_User_Menu),"undefined"!=typeof External_User_Sort_Menu&&(this.external_user_sort_menu=new External_User_Sort_Menu),"undefined"!=typeof Folder_Membership_Permission_Menu&&(this.folder_membership_permission_menu=new Folder_Membership_Permission_Menu),"undefined"!=typeof Folder_Picker_Menu&&(this.folder_picker_menu=new Folder_Picker_Menu),"undefined"!=typeof Group_Tag_Filter_Menu&&(this.group_tag_filter_menu=new Group_Tag_Filter_Menu),"undefined"!=typeof Group_Tag_Role_Menu&&(this.group_tag_role_menu=new Group_Tag_Role_Menu),"undefined"!=typeof Group_Selector_Menu&&(this.group_selector_menu=new Group_Selector_Menu),"undefined"!=typeof Group_Tag_Menu&&(this.group_tag_menu=new Group_Tag_Menu),"undefined"!=typeof Item_Menu&&(this.menu=new Item_Menu),"undefined"!=typeof Multi_Options_Menu&&(this.multi_options_menu=new Multi_Options_Menu),"undefined"!=typeof Paging_Menu&&(this.paging_menu=new Paging_Menu),"undefined"!=typeof Shared_File_Menu&&(this.shared_file_menu=new Shared_File_Menu),"undefined"!=typeof Sort_Enterprise_Menu&&(this.sort_enterprise_menu=new Sort_Enterprise_Menu),"undefined"!=typeof File_Filter_Menu&&(this.file_filter_menu=new File_Filter_Menu),"undefined"!=typeof File_Sort_Menu&&(this.file_sort_menu=new File_Sort_Menu),"undefined"!=typeof Tags_Menu&&(this.tags_menu=new Tags_Menu),"undefined"!=typeof Upload_Menu&&(this.upload_menu=new Upload_Menu),"undefined"!=typeof User_Action_Menu&&(this.user_action_menu=new User_Action_Menu),"undefined"!=typeof User_Role_Menu&&(this.user_role_menu=new User_Role_Menu),"undefined"!=typeof User_Sort_Menu&&(this.user_sort_menu=new User_Sort_Menu),"undefined"!=typeof View_Options_Menu&&(this.view_options_menu=new View_Options_Menu),"undefined"!=typeof GCM_User_Menu&&(this.gcm_user_menu=new GCM_User_Menu),this.map_menu_id_to_menu_object={dd_menu_box_item:this.menu,item_submenu_edit_with:this.menu,item_submenu_upload:this.menu,item_submenu_share:this.menu,item_submenu_properties:this.menu,item_submenu_sync_folder:this.menu,item_submenu_openbox:this.menu,item_submenu_collab:this.menu,item_submenu_manage:this.menu,item_submenu_properties:this.menu,dd_menu_create_filter:this.create_filter_menu,dd_menu_upload:this.upload_menu,dd_menu_user_action:this.user_action_menu,dd_menu_group_tag:this.group_tag_menu,dd_menu_external_user:this.external_user_menu,action_types_selector_menu:this.action_types_selector_menu,"actionbar-multiple-selection":this.multi_options_menu,add_account_menu:this.add_account_menu,app_category_filter_menu:this.app_category_filter_menu,app_view_filter_menu:this.app_view_filter_menu,collab_folder_role_menu:this.collab_folder_role_menu,external_user_sort_menu:this.external_user_sort_menu,folder_membership_permission_menu:this.folder_membership_permission_menu,group_tag_filter_menu:this.group_tag_filter_menu,group_tag_role_menu:this.group_tag_role_menu,group_selector_menu:this.group_selector_menu,menu_enterprise_action:this.enterprise_action_menu,multi_options_menu:this.multi_options_menu,paging_menu:this.paging_menu,qu_outer_container:this.quick_updates_menu,sort_enterprise_list:this.sort_enterprise_menu,file_filter_list:this.file_filter_menu,file_sort_list:this.file_sort_menu,tags_outer_container:this.tags_menu,user_role_menu:this.user_role_menu,user_sort_menu:this.user_sort_menu,view_options_menu:this.view_options_menu,device_application_type_filter:"undefined"!=typeof Device_Application_Type_Filter_Menu?Device_Application_Type_Filter_Menu.get():null,gcm_user_menu:this.gcm_user_menu}},get_menu_group:function(e){return this.menu_groups[e]||[]},add_menu_to_group:function(e,t){this.menu_groups[t]||(this.menu_groups[t]=[]),this.menu_groups[t].push(e)},get_menu_by_element_id:function(e){return this.map_menu_id_to_menu_object[e]}},{_initializing:!1,get:function(){return Box_Menus.__instance||(Box_Menus.__instance=new Box_Menus),Box_Menus.__instance}});Box.Timing.execution.push({name:"js/menus/box_abstract_menu.js",time:(new Date).getTime()});var Abstract_Menu=Base.extend({PAGE_MARGIN:10,_e_menu:null,_j_target_element:null,_target_event:null,_elements_that_keep_menu_open:this._elements_that_keep_menu_open||null,_elements_told_menu_is_open:this._elements_told_menu_is_open||null,
hoverEventsEnabled:!1,_hovers:null,_timeout_id:null,_timeout_duration:150,_clicks:null,visible:!1,stalking:!1,_action_required_to_close:this._action_required_to_close||!1,_callback:null,_defined_inline:!1,_prevent_rendering_offscreen:!0,window:window,_triggering_elements:function(){return $j(this._e_menu).add(this._j_target_element).add(this._elements_that_keep_menu_open)},_responding_elements:function(){return $j(this._e_menu).add(this._j_target_element).add(this._elements_that_keep_menu_open).add(this._elements_told_menu_is_open)},_attach_events:function(){var e=this;this.hoverEventsEnabled&&(this._hovers={on:function(t){e._hover_on(t)},off:function(t){e._hover_off(t)}},this._triggering_elements().mouseover(this._hovers.on),this._triggering_elements().mouseout(this._hovers.off))},_unattach_events:function(){if(this._clicks&&$("body").off("click.box_abstract_menu",this._clicks.out),this.hoverEventsEnabled){if(!this._hovers)return;this._triggering_elements().unbind("mouseout",this._hovers.off),this._triggering_elements().unbind("mouseover",this._hovers.on),this._hovers=null}},_hover_off:function(e){var t=this;this._timeout_id&&clearTimeout(this._timeout_id),this._timeout_id=setTimeout(function(){t.hide()},this._timeout_duration)},_hover_on:function(e){this._timeout_id&&(clearTimeout(this._timeout_id),this._timeout_id=null)},_set_position:function(){var e,t=$j(this._e_menu),i=5;this._target_event?e={left:this._target_event.pageX-i,top:this._target_event.pageY-i}:(e=this._j_target_element.offset(),this.stalking&&(e.top=0),e.top+=this._j_target_element.height());var n=this._get_offsets();e.top+=n.y,e.left+=n.x,"none"==this._e_menu.style.display&&(this._e_menu.style.visibility="hidden"),this._e_menu.style.display="block",this._e_menu.style.position=this.stalking?"fixed":"absolute",this._e_menu.style.left=e.left+"px",this._e_menu.style.top=e.top+"px",this._prevent_rendering_offscreen&&this._adjust_menu_offset(),t.hasClass("drop_down")&&"hidden"==t.css("visibility")?t.hide().css("visibility","visible").stop(!0,!0).slideDown(100):t.css("visibility","visible")},_adjust_menu_offset:function(){var e=$j(this._e_menu),t=e.offset(),i=this._get_size(),n=$j(this.window),o=this._calculate_available_space(t);o.left>=o.right?t.left+i.width>n.width()+n.scrollLeft()-this.PAGE_MARGIN&&(this.parent_menu?e.css("left",$j(this.parent_menu._e_menu).offset().left-i.width):e.css("left",n.width()+n.scrollLeft()-i.width-this.PAGE_MARGIN)):(o.right<i.width+this.PAGE_MARGIN||this._can_have_submenu&&o.right<2*i.width+this.PAGE_MARGIN)&&t.left<i.width&&(this.parent_menu||e.css("left",n.scrollLeft()+this.PAGE_MARGIN)),t.left<n.scrollLeft()+this.PAGE_MARGIN&&e.css("left",n.scrollLeft()+this.PAGE_MARGIN),t.top+i.height>n.height()+n.scrollTop()-this.PAGE_MARGIN&&e.css("top",n.height()+n.scrollTop()-i.height-this.PAGE_MARGIN),t.top<n.scrollTop()+this.PAGE_MARGIN&&e.css("top",n.scrollTop()+this.PAGE_MARGIN)},_calculate_available_space:function(e){var t=$(this.window),i=0,n=e.left;return this.parent_menu?(n=$j(this.parent_menu._e_menu).offset().left,i=t.width()+t.scrollLeft()-n-this.parent_menu._get_size().width):i=t.width()+t.scrollLeft()-n,{left:n,right:i}},_get_offsets:function(){return{x:0,y:0}},_get_size:function(){var e=$j(this._e_menu),t=e.css("left");e.css("left",0);var i={height:e.outerHeight()||e.children().outerHeight(),width:e.outerWidth()||e.children().outerWidth()};return e.css("left",t),i},hide:function(){if(this._j_target_element&&!this._j_target_element.is('input[type="text"], textarea')&&this._j_target_element.blur(),this.visible){this.visible=!1,this._timeout_id=null,$j(this._e_menu).hide(),this._action_required_to_close||this._unattach_events(),this._responding_elements().removeClass("hover menu_open ignore_mouseout");var e=Box.Application.getService("thumbnail");e.hideThumbnail(),this._callback&&this._callback()}},show:function(){this.visible||(this._timeout_id=null,$j(this._e_menu).hide(),this._unattach_events(),this._responding_elements().removeClass("menu_open ignore_mouseout")),this.visible=!0,this._defined_inline&&this._e_menu.parentElement!=document.body&&$j(this._e_menu).detach().appendTo(document.body),this._structure(),this._render(),this._set_position(),this._action_required_to_close||this._attach_events(),this._responding_elements().addClass("hover menu_open ignore_mouseout")},redraw:function(){this.visible&&this._set_position()},_render:function(){},_structure:function(){}},{});Box.Timing.execution.push({name:"js/menus/box_abstract_scrollable_menu.js",time:(new Date).getTime()});var Abstract_Scrollable_Menu=Abstract_Menu.extend({_scroll_interval_id:null,show:function(e){this.base();var t=this._get_size(),i=$j(window);this._prevent_rendering_offscreen&&t.height+60>=i.height()&&(this._show_scroll(),this._set_position())},hide:function(){this.base(),this._remove_scroll()},_show_scroll:function(){var e=this,t=$j(window),i=$j(this._e_menu),n=i.find(".list_menu li:first").parent(),o=n.parent(),a=n.outerHeight(),r=t.height()-75,s=a-r;o.css("padding",0),n.css("overflow-y","hidden").height(r).scrollTop(0);var l=i.find(".list_menu_scroll_up"),c=i.find(".list_menu_scroll_down");l.length?(l.show(),c.show()):(l=$j('<ul class="list_menu_scroll list_menu_scroll_up"></ul>').append($j('<li class="txt_c list_menu_scroll_arrow list_menu_scroll_arrow_up"><b class="sprite_9x9_up_arrow list_img"></b></li>')).append($j('<li class="separator pan mvs"><hr class="divider mbn mhs"></li>')),l.mouseenter(function(t){e._scroll_interval_id&&window.clearInterval(e._scroll_interval_id),e._scroll_interval_id=window.setInterval(function(){var e=n.scrollTop();9>=e?(n.scrollTop(0),l.find(".list_menu_scroll_arrow").addClass("list_menu_scroll_hidden")):(n.scrollTop(e-9),c.find(".list_menu_scroll_arrow").removeClass("list_menu_scroll_hidden"))},50)}).mouseleave(function(t){e._scroll_interval_id&&(window.clearInterval(e._scroll_interval_id),e._scroll_interval_id=null)}),c=$j('<ul class="list_menu_scroll list_menu_scroll_down"></ul>').append($j('<li class="separator pan mvs"><hr class="divider mbn mhs"></li>')).append($j('<li class="txt_c list_menu_scroll_arrow list_menu_scroll_arrow_down"><b class="sprite_9x9_down_arrow list_img"></b></li>')),c.mouseenter(function(t){e._scroll_interval_id&&window.clearInterval(e._scroll_interval_id),e._scroll_interval_id=window.setInterval(function(){var e=n.scrollTop();e>=s?(n.scrollTop(s),c.find(".list_menu_scroll_arrow").addClass("list_menu_scroll_hidden")):(n.scrollTop(e+9),l.find(".list_menu_scroll_arrow").removeClass("list_menu_scroll_hidden"))},50)}).mouseleave(function(t){e._scroll_interval_id&&(window.clearInterval(e._scroll_interval_id),e._scroll_interval_id=null)}),i.prepend(l),i.append(c)),n.scrollTop()<=0&&(l.find(".list_menu_scroll_arrow").addClass("list_menu_scroll_hidden"),c.find(".list_menu_scroll_arrow").removeClass("list_menu_scroll_hidden"))},_remove_scroll:function(){var e=$j(this._e_menu);e.find(".list_menu").css("height","auto"),e.find(".list_menu_scroll_up").remove(),e.find(".list_menu_scroll_down").remove()}},{});Box.Timing.execution.push({name:"js/menus/box_abstract_menu_with_submenus.js",time:(new Date).getTime()});var Abstract_Menu_With_Submenus=Abstract_Scrollable_Menu.extend({is_mouse_at_menu:!1,is_mouse_at_submenu:!1,displayed_submenu:null,_can_have_submenu:!0,_base:null,_hover_off:function(e){this.is_mouse_at_menu=!1;var t=this;this._timeout_id&&clearTimeout(this._timeout_id),this._base=this.base,this._timeout_id=setTimeout(function(){t.is_mouse_at_submenu||(t._base(),t._base=null,t._timeout_id=!1)},50)},_hover_on:function(e){this.is_mouse_at_menu=!0,this.base(e)},hide:function(){this.displayed_submenu&&this.displayed_submenu.hide(),this.base()},show_submenu:function(e,t){this.displayed_submenu&&this.displayed_submenu.hide();var i=this._new_submenu({submenu_id:e,parent_menu:this});i.show({_j_target_element:$j(t)}),this.displayed_submenu=i},_new_submenu:function(e){return new Submenu(e)}},{}),Submenu=Abstract_Scrollable_Menu.extend({parent_menu:null,keep_submenu_open:!1,isSubmenu:!0,hoverEventsEnabled:!0,_defined_inline:!0,constructor:function(e){e=e||{},this._e_menu=$j("#"+e.submenu_id).get(0),this.parent_menu=e.parent_menu},hide:function(){this.parent_menu.is_mouse_at_submenu=!1,this.base()},_get_offsets:function(){var e=this.parent_menu._get_size();return{x:e.width-3,y:-(this._j_target_element.height()+4)}},show:function(e){this._j_target_element=e._j_target_element;var t=Box_Menus.get().map_menu_id_to_menu_object[this._e_menu.id];t&&$.isFunction(t._render)&&(t._render(),t.visible=!0),this.base()}},{});Box.Timing.execution.push({name:"js/menus/box_item_menu.js",time:(new Date).getTime()});var Item_Menu=Abstract_Menu_With_Submenus.extend({item:null,type:null,_opened_by_more_btn:!1,_defined_inline:!0,constructor:function(e){e=e||{},this._e_menu=$j("#dd_menu_box_item").get(0),this.box_edit=Box.Application.getService("box-edit"),this.office_online=Box.Application.getService("office-online")},hide:function(){if($j.browser.msie&&this.item){var e=$j(this.item.element),t={"background-color":"transparent"};e.find(".item_info").css(t),e.find(".item_data").css(t)}this.base(),this.item=null},show:function(e){if(this.isSubmenu||$("body").trigger("close.menus"),e=e||{},this._target_event=e.event,this._j_target_element=$j(e.target),e.item){this._elements_told_menu_is_open=$j(e.item.element),this.item=e.item,this.type=e.type;var t=$j(this._e_menu);t.width(e.match_target_width?this._j_target_element.outerWidth():"auto"),Canvas.get().target_item=e.item,this.module_context=e.module_context,this._opened_by_more_btn=!!e.displayedByMoreButton,this.base(e),this._adjust_separators()}},_render:function(){var e=Box.Application,t=e.getService("v5"),i=t.get("Features"),n=e.getService("nav-state"),o=n.isGcm(),a=n.isSharedFolderPage(),r="folder"==this.item.type,s="file"==this.item.type,l="web_link"==this.item.type,c="boxnote"==this.item.extension,_=this.item.is_root_folder(),d=this.item.is_quarantined,u=this.item.can_delete_from_trash()||this.item.can_restore(),p=this.item.can_generate_link(),h=$j(".dd_menu_box_item li").hide();if($j("#item_menu_multiselect").hide().html(""),Canvas.get().selection.collection.items.length<=1||"right_click"!=this.type){!o&&(r||l)&&this.item.can_open()?($j("#item_menu_open").show(),l||$j("#item_menu_open_new_tab").show()):o&&r&&$j("#item_menu_export").show();var m=!(o||a||_||d||u||!p);if(m&&(this.item.is_favorited?($("#item_menu_unfavorite").show(),$("#item_menu_favorite").hide()):($("#item_menu_favorite").show(),$("#item_menu_unfavorite").hide())),s&&!c){if(this.item.permissions.download&&$j("#item_menu_download").show(),this._can_show_upload_button(this.item)){$j("#item_menu_upload_new_version").show();var f=Box.Application.getService("upload-process");f&&f.disableUploadElementForAjaxEol($("#item_menu_upload_new_version")[0])}!o&&this.item.permissions.preview&&($j("#item_menu_preview").show(),$j("#item_menu_preview_new_tab").show()),this._show_edit_options()}if(!_&&r&&this.item.permissions.download&&$j("#item_menu_download").show(),!o&&r&&this.item.permissions.upload&&(this._opened_by_more_btn||$j("#item_menu_new_folder").show(),!n.isEmbedWidget())){var g=!0;$j("#item_menu_upload_new_to_folder").show(),this.item.permissions.rename&&($j("#item_submenu_email_upload").show(),g=!1),this.item.permissions.upload&&(this.item.user_is_owner&&!Canvas.get().user.is_free_user||!this.item.user_is_owner&&this.item.permissions.options?($j("#item_submenu_upload_widget").show().find(".upgrade").hide(),g=!1):(this.item.user_is_owner||this.item.permissions.options)&&Canvas.get().user.is_free_user&&($j("#item_submenu_upload_widget").show().find(".upgrade").show(),$j("#item_submenu_upload_widget").find("a").prop("onclick",null),$j("#item_submenu_upload_widget").click(function(){var e=Box.Application.getService("v5popups");return e.showUpgradePopup("upload_widget"),!1}),g=!1),this.item.user_is_owner&&Canvas.get().user.is_free_user&&($j("#item_submenu_upload_widget_for_free_user").show(),g=!1)),g&&$j("#item_menu_upload_new_to_folder").hide()}this._show_lock_options(),this._display_collab_option(),this.item.permissions.synchronize&&(i.subfolder_sync_ui?this.item.is_synced_for_current_user===CONST.BOX_ITEM_SYNC_SYNCED?($j("#item_menu_folder_fully_synced").show(),$j("#item_submenu_sync_folder_disabled").show(),$j("#item_submenu_unsync").show()):this.item.is_synced_for_current_user===CONST.BOX_ITEM_SYNC_PARTIALLY_SYNCED?($j("#item_menu_folder_partially_synced").show(),$j("#item_submenu_sync_remaining").show(),$j("#item_submenu_unsync").show()):$j("#item_menu_sync").show():this.item.is_synced_for_current_user?$j("#item_menu_disable_sync").show():$j("#item_menu_sync").show()),this.item.is_item_type_taggable()&&this.item.permissions.create_tag?$j("#item_menu_add_edit_tags").show():$j("#item_menu_add_edit_tags").hide(),(!this.item.is_weblink()||this.item.permissions.rename)&&this._show_property_options(),n.isEmbedWidget()&&r&&this._j_target_element&&"folder_options_button"==this._j_target_element.attr("id")&&($j("#item_menu_view").show(),$j("#item_submenu_view_expanded").show(),$j("#item_submenu_view_icon").show(),$j("#item_menu_sort").show(),$j("#item_submenu_sort_name").show(),$j("#item_submenu_sort_date").show(),$j("#item_submenu_sort_size").show()),this.item.permissions.download&&this.item.permissions["delete"]&&!d&&$j("#item_menu_move").show(),!this.item.permissions["delete"]||o&&this.item.collaborated&&!this.item.user_is_owner||this.item.is_app_folder||$j("#item_menu_delete").show();var v=Canvas&&Canvas.get(),b=v&&"0"===v.current_folder.id,w=this.item.collaborated||this.item.is_self_or_ancestor_collaborated&&b;!o&&w&&!this.item.user_is_owner&&r&&$j("#item_menu_remove_folder").show(),this.item.is_app_folder&&this.item.user_is_owner&&$j("#item_menu_revoke_folder").show(),this._render_openbox_actions();var y=this.get_page();"shared"!=y&&this._show_share_collab_options(),("inbox"==y||"profile"==y||"shared"==y)&&($j("#item_menu_upload_new_to_folder").hide(),$j("#item_menu_lock_for_free_user").hide(),"shared"==y&&($j("#item_menu_lock").hide(),$j("#item_menu_unlock").hide()),$j("#item_menu_properties").hide(),$j("#item_submenu_general_info_file").hide(),$j("#item_submenu_general_info").hide(),$j("#item_submenu_expiration").hide(),$j("#item_submenu_version_for_free_user").hide(),$j("#item_submenu_version").hide(),$j("#item_submenu_advanced").hide(),$j("#item_submenu_access_level").hide(),$j("#item_submenu_access_stats").hide(),$j("#item_submenu_watermarking").hide(),$j("#item_menu_sync").hide(),$j("#item_menu_folder_fully_synced").hide(),$j("#item_menu_folder_partially_synced").hide(),$j("#item_menu_disable_sync").hide(),$j("#item_menu_move").hide(),$j("#item_menu_delete").hide(),$j("#item_menu_remove_folder").hide()),"shared"==y?($j("#item_menu_add_edit_tags").hide(),$j("#item_submenu_send_link").hide(),$j("#item_submenu_embed_widget").hide(),$j("#item_submenu_unshare").hide(),$j("#item_menu_request_unlock").hide()):"gcm"==y&&($j("#item_menu_move").hide(),$j("#item_submenu_embed_widget").hide(),$j("#item_submenu_widget").hide(),$("#item_menu_add_services").hide(),$("#item_submenu_add_services").hide()),"right_click"!=this.type&&($j("#item_menu_open_new_tab").hide(),$j("#item_menu_preview_new_tab").hide()),"containing_folder"==this.type?($j("#item_menu_open").hide(),$j("#item_menu_add_services").hide()):$j("#item_menu_new_folder").hide(),u&&(h.hide(),this.item.can_delete_from_trash()&&$j("#item_menu_delete_from_trash").show(),this.item.can_restore()&&this.item.raw_size<Canvas.get().current_folder.free_space_amount&&$j("#item_menu_restore").show()),d&&($j("#item_menu_move").hide(),$j("#item_menu_lock").hide()),"folder"!==this.item.type||this.item.is_root_folder()||n.isSharedPageOrEmbedWidget()||n.isTrash()||o||($j("#item_menu_properties").hide(),$j("#item_menu_general_info").show(),$j("#item_menu_folder_settings").show(),$j("#item_menu_sharing_and_collab").show(),$j("#item_menu_manage_folder").show(),this._display_collab_option())}else{var x=!0;n.isEmbedWidget()?$j(".multi_options li").each(function(){var e=$j(this);e.clone().appendTo("#item_menu_multiselect"),x=!1}):$("#actionbar-multiple-selection li:visible").each(function(){var e=$(this),t=$(this).find("button").attr("aria-label");t&&($("<li />").attr("id",e.attr("id")).addClass("dropdown_menu").text(t).appendTo("#item_menu_multiselect"),x=!1)}),x&&$j("<li />").addClass("ignore_mouseover").css("cursor","default").text($t("No actions available","js_item_menu_no_actions")).appendTo("#item_menu_multiselect");var S=$j("#item_menu_multiselect");S.find("li").each(function(){var e=$j(this);"none"!=e.css("display")&&e.css("display","block")}),S.show()}this._adjust_separators()},_can_show_upload_button:function(e){var t=Box.Application.getService("nav-state"),i=t.isGcm(),n=e.is_package,o=e.permissions.upload,a=t.isSharedFilePage()||t.isSharedFolderPage();return!i&&!n&&o&&!a},get_page:function(){var e="files",t=Box.Application.getService("v5").get("current_rm"),i=Box.Application.getService("nav-state");return"box_v2_new_inbox"==t?e="inbox":"box_user_profile_view"==t?e="profile":"box_shared_show"==t||"box_shared_show_by_name"==t||"box_view_vanity_url"==t?e="shared":i.isGcm()&&(e="gcm"),e},_get_box_edit_item_menu_label_text:function(e){var t=this.box_edit.getNativeApplicationName(this.item.extension),i="";return i=""===t?e?$t("Desktop App","item_menu_edit_office"):$t("Edit","box_edit_display_text"):e?t:$t("Open with %1","open_with_native_app_name",t)},_display_embed_option:function(){this._check_item_open_access()?$j("#item_submenu_embed_widget").show():$j("#item_submenu_embed_widget").hide()},_check_item_open_access:function(){return this.item&&this.item.shared&&this.item.shared_access==Item.SHARED_ACCESS_OPEN},_display_collab_option:function(){var e=Box.Application.getService("v5"),t=(e.get("Features"),Box.Application.getService("nav-state")),i=$("#item_submenu_collaborators");t.isGcm()||t.isSharedPageOrEmbedWidget()||t.isTrash()||(i=$("#item_menu_collaborators")),i.hide();var n=this.item,o=n.permissions.view,a=n.is_self_or_ancestor_collaborated,r=n.permissions.options,s=n.hide_collaborators===!0||"1"===n.hide_collaborators||n.parent_hide_collaborators===!0||"1"===n.parent_hide_collaborators;a&&o&&(!s||r)&&i.show()},show_submenu:function(e,t){this.base(e,t)},_show_edit_options:function(){var e=this._should_edit_with_office_online_only();if(this.item.permissions.download&&this.item.permissions.upload||e){var t=this.office_online&&this.office_online.isOfficeOnlineAvailableAndSupportedForFile(this.item);if(t){$(".office_online_submenu").show();var i=$("#item_menu_edit_with_office_online");this._show_proper_office_online_app_name(i)}e||this._show_box_edit_option(t)}},_should_edit_with_office_online_only:function(){var e="access_exception_item_locked_by_app_lock",t=this.office_online&&null!==this.item.lock&&this.office_online.isServiceIdOfficeOnline(this.item.lock.service_id),i=this.item.permissions.download||this.item.removed_permissions.download===e,n=this.item.permissions.upload||this.item.removed_permissions.upload===e;return t&&i&&n},_show_proper_office_online_app_name:function(e){var t=null,i=null;switch(this.item.extension){case"docx":t="Word Online",i="word-online-edit-with-icon";break;case"xlsx":t="Excel Online",i="excel-online-edit-with-icon";break;case"pptx":t="PowerPoint Online",i="powerpoint-online-edit-with-icon";break;default:i="sprite_16x16_edit_with_office_online"}t&&e.find(".item_menu_label").text(t),i&&e.find(".list_img").removeClass().addClass("list_img "+i)},_show_box_edit_option:function(e){var t=Box.Application.getService("browser"),i=Box.Application.getService("nav-state"),n=Box.Application.getGlobal("Features");if(this.box_edit){var o=this.box_edit.isBoxEditInstalled(),a=!this.box_edit.isBoxEditDisabledByAdmin()&&(t.isBrowserPluginsSupported()||n.box_edit_two),r=!i.isEmbedWidget()||o;if(a&&r){var s=!o&&this.box_edit.isExtensionSupportedByDefault(this.item.extension);if(this.box_edit.canUserOpenFileOnDesktop(this.item)||s){var l=this._get_box_edit_item_menu_label_text(e),c=$(e?"#item_menu_edit_with_box_edit":"#item_menu_box_edit");c.find(".item_menu_label").text(l),this._showProperBoxEditAppIcon(c),c.show()}}}},_showProperBoxEditAppIcon:function(e){var t,i=this.box_edit.getNativeApplicationName(this.item.extension);switch(i){case"Microsoft Word":t="microsoft-word-edit-with-icon";break;case"Microsoft Excel":t="microsoft-excel-edit-with-icon";break;case"Microsoft PowerPoint":t="microsoft-powerpoint-edit-with-icon";break;default:t="sprite_16x16_edit_file"}t&&e.find(".list_img").removeClass().addClass("list_img "+t)},_show_share_collab_options:function(){if(this.item.can_generate_link()){$j("#item_menu_sharing_and_collab").show(),$j("#item_menu_share").show();var e=Box.Application.getService("nav-state");this.item.is_weblink()||e.isGcm()||e.isEmbedWidget()||$j("#item_menu_embed_widget").show()}this.item.can_collab()&&$("#item_menu_collaborate").show()},_show_share_options:function(){var e=this.item.can_generate_link(),t=this.item.can_collab(),i=Box.Application.getService("nav-state");(e||t)&&($j("#item_menu_share").show(),t&&$j("#item_submenu_collaborate").show(),e&&($j("#item_submenu_get_link").show(),$j("#item_submenu_send_link").show()),this.item.is_folder()&&this.item.permissions.share&&!i.isEmbedWidget()&&$j("#item_submenu_embed_widget").show(),this.item.permissions.share&&(this.item.shared||this.item.vanity_name)&&$j("#item_submenu_unshare").show())},_show_lock_options:function(){var e="file"==this.item.type,t=this.item.lock;e&&(t?t.can_unlock?$j("#item_menu_unlock").show():this.item.permissions.view&&$j("#item_menu_request_unlock").show():this.item.is_manually_lockable()&&this.item.permissions.upload&&this.item.permissions.download&&(this.item.owner_is_free?Canvas.get().user.is_free_user&&$j("#item_menu_lock_for_free_user").show():$j("#item_menu_lock").show()))},_show_property_options:function(){var e=!1,t=Box.Application.getService("nav-state"),i=t.isGcm();this.item.is_root_folder()||$j("#item_menu_properties").show(),this.item.permissions.view&&($j("#item_submenu_general_info").show(),this.item.is_folder()&&(this.item.permissions.options||i)&&$j("#item_submenu_advanced").show(),e=!0),this.item.can_view_download_stats()&&!this.item.owner_is_free&&($j("#item_submenu_access_stats").show(),e=!0);var n=Canvas.get().user.has_custom_feature("auto_expiration")&&(this.item.can_change_share_expiration||this.item.can_change_delete_expiration);!i&&n&&($j("#item_submenu_expiration").show(),e=!0),this.item.is_folder()&&!t.isEmbedWidget()&&this.item.permissions.view&&($j("#item_submenu_email").show(),e=!0);var o=User.find(this.item.user_id);o&&this.item.is_file()&&this.item.permissions.view&&!this.item.is_boxnote()&&(-1==$.inArray("version_history",o.features)?$j("#item_submenu_version_for_free_user").show():$j("#item_submenu_version").show(),e=!0),this.item.is_file()&&$j("#item_submenu_watermarking").length&&$j("#item_submenu_watermarking").show(),e||$("#item_menu_properties").hide(),this.item.is_item_type_taggable()&&this.item.permissions.create_tag&&$j("#item_menu_add_edit_tags_file").show()},_adjust_separators:function(){var e=$j(this._e_menu).find(".separator");e.show().each(function(){var e=$j(this).nextAll(":visible:first"),t=$j(this).prevAll(":visible:first");(!e.length||e.hasClass("separator"))&&$j(this).hide(),t.length||$j(this).hide()})},_render_openbox_actions:function(){var e=Box.Application.getService("openbox-service-actions"),t=e.getActions(this.item,{type:"openbox"}),i=window.promoted_app_ids||"",n=Box.Application.getService("nav-state");i=i.split(","),$j("#openbox_separator").hide(),$j("#dd_menu_box_item").find(".item_menu_action_default").remove();for(var o=0,a={},r=0,s=t.length;s>r;r++){a=t[r],$j.inArray(a.id.substring("openbox_service".length),i)>-1&&(a.promoted=!0);var l=this._render_openbox_action(a);l&&o++}var c,_=n.isEmbedWidget();if(o){var d=$j("#item_menu_more_openbox");if(d.find(".badge").text(o),d.show(),Canvas.get().logged_in&&!_){var u=$j("#submenu_openbox_menu");c=$j("#item_submenu_add_services").detach();var p=$j("#openbox_separator").detach();p.appendTo(u).show(),c.appendTo(u).show()}}else Canvas.get().logged_in&&!_&&(c=$j("#item_menu_add_services").detach(),c.show().appendTo($j("#dd_menu_box_item .item_menu")))},_render_openbox_action:function(e){function t(){n.off().on("click",function(){return e.execute(),!1})}if(!e.can_execute())return!1;var i=!0,n=$j('.openbox_action[data-openbox_action_id="'+e.id+'"]');return n.length||(i=!1,n=$j("<li>").attr("data-openbox_action_id",e.id).addClass("openbox_action"),n.append($j('<a href="#" class="item_menu_item_openbox" />').text(e.name)),e.favicon_url&&n.children(".item_menu_item_openbox").prepend($j('<img class="list_img" width="16" height="16">').attr("src",e.favicon_url))),e.executed_by_default||e.promoted?(i||$j("#default_openbox_separator").before(n.addClass("item_menu_action_default")),t(),!1):e.editable_on_gallery?($j(this._e_menu).find("#item_menu_edit_file").off().on("click",function(){return e.execute({skip_popup:!0}),!1}).show(),this.box_edit&&this.box_edit.isFileExtHandledByOpenbox(this.item.extension)&&$j("#item_menu_box_edit").hide(),t(),!1):this.box_edit&&this.box_edit.isActionIdBoxEdit(e.id)||this.office_online&&this.office_online.isActionIdOfficeOnline(e.id)?!1:(i||$j("#item_submenu_openbox ul").append(n),t(),n.show(),!0)},event_click:function(e){var t=Box.Application,i=t.getService("v5popups"),n=t.getService("v5popups-postload"),o=t.getService("nav-state"),a=$j(e.target).closest("li")[0],r=(t.getService("v5").get("Features"),t.getService("nav"));if(!this.item||!a)return!1;var s=this.item.j_element,l=a.id;if("item_menu_multiselect"==a.parentNode.id)return Box_Menus.get().multi_options_menu.event_click(e);switch(l){case"item_menu_open":this.item.click(),this.hide();break;case"item_menu_open_new_tab":this.item.open_in_new_window();break;case"item_menu_preview":s&&(t.navigate(s.find("a.item_link").attr("href")),this.hide());break;case"item_menu_preview_new_tab":this.item.open_in_new_window();break;case"item_menu_download":this.item.download(),this.hide();break;case"item_menu_box_edit":case"item_menu_edit_with_box_edit":this.box_edit&&this.box_edit.isBoxEditFullyEnabled(this.item)?this.box_edit.executeBoxEdit(this.item.id,this.item.typed_id):t.getService("popups").open("box_edit_download",{data:{action:"edit",typed_id:this.item.typed_id,extension:this.item.extension}});break;case"item_menu_edit_with_office_online":this.office_online.launchFileActionForItem(this.item);break;case"item_menu_new_folder":this.item.new_folder();break;case"item_menu_upload_new_version":var c=Upload_Process.get();"default"===c.get_type()?t.getService("upload-process").showAjaxEolMessage():Upload_Process.get().show_upload_new_version_popup();break;case"item_menu_lock_for_free_user":i.showUpgradePopup("file_lock");break;case"item_menu_request_unlock":n.showUnlockRequestPopup(Canvas.get().target_item.lock);break;case"item_menu_share":this.show_popup_redesign(this.item);break;case"item_menu_embed_widget":this.show_file_embed_widget(this.item);break;case"item_submenu_send_link":Box_Menus.get().menu.handle_share_click("send");break;case"item_menu_sync":this.item.synchronize();break;case"item_menu_properties":break;case"item_menu_general_info":case"item_submenu_general_info":this.item.edit_properties();break;case"item_menu_folder_settings":if("folder"===this.item.type){var _="/folder/"+this.item.id+"/settings";return r.redirect(_),!1}break;case"item_menu_add_edit_tags":case"item_menu_add_edit_tags_file":this.item.tag();break;case"item_menu_disable_sync":this.item.synchronize({unsync:!0});break;case"item_menu_move":this.item.move({create_new_action_instance:!0});break;case"item_menu_delete":if(this.item.id==Canvas.get().current_folder.id){var d=Canvas.get().current_folder;o.set({id:d.parent,page:0,folderName:""})}this.item.delete_me();break;case"item_menu_remove_folder":if(t.getGlobalConfig("showAmsterdamCollabSharing")){var u=t.getService("collab-actions");u.removeCurrentUserFromItem(this.item.typed_id),this.hide()}else this.showCurrentUserTaskAffectedWarningOnRemove(this.item.typed_id);break;case"item_menu_revoke_folder":this.item.revoke_app_folder();break;case"item_menu_delete_from_trash":this.item.delete_from_trash();break;case"item_menu_restore":this.item.restore();break;case"item_menu_lock":this.item.lock_file();break;case"item_menu_unlock":this.item.unlock_file();break;case"item_submenu_email_upload":case"item_submenu_email":Box_Menus.get().menu.item.edit_properties({selected_tab:"email_options"});break;case"item_submenu_upload_widget":Box_Menus.get().menu.item.embed_upload_widget();break;case"item_menu_collaborate":case"item_submenu_collaborate":this.handle_item_submenu_collaborate_click();break;case"item_menu_favorite":this.handle_item_favorite_click();break;case"item_menu_unfavorite":this.handle_item_unfavorite_click();break;case"item_submenu_get_link":Box_Menus.get().menu.handle_share_click("link");break;case"item_submenu_embed_widget":Box_Menus.get().menu.handle_share_click("embed");break;case"item_submenu_access_stats":Box_Menus.get().menu.item.edit_properties({selected_tab:"stats"});break;case"item_submenu_version_for_free_user":var p=Canvas.get().user;if(p.is_free_user||this.item.user_id===p.id)i.showUpgradePopup("version_history");else{var h=$t("This feature is unavailable because the owner does not have Version History enabled.","feature_disabled_by_owner_error_message");Box.Application.getService("notifications").error(h)}break;case"item_submenu_version":Box_Menus.get().menu.item.version_history();break;case"item_menu_collaborators":case"item_submenu_collaborators":this.handle_item_submenu_collaborators_click();break;case"item_submenu_advanced":Box_Menus.get().menu.item.edit_properties({selected_tab:"advanced"});break;case"item_submenu_expiration":Box_Menus.get().menu.item.set_expirations();break;case"item_submenu_sync_remaining":Box_Menus.get().menu.item.synchronize();break;case"item_submenu_unsync":Box_Menus.get().menu.item.synchronize({unsync:!0});break;case"item_menu_add_services":case"item_submenu_add_services":var m=t.getService("url");m.openWindow("/services");break;case"item_menu_export":if(o.isGcm()){var f=Box_Menus.get().menu.item;Box_Master_GCM.get().export_folder_tree(f)}break;case"item_menu_quarantine_restore":t.broadcast("x-quarantinerestore",{element:this.module_context}),this.hide();break;case"item_menu_quarantine_delete":t.broadcast("x-quarantinedelete",{element:this.module_context}),this.hide();break;case"item_menu_quarantine_false_positive":t.broadcast("x-quarantinefalsepositive",{element:this.module_context}),this.hide();break;case"item_submenu_watermarking":this.showWatermarkingPopup();break;default:return!1}return!1},_has_query_params:function(e){return-1===e.indexOf("?")},_get_offsets:function(){var e=this._target_event?{x:-5,y:-5}:{x:0,y:-7};return this._j_target_element.is("button")&&(e.y=11),e},handle_share_click:function(e){if(""==this.item.shared_link){var t=this;return this.item.get_shared_info(function(){t.handle_share_click(e)}),!1}return this.item.sharebar({selected_tab:e}),this.hide(),this.displayed_submenu.hide(),!1},handle_item_submenu_collaborate_click:function(){var e,t=Box.Application,i=t.getService("v5"),n=i.get("Box_Menus").menu;if(n.item)if(t.getGlobalConfig("showAmsterdamCollabSharing")){var o=t.getService("url"),a=o.getGcmCompatibleRm("collab_invite_popup");e=t.getService("popups-amsterdam"),e.open(a,{data:{itemTypedId:n.item.typed_id}}),this.hide()}else e=t.getService("popups"),e.open("collaborate",{data:{typed_id:n.item.typed_id}})},handle_item_submenu_collaborators_click:function(){var e=Box.Application,t=e.getService("v5"),i=t.get("Box_Menus").menu.item;e.getService("logger").sendLog("collab","OPEN_COLLAB_POPUP",{context:"item_menu",content:"redesign"});var n=e.getService("nav-state");if(e.getGlobalConfig("showAmsterdamCollabSharing")&&!n.isGcm()){
var o="/folder/"+i.id+"/collaborators";n.isEmbedWidget()?window.open(o):e.getService("nav").redirect(o)}else e.getService("popups").open("show_collabs_by_folder",{data:{folderId:i.id,collabId:"-1",collabType:"inherited"}})},handle_item_favorite_click:function(){var e=Box.Application,t=e.getService("v5").get("Box_Menus").menu.item;e.broadcast("favoritetoggled",{item:t}),e.getService("fileop-favorites").add(t.typed_id,!1,"favorite"+t.type+"menu"),this.hide()},handle_item_unfavorite_click:function(){var e=Box.Application,t=e.getService("v5").get("Box_Menus").menu.item;e.broadcast("favoritetoggled",{item:t}),e.getService("fileop-favorites").remove(t.typed_id,!1,"unfavorite"+t.type+"menu"),this.hide()},show_popup_redesign:function(e){var t=this;e.shared_link?this.show_share_popup_redesign(e):this.share_and_show_popup_redesign(e,function(){t.show_share_popup_redesign(e)})},share_and_show_popup_redesign:function(e,t){var i=Box.Application,n=i.getService("ajax"),o=i.getService("url"),a={itemTypedId:e.typed_id},r=o.getGcmCompatibleRm("box_share_item_by_typed_id");n.post(r,a,{success:function(n){t(),i.broadcast("sharedlinkcreated",{itemTypedId:e.typed_id,context:"item_menu"})},error:function(e){i.getService("notifications").error(e.data)}})},show_share_popup_redesign:function(e){var t,i=Box.Application;if(i.getGlobalConfig("showAmsterdamCollabSharing")){var n=i.getService("url"),o=n.getGcmCompatibleRm("item_share");this.hide(),t=i.getService("popups-amsterdam"),t.open(o,{data:{itemTypedId:e.typed_id}})}else t=i.getService("popups"),t.open("show_share_properties_for_item",{data:{itemTypedId:e.typed_id,selectedTab:"share"}})},show_file_embed_widget_popup:function(e){var t=Box.Application,i=t.getService("popups-amsterdam");this.hide(),i.open("item_embed_widget_settings",{data:{itemTypedId:e.typed_id}})},show_file_embed_widget:function(e){var t=this;e.shared_link?this.show_file_embed_widget_popup(e):this.share_and_show_popup_redesign(e,function(){t.show_file_embed_widget_popup(e)})},showWatermarkingPopup:function(){var e=this,t=this.item,i=Box.Application.getService("popups-amsterdam");t.is_file()&&(e.hide(),i.open("watermark_label_popup",{data:{typedId:t.typed_id}}))},selfUpdateSuccessful:function(e,t){t||(t=""),Box.Application.navigate(t,{},{callback:function(){Box.Application.getService("notifications").confirm(e)}})},showCurrentUserTaskAffectedWarningOnRemove:function(e){var t=$t("Are you sure you want to remove yourself as a collaborator? You will no longer have access to content in this folder or its sub-folders and will not be able to complete pending tasks.","task_affected_current_user_removal_warning"),i=Box.Application.getService("popups"),n=this;i.confirm(t,{onconfirm:function(){n.removeCurrentUserWithChecks(!0,e)},oncancel:function(){Box.Application.broadcast("collabchangecanceled")}})},handleCurrentUserModifyOwnInheritedCollabRecord:function(){var e=Box.Application.getService("popups"),t=$t("You cannot modify your collaboration settings in a subfolder of a collaborated folder. Please visit the parent folder you are collaborated in to make any changes.","modify_own_collab_settings_error_due_to_inherited_collab");e.alert(t,{onclose:function(){Box.Application.broadcast("collabchangecanceled")}})},removeCurrentUserWithChecks:function(e,t){var i=Box.Application.getService("url").getGcmCompatibleRmUrl("delete_current_user_collab_by_folder"),n={folderTypedId:t,ignoreTaskWarning:!!e,ignoreInheritanceCheck:!1},o=this;Box.Application.broadcast("collabchangeinitiated"),$.postJSON(i,n,function(e){if(e.success){var i=$t("You have removed yourself as a collaborator.","collaborate_confirmation_remove_self_as_collab");o.selfUpdateSuccessful(i,"/files")}else switch(e.code){case"collabNotFound":o.handleCurrentUserModifyOwnInheritedCollabRecord();break;case"taskAffected":o.showCurrentUserTaskAffectedWarningOnRemove(t);break;default:Box.Application.getService("notifications").error(e.message),Box.Application.broadcast("collabremoveerror")}o.hide()})}},{});Box.Timing.execution.push({name:"js/menus/box_create_item_menu.js",time:(new Date).getTime()});var Create_Item_Menu=Abstract_Menu.extend({_defined_inline:!0,constructor:function(e){e=e||{},this._e_menu=$j("#dd_menu_create_item").get(0),this.box_edit=Box.Application.getService("box-edit")},show:function(e){$("body").trigger("close.menus"),e=e||{},this._j_target_element=$j(e.target),this._elements_that_keep_menu_open=$j(e.target).find("span"),this._isOfficeAndGoogleDocCreationPermitted()?($(".office_online_types").show(),$(".newdoc_types").show()):($(".office_online_types").hide(),$(".newdoc_types").hide()),this._filter_supported_box_edit_types($j(this._e_menu).find(".box_edit_types"),$j(this._e_menu).find(".office_online_types")),this.base();var t=$("#create_item_button").closest(".actionbar_button_wrapper"),i=Box.Application.getGlobalConfig("showAmsterdamCollabSharing");i?$j(this._e_menu).appendTo(t).css("top","34px").css("left",""):$j(this._e_menu).appendTo(t).css("top","").css("left",""),this._isBoxNoteCreationPermitted()?this._showCreateBoxNoteFromCreateItemMenu():this._hideCreateBoxNoteFromCreateItemMenu()},_showCreateBoxNoteFromCreateItemMenu:function(){var e=Box.Application.getService("dom"),t=this._e_menu.querySelector("#new_item_new_boxnote");e.removeClass(t,"hidden")},_hideCreateBoxNoteFromCreateItemMenu:function(){var e=Box.Application.getService("dom"),t=this._e_menu.querySelector("#new_item_new_boxnote");e.addClass(t,"hidden")},_isBoxNoteCreationPermitted:function(){var e=Box.Application.getService("v5").get("Canvas").current_folder;if(e&&e.permissions){var t=e.permissions;return t.preview&&t.upload&&t.download&&t.share||e.is_root_folder()}return!1},_isOfficeAndGoogleDocCreationPermitted:function(){var e=Box.Application.getService("v5").get("Canvas").current_folder;if(e&&e.permissions){var t=e.permissions;return t.download}return!1},_get_offsets:function(e){return{x:0,y:11}},_filter_supported_box_edit_types:function(e,t){var i=Box.Application.getService("browser"),n=Box.Application.getService("nav-state"),o=Box.Application.getGlobal("Features"),a=Box.Application.getService("office-online");this.box_edit&&!this.box_edit.isBoxEditDisabledByAdmin()&&(i.isBrowserPluginsSupported()||o.box_edit_two)?this.box_edit.isBoxEditInstalled()?(t.remove(),this._hide_unsupported_file_types(e)):n.isEmbedWidget()?(e.remove(),t.remove()):a.isOfficeOnlineEnabled()?e.remove():(t.remove(),e.off("click").on("click",function(){var e=$j(this);return Box.Application.getService("popups").open("box_edit_download",{data:{action:"create",file_type:e.data("newdoc_type"),extension:e.data("newdoc_extension")}}),!1})):a.isOfficeOnlineEnabled()?e.remove():(e.remove(),t.remove())},_hide_unsupported_file_types:function(e){for(var t,i,n=0,o=e.length;o>n;n++)t=$j(e).eq(n),i=t.data("newdoc_extension"),i&&this.box_edit.getNativeApplicationName(i)||t.hasClass("separator")||t.hide()},event_click:function(e){var t=Box.Application.getService("nav-state"),i=$(e.target).closest("li").get(0);if(t.isSearch()||!i)return!1;var n=Box.Application.getService("popups"),o=Box.Application.getService("v5").get("Canvas");switch(i.id){case"new_item_new_folder":case"new_item_new_folder_link":o.current_folder.new_folder();break;case"new_item_new_boxnote":case"new_item_new_boxnote_link":n.open("new_document",{data:{folder_id:o.current_folder.id,type:"boxnote"}});break;case"new_item_new_bookmark":case"new_item_new_bookmark_link":n.open("new_web_link",{data:{folder_id:o.current_folder.id}});break;default:var a=$j(i),r=a.parents().andSelf(),s=a.attr("data-newdoc_type")||a.parent().attr("data-newdoc_type");s&&r.hasClass("new_file_type")&&n.open("new_document",{data:{folder_id:o.current_folder.id,type:s}})}return!1}},{});Box.Timing.execution.push({name:"js/menus/box_select_element.js",time:(new Date).getTime()});var Select_Element=Abstract_Menu.extend({j_select:null,constructor:function(e){this.j_select=$j(e).parent(),this.j_button=$j(e),this._j_target_element=this.j_button,this._e_menu=this.j_select.find(".select_options")[0]},show:function(){if(!this.j_button.hasClass("disabled")){if(this.j_button.data("not_show"))return void this.j_button.data("not_show",!1);this.menu_clicked=!1,$j(".select_options").filter(":visible").hide(),$j(this._e_menu).detach().appendTo($j("body")),this._set_position(),this._attach_events(),$j(this._e_menu).width($j(this.j_button).outerWidth()-2).show(),this.j_button.focus()}},_set_position:function(){var e;e=this._j_target_element.offset(),e.top+=this._j_target_element.outerHeight(),this._e_menu.style.display="block",this._e_menu.style.position="absolute",this._e_menu.style.left=e.left+"px",this._e_menu.style.top=e.top+"px"},_attach_events:function(){var e=this;this.j_button.unbind("blur").bind("blur",function(t){e.menu_clicked||$j(e._e_menu).hide().detach().appendTo(e.j_select)}),this.j_button.off("click.selectelement").on("click.selectelement",function(t){$j(e._e_menu).is(":visible")&&$j(this).blur().data("not_show",!0)}),$j(this._e_menu).off("mousedown.selectelement").on("mousedown.selectelement",function(t){e.menu_clicked=!0}),$j(this._e_menu).off("scroll.selectelement").on("scroll.selectelement",function(t){e.menu_clicked=!1,e.menu_scrolled=!0}),$j("body").off("mousedown.selectelement").on("mousedown.selectelement",function(t){e.menu_scrolled&&!e.menu_clicked&&($j(e._e_menu).hide().detach().appendTo(e.j_select),e.menu_scrolled=!1)}),$j(this._e_menu).find("a").off("mousedown.selectelement").on("mousedown.selectelement",function(t){e.menu_clicked=!0}).unbind("click").bind("click",function(t){return e.handle_option_click(t),!1})},handle_option_click:function(e){var t=this,i=$j(e.target),n=i.closest("li"),o=n.find(".hidden_value").text();n.hasClass("disabled")||(n.removeClass("hover"),Box.Application.getService("tooltips").hideTooltips(),this.select(o)),n.closest(".select_options").hide().detach().appendTo(t.j_select),Box.Application.broadcast("x-optionclick",{id:this.j_select.attr("id"),value:o})},select:function(e){var t=this.j_select,i=$j(this._e_menu).find('[data-option-name="'+e.toString()+'"]');i.length||(i=$j(this._e_menu).find("."+e.toString().replace(" ","-")));var n=i.text();t.find(".currently_selected").text(n),t.find("input").val(e).change()},option_actions:function(e,t){if(t){var i=$j(this._e_menu).find("."+e),n=[],o=[];$j.in_array("show",t)&&o.push("hidden_value"),$j.in_array("hide",t)&&n.push("hidden_value"),$j.in_array("enable",t)&&o.push("disabled"),$j.in_array("disable",t)&&n.push("disabled"),n.length&&i.addClass(n.join(" ")),o.length&&i.removeClass(o.join(" "))}}},{});Box.Timing.execution.push({name:"js/menus/box_multi_options_menu.js",time:(new Date).getTime()});var Multi_Options_Menu=Base.extend({_collection:null,_positioned:!1,_is_embed_widget:!1,_is_gcm:!1,_offsets:{x:12,y:-15,stalker:51},_actions:{multi_options_sharebar:{selected_tab:"send"},multi_options_tag:void 0,multi_options_move:{from:"Group Move/Copy"},multi_options_delete_me:void 0,multi_options_download:void 0,multi_options_delete_from_trash:void 0,multi_options_restore:void 0,multi_options_synchronize:void 0},constructor:function(){this._collection=new ItemCollection;var e=Box.Application.getService("nav-state");this._is_embed_widget=e.isEmbedWidget(),this._is_gcm=e.isGcm(),this._is_embed_widget||this._is_gcm||(this._offsets.x=49)},render:function(e){var t,i,n=this,o=!1,a=Box.Application.getService("nav-state"),r=Box.Application.getService("dom");if(this._collection=e,0===this._collection.size())return void this.hide();o=!1,t=this._get_j_element();var s;for(s in this._actions)if(this._actions.hasOwnProperty(s)){var l=s.replace("multi_options","can"),c=n._collection[l]();t.find("#"+s)[c?"show":"hide"](),o=o||c}if(a.isGcm()&&this.hide_gcm_actions(),t.find("#multi_options_no_actions")[o?"hide":"show"](),a.isGcmQuarantine()||!this._is_embed_widget&&!this._is_gcm){var _=r.query("#actionbar-wrapper");if(_){var d=_.getAttribute("data-actionbar"),u=a.isGcmQuarantine()?"quarantine":"multiple-selection";d!==u&&(_.setAttribute("data-prev-actionbar",d),_.setAttribute("data-actionbar",u),$(".actionbar_button_wrapper:visible:first button").addClass("mln")),a.isGcmQuarantine()&&(i=r.query("#quarantine_actions_button"),r.removeClass(i,"disabled"),i.disabled=!1)}}else this._show_stalker_or_non_stalker(),this._position(),this._get_j_element().trigger("scroll.stalker")},hide_gcm_actions:function(){var e=this._get_j_element();e.find("#multi_options_move").hide(),e.find("#multi_options_sharebar").hide();var t=Box.Application.getService("nav-state");t.isTrash()&&e.find("#multi_options_download").hide()},getItemIdsFromCollection:function(e){var t=[],i=0,n=e.size(),o=e.items;for(i=0;n>i;i++)t.push(o[i].typed_id);return t},event_click:function(e){var t,i=Box.Application,n=Box.Application.getService("nav-state");if(n.isGcmQuarantine()||!this._is_embed_widget&&!this._is_gcm){var o=$(e.target);if(t=o.hasClass("dropdown_menu")?o.attr("id"):o.parents("li").first().attr("id"),!t)return!1}else t=e.target.parentNode.id;if(t in this._actions){var a=t.replace("multi_options_","");if("sharebar"===a){var r=this.getItemIdsFromCollection(this._collection);r.length&&i.getService("popups").open("show_multi_items_share",{data:{itemTypedIds:r}})}else this._collection[a](this._actions[a])}return!1},hide:function(){var e=Box.Application.getService("nav-state");if(e.isGcmQuarantine()||!this._is_embed_widget&&!this._is_gcm){var t=Box.Application.getService("dom"),i=t.query("#actionbar-wrapper");if(i){var n=i.getAttribute("data-actionbar"),o=i.getAttribute("data-prev-actionbar");if(o&&"multiple-selection"===n)$(".actionbar_button_wrapper:visible:first button").removeClass("mln"),i.setAttribute("data-actionbar",o);else if("quarantine"===n){var a=t.query("#quarantine_actions_button");t.addClass(a,"disabled"),a.disabled=!0;var r=this._get_j_element();r&&r.css("visibility","hidden")}}}else this._get_j_element().css("visibility","hidden")},_get_j_element:function(){return $(this._is_embed_widget||this._is_gcm?".multi_options":"#actionbar-multiple-selection")},_get_j_container:function(){return $(".multi_options_container").filter(function(e,t){return $(t).height()>0})},_hide_non_stalker:function(){this._get_j_element().first().css("visibility","hidden"),this._positioned||this._position()},_show_non_stalker:function(){return 0===this._collection.size()?void this.hide():(this._get_j_element().first().css("visibility","visible"),void(this._positioned||this._position()))},_show_stalker_or_non_stalker:function(){this._get_j_element().last().css("visibility","visible")},_stalk:function(){var e=this;this._get_j_element().stalker({offset:this._offsets.stalker,startCallback:function(){e._hide_non_stalker()},stopCallback:function(){e._show_non_stalker()}})},_position:function(){this._set_width();var e,t,i,n=this._get_j_container(),o=n.offset(),a=n.width(),r=this;this._get_j_element().css("left",o.left+a-this._get_j_element().width()-this._offsets.x);var s=Box.Application.getService("nav-state");(!this._positioned||s.isGcm())&&(this._positioned=!0,e=0,t=n.attr("data-multi_options_container"),t?(i=$(t).filter(":visible"),e=i.offset().top+i.outerHeight()-parseInt(this._get_j_element().css("margin-top"),10)):e=o.top+this._offsets.y,this._get_j_element().css("top",e),r=this,$(window).on("resize.multi_options",function(){r._position()}),this._stalk())},_set_width:function(){var e=0;this._get_j_element().filter(":visible").find("li:visible").each(function(t,i){e+=$(i).outerWidth()}),this._get_j_element().css("width",e+1)}},{});Box.Timing.execution.push({name:"js/menus/box_folder_picker_menu.js",time:(new Date).getTime()});var Folder_Picker_Menu=Abstract_Menu.extend({folder_selector:null,_action_required_to_close:!0,constructor:function(e){e=e||{},this._e_menu=$j("#folder_picker_menu").get(0),Canvas.get().register_body_click_handler(this)},hide:function(){this.folder_selector&&this.folder_selector.hide(),this.folder_selector=null,this.base()},_get_offsets:function(){return"folder-picker-button"===this._j_target_element.attr("data-type")?{x:0,y:8}:{x:0,y:-4}},show:function(e){e=e||{},this._j_target_element=$j(e.target),this.folder_selector&&this.folder_selector.hide();var t=this,i=function(i,n){e.callback(i,n),t.hide()},n=!e.hide_trash;this.folder_selector=new Box_Folder_Tree_Search_Selector({select_callback:i,opened_item_id:e.opened_item_id||null,show_trash:n}),this.base(),this.folder_selector.component().find(".selector_input_box input").focus(),this.folder_selector.component().find(".selector_input_box input").removePlaceholderize().placeholderize({extraMarginLeftIE:6})},_render:function(){var e=$j(this._e_menu);this.folder_selector.attachTo(e)},body_click_handler:function(e){var t=$j(this._e_menu),i=!1;if(this._j_target_element)for(var n=0,o=this._j_target_element.length;o>n;n++)$j.elementIsDescendent(e.target,this._j_target_element[n])&&(i=!0);!t.is(":visible")||$j.elementIsDescendent(e.target,t[0])||i||this.hide()}},{});Box.Timing.execution.push({name:"js/menus/box_paging_menu.js",time:(new Date).getTime()});var Paging_Menu=Abstract_Menu.extend({current_page:null,_defined_inline:!0,constructor:function(e){e=e||{},this._set_menu()},_get_offsets:function(e){return{x:0,y:16}},_set_menu:function(){this._j_menu=$j("#paging_menu"),this._e_menu=this._j_menu.get(0)},show:function(e){if(e=e||{},this._j_target_element=$j(e.target),this._set_menu(),this.base(),this._j_target_element.closest("#actionbar-wrapper").length){var t=$("#paging_label_top").closest(".actionbar_button_wrapper");this._j_menu.detach().appendTo(t).removeAttr("style").addClass("mlm")}else this._j_menu.removeClass("mlm");this._j_menu.find(".cntr").scrollTo(this._j_menu.find(".selected"))},event_click:function(e){var t=$j(this._e_menu),i=$j(e.target);i.is("a")&&(i=i.parent());var n=i.attr("id").substr(5);return n==this.current_page?(this.hide(),!1):(this.current_page=n,t.find("li").removeClass("selected"),i.addClass("selected"),Canvas.get().update_page(n),Box.Application.broadcast("x-pagechange",n),this.hide(),!1)}},{});Box.Timing.execution.push({name:"js/menus/box_tags_menu.js",time:(new Date).getTime()});var Tags_Menu=Abstract_Menu.extend({selected_tags:null,num_selected_tags:null,tag_timeout_id:null,loading:!1,constructor:function(){this._j_menu=$j("#tags_outer_container"),this.j_list_container=$j("#tag_and_filter_list_container"),this._e_menu=this._j_menu.get(0),this._prevent_rendering_offscreen=!1},show:function(e){$("body").trigger("close.menus"),this.params=e||{};var t=this;this._j_target_element=e.target?$j(e.target):null;var i="#tags_button";$j(i).addClass("ignore_mouseout hover"),this._hide_apply_button(),this.j_list_container.css({width:"220px"}).off("click").on("click",function(e){return t.event_click(e)}),this.base();var n=$("#tags_button").closest(".actionbar_button_wrapper");this._j_menu.detach().appendTo(n).removeAttr("style")},_get_offsets:function(){return{x:0,y:11}},_render:function(){var e=this,t=Tag_Collection.get().my_tags;if($j.isEmptyObject(t)){var i=$j("#tag_loading");this.loading||(this.loading=!0,i.find(".spinner_gif_container").addClass("spinner_gif"),i.show(),Canvas.get().load_tags(function(){e.loading=!1,i.hide(),e._j_menu.is(":visible")&&e._render_tags()},{}))}else this._render_tags()},_render_tags:function(){var e=$j("#tag_and_filter_list").empty();this.j_list_container.find(".select_all").show(),this.selected_tags={},this.num_selected_tags=0;var t=Box.Application.getService("nav-state"),i=t.get();if(t.isTag()){var n=i.id.split(",");for(var o in n)this.selected_tags[n[o]]=1,this.num_selected_tags++}var a=0,r=!0,s=Tag_Collection.get().my_tags;if(s){var l=$j("<ul></ul>");for(var c in s){a++;var _,d=s[c],u=$j('<li class="media pas mvn tag_and_filter_list_item" />').attr("id","li_"+$.box.escapeHTML(d.name)),p=$j('<div class="bd tag_name ellipsis ellipsis_140"></div>').append($j('<a href="#"></a>').text(d.name));this.selected_tags[d.name]?_="sprite_16x16_selected":(_="sprite_16x16_select select",r=!1);var h=$j('<div class="img_ext sprite_16x16 fakebox" />').addClass(_);u.append(h),$j('<div class="img_ext sprite_16x16_delete tag_delete" style="display:none" />').attr("id",$.box.escapeHTML(c)).appendTo(u),u.append(p),u.appendTo(l),$j('<li class="separator pan ignore_mouseover"><hr class="divider mbn mhs" /></li>').appendTo(l)}e.append(l.children()),e.on("mouseenter",".tag_and_filter_list_item",function(){$j(this).find(".sprite_16x16_delete").show()}).on("mouseleave",".tag_and_filter_list_item",function(){$j(this).find(".sprite_16x16_delete").hide()})}if(s&&0!==a)this.j_list_container.find(".select_all_checkbox").show();else{this.j_list_container.find(".select_all_checkbox").hide(),$j('<div class="center sprite_128x128_empty_tag"></div>').appendTo(e);var m=$t("You have no tags yet","you_have_no_tags");$j('<h4 class="center center_contents" />').text(m).appendTo(e);var f=$t("Add tags to your items in the file or folder options menu.","add_tags_text");$j('<p class="center center_contents phs" />').text(f).appendTo(e)}r?this.j_list_container.find(".select_all").addClass("all_selected sprite_16x16_selected").removeClass("select_all sprite_16x16_select"):this.j_list_container.find(".all_selected").removeClass("all_selected sprite_16x16_selected").addClass("select_all sprite_16x16_select"),this._j_menu.show()},event_click:function(e){var t=$j(e.target);if(t.hasClass("tag_remove"))return!1;if(t.parents().andSelf().hasClass("tag_name"))return this._select_all(!1),this._hide_apply_button(),this.apply_tags(t.closest("a").text()),!1;if(t.hasClass("tag_menu_option")&&!t.hasClass("badge")){for(var i=t.closest("ul").find(".badge"),n=0;n<i.length;n++){var o=$j(i[n]);o.removeClass("badge filter"),o.addClass("txt-bold")}t.removeClass("txt-bold").addClass("badge filter");{t.attr("id")}return this._render(),!1}if(t.hasClass("fakebox")||t.hasClass("tag_and_filter_list_item")){var a=t.hasClass("fakebox")?t:t.children(".fakebox");if(a.length>0)if(a.hasClass("select_all"))a.removeClass("select_all sprite_16x16_select").addClass("all_selected sprite_16x16_selected"),this._select_all(!0);else if(a.hasClass("all_selected"))a.removeClass("all_selected sprite_16x16_selected").addClass("select_all sprite_16x16_select"),this._select_all(!1);else if(a.hasClass("sprite_16x16_select")){a.removeClass("sprite_16x16_select").addClass("sprite_16x16_selected");var r=this._j_menu.find(".sprite_16x16_select");1==r.length&&this._j_menu.find(".select_all").addClass("all_selected sprite_16x16_selected").removeClass("select_all sprite_16x16_select"),this._show_apply_button()}else{a.addClass("sprite_16x16_select").removeClass("sprite_16x16_selected");var s=this._j_menu.find(".all_selected");s.length&&s.removeClass("all_selected sprite_16x16_selected").addClass("select_all sprite_16x16_select"),this._show_apply_button()}var l=a.parent().parent().find(".sprite_16x16_selected");if(this.num_selected_tags===l.length){for(var c=!0,_=0;_<l.length;_++){var d=l.eq(_).parent().text();if(!this.selected_tags[d]){c=!1;break}}c&&this._hide_apply_button()}}return t.hasClass("tag_delete")&&Tag_Collection.get().delete_tag(t.attr("id"),t.closest("li")),!1},_show_apply_button:function(){var e=this,t=$j("#apply_and_cancel_buttons");return t.length?(t.show(),!1):(t=$j('<div id="apply_and_cancel_buttons" class="mls" style="width:220px;"></div>'),$j("<button></button>").addClass("btn btn-primary").text($t("Apply","apply")).click(function(){e.apply_tags(),e.hide()}).appendTo(t),$j("<button></button>").addClass("btn").text($t("Cancel","js_button_cancel")).click(function(){e.hide()}).appendTo(t),$j('<hr class="divider" />').prependTo(t),void this._j_menu.append(t))},_hide_apply_button:function(){$j("#apply_and_cancel_buttons").hide()},_select_all:function(e){var t=this.j_list_container.find("#tag_and_filter_list").find(".fakebox");e?t.removeClass("sprite_16x16_select").addClass("sprite_16x16_selected"):t.addClass("sprite_16x16_select").removeClass("sprite_16x16_selected"),this._show_apply_button()},apply_tags:function(e){var t=[];if(e)t.push(e);else for(var i=this.j_list_container.find("#tag_and_filter_list .fakebox"),n=0;n<i.length;n++){var o=i.eq(n);o.hasClass("sprite_16x16_selected")&&t.push(o.parent().text())}var a=Box.Application.getService("nav-state");a.isSearch()&&Box.Application.broadcast("globalsearchreset"),this.hide(),Tag_Collection.get().apply_tags(t)}});Box.Timing.execution.push({name:"js/box_quick_search.js",time:(new Date).getTime()});var Quick_Search=Abstract_Menu.extend({_active_menu_links_count:null,_active_menu_selected_index:null,block_search_menu:!1,block_search_submit:!1,_html:null,_e_menu:null,_j_menu:null,_j_target_element:null,menu_css:null,_search_input:null,_search_string:null,_previous_search_string:"",_search_tooltip_text:null,_warmed_up:!1,_path_populated:!1,__instance:this,logService:null,start_time:{},constructor:function(){this._search_input=$j("#search"),this._j_menu=$j("#qs_menu"),this._e_menu=this._j_menu[0],this.logService=Box.Application.getService("logger"),this._action_required_to_close=!0;var e=this;this._j_menu.on("click","li",function(t){return e.event_click(t)}),this._search_input.focus(function(t){if(!e._warmed_up){var i="/index.php?rm=box_search_warmup";$j.getJSON(i,{},function(e){}),e._warmed_up=!0}}),this._search_input.keydown(function(t){(t.which==Quick_Search.KEY_DOWN||t.which==Quick_Search.KEY_UP)&&(e._j_menu.is(":visible")?e._walk_in_menu(t.which==Quick_Search.KEY_UP?"up":"down"):e._show_menu()),t.which==Quick_Search.KEY_ENTER&&(Quick_Search.get()._submit("keyboard"),e.block_search_submit&&t.preventDefault(),e.hide()),t.which==Quick_Search.KEY_ESCAPE&&(e.hide(),t.preventDefault())}),this._search_input.keyup(function(t){var i=$j.trim(this.value);return t.which===Quick_Search.KEY_ENTER&&e.block_search_submit?(t.stopPropagation(),void(e.block_search_submit=!1)):(e._is_control_key(t.which)||!(i.length>0)&&i||e._search_string==i||e._show_menu(),e._is_start_of_quick_search_session(i)&&e._log_quick_search_start(),void(e._previous_search_string=i))}),Canvas.get().register_body_click_handler(this)},_is_start_of_quick_search_session:function(e){return!this._previous_search_string&&e!==this._previous_search_string},_get_offsets:function(e){return this.stalking?{x:1,y:33}:{x:1,y:this._show_dropdown_arrow()?14:5}},_toggle_spinner:function(e){var t=$j("#search");e?t.css({"background-image":"url("+Box.Application.getService("assets").getAssetURL(images_box_path,"spinner.gif")+")","background-repeat":"no-repeat","background-position":"98% 50%"}):t.css("background-image","")},_load:function(e,t){var i=this;e.length>1&&this._toggle_spinner(!0);var n="/index.php?rm=box_quick_search",o={search_string:e,sort:"relevance",sort_direction:null,user_id_sql:""},a=$j.box.formatQuery(o);this._path_populated=!1,$j.getJSON(n,a,function(e){if(e.html&&!i.block_search_menu){if(e.search_string!=$.box.escapeHTML(i._search_string))return;i._html=e.html,$j.isFunction(t)&&t.call(i)}else i._html="",i.hide();i._toggle_spinner(!1)})},_remove_hover:function(){this._j_menu.find(".hover").each(function(){$j(this).removeClass("hover")}),$j("#tooltip").remove()},_render:function(){var e=this;this._show_dropdown_arrow()&&(this._html='<div class="header_drop_down_arrow qs_menu_arrow"><div class="header_drop_down_arrow_border" /></div>'+this._html),this._j_menu.html(this._html);var t=this._j_menu.find("li");t.mouseenter(function(){e._remove_hover(),$j(this).addClass("hover"),e._active_menu_selected_index=$j(this).index()}).mouseleave(function(){e._remove_hover(),e._active_menu_selected_index=-1}),this._j_menu.find("a").on("mouseenter mouseleave",function(){e._remove_hover(),e._active_menu_selected_index=$j(this).parents("#qs_menu li").index()});var i=this.start_time[this._search_string];if(i){var n=new Date-i;this.logService.sendLog("search_performance","END_USER_QUICK",{search_completion_time:n,total_count:t.length-1})}this.start_time={}},show:function(e){e?(this.start_time[e]=new Date,this._search_input=$j("#search"),this._j_target_element=this._search_input,this.block_search_menu=!1,this.block_search_submit=!1,this._active_menu_selected_index=-1,this._active_menu_links_count=null,this._j_menu.width(this._j_target_element.outerWidth()+(this._show_dropdown_arrow()?30:0)),this._load(e,this.base)):this.hide()},_show_menu:function(){var e=this;this._search_string=$j.trim(this._search_input.val()),Quick_Search.get().show(e._search_string)},_walk_in_menu:function(e){if(this._j_menu.is(":visible")){this._remove_hover(),this._active_menu_links_count||(this._active_menu_links_count=this._j_menu.find("a").length),"down"==e&&this._active_menu_links_count>this._active_menu_selected_index+1?this._active_menu_selected_index++:"up"==e&&this._active_menu_selected_index-1>=0?this._active_menu_selected_index--:"down"==e?this._active_menu_selected_index=0:"up"==e&&(this._active_menu_selected_index=this._active_menu_links_count-1);var t=this._j_menu.find("li:eq("+this._active_menu_selected_index+")");t.addClass("hover").trigger("mouseover")}},_submit:function(e){if(null!==this._active_menu_selected_index){var t=Box.Application.getService("nav-state");if(t.setFirstResultClick(!0),this._active_menu_selected_index>-1){var i=this._j_menu.find("a:eq("+this._active_menu_selected_index+")");i.hasClass("qs_result")?this._log_result_pick(e,i):this._log_search_all(e),this.block_search_submit=!0,this.hide();var n=this._get_openbox_action_for_element(i),o=i.attr("href");if(n)n.execute();else if("_blank"===i.attr("target")){var a=Box.Application.getService("url");a.openWindow(o)}else if(window.box&&"files"===box.hist_name)Box.Application.navigate(o);else{var r=Box.Application.getService("url");r.goToUrl(o)}this._search_input.blur()}else this._log_search_all("keyboard")}},_get_item_model_for_element:function(e){var t=Box.Application.getService("v5"),i=t.get("Item"),n=i.find(e.data("typed_id"));return n||(n=new i({id:e.data("item_id"),extension:e.data("item_extension"),typed_id:e.data("typed_id"),type:e.data("item_type")})),n},_get_openbox_action_for_element:function(e){var t=Box.Application.getService("openbox-service-actions"),i=this._get_item_model_for_element(e);return i?t.getDefaultOpenboxAction(i,{ignore_permissions:!0}):null},hide:function(){this._search_string=null,this.block_search_menu=!0,this._remove_hover(),this._active_menu_selected_index=-1,this._toggle_spinner(!1),this.base()},event_click:function(e){return this._submit("mouse"),!1},_log_quick_search_start:function(){var e=(new Date).getTime(),t={search_string:this._search_string,created_at:e};this.logService.sendLog("search","SEARCH_QUICK_SEARCH_START",t)},_log_result_pick:function(e,t){var i=(new Date).getTime(),n={result_num:this._active_menu_selected_index+1,search_string:this._search_string,user_input_trigger:e,item_type:t.data("item_type"),item_id:t.data("item_id"),typed_id:t.data("typed_id"),created_at:i};this.logService.sendLog("search","SEARCH_QUICK_SEARCH_PICK_RESULT",n);var o=Box.Application.getService("resin");o.recordAction({application:"files",page:"header",component:"header",feature:"search",target:"result",action:"click",data:{index:this._active_menu_selected_index,resultsCount:this._j_menu.find("li.quick-search-item").length,typedId:t.attr("data-typed_id")}})},_log_search_all:function(e){var t=(new Date).getTime(),i={search_string:this._search_string,user_input_trigger:e,created_at:t};this.logService.sendLog("search","SEARCH_QUICK_SEARCH_PICK_SEARCH_ALL",i)},_show_dropdown_arrow:function(){var e=Box.Application.getService("nav-state");return!e.isEmbedWidget()},body_click_handler:function(e){var t=$j("#qs_menu");t.is(":visible")&&!$j.elementIsDescendent(e.target,t[0])&&Quick_Search.get().hide()},_is_control_key:function(e){return e==Quick_Search.KEY_ESCAPE||e==Quick_Search.KEY_DOWN||e==Quick_Search.KEY_UP||e==Quick_Search.KEY_ENTER}},{KEY_DOWN:40,KEY_UP:38,KEY_ENTER:13,KEY_ESCAPE:27,get:function(){return Quick_Search.__instance||(Quick_Search.__instance=new Quick_Search),Quick_Search.__instance}
});Box.Timing.execution.push({name:"js/features.js",time:(new Date).getTime()}),function(){var e,t,i=document.querySelectorAll('meta[type="feature_flag"]'),n=i.length;for(window.Features=window.Features||{},e=0;n>e;e++)t=i[e],window.Features[t.getAttribute("name")]=!0}(),Box.Timing.execution.push({name:"js/box_object.js",time:(new Date).getTime()});var Box_Object=Box_Base.extend({set_params:function(e){e=e||{},Box_Object._convert_old_id(this.constructor,e),"id"in e&&(this.id=e.id),null!=this.id&&""!=this.id&&(this.type in Box_Object._objects_by_type_and_id||(Box_Object._objects_by_type_and_id[this.type]={}),Box_Object._objects_by_type_and_id[this.type][this.id]=this);for(var t in e)this[t]=e[t];return this},process_permissions:function(e,t){if(this.permissions&&"string"!=typeof this.permissions||(this.permissions={}),e){if("string"==typeof e){var i=e.split("");e={};for(var n in i)e[i[n]]=!0}for(var o in t){var a=t[o];this.permissions[o]=e[o]||e[a]?!0:!1}}},update_params_and_render:$j.abstract_function},{extend:function(e,t){if(!t.type)return $j.throw_error("The 'type' static property is missing in the declaration of the Box_Object subclass",t),null;e.type=t.type;var i=Box_Base.extend.call(Box_Object,e,t),n=["find","find_or_create"];for(var o in n){var a=n[o];a in t||(i[a]=Box_Object[a])}return"item"==i.type?$j.each(i._subtypes,function(e,t){Box_Object._objects_by_type_and_id[t]={}}):Box_Object._objects_by_type_and_id[i.type]={},i},_objects_by_type_and_id:{},_types_by_old_prefix:{d:"folder",f:"file",l:"web_link",u:"user"},_old_prefix_by_type:{folder:"d",file:"f",web_link:"l",user:"u"},_subclass_names_by_type:{folder:"Item",file:"Item",web_link:"Item"},_convert_old_id:function(e,t){var i=e.type+"_id";return!("id"in t)&&i in t&&(t.id=t[i],delete t[i]),t},_get_subclass:function(e){var t=Box_Object._subclass_names_by_type[e];if(!t){var i=Box.Application.getService("strings");t=i.capitalize(e)}var n=window[t];return n?n.find_or_create?n:($j.throw_error("The class "+t+" does not inherit from Box_Object"),null):($j.throw_error("The class "+t+" is not defined"),null)},_is_id:function(e){return(e+"").match(/^\d+$/)},_get_typed_id_regex:function(){return/^([a-z_]+)_(\d+_?\d*)?$/},_is_typed_id:function(e){return(e+"").match(this._get_typed_id_regex())},_get_type_and_id:function(e){var t=this._get_typed_id_regex();e=e.toString();var i=e.match(t),n=i[1];1==n.length&&(n=Box_Object._types_by_old_prefix[n]);var o=i[2];return{type:n,id:o}},_get_typed_id:function(e,t){if(t){var i=this._old_prefix_by_type[e.type];return i+"_"+e.id}return e.type+"_"+e.id},find_by_type_and_id:function(e,t){var i=e;return 1==arguments.length&&(t=e.id,i=e.type),Box_Object._objects_by_type_and_id[i]?Box_Object._objects_by_type_and_id[i][t]:null},find_by_typed_id:function(e){var t=Box_Object._get_type_and_id(e);return Box_Object.find_by_type_and_id(t)},get_params:function(e,t){return $j.isArray(e)?$j.map(e,function(e){return e[t]}):[e[t]]},load_params:function(e,t,i){$j.getJSON("/index.php?rm=unidb_get_objects",{typed_ids:this.get_params(e,"typed_id"),format:t},function(e){i&&i(e)})},find:function(e){return Box_Object.find_by_type_and_id(this.type,e)},find_or_create:function(e){if(""==e)return null;var t,i,n;if("object"!=typeof e){var o=e,a=Box_Object._get_type_and_id(o);t=a.type,i=a.id}else n=e,n=Box_Object._convert_old_id(this,n),t=n.type,i=n.id;var r;if(this==Box_Object){if(r=Box_Object._get_subclass(t),!r)return null;if("undefined"!=typeof r.find_or_create&&r.find_or_create!=this.find_or_create)return r.find_or_create(e)}else r=this;if(t!=r.type)return $j.throw_error("The class "+r.type+" cannot create an object of type "+t),null;var s=r.find(i);return s?(n&&s.set_params(n),s):(n||(n={id:i}),new r(n))},find_async:function(e){var t,i=Box_Object._get_type_and_id(e),n=i.type,o=i.id;if(this==Box_Object){if(t=Box_Object._get_subclass(n),!t)return a.reject().promise()}else t=this;var a=$.Deferred();if(n!=t.type)return $j.throw_error("The class "+t.type+" cannot create an object of type "+n),a.reject().promise();var r=t.find(o);if(r)return a.done(r).promise();var s="/index.php?rm=unidb_get_items",l={type:n,id:o},c=$.box.formatQuery(l);return $.getJSON(s,c,function(e){var i=new t(e.params);a.resolve(i)}),a.promise()},type:"undefined"});Box.Timing.execution.push({name:"js/box_behavior_handler.js",time:(new Date).getTime()});var Box_Behavior_Handler=Box_Base.extend({handle_event:function(e){var t="event_"+e.type;return t in this?this[t](e):!0}},{RIGHT_CLICK:2,find_by_element:function(e){var t=Box.Application.getService("strings"),i=$j(e).closest("[data-behavior]");if(!i.length)return null;var n=i.attr("data-behavior"),o="Box_Behavior_Handler_"+t.capitalize(n),a=window[o];if(!a)return $j.throw_error("Undefined Behavior_Handler class",o),null;var r={};r.j_element=i;var s=new a(r);return s}});Box.Timing.execution.push({name:"js/box_behavior_handler/edit_in_place.js",time:(new Date).getTime()});var Box_Behavior_Handler_Edit_In_Place=Box_Behavior_Handler.extend({event_mouseover:function(e){if(Box_Behavior_Handler_Edit_In_Place.enabled){var t=this,i=this.j_element;if(this.show_form()){var n=i.attr("data-edit-icon-sprite-class")||"sprite_16x16_pencil",o=$j('<span class="edit_in_place_hover_cntr" />').append($j('<div class="edit_in_place_hover"></div>').attr({"data-hover":"tooltip","aria-label":Box_Behavior_Handler_Edit_In_Place.edit_prompt}).addClass(n));if(i.next().hasClass("icon")){var a=i.next().width();o.css("padding-left",a+23+"px"),o.css("right","-"+(a+23)+"px")}i.prepend(o),i.data("editable_icon_move_right")&&(o.css("right",parseInt(o.css("right"))-i.data("editable_icon_move_right")),o.css("padding-left",parseInt(o.css("padding-left"))+i.data("editable_icon_move_right")));var r=i.data("make_overflow_hidden_element_visible");r&&(this.j_overflow_hidden_element=$j("#"+r)),i.mousedown(function(e){var n=$j(e.target);if(n.hasClass("edit_in_place_hover")||n.hasClass("placeholder")||n.hasClass("edit_in_place_inline")){e.preventDefault(),e.stopPropagation(),$j(".edit_in_place_hover_cntr").remove(),i.unbind(),Box.Application.getService("tooltips").hideTooltips(),$j(".edit_popup").find("input").trigger({type:"keydown",keyCode:27}),t.need_to_change_draggable()&&i.parents('[draggable="true"]').removeAttr("draggable").addClass("need_to_restore_dnd_draggable");var o=i.data("type")||"text",a=i.data("select_data")||null,r=i.data("update_html")||null,s=i.data("maxlength")||null,l=i.data("validate")||null,c=null,_=i.data("item_id")||null,d=i.data("item_type")||null,u=i.data("field")||null,l=i.data("validate")||null,p=Box_Behavior_Handler_Edit_In_Place.placeholder_text,h=i.hasClass("item_name");i.attr("placeholder")&&(p=i.attr("placeholder"));var m,f={},g=null,v=Box.Application.getService("nav-state");_&&d&&(g="gallery"==_?v.galleryItem():"current"==_?Canvas.get().current_folder:Item.find(_),"page_title"==i.attr("id")&&(f.return_path=!0),f.item_id=g.id,f.item_type=d,h&&(c=function(e,t){return"file"==g.type&&g.extension?e.substr(0,e.lastIndexOf(".")):e}),m=function(e){e&&e.result===!0&&(g[u]=e.value,i.data("update_tooltip_after_edit")&&i.attr({"data-hover":"tooltip","aria-label":e.value})),t.on_form_close();var n=i.data("callback");"function"==typeof n&&n(e)}),u&&(f.field=u);var b="24px",w="235px";"textarea"==o&&(b="40px",w="730px"),i.data("width")&&(w=i.data("width")),i.height()>parseInt(b,10)&&(b=i.height());var y={};if(l){y.rules={},y.messages={};var x=l.split(" ");for(var S in x){var k=x[S];if("empty"==k)$j.extend(!0,y.rules,{value:{required:!1}});else if("url"==k)$j.extend(!0,y.rules,{value:{url:!0}}),$j.extend(!0,y.messages,{value:$t("Please enter correct URL.","Please_enter_correct_URL")});else if("not_empty"==k)$j.extend(!0,y.rules,{value:{required:!0}}),$j.extend(!0,y.messages,{value:{required:$t("Field can't be empty. Please enter correct value.","Field_cant_be_empty_Please_enter_correct_value")}});else if("not_empty_item_type"==k){$j.extend(!0,y.rules,{value:{required:!0}});var T=$t("Please enter a file name.","js_please_enter_a_file_name");"folder"==i.data("item_type")&&(T=$t("Please enter a folder name.","js_please_enter_a_folder_name")),$j.extend(!0,y.messages,{value:{required:T}})}else"phone"==k?($j.extend(!0,y.rules,{value:{phone:!0}}),$j.extend(!0,y.messages,{value:$t("Please enter correct phone.","Please_enter_correct_phone")})):"filename"==k&&($j.extend(!0,y.rules,{value:{filename:!0}}),$j.extend(!0,y.messages,{value:{filename:"|"+$t("The name you specified contains special characters %1 or words that are not allowed. Names with leading or trailing whitespace or periods are not allowed. Modify the name and try again.","file_name_special_chars",Validator.file_name_special_chars)}}));y.tip_delay=3e3}}t.j_overflow_hidden_element&&t.j_overflow_hidden_element.css("overflow","visible"),t.j_element.removeAttr("data-hover aria-label");var j=Box.Application.getService("strings");i.editable({cssclass:"edit_popup",width:w,height:b,type:o,data:a?a:c,placeholder:i.attr("placeholder")||Box_Behavior_Handler_Edit_In_Place.placeholder_text,update_html:r,submitdata:f,maxlength:s,validate:y?y:null,text_filter:j.getHyperlinkedString,callback:m,onreset:function(){t.on_form_close()},onsubmit:function(){if(g&&"file"==g.type&&g.extension){var e=this.find("input");e.val(e.val()+"."+g.extension)}Box.Application.broadcast("itemchange",{type:"editinplace"})},hide_original_text:t.j_overflow_hidden_element?!0:!1})}});var s=i;"parent"==i.data("editable_mouseout_target")&&(s=i.parent()),s.mouseleave(function(e){var t=$j(e.relatedTarget);t.parent().andSelf().hasClass("edit_in_place_hover_cntr")||t.hasClass("icon")||(i.find(".edit_in_place_hover_cntr").hide().remove(),i.unbind())})}}},show_form:function(){var e=this.j_element;return!e.find(".edit_in_place_hover_cntr").length&&!e.find("form").length&&!e.closest("ul.icon_view").length},on_form_close:function(){this.j_overflow_hidden_element&&this.j_overflow_hidden_element.css("overflow","hidden"),this.need_to_change_draggable&&$j(".need_to_restore_dnd_draggable").removeClass("need_to_restore_dnd_draggable").attr("draggable",!0),Box.Application.getService("tooltips").hideTooltips()},need_to_change_draggable:function(){var e=Box.Application.getService("browser");return e.isFirefox()||e.isIE()}},{enabled:!0,placeholder_text:$t("Add","edit_in_place_placeholder"),edit_prompt:$t("Click to edit","edit_in_place_prompt"),toggle_edit_in_place:function(e){this.enabled=e},j_overflow_hidden_element:null});Box.Timing.execution.push({name:"js/box_behavior_handler/select_text_when_clicked.js",time:(new Date).getTime()});var Box_Behavior_Handler_Select_Text_When_Clicked=Box_Behavior_Handler.extend({event_click:function(e){this.j_element.focus(),this.j_element.select()}},{});Box.Timing.execution.push({name:"js/box_view_handler.js",time:(new Date).getTime()});var Box_View_Handler=Box_Base.extend({j_event_elements:null,handle_event:function(e){var t=e.type;"mouseup"==t&&e.button==Box_View_Handler.RIGHT_CLICK&&(t="right_click");var i=this["event_"+t];return i?i.call(this,e):!0},get_j_event_elements:function(e){if(!this.j_event_elements){var t=$j(e.target);this.j_event_elements=t.is("[data-view_id]")?t.add(this.j_element):t.parentsUntil("[data-view_id]").andSelf().add(this.j_element)}return this.j_event_elements}},{RIGHT_CLICK:2,find_object_by_element:function(e){var t=$j(e).closest("[data-view_id]");if(!t.length)return null;var i=t.data("view_id");return Box_Object._is_typed_id(i)?Box_Object.find_by_typed_id(i):null},find_by_element:function(e){var t=$j(e).closest("[data-view_id]");if(!t.length)return null;var i,n,o,a,r=t.attr("data-view_id");if(Box_Object._is_typed_id(r)){if(o=r,a=Box_Object.find_by_typed_id(o),!a)return $j.throw_error("Model not found for View with id",o),null;i=a.type,("file"==i||"folder"==i||"web_link"==i)&&(i="item"),n={object:a}}else{var s=r.match(/^([a-z_]+)_(\{.*\})$/);if(!s)return $j.throw_error("Invalid view_id",r),null;if(i=s[1],n=$j.parseJSON(s[2]),o=n.typed_id){if(a=Box_Object.find_by_typed_id(o),!a)return $j.throw_error("Model not found for View with id "+r+" and object_typed_id "+o,r,o),null;n.object=a}else if("user"==i&&n.email){if("undefined"!=typeof Tombstone&&Tombstone.marker("./js/box_view_handler.js:48","2013-05-15","auto tombstoned"),a=User.find_collab_data_by_email(n.email),!a)return $j.throw_error("Model not found for pending collab with email "+n.email),null;n.object=a}}var l=Box.Application.getService("strings"),c="Box_View_Handler_"+l.capitalize(i),_=window[c];return"function"!=typeof _?($j.throw_error("Undefined View_Handler class",c),null):(n.j_element=t,new _(n))},find_by_object:function(e){var t=e.typed_id,i=$j("."+t),n=[];return $j.each(i,function(e,t){var i=Box_View_Handler.find_by_element(t);n.push(i)}),n},target_has_href:function(e){var t=$(e).attr("href"),i=window.location.href,n=i.indexOf("#");return t&&"#"!=t&&t!=i.substring(0,n)&&t!=i.substring(0,n+1)?!0:!1}});Box.Timing.execution.push({name:"js/box_view_handler/user.js",time:(new Date).getTime()});var Box_View_Handler_User=Box_View_Handler.extend({event_click:function(e){var t=this.object,i=this.get_j_event_elements(e);if(i.hasClass("mail")){if(Box_View_Handler.target_has_href(e.target))return!0}else if(i.hasClass("edit"))this.handle_edit(t);else if(i.hasClass("corporate_network")){if(window.CollaborateAction){var n={};n[t.user_id]={name:t.name,email:t.email},this.set_interval_id&&clearInterval(this.set_interval_id),CollaborateAction.create_invite_popup(n,"corporate_network_sidebar",{show_access_types:!0})}else if(!this.collaborate_action_requested){var o=new Item({type:"folder"});o.available_permissions=collab_permissions;var a=Box.Application.getService("openbox-service-actions");a.createAction(o,"collaborate"),this.collaborate_action_requested=!0;var r=this;this.set_interval_id=setInterval(function(){r.event_click(e)},50)}}else{if(Box_View_Handler.target_has_href(e.target))return!0;t.open_profile()}return!1},event_mouseover:function(){},event_mouseout:function(e){$(e.target).closest(".hover").removeClass("hover")}},{});Box.Timing.execution.push({name:"js/box_view_handler/select_element.js",time:(new Date).getTime()});var Box_View_Handler_Select_Element=Box_View_Handler.extend({event_click:function(e){var t=this._find_element_for_select_element(e);return new Select_Element(t).show(),!1},_find_element_for_select_element:function(e){return $j(e.target).closest("[data-view_id]")}},{});Box.Timing.execution.push({name:"js/box_view_handler/select_text_when_clicked.js",time:(new Date).getTime()});var Box_View_Handler_Select_Text_When_Clicked=Box_View_Handler.extend({event_click:function(e){var t=$j(e.target);return t.focus(),t.select(),!1}},{});Box.Timing.execution.push({name:"js/box_view_handler/upgrade_popup.js",time:(new Date).getTime()});var Box_View_Handler_Upgrade_Popup=Box_View_Handler.extend({event_click:function(e){var t=this.j_element.attr("data-upgrade-slide")||null,i=Box.Application.getService("v5popups");return t?i.showUpgradePopup(t):i.showUpgradeTourPopup(),!1}},{});Box.Timing.execution.push({name:"js/views/sidebar.js",time:(new Date).getTime()});var Box_Sidebar_View=Base.extend({sidebar_queue:[],display_order:["collab_module_container","account_info_sidebar_module","resources_sidebar_module"],getSidebarFavoritesModulePromise:null,populate_html:function(e,t){var i=Box.Application.getService("dom"),n=i.query("#content_sidebar");i.removeClass(n,"hidden"),e&&i.setHTML(n,e);var o=i.query(".share-module-content");o&&t&&i.setHTML(o,t)},display_box_files_sidebar_in_order:function(e,t){var i=$j.inArray(e,this.display_order),n=this.sidebar_queue;n[i]={id:e,displayed:!1,content:t};for(var o=Box.Application,a=o.getService("imageloader"),r=o.getService("dom"),s=o.getService("nav-state"),l=0;l<n.length;l++){var c=n[l];if("undefined"!=typeof c)c.content&&!c.displayed?(r.setHTML(r.query("#"+c.id),c.content),c.displayed=!0):$j("#"+c.id).removeClass("hidden");else if(!s.isGcm())break}a.loadImages(document.getElementById(e),!0)},_show_html_in_sidebar_placeholder:function(e){this.display_box_files_sidebar_in_order("collab_module_container",e)},show_sidebar_collaborators_module:function(){var e=Canvas.get().current_folder;if(0==e.id||""==e.id||e.is_trash_folder)return void this._show_html_in_sidebar_placeholder("");var t=this,i=Box.Application,n={folder_id:e.id,number_of_collaborators_to_load:"default"},o=i.getService("dom"),a=i.getService("url"),r=a.getGcmCompatibleRmUrl("box_collaborate_get_sidebar");$.getJSON(r,$.box.formatQuery(n),function(e){var i=o.query(".sidebar-collab-spinner-container");i&&(o.removeClass(i,"is-displayed"),setTimeout(function(){t._show_html_in_sidebar_placeholder(e.sidebar_html),o.addClass(i,"hidden")},400))})},showLoadingForSidebarFavoritesModule:function(){var e=Box.Application.getService("dom"),t=e.query(".sidebar-favorites-spinner-container");e.addClass(t,"is-loading"),e.removeClass(t,"hidden"),e.addClass(t,"is-displayed")},hideLoadingForSidebarFavoritesModule:function(){var e=Box.Application.getService("dom"),t=e.query(".sidebar-favorites-spinner-container");e.removeClass(t,"is-loading"),e.removeClass(t,"is-displayed"),setTimeout(function(){e.addClass(t,"hidden")},400)},setSidebarFavoritesModuleContent:function(e){var t,i,n,o=this,a=Box.Application.getService("dom"),r=a.query(".sidebar-favorites-container");i=document.createElement("div"),a.addClass(i,"accessibility-hidden"),a.setHTML(i,e),i.style.width="223px",r.appendChild(i),t=i.clientHeight,r.removeChild(i),n=a.query(".sidebar-favorites-placeholder"),n.style.height=t+"px",setTimeout(function(){a.setHTML(r,e),o.hideLoadingForSidebarFavoritesModule()},350)},getSidebarFavoritesModuleSuccessHandler:function(e){return function(t){var i,n=t.data;n&&(i=n.html,e.setSidebarFavoritesModuleContent(i))}},getSidebarFavoritesModuleErrorHandler:function(e){return function(t){var i,n=Box.Application,o=n.getService("promises"),a=n.getService("templates");if(!(t instanceof o.CancellationError))try{i=a.getTemplateHTML("sidebar-favorites-error"),e.setSidebarFavoritesModuleContent(i)}catch(r){}}},getAndShowSidebarFavoritesModule:function(){{var e=Box.Application,t=e.getService("dom"),i=e.getService("ajax");t.query(".sidebar-favorites-spinner-container")}this.showLoadingForSidebarFavoritesModule(),this.getSidebarFavoritesModulePromise&&this.getSidebarFavoritesModulePromise.isPending()&&this.getSidebarFavoritesModulePromise.cancel(),this.getSidebarFavoritesModulePromise=i.get("box_get_favorites_sidebar",{}).then(this.getSidebarFavoritesModuleSuccessHandler(this),this.getSidebarFavoritesModuleErrorHandler(this)).caught(this.getSidebarFavoritesModuleErrorHandler(this))},displaySidebarCollabOverlay:function(){var e=Box.Application.getService("dom"),t=e.query(".sidebar-collab-spinner-container");e.addClass(t,"is-displayed")},hideSidebarCollabPlaceholder:function(){var e=Box.Application.getService("dom"),t=e.query(".collab-sidebar-placeholder");e.addClass(t,"hidden")},displaySidebarShareModule:function(){var e=Box.Application.getService("dom"),t=e.query(".share-module");e.removeClass(t,"hidden")},hideSidebarShareModule:function(){var e=Box.Application.getService("dom"),t=e.query(".share-module");t&&e.addClass(t,"hidden")},displaySidebarSearchModule:function(){var e,t,i=Box.Application.getService("dom"),n=i.query(".search-module");n?i.removeClass(n,"hidden"):(e=i.query(".sidebar-search-filters-outer"),t=Box.Application.getService("ajax"),t.get("get_search_filters_container",{},{success:function(t){t.data&&i.setHTML(e,t.data.html)}}))},hideSidebarSearchModule:function(){var e=Box.Application.getService("dom"),t=e.query(".search-module");e.addClass(t,"hidden")},displaySidebarMiscFilesModules:function(){var e=Box.Application.getService("dom"),t=e.queryAll(".misc-files-module");e.removeClass(t,"hidden")},hideSidebarMiscFilesModules:function(){var e=Box.Application.getService("dom"),t=e.queryAll(".misc-files-module");e.addClass(t,"hidden")}},{get:function(){return Box_Sidebar_View.__instance||(Box_Sidebar_View.__instance=new Box_Sidebar_View),Box_Sidebar_View.__instance}});Box.Timing.execution.push({name:"js/helpers/ie-hover.js",time:(new Date).getTime()}),Loader.t3Loaded.done(function(){"use strict";function e(e){if(e.target){var o=e.target;if("string"==typeof o.className&&!o.className.match(t)){var a=!1;if("mouseout"===e.type&&o.givesHover)a=!0;else if("mouseover"===e.type&&o.doesntGiveHover)return;for(var r=[o],s=o;s&&(s.nodeName.match(i)&&(a||!s.className.match(n)&&"BUTTON"!==s.nodeName||(a=!0),s===o||-1===s.className.indexOf("gets_hover")&&"LI"!==s.nodeName&&"BUTTON"!==s.nodeName||s.className.match(t)||r.push(s)),s=s.parentNode,!s||"BODY"!==s.nodeName););if(!a)return void(o.doesntGiveHover=!0);o.givesHover=!0,$(r).toggleClass("hover","mouseover"===e.type)}}}var t=/ignore_mouse(over|out)/,i=/div|ul|li|button/i,n=/(?:.* |^)(nav|admin_nav|list_ext|hover_list|needs_hover)(?:$| .*)/;$(document.body).on("mouseover",e).on("mouseout",e)}),Box.Timing.execution.push({name:"js/box_confirmation_message.js",time:(new Date).getTime()});var Box_Confirmation_Message=Base.extend({_j_confirmation_message:null,_j_confirmation_content:null,_j_confirmation_description:null,_j_confirmation_close:null,constructor:function(){this._j_confirmation_message=$j("#box_confirmation"),this._j_confirmation_content=$j("#box_confirmation_content"),this._j_confirmation_description=$j("#box_confirmation_description"),this._j_confirmation_close=$j("#box_confirmation_close"),this._bind_close_callback()},show_confirmation:function(e,t){this._show_message(e,t)},show_error:function(e,t){this._show_message(e,t)},hide:function(e){this._migrated_action_handler=null,e?(this._j_confirmation_message.hide(),this._cleanup_after_hide()):this._j_confirmation_message.slideUp("fast",$.proxy(this,"_cleanup_after_hide"))},get_confirmation_height:function(){return this._j_confirmation_message.outerHeight(!0)},is_confirmation_visible:function(){return this._j_confirmation_message.is(":visible")},_cleanup_after_hide:function(){if(this._j_confirmation_extra_classes){for(var e=this._j_confirmation_extra_classes.length,t=0;e>t;t++)this._j_confirmation_message.removeClass(this._j_confirmation_extra_classes[t]);this._j_confirmation_extra_classes=null}$j.selectable("refresh"),$j.fast_draggable("refresh")},_show_message:function(e,t){t=t||{};var i=t.description,n=t.callback||null,o=t.disable_scroll||!1,a=t.extra_classes||null,r=$j('<div class="bd"/>');if(r.append(e),this._j_confirmation_content.empty().append($j('<div class="img" />')).append(r),this._bind_close_callback(n),this._bind_click_events(),this._set_confirmation_description(i),this._j_confirmation_extra_classes=a,this._j_confirmation_extra_classes)for(var s=this._j_confirmation_extra_classes.length,l=0;s>l;l++)this._j_confirmation_message.addClass(this._j_confirmation_extra_classes[l]);this._j_confirmation_message.show(),this._refresh_global_state(),o||Box.Application.getService("scroll").scrollToTop()},_set_confirmation_description:function(e){e?this._j_confirmation_description.empty().append(e).show():this._j_confirmation_description.hide()},_bind_close_callback:function(e){var t=this;this._j_confirmation_close.off("click.confirmation_message").on("click.confirmation_message",function(){return t.hide(!0),$j.isFunction(e)&&e(),!1})},_bind_click_events:function(){this._j_confirmation_message.off("click.message_actions").on("click.message_actions",this,this._confirmation_message_click_handler)},_confirmation_message_click_handler:function(e){var t=$j(e.target),i=null,n=e.data,o=Box.Application.getService("nav-state");if(t.attr("data-action_load_item"))o.setItemInFiles(t.attr("data-action_load_item")),Box.Application.navigate("");else if(t.attr("data-action_sharebar"))i=t.data("action_sharebar"),i.item_id&&Item.find(i.item_id).sharebar();else if(t.attr("data-action_collaborate_current_folder"))Box.Application.getService("popups").open("collaborate",{data:{typed_id:Canvas.get().current_folder.typed_id}});else if(t.attr("data-action_auto_collab_message_link"))n._auto_collaboration_message_link_click_handler(t);else if(t.attr("data-action_master_invite_accept"))Box_Files.get().master_invite_answer(t,"accepted");else if(t.attr("data-action_master_invite_reject"))Box_Files.get().master_invite_answer(t,"rejected");else{if(!t.attr("data-migrated_action")||!e.data._migrated_action_handler)return!0;e.data._migrated_action_handler()}return!1},_auto_collaboration_message_link_click_handler:function(e){$j.post("/index.php?rm=box_collaborate_mark_invites");var t=e.data("action_auto_collab_message_link"),i=t.item_id,n=Box.Application.getService("nav-state");return n.setItemInFiles(i),Box.Application.navigate(""),!1},_refresh_global_state:function(){$j.selectable("refresh"),$j.fast_draggable("refresh")}},{_instance:null,get:function(){return Box_Confirmation_Message._instance||(Box_Confirmation_Message._instance=new Box_Confirmation_Message),Box_Confirmation_Message._instance}});Loader.t3Loaded.done(Box_Confirmation_Message.get),Box.Timing.execution.push({name:"js/box_confirmation_message_builder.js",time:(new Date).getTime()});var Box_Confirmation_Message_Builder=Base.extend({show_collaboration_invite_message:function(e){var t=Box_Confirmation_Message.get().is_confirmation_visible(),i=e.length,n=$j.isArray(e)&&i;if(!n||t)return!1;var o=this,a=$j("<div />"),r=0,s=0;if($j.each(e,function(t){if(10===t)return!1;"file"==e[t].item_type?r++:s++;var i=e[t],n=i.inviter_user_name?i.inviter_user_name:i.item_user_name,l="file"==e[t].item_type?$t("File Info","collaborators_js_list_tooltip_file"):$t("Folder Info","js_collaborators_js_list_tooltip_folder"),c=l+"|"+(i.files_count?$t("Files: %1","collaborators_js_list_tooltip_files",i.files_count):"")+(i.files_count&&1!=i.hide_collaborators?"  ":"")+(1==i.hide_collaborators?"":$t("Collaborators: %1","collaborators_js_list_tooltip_collabs",i.collaborators_count)),_="sprite_32x32_collab_folder",d=Box.Application.getService("v5"),u=d.get("Canvas").user;if(u){var p=u.enterprise_id,h=i.item_user_enterprise_id;p!==h&&(_=_.replace("_collab_folder","_external_collab_folder"))}var m=$j('<div class="pending_collab_row media" />').append($j('<div class="img_ext collab_invite_links" />').append($t("%1 or %2","collaborators_js_accept_reject",$j('<a class="collab_invite_accept_link txt-bold" href="#" />').text($t("Accept","collaborators_js_accept")).attr("id","collab_invite_accept_link_"+i.item_id)[0].outerHTML,$j('<a class="collab_invite_reject_link txt-bold" href="#" />').text($t("Reject","collaborators_js_reject")).attr("id","collab_invite_reject_link_"+i.item_id)[0].outerHTML))).append($j('<span class="img sprite_32x32" />').addClass(_).append($('<span class="right_corner_overlay sprite_24x24_add" />'))).append($j('<div class="bd" />').append($j('<ul class="basic_list" />').append($j("<li />").append($j("<b />").text(i.item_name)).append($j('<span class="img sprite_16x16_info confirmation_sprite_spacing" alt="" />').attr({"data-hover":"tooltip","aria-label":c}))).append($j("<li />").append($j('<span class="owner ellipsis ellipsis_300" style="float:none; clear:both;" />').text($t("By %1","collaborators_js_pending_by_2",n)))))).attr("id","inv"+t);m.find(".collab_invite_links a:eq(0)").click(o._get_accept_handler(i)),m.find(".collab_invite_links a:eq(1)").click(function(e){var t=new Collab(i);return t.accept({}),!1}),t>0&&m.addClass("line"),a.prepend(m)}),!s)return!1;var l=Box.Application.getService("nav-state"),c=l.get();if(c.id==root_folder_id.substr(2)&&$j("#confirmation_auto_accepted_folders").length){var _=$j("#confirmation_auto_accepted_folders").clone().attr("id","").css("display","block");a.append(_)}var d=this._get_pending_collab_message(s,r,i);return Box_Confirmation_Message.get().show_confirmation(d,{description:a,callback:function(){$j.post("/index.php?rm=box_collaborate_mark_invites",{})}}),!0},show_added_weblink_message:function(e){var t=$t("%1 has been added.","js_myfiles_js_has_been_successfully_weblink",e);Box.Application.getService("notifications").confirm(t)},show_sso_groups_exceeded_message:function(){var e=$t("Your group memberships on Box have not been updated. Please contact your enterprise administrator to update your group's access priviledge","sso_groups_exceeded");Box.Application.getService("notifications").error(e)},show_grace_notification_message:function(){var e=$t("Due to an issue on our billing system, we were unable to validate your credit card info.","billing_cannot_validate_cc_info")+$t("You may be asked to input your information again.","may_be_asked_to_input_info_again");Box.Application.getService("notifications").error(e,{onhide:function(){$j.post("/index.php?rm=box_zuora_actions_hide_billing_failed_message")}})},show_temporary_access_message:function(e,t){var i=$t("You have been granted temporary access to this folder. You will be automatically removed from this folder on %1","initial_text_access",e);Box.Application.getService("notifications").confirm(i,{onhide:function(){$j.post("/index.php?rm=box_item_expirations_mark_as_seen",{collab_id:t})}})},show_collab_by_link_unsuccessful_message:function(){var e=$t("This invite link is no longer active. Please contact the person who provided you with this link.","collab_by_link_unsuccessful");Box.Application.getService("notifications").error(e)},show_gcm_move_file_message:function(e){Box.Application.getService("notifications").confirm($t("You have moved %3.","gcm_items_moved_confirmation","","",e.join(", ")))},show_master_invite_message:function(e){Box_Confirmation_Message.get().show_confirmation(e,{description:$t("%1Note: %2By accepting, you will be giving the enterprise access to your Box account. We recommend creating a personal account for any personal files you have stored on Box.","collab_master_invite_enterprise_recommendation_message","<strong>",'<span style="color: #888;">',"</span>")})},show_added_email_alias_message:function(e){Box.Application.getService("notifications").confirm($t("%1 has been added to your account.","added_to_users_account",e))},_get_single_item_notification_message:function(e,t){var i,n,o;return 1===t.success?(o=!0,i="file"==t.first_item.type?$t("%1 has been uploaded.","file_uploaded_successfully",t.first_item.name):$t("%1 has been created.","item_uploaded_successfully",t.first_item.name)):(i=this._get_error_messages(t.errors)[0],o=!1),{message:i,is_success:o,action:n}},_get_multiple_items_notification_error:function(e){var t,i;return e.has_unique_error?t=0===e.success?this._get_error_messages(e.errors)[0]:$t("%1 items uploaded, but %2 failed. %3","some_items_upload_failed_with_error_message",e.success,e.error,this._get_error_messages(e.errors)[0]):e.error>0&&(t=0===e.success?$t("Unable to create items.","items_upload_failed"):$t("%1 items created, but %2 failed.","some_items_upload_failed",e.success,e.error),i={text:$t("See Details","see_details_in_upload_error"),onclick:function(){Box.Application.getService("popups").alert(this._get_error_messages(e.errors).join("\n"))}}),{message:t,is_success:!1,action:i}},show_notification_for_new_items:function(e){var t,i=this._parse_new_items_data(e),n=Box.Application.getService("notifications"),o=!0,a=null,r=i.success+i.error,s=null;0!==r&&(1===r?(t=this._get_single_item_notification_message(e,i),a=t.message,o=t.is_success,s=t.action):r>1&&(i.error>0?(t=this._get_multiple_items_notification_error(i),a=t.message,o=t.is_success,s=t.action):a=$t("%1 items have been uploaded.","items_uploaded_successfully",i.success)),o?n.confirm(a,{action:s}):n.error(a,{action:s}))},_get_error_messages:function(e){var t,i,n,o=[];for(var a in e){switch(i=e[a],n=i.join(", "),a){case"no_upload_access":t=$t("%1 failed because you do not have permission to create folders.","failed_to_create_folders_due_to_permissions",n);break;case"name":t=$t("%1 failed because items with the same name already exist.","items_failed_to_create_due_to_name_conflict",n);break;case"folder_depth_limit_exceeded":t=$t("%1 cannot be created because the depth of folders is too deep.","failed_to_create_folders_due_to_deep_tree",n);

break;case"folder_breadth_limit_exceeded":t=$t("%1 cannot be created because there are too many folders inside them.","failed_to_create_folders_due_to_large_amount_of_children",n);break;case"invalid_folder_name":t=$t("%1 cannot be created because their names are invalid.","failed_to_create_folders_due_to_invalid_name",n);break;case"folder_name_length_exceeded":t=$t("%1 cannot be created because their names are too long.","failed_to_create_folders_due_to_long_name",n);break;default:t=$t("%1 cannot be created due to an unexpected error.","failed_to_create_item_due_to_unknown_error",n)}o.push(t)}return o},_parse_new_items_data:function(e){var t,i,n,o,a=0,r=0,s=0,l={};for(var c in e)if(i=e[c],t||(t={id:c,name:i.name,type:i.type}),n=$.makeArray(i.errors),n&&n.length>0){r++;for(var _=0,d=n.length;d>_;_++)o=n[_],l[o]||(s++,l[o]=[]),l[o].push(i.name)}else a++;return{success:a,error:r,first_item:t,has_unique_error:1===s,errors:l}},get_successfully_uploaded_new_items:function(e){var t={};for(var i in e){var n=e[i];n.errors||(t[n.type]||(t[n.type]=[]),t[n.type].push(i))}return t},get_error_message_from_code:function(e,t){switch(t){case"no_upload_access":return $t("You do not have permission to create folders.","js_confirmation_no_permission_to_create_folders");case"name":return $t("Sorry, but an item named %1 already exists.","js_confirmation_item_already_exist",e.name);case"folder_depth_limit_exceeded":return $t("Folder cannot be created since the folder tree is too deep.","js_confirmation_folder_depth_limit_exceeded");case"folder_breadth_limit_exceeded":return $t("Folder cannot be created since the folder tree is too wide.","js_confirmation_folder_breadth_limit_exceeded");case"invalid_folder_name":return $t("Folder name is invalid.","js_confirmation_invalid_folder_name");case"destination_folder_locked":return $t("Folder is locked by another operation.","js_confirmation_destiantion_folder_locked");case"folder_name_length_exceeded":return $t("Folder name has exceeded its limit.","js_confirmation_folder_name_length_exceeded");default:var i=ItemTypeTranslation.singular(e.type);return this.format_message_items_add_failed(i,e.name)}},format_message_items_add_failed:function(e,t){return $t('The %1 "%2" could not be created.',"js_item_could_not_be_created",e,t)},show_auto_collaboration_message:function(e,t,i){if(0!=e||0!=t){var n=this.get_item_number_string(e,t),o=$t("You joined %1 items since your last login.","joined_items_since_login",n),a=$t("Change your auto-accept setting.","change_your_auto_accept_setting"),r=$t("If the folder owner requires collaborators to agree to a terms of service, you will still need to accept the terms before accessing the folder.  All other folders will be accepted automatically.","change_auto_accept_desc"),s=o+' <a href="/settings/collaboration" target="_blank">'+a+'</a><span class="sprite_16x16_info list_img" data-hover="tooltip" aria-label="'+r+'">&nbsp;</span>';Box_Confirmation_Message.get().show_confirmation(s,{description:$j(i),callback:function(){$j.post("/index.php?rm=box_collaborate_mark_invites")}})}},_get_pending_collab_message:function(e,t,i){var n=this.get_item_number_string(e,t,i),o="";return o="1"===n?$t("You have 1 collaboration invitation.","confirmation_message_one_invite")+" ":$t("You have %1 collaboration invitations.","confirmation_message_num_invites",n)+" ",o+=-1===n.indexOf("+")?$t("You can accept below:","confirmation_message_accept_collab_invites"):$t("To see the rest of your invitations, you must act on some below:","confirmation_message_see_more")},get_item_number_string:function(e,t,i){var n=e+t;return void 0!==i&&i>n&&(n+="+"),""+n},_get_accept_handler:function(e){return function(){var t=$(this).parent(),i=new Collab(e);return i.accept({accept_dialog:!0,callback:function(e){if($j.isFunction(box._accept_collab_callback)){var n=e.error?!1:!0;box._accept_collab_callback(t,i,n,e.error)}}}),!1}}},{_instance:null,get:function(){return Box_Confirmation_Message_Builder._instance||(Box_Confirmation_Message_Builder._instance=new Box_Confirmation_Message_Builder),Box_Confirmation_Message_Builder._instance}});Box.Timing.execution.push({name:"js/box_canvas.js",time:(new Date).getTime()});var Canvas=Base.extend({collections:null,container:null,current_folder:null,element:null,expanded_list_view:!1,group_tags:null,in_account:!0,logged_in:!1,menu:null,on_load:null,path:null,permissions:null,selection:null,device_pinning_selection:null,shared_name:null,tag_collection:null,target_item:null,update_page_callback:null,use_dragdrop:!1,use_item_expansion:null,use_menu_shortcuts:!1,use_selectables:!1,user:null,devices:null,users:null,view:null,body_click_handlers:[],constructor:function(e){Canvas.__instance=this,OpenboxAction.load(window.openbox_actions),e=e||{},this.users=new UserCollection,this.devices=new Device_Pinning_Collection,"undefined"!=typeof Group_Tag_Collection&&(this.group_tags=new Group_Tag_Collection),"undefined"!=typeof Tag_Collection&&(this.tag_collection=new Tag_Collection),this.enterprises=new Enterprise_Collection,this._set_user(),this._set_enterprise(),this.collections=[],this.element=$j(document.body),this.expanded_list_view=e.expanded_list_view||!1,"undefined"!=typeof e.in_account&&(this.in_account=e.in_account),this.logged_in=""!=this.user.login,this.path=e.path||{},this.permissions=e.permissions||{},this.shared_name=e.shared_name||"",this.vanity_name=e.vanity_name||"",this.collab_invite_token=e.collab_invite_token||"",this.use_item_expansion={},this.view=e.view||"icon",Box_Pub_Sub&&Canvas.implement(Box_Pub_Sub),"undefined"!=typeof Add_Group_Tag_Form&&(this.add_group_tag_form=new Add_Group_Tag_Form),"undefined"!=typeof Add_User_Form&&(this.add_user_form=new Add_User_Form),"undefined"!=typeof Bulk_Add_User_Form&&(this.bulk_add_user_form=new Bulk_Add_User_Form),"undefined"!=typeof Bulk_Edit_User_Form&&(this.bulk_edit_user_form=new Bulk_Edit_User_Form),"undefined"!=typeof Edit_External_User_Form&&(this.edit_external_user_form=new Edit_External_User_Form),"undefined"!=typeof Edit_Group_Tag_Form&&(this.edit_group_tag_form=new Edit_Group_Tag_Form),"undefined"!=typeof Edit_User_Form&&(this.edit_user_form=new Edit_User_Form),"undefined"!=typeof Change_Password_Form&&(this.change_password_form=new Change_Password_Form),this.selection=new ItemSelection,this.device_pinning_selection=new Device_Pinning_Selection(this.devices),this._attach_item_events(),this._bind_actionbar_stalker();var t=Box.Application.getService("v5"),i=t.get("In_App_Message"),n=Box.Application.getService("nav-state");i&&!n.isEmbedWidget()&&i.get_in_app_message_to_show()},register_body_click_handler:function(e){$j.isFunction(e.body_click_handler)&&this.body_click_handlers.push(e)},_attach_item_events:function(){var e=Box.Application.getService("loading");$j(document).bind("contextmenu",function(t){var i=$j(t.target);return i.is("input[type=text], textarea, a.bookmarklet, .allow_right_click")?!0:i.hasParent(".allow_right_click")?!0:i.closest(".body").length||i.closest(".box-menu").length?e.isBlocking()?void 0:!1:!0}),$j(this.element).off("click.canvas").on("click.canvas",$j.proxy(this._canvas_click_handler,this)).off("mousedown.canvas").on("mousedown.canvas",$j.proxy(this._canvas_mousedown_handler,this)).off("mouseup.canvas").on("mouseup.canvas",$j.proxy(this._canvas_mouseup_handler,this)).off("mouseover.canvas").on("mouseover.canvas",$j.proxy(this._canvas_mouseover_handler,this)).off("mouseout.canvas").on("mouseout.canvas",$j.proxy(this._canvas_mouseout_handler,this))},_bind_actionbar_stalker:function(){$("#actionbar-stalking-wrapper.actionbar_stalking").length||$("#actionbar-stalking-wrapper").stalker({offset:51,stalkerStyle:"actionbar_stalking"})},_canvas_mouseover_handler:function(e){if(!window.isSelecting&&!window.isDragging){this.trigger_tooltip_timer&&clearTimeout(this.trigger_tooltip_timer),this.trigger_tooltip_timer=setTimeout(function(){Box.Application.getService("tooltips").triggerTooltips(e)},100);var t=Box_View_Handler.find_by_element(e.target);t&&t.event_mouseover&&t.event_mouseover(e);var i=Box_Behavior_Handler.find_by_element(e.target);return i&&i.handle_event(e),!0}},_canvas_mouseout_handler:function(e){if(!window.isSelecting&&!window.isDragging){this.trigger_tooltip_timer&&(clearTimeout(this.trigger_tooltip_timer),this.trigger_tooltip_timer=null);var t=Box_View_Handler.find_by_element(e.target);t&&t.event_mouseout&&t.event_mouseout(e);var i=Box_Behavior_Handler.find_by_element(e.target);return i&&i.handle_event(e),!0}},_canvas_mouseup_handler:function(e){if(e.button==Canvas.RIGHT_CLICK&&!$j(e.target).is("input[type=text], textarea, .allow_right_click")){var t=Box_View_Handler.find_by_element(e.target);return t?t.handle_event(e):void 0}},_canvas_click_handler:function(e){if(e.button!=Canvas.LEFT_CLICK&&e.button!=Canvas.MIDDLE_CLICK)return!1;var t=$(e.target);if(t.hasClass("disabled")||t.hasClass("ignore_click"))return!1;if(t.hasClass("ignore_click_handler"))return!0;var i,n;for(i=0,n=this.body_click_handlers.length;n>i;i++)this.body_click_handlers[i].body_click_handler(e);Box.Application.getService("tooltips").hideTooltips();var o=Box_View_Handler.find_by_element(e.target);if(o){var a=o.handle_event(e);return!!a}var r=Box_Behavior_Handler.find_by_element(e.target);if(r){var a=r.handle_event(e);if(r=null,!a)return!1}},_canvas_mousedown_handler:function(e){var t=$(e.target);if(t.is(".ignore_mousedown"))return!1;if(!t.closest("[aria-haspopup]").length&&!t.closest(".overlay").length){var i=Box.Application.getService("overlay");i&&i.close()}var n=Box_View_Handler.find_by_element(e.target);return n?n.handle_event(e):void 0},_set_user:function(){var e={},t=Box.Application.getGlobalConfig();e[t.userLogin]={id:t.userId,is_free_user:t.isFreeUser,login:t.userLogin,enterprise_id:t.enterpriseId,phone:t.userPhone,pic_urls:t.picUrls,features:t.features,public_name:t.publicName,name:t.publicName,email:t.userLogin,slave_status_id:t.slaveStatusId,company_name:t.companyName},"undefined"!=typeof window.is_master&&(e[t.userLogin].is_master=window.is_master),this.users.set_params(e),this.user=this.users.find(t.userId)},_set_enterprise:function(){var e=0;if("undefined"!=typeof window.enterprise){var t={};e=window.enterprise.id||window.enterprise.enterprise_id,t[e]=window.enterprise,this.enterprises.set_params(t),this.enterprise=this.enterprises.find(Box.Application.getGlobalConfig("enterpriseId"))}},attach_events:function(){var e=this;if("expanded"==this.view||"icon"==this.view){this.attach_selectable_events();var t,i=$(window),n=i.height(),o=i.width(),a=function(){var t=i.height(),a=i.width();(t!=n||a!=o)&&(n=t,o=a,e.fix_page_height())};i.off("resize.canvas").on("resize.canvas",function(){clearTimeout(t),t=setTimeout(a,200)}),i.off("focus.canvas").on("focus.canvas",function(){window.infocus=!0}),i.off("blur.canvas").on("blur.canvas",function(){window.infocus=!1})}},attach_selectable_events:function(){if(this.use_selectables){var e,t=this,i=[],n=Box.Application.getService("nav-state"),o=n.get();if($j(this.collections[this.collections.length-1].items).each(function(e,t){t.element&&i.push($(t.element).get(0))}),e=i.length>0&&null!=i[0]?$j(i):$j("div.item",this.element),e.selectable({handle:"icon"==this.view?".thumb_large":null,ignore:".dnd, #j_popup, #folder_tree, #player, .checkbox_block, .item_expansion_comments, .item_expansion, .edit_description_text, .description_text, .sub_nav, .content_sidebar, .path_container",select:function(e){var t=e.id.split("_").pop(),i=Item.find(t);i&&i.select()},start:function(e){return Box.Application.getService("loading").isBlocking()||$j.popup.get().length>0?!1:o.isGallery?!1:void 0},unselect:function(e,t){var i=e.id.split("_").pop(),n=Item.find(i);n&&n.unselect(t)}}),this.use_dragdrop){var a=e;a.fast_draggable({clone:!0,ghost:!0,handle:"icon"==this.view?".thumb_large":null,ignore:".arrow, .item_expansion",revert:!0,scroll:!0,start:function(e){$j(e).removeClass("hover menu_open selected");var i=$j(".draggable_wrapper");0===i.length&&(i=$j('<div class="item_collection draggable_wrapper"></div>'));var n="icon"==t.view?"icon_view":"list_view",o="icon"==t.view?"list_view":"icon_view";i.removeClass(o).addClass(n).append(e).appendTo(document.body)}});var r=a;r.filter(function(){return $j(this).hasClass("folder")}).droppable({accept:".item",area:"icon"==this.view?".thumb_large":null,drop:function(e,i){t._handle_drop(e,i)},hoverClass:"receiving_drop"})}}},_handle_drop:function(e,t){var i=e.id.split("_").pop(),n=Item.find(i),o=this.selection.collection.size()?this.selection.collection:this.target_item;o.move({target:n,autosubmit:!0,from:"Drag and Drop"})},change_view:function(e,t){t=t||{},e||(e="expanded"==this.view?"icon":"expanded"),"undefined"==typeof t.expanded_list_view&&(t.expanded_list_view=this.expanded_list_view);var i="icon"==e?"list":"icon",n="icon"==e?"icon":"list";if($j("#"+i+"_view_toggle").removeClass("prite_16x16_"+i+"_view_selected").addClass("sprite_16x16_"+i+"_view"),$j("#"+n+"_view_toggle").removeClass("sprite_16x16_"+n+"_view").addClass("sprite_16x16_"+n+"_view_selected"),$j("#jquery_editable_input").length&&$j("#jquery_editable_input").blur(),e!=this.view||this.expanded_list_view!=t.expanded_list_view){this.selection.unselect_all(),this.expanded_list_view=t.expanded_list_view,this.view=e;var o={expanded_list_view:this.expanded_list_view?1:0,view:this.view};$j.post("/index.php?rm=box_files_change_view",o);for(var a in this.collections)this.collections[a].change_view(this.view)}"icon"==this.view&&$j(".body").removeClass("disable_48x48_sprites"),this.fix_page_ui_issues(),this.attach_events(),Box.Application.broadcast("viewchange",{view:this.view})},fix_page_ui_issues:function(){this.fix_page_height(),this.fix_ie_ellipsis(),this._isBrowserLteIE7()&&this.fixIESidebarHeight()},_isBrowserLteIE7:function(){var e=Box.Application.getService("browser"),t=e.getVersion();return e.isIE()&&Math.floor(parseFloat(t))<=7},fix_page_height:function(){var e=Box.Application.getService("nav-state");if(!e.isEmbedWidget()){var t,i=window.innerHeight||document.documentElement.clientHeight,n=$(".foot").outerHeight(),o=$(".head").outerHeight(),a=0;t=e.isGcm()?$(".sub_nav:visible").outerHeight():$(".subheader").outerHeight(),a=i-o-t-n,$(".body").css("min-height",a)}},fixIESidebarHeight:function(){var e=Box.Application.getService("dom"),t=e.query(".right_col .ie-after");if(!t){var i=e.query(".right_col"),n=document.createElement("i");n.className="ie-after",i&&i.appendChild(n)}},fix_ie_ellipsis:function(){var e=Box.Application.getService("browser");e.isMinBrowser("Explorer",8)&&setTimeout(function(){$(".ellipsis").filter("span, a").each(function(e,t){var i=$(this),n=i.css("max-width");"none"!==n&&i.outerWidth()>=parseInt(n.replace("px",""),10)&&(this.style.width=n)})},2500)},context:function(){var e={};return(this.shared_name||this.vanity_name)&&(e.shared_item={shared_name:this.shared_name,vanity_name:this.vanity_name}),this.collab_invite_token&&(e.collab_preview_item={invite_token:this.collab_invite_token}),e},count_items:function(){var e=0;for(var t in this.collections)e+=this.collections[t].size();return e},reset:function(){this.selection.unselect_all(),this.collections=[]},construct_collection_classes:function(){var e=[],t=Box.Application.getService("nav-state"),i=t.get();return this.use_item_expansion.comments&&e.push("use_comments_expansion"),this.use_item_expansion.options&&e.push("use_options_expansion"),this.use_item_expansion.share&&e.push("use_share_expansion"),this.use_item_expansion.tasks&&e.push("use_tasks_expansion"),this.use_menu_shortcuts&&e.push("use_menu_shortcuts"),this.use_selectables&&e.push("use_selectables"),"f"!==i.type&&"a"!==i.type&&e.push("searching"),e.push("icon"!=this.view?"list_view":"icon_view"),Canvas.get().expanded_list_view&&e.push("list_view_expanded"),e.join(" ")},page_count:null,page_size:null,current_page:null,init_pages:function(e,t){var i=$j("#top_pages"),n=$j("#mod-paging-bottom");return"undefined"==typeof e||"undefined"==typeof e.current_page||"undefined"==typeof e.page_count?void n.html(i.find("#paging_data").clone().attr("id","paging_data_bottom")):(this.current_page=e.current_page,"string"==typeof e.to_search&&e.to_search.length>0||(this.page_size=e.page_size),this.page_count=e.page_count,"undefined"!=typeof e.paging_html&&(e.reports_tab||-1==e.paging_html.indexOf("paging_menu")||$j("#paging_menu").remove(),i.empty().html(e.paging_html)),n.html(i.find("#paging_data").clone().attr("id","paging_data_bottom")),n.find(".actionbar_pagination").attr("id","paging_label_bottom"),void("function"==typeof t&&(this.update_page_callback=t)))},update_page:function(e){e&&"function"==typeof this.update_page_callback&&(Box_Menus.get().paging_menu&&(Box_Menus.get().paging_menu.current_page=e),this.update_page_callback(e),this.fix_page_ui_issues())},load:function(e){e=e||{};var t=Box.Application.getService("nav-state"),i=t.get(),n=Box.Application.getService("dom"),o=e.background||!1,a=e.collaborated||!1;this.current_page=e.current_page||0,this.use_dragdrop=e.use_dragdrop||!1,this.use_item_expansion=e.use_item_expansion||!1,this.use_menu_shortcuts=e.use_menu_shortcuts||!1,this.use_selectables=e.use_selectables||!1,e.path&&(this.path=e.path),e.permissions&&(this.permissions=e.permissions),e.view&&(this.view=e.view),"s"==i.type&&(this.expanded_list_view=!0);var r=e.container?$j(e.container).get(0):$j("#files"),s=$j(r).find(".item_collection"),l=e.items_html,c=n.query("#automationRetentionContainer");if(c){var _=e.automationRetentionHTML;n.setHTML(c,_),_?n.removeClass(c,"hidden"):n.addClass(c,"hidden")}if("expanded"==this.view||"icon"==this.view){delete this.current_folder,e.folder&&(e.folder.type="folder",e.folder.name||0!=e.folder.id||(e.folder.name=$t("All Files","js_global_allfiles")),this.current_folder=Item.find_or_create(e.folder));var d=new ItemCollection({collaborated:a,container:s,id:this.collections.length,maximum_items:e.maximum_items,nodes:e.nodes,permissions:this.permissions,removed_permissions:this.removed_permissions,shared_name:e.shared_name,update:e.update,view:this.view});if(e.folder&&(this.current_folder.children=d),this.collections.push(d),!o){e.predisplay_items_html||"undefined"==typeof l||s.html(l);var u={file_view:e.file_view,page:e.page};e.skip_change_view?u.skip_change_view=!0:u.change_items_view_only=!0,d.render(u)}}this.attach_events(),$j.isFunction(this.on_load)&&this.on_load(),this.on_load=null},load_tags:function(e,t){var i="/index.php?rm=box_tag_get_tags",n=this,o={};$j.getJSON(i,o,function(i){n.tag_collection.my_tags=i.nodes||{},$j.isFunction(e)&&e(t)})},openbox_unload:function(e){var t=e.service_name,i=e.confirmation_message,n=e.file_id,o=e.sha1,a=e.unlock,r=a?a.saves_back_file_upon_unlock:!1;if(box.after_load_callback=function(){var e=Item.find(n);if(i||e&&e.sha1!=o&&(i=$t('The %1 "%2" has been successfully modified by %3',"popup_openbox_service_successfully_modified_item",ItemTypeTranslation.singular(e.type),e.name,t)),i&&Box.Application.getService("notifications").confirm(i),r){var a=Toaster.get();a.set_progress(100),a.hide();var s=e.j_element;s&&s.enable()}},a&&0!=e.lock_id){if(r){var s=Item.find(n),l=s.j_element;l&&l.disable();var c=Toaster.get();c.toggle_cancel_link(!1),c.set_message($t("Saving %1 to Box...","popup_openbox_unload_saving_back",$.box.escapeHTML(s.name))),c.set_progress(10),c.set_fake_toaster(4e3),c.show({hide_cancel:!0})}var _,d=function(){$("html, body").hasClass("has_lightbox")?s&&"function"==typeof s.refresh?s.refresh(function(){Box.Application.broadcast("previewunlock")}):Box.Application.broadcast("previewunlock"):Box.Application.navigate("",{},{not_scroll:!0})};_={lock_id:e.lock_id};var u=Box.Application.getService("ajax");u.post("box_api_file_action_lock_delete",_,{success:d,error:function(){if(r){c.finish_fake_toaster(300);var e=$t("Sorry, we couldn't save that file back to Box. Please re-open it and try saving again.","popup_openbox_unload_saving_back_error");Box.Application.getService("popups").alert(e)}}})}else Box.Application.navigate("",{},{not_scroll:!0})}},{LEFT_CLICK:0,MIDDLE_CLICK:1,RIGHT_CLICK:2,get:function(){return Canvas.__instance||(Canvas.__instance=new Canvas),Canvas.__instance}});Box.Timing.execution.push({name:"js/box_action.js",time:(new Date).getTime()});var Action=Base.extend({constructor:function(e){if(e=e||{},!e.id)return!1;if(!e.object&&!e.collection)return!1;this.id=e.id,this.object=e.object,this[this.constructor.object_type]=this.object,this.collection=e.collection,this.options=e.options||{},this.name=this.id.toLowerCase().split("_").join(" "),"delete me"==this.name&&(this.name="delete");var t=Box.Application.getService("v5").get("current_rm");return"box_files"==t?this.source="files":"box_v2_new_inbox"==t?this.source="updates":"box_shared_show_by_name"==t?this.source="shared_folder":"box_user_profile_view"==t?this.source="user_profile":"box_view_vanity_url"==t&&(this.source="vanity_url"),this.source&&"unknown"!=this.source||(this.source="shared_file"),!1},_invalid_items:{},collection:null,id:null,object:null,object_type:"",name:"",options:null,can_execute:function(){this._invalid_items={};var e=!1,t=this.constructor.required,i=this.object?[this.object]:this.collection?this.collection.objects:[];for(var n in i){var o=i[n];for(var a in t)for(var r in t[a]){var s=t[a][r];if(s){var l="boolean"!=typeof s;if(l){if(s.apply(this))continue}else if(o[a]&&o[a][r])continue;this._invalid_items[a]||(this._invalid_items[a]=[],e=!0),this._invalid_items[a].push(o)}}}return!e},cannot_execute_message:function(){Box.Application.getService("popups").alert($t("You cannot perform this action","js_cannot_perform_action"))}},{create:function(e,t,i,n){if((!n||n=={})&&t._actions&&t._actions[i])return t._actions[i];var o=Action.get_class_name(e,i);window[o]||Action.load_class(e,i);var a=new window[o]({id:i,object:t,options:n});return n&&n!={}||(t._actions||(t._actions={}),t._actions[i]=a),a},get_class_name:function(e,t){var i=e,n=t.split("_");for(var o in n)i+="_"+n[o].substr(0,1).toUpperCase()+n[o].substr(1).toLowerCase();return i},load_class:function(e,t){var i=e.toLowerCase(),n=Box.Application.getService("assets").getAssetURL(js_path,"actions/"+i+"/"+t+".js",!1);$j.ajax({async:!1,dataType:"script",url:n,cache:!0,no_context:!0});var o=Action.get_class_name(e,t),a=window[o];a.prototype.execute_without_test=a.prototype.execute,a.prototype.execute=function(){return this.can_execute()?(this.item&&!this.collection&&(Canvas.get().target_item=this.item),this.execute_without_test()):(this.cannot_execute_message(),null)},a.object_type=i,a.prototype[i]=null},register_actions:function(e,t){var i=window[e];for(var n in t){var o=t[n];Action.register_actions_helper(i,e,o)}i.prototype._actions=null},register_actions_helper:function(e,t,i){e.prototype[i]=function(e){var n=Action.create(t,this,i,e);return n.execute()},e.prototype["can_"+i]=function(e){var n=Action.create(t,this,i,e);return n.can_execute()}}});Box.Timing.execution.push({name:"js/services/nav-state.js",time:(new Date).getTime()}),Box.Application.addService("nav-state",function(e){"use strict";function t(){var e=c.getCurrentWindowUrl(),t=c.getQueryParams(e);return $.extend({},s,t)}function i(e){for(var t in e)s.hasOwnProperty(t)&&(s[t]=e[t])}function n(e){return $(".body").attr("data-page-type")===e}function o(){var e=!1;try{e=_.top!==self}catch(t){e=!0}return e}function a(){var t=!!e.getGlobalConfig("embed"),i=!!e.getGlobal("is_embed_widget")||!!e.getGlobal("embed");return i||t}var r={firstResultClick:!0,folderName:null,galleryId:null,gcmUserId:0,id:null,isGallery:!1,lastType:null,page:0,searchFilters:null,searchString:null,singleFilePreview:!1,sort:null,sortDirection:null,subId:null,tags:null,trashFilter:null,type:"f",updateType:null,wasGallery:!1,lastNonGalleryUrl:"",policyId:null},s={application:null,fileVersionId:null,firstResultClick:!0,folderName:null,galleryId:null,gcmUserId:0,id:null,isGallery:!1,lastType:null,page:0,searchFilters:null,searchString:null,singleFilePreview:!1,sort:null,sortDirection:null,subId:null,tags:null,trashFilter:null,type:"",updateType:null,wasGallery:!1,lastNonGalleryUrl:"",policyId:null},l=e.getService("v5"),c=e.getService("url"),_=l.get("window"),d=l.get("Item");return function(){if(o()&&!a())try{var t={referer:document.referer||""},i=e.getService("logger");i.sendLog("navigation","NON_WIDGET_IFRAME",t)}catch(n){}}(),{galleryItem:function(){return"undefined"!=typeof d?d.find(t().galleryId):null},getSearchFiltersFromString:function(e){var t,i,n,o,a,r,s=e,l=[];if(!e)return[];for(t=c.getQueryParamString(e),t&&(s=e.split("?"+t)[0]),i=s.split("|"),a=0,r=i.length;r>a;a++)n=i[a].split(":"),o=n.shift(),l.push({type:o,value:n.join(":")});return l},getSearchStringFromFilters:function(e){return $.isArray(e)?$.map(e,function(e){return e.type+":"+e.value}).join("|"):""},isShowingFiles:function(){return this.isFiles()||this.isSearch()||this.isTag()},isShowingSearchOrTag:function(){return this.isSearch()||this.isTag()},isRootFolder:function(){var e=t().id;return this.isFiles()?"undefined"!=typeof d?e==d.ROOT_FOLDER_ID||e==_.root_folder_id:e==_.root_folder_id||0==e:!1},isTrash:function(){var e=t().id;return"undefined"!=typeof d?e===d.TRASH_FOLDER_ID:1===e},isEmbedWidget:a,isSharedPage:function(){return"undefined"!=typeof _.shared_folder&&"undefined"!=typeof _.shared_name},isGcm:function(){return n("gcm")},isSharedFilePage:function(){return n("shared-file")},isSharedFolderPage:function(){return n("shared-folder")},isSharedPageOrEmbedWidget:function(){return this.isSharedFilePage()||this.isSharedFolderPage()||this.isEmbedWidget()},isFirstResultClick:function(){return t().firstResultClick},isMovingOutOfSearch:function(){return!this.isSearch()&&this.wasSearch()},isMovingIntoSearch:function(){return this.isSearch()&&!this.wasSearch()},isMovingOutOfPreview:function(){var e=t();return e.wasGallery&&!e.isGallery},isPreviewOpen:function(){var e=t();return e.isGallery},isSortedBy:function(e){return t().sort===e},isSingleFilePreview:function(){var e=t();return e.singleFilePreview},getTypeSpecificId:function(e){var i=t();switch(e){case"s":return i.searchString;case"t":return i.tags;default:return i.id}},getLastNonGalleryUrl:function(){var e=t();return e.lastNonGalleryUrl},getLastType:function(){var e=t();return e.lastType},setFirstResultClick:function(e){i({firstResultClick:e})},setCurrent:function(e){i({type:e,lastType:t().type})},setPrevious:function(){var e=t();i({lastType:e.type,wasGallery:e.isGallery})},setPage:function(e){i({page:e})},setNav:function(e){var n=t(),o=$.extend({},e);o.lastType=o.lastType||n.type,o.wasGallery=o.wasGallery||n.isGallery,i(o)},setSort:function(e,t){var n={sort:e};t&&(n.sortDirection=t),i(n)},resetSort:function(){i({sort:null,sortDirection:null})},setPreviewItem:function(e){i({isGallery:!0,galleryId:e,subId:e})},clearPreview:function(){i({isGallery:!1,galleryId:0,subId:0})},setItemInFiles:function(e,n,o){var a=t(),r={type:"f",lastType:a.type,isGallery:!1,page:o||0,id:e};n&&(r.folderName=n),i(r)},setTagsNav:function(e,t){e=c.decodePathComponent(e),i({type:"t",tags:e,id:e,page:t||0})},setSearchNav:function(e,t,n){i({page:t||0,id:e,searchString:e,searchFilters:n||""})},setSearchFilters:function(e){i({searchFilters:e})},setPreviewState:function(e){return e?(parseInt(e,10)&&(e="f_"+e),void this.setPreviewItem(e)):void this.clearPreview()},setSingleFilePreview:function(e){i({singleFilePreview:e})},isInFolder:function(){return this.isFiles()&&!this.isTrash()&&!this.isRootFolder()},isFiles:function(){return"f"===t().type},wasFiles:function(){return"f"===t().lastType},setCurrentAsFiles:function(){i({lastType:t().type,type:"f"})},isSearch:function(){return"s"===t().type},wasSearch:function(){return"s"===t().lastType},setCurrentAsSearch:function(){i({lastType:t().type,type:"s"})},isTag:function(){return"t"===t().type},wasTag:function(){return"t"===t().lastType},setCurrentAsTag:function(){i({lastType:t().type,type:"t"})},isGcmFiles:function(){return"gcm_files"===t().type},wasGcmFiles:function(){return"gcm_files"===t().lastType},setCurrentAsGcmFiles:function(){i({lastType:t().type,type:"gcm_files"})},isGcmSearch:function(){return"gcm_search"===t().type},wasGcmSearch:function(){return"gcm_search"===t().lastType},setCurrentAsGcmSearch:function(){i({lastType:t().type,type:"gcm_search"})},isGcmUsers:function(){return"gcm_users"===t().type},wasGcmUsers:function(){return"gcm_users"===t().lastType},setCurrentAsGcmUsers:function(){i({lastType:t().type,type:"gcm_users"})},isGcmQuarantine:function(){return"gcm_quarantine"===t().type},wasGcmQuarantine:function(){return"gcm_quarantine"===t().lastType},setCurrentAsGcmQuarantine:function(){i({lastType:t().type,type:"gcm_quarantine"})},isGcmQuarantinePreview:function(){return"gcm_quarantine_preview"===t().type},wasGcmQuarantinePreview:function(){return"gcm_quarantine_preview"===t().lastType},setCurrentAsGcmQuarantinePreview:function(){i({lastType:t().type,type:"gcm_quarantine_preview"})},isAutomation:function(){return"admin_automation"===t().type},wasAutomation:function(){return"admin_automation"===t().lastType},setCurrentAsAutomation:function(){i({lastType:t().type,type:"admin_automation"})},isPolicies:function(){return"admin_policies"===t().type},wasPolicies:function(){return"admin_policies"===t().lastType},setCurrentAsPolicies:function(){i({lastType:t().type,type:"admin_policies"})},isContacts:function(){return"contacts"===t().type},wasContacts:function(){return"contacts"===t().lastType},setCurrentAsContacts:function(){i({lastType:t().type,type:"contacts"})},isCorporateNetwork:function(){return"corporate_network"===t().type},wasCorporateNetwork:function(){return"corporate_network"===t().lastType},setCurrentAsCorporateNetwork:function(){i({lastType:t().type,type:"corporate_network"})},createNavObject:function(e){return $.extend({},r,e)},get:t,set:i}}),Box.Timing.execution.push({name:"js/services/nav-url.js",time:(new Date).getTime()}),Box.Application.addService("nav-url",function(e){"use strict";var t=e.getService("url"),i=e.getService("nav-state");return{getSearchUrl:function(i,n,o,a){var r=t.encodePathComponent(i),s="",l="",c=e.getGlobal("path_prefix")||"",_={};return n=n||0,o&&(s="/"+t.encodePathComponent(o)),a&&(_.mdfilters=a),l="/"+c+"files/search/"+r+"/"+n+s,t.createUrl(l,_)},getSearchUrlForCollaboratorsPage:function(e,t){return"/contacts/search/"+t+"?search="+encodeURIComponent(e)},getFileUrl:function(t,n,o,a){var r=e.getGlobal("path_prefix")||"";return a||(a=i.get().type),"/"+r+"files/"+o+"/"+a+"/"+n+"/1/f_"+t},getFileUrlForSharedPage:function(t,i,n,o){var a=o.length>=20?"s/":"shared/",r=e.getGlobal("path_prefix")||"";return"/"+r+a+o+"/"+n+"/"+i+"/"+t+"/1"},getFileUrlForVanityPage:function(e,t,i,n){return"/"+n+"/"+i+"/"+t+"/"+e+"/1"},getFolderUrl:function(e,i,n){return"/files/"+i+"/f/"+e+(n?"/"+t.encodePathComponent(n):"")},getSharedFolderUrl:function(e,t,i){var n=e.length>=20?"s/":"shared/";return"/"+n+e+"/"+t+"/"+i},getVanityUrl:function(e,t,i){return"/"+e+"/"+t+"/"+i},getTagsUrl:function(e,i){return"/files/"+i+"/t/"+t.encodePathComponent(e)},getContactsUrl:function(e){return"/contacts/"+e},getCorporateNetworkUrl:function(e){return"/contacts/network/"+e},getFileUrlForPreview:function(n,o){var a=e.getGlobal("gallery_page"),r=i.get(),s=o||r.page,l=e.getGlobal("shared_name"),c=e.getGlobal("vanity_name");switch(a){case"files":var _={};return r.mdfilters&&(_.mdfilters=r.mdfilters),t.createUrl(this.getFileUrl(n,i.getTypeSpecificId(r.type),s,r.type),_);case"shared_folder":return this.getFileUrlForSharedPage(n,r.id,s,l);case"vanity_url":return this.getFileUrlForVanityPage(n,r.id,s,c);default:return!1}},getReturnUrlForPreview:function(){var t=e.getGlobal("gallery_page"),n=i.get(),o=n.type,a=n.page,r=n.searchFilters,s=n.mdfilters,l=n.policy_id||n.policyId,c=n.user_id||n.userId,_=n.id,d=e.getGlobal("shared_name"),u=e.getGlobal("vanity_name"),p="";switch(t){case"files":return p=i.isSearch()?this.getSearchUrl(i.getTypeSpecificId(o),a,r,s):i.isSingleFilePreview()?"/":this.getFolderUrl(i.getTypeSpecificId(o),a);

case"shared_folder":return this.getSharedFolderUrl(d,a,_);case"vanity_url":return this.getVanityUrl(u,a,_)}return i.isGcmQuarantinePreview()?this.getGcmUrlForQuarantine(a,l,c):i.isGcmSearch()?this.getGcmUrlForSearch(n.searchString,a,r):i.isGcm()?this.getGcmUrlForFiles(n.gcmUserId,_,a):!1},getGcmRootUrl:function(){return"/master/content"},getGcmUrlForFiles:function(e,t,i){return this.getGcmRootUrl()+"/"+e+"/"+t+"/"+i},getGcmUrlForPreview:function(e,t,i,n){return this.getGcmRootUrl()+"/"+e+"/"+t+"/"+i+"/"+n},getGcmUrlForQuarantine:function(e,i,n,o,a){return t.createUrl(this.getGcmRootUrl()+"/quarantine/"+e,{policy_id:i||null,user_id:n||null,before_id:o||null,after_id:a||null})},getGcmUrlForQuarantinePreview:function(e){return t.createUrl(this.getGcmRootUrl()+"/quarantine/preview/"+e)},getGcmUrlForSearch:function(e,i,n){var o=t.encodePathComponent(e),a=n?"/"+t.encodePathComponent(n):"";return i=i||0,this.getGcmRootUrl()+"/search/"+o+"/"+i+a},getGcmUrlForSearchPreview:function(e,i,n){var o=t.encodePathComponent(e);return i=i||0,this.getGcmRootUrl()+"/search/"+o+"/"+i+"/"+n}}}),Box.Timing.execution.push({name:"js/box_collab.js",time:(new Date).getTime()});var Collab=Box_Object.extend({accepted:null,collaborators_count:null,collab_id:null,email:null,expiration:null,files_count:null,group_tag_id:null,invite_seen:null,item_id:null,item_name:null,item_permissions_id:null,item_type:null,item_user_name:null,name:null,permission:null,stat:null,user_id:null,tos_id:null,item_user_enterprise_id:null,tos_text:null},{type:"collab",MAX_NUMBER_OF_DOMAINS_TO_DISPLAY_IN_RESTRICT_COLLAB_WARNING_MESSAGE:3,direct_collab_on_item:function(e,t,i){if(t){var n=t.id,o=null;for(var a in e)e[a].item_id==n&&(o?0==e[a].group_tag_id&&(o=e[a]):o=e[a]);return o}},collab_form_submit:function(e){e=e||{};var t,i,n,o,a=e.emails||[],r=this,s=[],l=Item.DEFAULT_ROOT_FOLDER_ID,c=0;for(t in a)if(i=$j.trim(a[t])){if(!$j.box.isEmail(i))return alert($t("The email address is invalid.","invalid_email")),!1;s.push(i)}if("d_"==l.substr(0,2)&&(l=l.substr(2)),box.collab_item_id=="d_"+l)return Box.Application.getService("popups").alert($t("The root folder can not be selected for collaboration.","collaborators_js_alert_root_folder")),!1;if(!e.folder_typed_id&&!box.collab_item_id)return Box.Application.getService("popups").alert($t("Please select a folder to invite collaborators to.","collaborators_js_alert_select_folder")),!1;if(!s.length)return Box.Application.getService("popups").alert($t("Please enter at least one email","collaborators_js_alert_enter_atleast_one_email")),!1;for(t in collab_permissions)c++;o=$j("#collaborators_permissions").val(),n=o||e.permission;var _=e.message||"",d=Box.Application.getService("url"),u=d.getGcmCompatibleRmUrl("box_collaborate_invite"),p={email:s.join(","),email_message:_,node_id:e.folder_typed_id||box.collab_item_id,notify:1,permissions:n},h=$j.box.formatQuery(p);$j.postJSON(u,h,function(t){var i=Collab.get_confirmation_message(t),n=0,o=!1,a=!1,s={},l=Box.Application.getService("nav-state");return t.invited_users&&(n=t.invited_users.length),!n&&t.error?void $.popup.alert(i.title,i.message):(t.not_within_owner_company&&t.not_within_owner_company.length&&$.popup.alert(i.title,i.message),$j("#email_label").length||e.skip_reload||(a=!0,o=!0,t.not_within_owner_company&&t.not_within_owner_company.length||(r._show_notification(i),Collab._show_or_hide_expansion_based_on_message_success(i,t)),"all-files"==e.location&&Item.find(p.node_id.substr(2)).expansion.toggle("Item_Feed"),l.isGcm()&&(s.hideElementsForGCM=!0),Box.Application.broadcast("x-collabchange",s)),a||r._show_notification(i),void(o||"function"==typeof e.callback&&e.callback()))})},_show_or_hide_expansion_based_on_message_success:function(e,t){"error"!=e.type&&t.collabs[0].item.expansion.hide()},_show_notification:function(e){var t=Box.Application.getService("notifications");"error"===e.type?t.error(e.title,{description:e.description}):t.confirm(e.title,{description:e.description})},merge_permissions:function(e){var t=!1,i=!1,n=!1,o=!1,a=!1,r=!1,s=!1;for(var l in e)"Editor"==e[l]?t=!0:"Viewer"==e[l]?i=!0:"Previewer"==e[l]?n=!0:"Uploader"==e[l]?o=!0:"Co-owner"==e[l]?s=!0:"Previewer+Uploader"==e[l]||"Previewer Uploader"==e[l]?a=!0:("Viewer+Uploader"==e[l]||"Viewer Uploader"==e[l])&&(r=!0);return s?"Co-owner":t?"Editor":r?"Viewer+Uploader":i?o||a?"Viewer+Uploader":"Viewer":a?"Previewer+Uploader":o?n?"Previewer+Uploader":"Uploader":n?"Previewer":void 0},get_translated_role_by_role_name:function(e){switch(e=e.toLowerCase().replace(" ","_").replace("-","_")){case"owner":return $t("Owner","collab_role_owner");case"co_owner":return $t("Co-owner","collaborate_type_Co_owner");case"editor":return $t("Editor","collaborate_type_editor");case"previewer":return $t("Previewer","collaborate_type_previewer");case"previewer+uploader":return $t("Previewer Uploader","collaborate_type_previewer_uploader");case"uploader":return $t("Uploader","collaborate_type_uploader");case"viewer":return $t("Viewer","collaborate_type_viewer");case"viewer+uploader":return $t("Viewer Uploader","collaborate_type_viewer_uploader")}},_get_alert_popup_message:function(e){var t,i="",n="";if(e.error)i="Cannot invite self as a collaborator."==e.error?$t("You can't invite yourself to collaborate.","collaborators_js_alert_yourself"):"User is already a collaborator"==e.error?$t("We've already sent this person an invite","collabs_js_alert_already_invited"):$t("We were unable to add the collaborators you specified.","collaborators_js_alert_default"),t=$t("Add Collaborator Alert","collaborators_js_alert_title"),n=i;else{if(t=$t("Invitations Restricted","collaborators_js_alert_restricted_title"),e.within_owner_company&&e.within_owner_company.length){var o=e.within_owner_company.join(", "),a=$t("Invitations were successfully sent to:","collaborators_js_alert_within_company_invites");i+=['<div class="media">','<span class="img sprite_16x16_green_checkmark"></span>','<span class="bd">',a,"<br />",'<span class="standard">'+o+"</span>","<br /><br /></span>","</div>"].join(""),n+=a+o}if(e.not_within_owner_company&&e.not_within_owner_company.length){var r=e.not_within_owner_company.join(", "),s=$t("Invitations could not be sent to the following people because collaboration is restricted to your enterprise:","collaborators_js_alert_not_within_company_invites");i+=['<div class="media">','<span class="img sprite_16x16_warning_sign"></span>','<span class="bd">',s,"<br />",'<span class="standard">'+r+"</span>","<br /><br /></span>","</div>"].join(""),n+=s+r}if(e.external_collaborator_invites_other_external_collaborators&&e.external_collaborator_invites_other_external_collaborators.length){var l=e.external_collaborator_invites_other_external_collaborators.join(", "),c=$t("Invitations could not be sent to the following people because you are not permitted to invite external collaborators:","collaborators_js_alert_external_inviting_external");i+=['<div class="media">','<span class="img sprite_16x16_warning_sign"></span>','<span class="bd">',c,"<br />",'<span class="standard">'+l+"</span>","<br /><br /></span>","</div>"].join(""),n+=c+l}if(e.invitee_not_on_inviter_collab_whitelist&&e.invitee_not_on_inviter_collab_whitelist.length){var _=e.invitee_not_on_inviter_collab_whitelist.join(", "),d=$t("Invitations could not be sent to the following people because collaboration is restricted to your enterprise's collaboration whitelist:","collaborators_js_alert_inviter_whitelisted");i+=['<div class="media">','<span class="img sprite_16x16_warning_sign"></span>','<span class="bd">',d,"<br />",'<span class="standard">'+_+"</span>","<br /><br /></span>","</div>"].join(""),n+=d+_}if(e.inviter_not_on_invitee_collab_whitelist&&e.inviter_not_on_invitee_collab_whitelist.length){var u=e.inviter_not_on_invitee_collab_whitelist.join(", "),p=$t("Invitations could not be sent to the following people because collaboration is restricted to their enterprise's collaboration whitelist:","collaborators_js_alert_invitee_whitelisted");i+=['<div class="media">','<span class="img sprite_16x16_warning_sign"></span>','<span class="bd">',p,"<br />",'<span class="standard">'+u+"</span>","<br /><br /></span>","</div>"].join(""),n+=p+u}}return{title:t,message:i,simple_message:n}},get_confirmation_message:function(e){var t="",i=Canvas.get().user.email;if(e.error||e.not_within_owner_company&&e.not_within_owner_company.length||e.external_collaborator_invites_other_external_collaborators&&e.external_collaborator_invites_other_external_collaborators.length||e.invitee_not_on_inviter_collab_whitelist&&e.invitee_not_on_inviter_collab_whitelist.length||e.inviter_not_on_invitee_collab_whitelist&&e.inviter_not_on_invitee_collab_whitelist.length)return this._get_alert_popup_message(e);if(!e.invited_users.length&&e.deactivated_invitees.length)return{type:"error",title:$t("Sorry, you can not invite deactivated users to collaborate.","collaborators_js_alert_deactiavted_users")};if(!e.invited_users.length&&e.already_collaborated.length)return t=-1!=$.inArray(i,e.already_collaborated)?$t("You can't invite yourself to collaborate.","collaborators_js_alert_yourself"):$t("We've already sent this person an invite","collabs_js_alert_already_invited"),{type:"error",title:t};if(e.invited_users.length>0){{e.invited_users.length}return t=$t("Collaborator(s) were successfully invited.","successfully_invited_collaborators"),{type:"confirm",title:t,description:""}}},_should_use_js_load:function(){return window.box&&"files"==box.hist_name},getCollabWarningWhenCollabRestrictedForItemOwner:function(e){var t=$t("Invitations could not be sent to the following people because collaboration is restricted to your enterprise.","js_popup_collaborate_restrict_collab_default_warning");return e?$t("Collaboration invitations can only be sent to people within %1.","js_popup_collaborate_restrict_collab_within_enterprise_warning",e):t},parseEnterpriseDomains:function(e){var t={firstThreeDomains:e,numberOfLeftoverDomains:0,leftoverDomains:null},i=$.box.escapeHTML(e).split(",");if(i.length>Collab.MAX_NUMBER_OF_DOMAINS_TO_DISPLAY_IN_RESTRICT_COLLAB_WARNING_MESSAGE){var n=i.slice(0,3).join(","),o=i.slice(3,i.length);t.firstThreeDomains=n,t.numberOfLeftoverDomains=o.length,t.leftoverDomains='<span class="sprite_16x16_info list_img list_img_inside_label" data-htmltooltip="'+o.join("<br>")+'"></span>'}return t},render_restricted_email_popup:function(e,t,i){var n,o="",a=!1,r=null;t&&t.user_id?(n=User.find(t.user_id),r=t.owner_enterprise_display_domain):n=Canvas.get().user;var s=!1;if(n&&(a=n.is_external_collab_restricted,n.enterprise_id)){var l=Box.Application.getService("ajax");s=l.get("box_enterprise_has_collaboration_restricted_to_enterprise",{enterpriseId:n.enterprise_id},{success:function(e){return e.data.hasCollaborationRestrictedToEnterprise},error:function(){return!1}})}var c="";(a||t&&t.restrict_collab_to_company||s)&&(c=Collab.getCollabWarningWhenCollabRestrictedForItemOwner(r));for(var _=0,d=e.length;d>_;_++)o+='<li class="folder_collab_user"><div class="media"><div class="bd">'+e[_]+"</div></div></li>";var u=$j("<div/>"),p="<strong>"+$t("Invitations could not be sent to","invitations_not_sent")+':</strong></div><ul class="list_ext cntr scrollable cntr_squared">'+o+"</ul><div>"+c;u.html(p),$j.popup.alert($t("Invitations Restricted","collab_popup_invitation_restricted_modal_title"),u,null,i)},invite_selected_collaborators:function(e,t){var i=e.get_restricted_unrestricted_and_group_keys(),n=i.restricted_collab_emails,o=i.unrestricted_collab_emails,a=function(){o.length&&Collab.collab_form_submit({message:$t("I'd like to share my files with you on Box","collab_invite_default_share_message"),folder_typed_id:t.typed_id,folder_name:t.name,permission:"Editor",location:"all-files",emails:o})};n.length?Collab.render_restricted_email_popup(n,t,a):o.length?a():Box.Application.getService("popups").alert($t("Please enter at least one email","collaborators_js_alert_enter_atleast_one_email"))},render_restricted_collab_warning_flyout:function(e,t,i){var n='<div style="margin-left:-315px; margin-top:-25px;" class="cntr bubble bubble_sidebar pvs">	<span class="arrow" style="margin-top:-20px"></span>	<div class="media">		<div class="img icon sprite_48x48_collab_folder mlm"></div>		<div class="bd pvs phm"><p class="lh16 js_collab_warning"></p></div>	</div></div>',o=$j(n);o.attr("id",t),o.find(".js_collab_warning").text(i),e.prepend(o),e.mouseenter(function(){$j("#"+t).show()}),e.mouseleave(function(){$j("#"+t).hide()})}});Action.register_actions("Collab",["accept"]),Box.Timing.execution.push({name:"js/box_item.js",time:(new Date).getTime()});var Item=Box_Object.extend({_actions:null,_events_attached:!1,_index:null,all_collaborators_loaded:null,allow_invite_collaborators:!0,available_permissions:null,app_integration_info:null,can_change_share_expiration:!0,can_change_delete_expiration:!0,can_invite_collaborators:!0,children:null,clickable:null,collaborated:null,collaborations:null,collaborators_count:0,collection:null,comments_count:null,created:0,created_by:null,created_by_user_id:null,date:null,description:null,element:null,embed_hash:null,expansion:null,expirations:null,extension:null,files:null,files_count:0,file_content_excerpt:null,comments_excerpt:null,file_id_hash:null,flash:null,folder:null,has_pic_x:null,hostname:null,custom_shared_link_root:"",hide_collaborators:0,groups_count:0,id:null,image:null,is_deleted:!1,is_trash_disabled:null,is_infinite:null,is_executable:!1,is_trash_folder:!1,is_quarantined:!1,is_package:!1,index_by_search_engine:0,item_override:!1,is_synced_for_current_user:!1,is_favorited:!1,item_feed_count:null,lock:null,notify_comments_folder:!1,notify_comments_user:!1,notify_download_folder:!1,notify_download_user:!1,notify_upload_folder:!1,notify_upload_user:!1,name:null,owner:null,owner_enterprise_display_domain:"",owner_enterprise_desc_domain:"",owner_id:0,owner_is_free:!0,owner_enterprise_id:null,owner_disabled_shared_download:!1,owner_has_metadata_enabled:!1,open_collab_invite_permission:null,params:null,parent:null,is_self_or_ancestor_collaborated:!1,parent_hide_collaborators:0,has_password:!1,path:null,permissions:null,pic_x:null,previous_versions:null,removed_permissions:null,restrict_collab_to_company:null,referencing_integration_pic:null,raw_size:0,restrict_invite_privelege_by_enterprise:0,selected:!1,sha1:null,shared:null,shared_access:null,shared_access_levels:null,shared_link:null,shared_name:null,shared_download_off:!0,shared_views:0,sharing_disabed:!1,sharing_disabled_on_user:!1,sharing_disabled_on_parent:!1,show_comments_disable_option:!1,show_expiration_notice:null,tags:null,task_count:null,task_to_complete:null,tasks:null,thumb_class_x_small:null,trash_time:null,type:null,typed_id:null,uniq_name:null,update:null,url:null,url_for_page_link:"",user_is_collab:null,user_is_owner:null,users_count:0,vanity_name:null,version_count:null,upload_id:null,max_upload_size:null,free_space_amount:null,owner_enterprise_disable_open_custom_links:!1,constructor:function(e){e=e||{},this._index=e.index,this.all_collaborators_loaded=e.all_collaborators_loaded||!1,this.allow_invite_collaborators=e.allow_invite_collaborators,this.available_permissions=e.available_permissions||{},this.can_change_delete_expiration=e.can_change_delete_expiration,this.can_change_share_expiration=e.can_change_share_expiration,this.can_invite_collaborators=e.can_invite_collaborators,this.children=e.children;var t=e.granted_permissions?e.granted_permissions:e.permissions;if(this.process_permissions(t,Item.PERMISSION_CONSTANTS),this.clickable=("file"!=e.type||this.permissions.download||this.permissions.preview)&&!(this.permissions&&(this.permissions.restore||this.permissions.delete_from_trash)),this.collaborated=e.is_collab_mini||e.collaborated||!1,this.collaborations=e.collaborations||null,this.collaborators_count=parseInt(e.collaborators_count,10),this.collection=e.collection||new ItemCollection({view:Canvas.get().view}),this.comments_count=parseInt(e.comments_count,10)||0,this.created_by=e.created_by||e.owner,this.created_by_user_id=e.created_by_user_id||!1,this.created=e.created||!1,this.custom_link=e.custom_link||"",this.date=e.date||"",this.description=e.description||"",this.direct_shared_link=e.direct_shared_link||"",this.embed_hash=e.embed_hash||"",this.extension=e.extension||"",this.file_content_excerpt=e.file_content_excerpt||"",this.comments_excerpt=e.comments_excerpt||"",this.file_id_hash=e.file_id_hash||"",this.files=e.files||0,this.files_count=e.files_count||0,this.flash=e.flash||!1,this.folder=e.folder,this.folder_id=e.folder_id,this.hide_collaborators=1==e.hide_collaborators,this.groups_count=parseInt(e.groups_count,10)||0,this.hostname=e.hostname||"",this.custom_shared_link_root=e.custom_shared_link_root||"",this.image=1==e.image,this.index_by_search_engine=e.index_by_search_engine||0,this.is_app_folder=e.is_app_folder||!1,this.is_trash_disabled=e.is_trash_disabled,this.is_infinite=e.is_infinite,this.is_deleted=e.is_deleted||!1,this.is_quarantined=e.is_quarantined||!1,this.is_package=e.is_package||!1,this.is_executable=e.is_executable,this.is_trash_folder=e.is_trash_folder||!1,this.is_synced_for_current_user=e.is_synced_for_current_user,this.is_favorited=e.is_favorited||!1,this.last_updated_by=e.last_updated_by||e.owner,this.last_updated_by_user_id=e.last_updated_by_user_id||null,this.lock=e.lock,this.locked=e.locked,this.concurrently_locked=e.concurrently_locked,this.locked_key=e.locked_key,this.name=e.name||"",this.owner=e.owner||"",this.owner_enterprise_display_domain=e.owner_enterprise_display_domain||"",this.owner_enterprise_desc_domain=e.owner_enterprise_desc_domain||"",this.owner_id=e.owner_id||"",this.show_comments_disable_option=e.show_comments_disable_option,this.owner_is_free="undefined"!=typeof e.owner_is_free?e.owner_is_free:!0,this.owner_enterprise_id=e.owner_enterprise_id,this.owner_disabled_shared_download=e.owner_disabled_shared_download||!1,this.owner_has_metadata_enabled=e.owner_has_metadata_enabled||!1,this.open_collab_invite_permission=e.open_collab_invite_permission||"",this.parent=e.parent,this.is_self_or_ancestor_collaborated=e.is_collab_mini||e.is_self_or_ancestor_collaborated||!1,this.parent_hide_collaborators=e.parent_hide_collaborators||!1,this.partner_tags=e.partner_tags||null,this.has_password=e.has_password||!1,this.path=e.path,this.previous_versions=e.previous_versions||null,this.removed_permissions=Item.translateRemovedPermissions(e.removed_permissions),this.referencing_integration_pic=e.referencing_integration_pic,this.raw_size=e.raw_size,this.restrict_collab_to_company=e.restrict_collab_to_company,this.restrict_invite_privilege_by_enterprise=e.restrict_invite_privilege_by_enterprise,this.sha1=e.sha1||"",this.shared=e.shared||!1,this.shared_access="number"==typeof e.shared_access?e.shared_access:null,this.shared_access_levels=e.shared_access_levels||null,this.shared_link=e.shared_link||"",this.shared_name=e.shared_name||"",this.shared_download_count=parseInt(e.shared_download_count,10)||0,this.shared_preview_count=parseInt(e.shared_preview_count,10)||0,this.shared_download_off=e.shared_download_off||"",this.shared_views=e.shared_views||0,this.sharing_disabled=e.sharing_disabled||"",this.sharing_disabled_on_parent=e.sharing_disabled_on_parent||"",this.sharing_disabled_on_user=e.sharing_disabled_on_user||"",this.show_expiration_notice=e.show_expiration_notice||null,this.owner_enterprise_disable_open_custom_links=e.owner_enterprise_disable_open_custom_links||!1,this.size=e.size||"",this.tags=e.tags,this.task_count=parseInt(e.task_count,10)||0,this.thumb_class_x_small=e.thumb_class_x_small||"",this.thumb_class_small=e.thumb_class_small||"",this.thumb_class_large=e.thumb_class_large||"",this.has_task_to_complete=e.has_task_to_complete||!1,this.expirations=e.expirations||{},this.pic_x=e.pic_x,this.has_pic_x=e.has_pic_x,this.trash_time=e.trash_time,this.uniq_name=e.uniq_name,this.update=e.update,this.use_created=e.use_created||!1,this.user_id=e.user_id,this.user_is_collab=e.user_is_collab||!1,this.user_is_owner=e.user_is_owner||!1,this.users_count=parseInt(e.users_count,10)||0,this.url=e.url||"",this.url_for_page_link=e.url_for_page_link||"",this.vanity_name=e.vanity_name||"",this.version_count=e.version_count||0,this.upload_id=e.upload_id||"",this.element=e.element,this.max_upload_size=e.max_upload_size,this.free_space_amount=e.free_space_amount,this.small_thumb=e.small_thumb,this.is_hidden_external_collab=e.is_hidden_external_collab,this.service_id=e.service_id||0,this.service_name=e.service_name||"",this.item_feed_count=this.comments_count+this.task_count,this.id="id"in e?e.id:"",this.type=e.type||"file",this.typed_id="typed_id"in e?e.typed_id:"",e.folder||"folder"==this.type||(this.folder=Item.find(this.parent)),""==this.typed_id&&""!=this.id&&(this.typed_id=Box_Object._get_typed_id(this,!0)),""==this.id&&""!=this.typed_id){var i=Box_Object._get_type_and_id(this.typed_id);this.type=i.type,this.id=i.id}this.shared&&this.shared_link&&!this.shared_name&&(this.shared_name=this.shared_link.replace(/.*\//,"")),e.missing_thumbnails&&Item.add_to_items_with_missing_thumbnails(this),this.params=e.old_params||{},this.base()},set_params:function(e){e=e||{},this.base(e);var t=e.granted_permissions?e.granted_permissions:e.permissions;return this.process_permissions(t,Item.PERMISSION_CONSTANTS),e.removed_permissions&&(this.removed_permissions=Item.translateRemovedPermissions(e.removed_permissions)),this},update_params_and_render:function(e,t){var i=Box.Application.getService("nav-state"),n=i.get();$.isEmptyObject(e)||(this.set_params(e),this.j_element&&this._update_view_list_or_icon(e,t),"folder"==this.type&&this==Canvas.get().current_folder&&this._update_view_current_folder(e,t),"file"===this.type&&n.galleryId===this.typed_id&&this._update_view_gallery(e,t),$j.selectable("refresh"),$j.fast_draggable("refresh"))},_update_view_list_or_icon:function(e,t){var i=t.just_refreshed;return i?void 0:void this.refresh(function(i){t.just_refreshed=!0,i.update_params_and_render(e,t)})},_update_view_current_folder:function(e,t){if(e.created_children){var i=$j.size(e.created_children)>0;for(var n in e.new_version_children){if("undefined"!=typeof Tombstone&&Tombstone.marker("./js/box_item.js:15337","2013-05-15","auto tombstoned"),i)break;var o=Box_Object.find_by_typed_id(e.new_version_children[n]);i=!o.new_version}if(i){var a=e.created_children.concat(e.new_version_children),r=$j("<span></span>").html(t.message.replace(/<br\s?\/?>/," ")+". "),s=this,l=$j('<a href="#"></a>').text($t("Show","realtime_refresh_folder")).click(function(){return s.open({display_on_top_typed_ids:a,callback:function(){for(var e in a){var i=Box_Object.find_by_typed_id(a[e]);i&&(t.just_refreshed=!0,i.update_params_and_render({created_or_new_version:!0},t))}}}),!1});r.append(l),Box_Confirmation_Message.get().show_confirmation(r)}}},_update_view_gallery:function(e,t){var i=Box.Application.getService("notifications"),n=this.id,o=this.typed_id;t&&t.just_refreshed&&(e.new_version?(Box.Application.broadcast("previewaction",{action:"invalidatecache",itemTypedID:o,fileId:n}),i.warn($t("A new version of this file is available. Would you like to refresh the page?","item_notification_new_version_refresh"),{containerNode:".preview-notification",action:{text:$t("Yes","js_Yes"),onclick:function(){i.hide(),Box.Application.navigate("")}}})):e.created_comments&&Box.Application.broadcast("previewaction",{action:"commentsupdated",itemTypedID:o,fileId:n}))},_attach_events:function(){this._events_attached||(this._events_attached=!0)},_render_classes:function(){var e=$j(this.element),t=["item_mouseover_handler",this.type];t.push(e&&e.hasClass("mini_item")?"mini_item":"item"),this.concurrently_locked?t.push("concurrently_locked"):this.locked_key?t.push("locked_key"):this.locked&&t.push("locked"),this.clickable||t.push("not_clickable"),this.comments_count>0&&t.push("has_comments"),this.task_count>0&&t.push("has_tasks"),(this.comments_count>0||"undefined"==typeof shared_folder&&this.task_count>0)&&t.push("has_item_feed"),this.description&&this.description.length>0&&t.push("has_description"),"mp3"==this.extension&&t.push("song"),this.permissions.download||t.push("not_downloadable"),this.is_deleted&&t.push("deleted"),this.flash&&t.push("play"),(this.image||this.flash)&&t.push("previewable"),this.permissions.share||t.push("not_shareable"),this.permissions.create_comment||t.push("not_commentable"),this.shared&&t.push("shared"),$.isEmptyObject(this.tags)||t.push("has_tags"),this.permissions.synchronize&&this.is_synced_for_current_user&&(t.push("is_synced"),this.is_synced_for_current_user==CONST.BOX_ITEM_SYNC_PARTIALLY_SYNCED?(t.push("partially_synced"),e.find(".sync").attr({"data-hover":"tooltip","aria-label":$t("Some Items Synced","item_tooltip_partially_synced")+"|"+$t("Box Sync is enabled for some items in this folder.","item_tooltip_is_partially_synced")})):e.find(".sync").attr({"data-hover":"tooltip","aria-label":$t("Synced","item_tooltip_desktop_sync")+"|"+$t("Box Sync is enabled for all items in this folder.","item_tooltip_is_synced")})),this.is_hidden_external_collab&&(t.push("disabled"),t.push("hidden_external_collab")),e.hasClass("has_comments")&&t.push("has_comments"),e.hasClass("has_item_feed")&&t.push("has_item_feed"),this._is_inbox_or_profile_gallery_page()&&t.push("inbox_item"),this.element&&(this.element.className=t.join(" ")),"icon"!=Canvas.get().view&&(Canvas.get().expanded_list_view||this._is_inbox_or_profile_gallery_page())?(e.find(".tags")[this.tags?"show":"hide"](),e.find(".partner_tags")[this.partner_tags?"show":"hide"]()):e.find(".tag_container")[Canvas.get().expanded_list_view?"show":"hide"](),this.description?e.find(".old_description").show():e.find(".old_description").hide(),"icon"==Canvas.get().view?(e.find(".search_path").hide(),e.find(".select").hide()):(e.find(".search_path").show(),this._is_inbox_or_profile_gallery_page()||e.find(".select").show());var i=Box.Application.getService("v5").get("current_rm"),n="box_shared_show"==i||"box_shared_show_by_name"==i||"box_view_vanity_url"==i;n||this.render_share_indicator()},render_share_indicator:function(){var e=Box.Application.getService("dom"),t=document.querySelector('[data-id="'+this.id+'"].share-menu-indicator');this.shared?e.removeClass(t,"hidden"):e.addClass(t,"hidden")},_render_init:function(e){var t=this.element&&$(this.element).parents("body").length;t||(e||(this.element=document.getElementById(this.typed_id),t=this.element),t||(this.element=document.getElementById("c"+this.collection.id+"_"+this.typed_id)),this.element&&(this.j_element=$j(this.element),0!==this.element.id.indexOf("c")&&(this.element.id="c"+this.collection.id+"_"+this.typed_id)))},render_tags:function(e){var t;if(e=e||{},e.force_render_tags||"icon"!=Canvas.get().view&&Canvas.get().expanded_list_view){var i,n,o=$j(e.container_elem?e.container_elem:this.element),a=o.find(".tags"),r=o.find(".partner_tags"),s=!1,l=0;if(a.empty(),r.empty(),o.find(".update-icon_separator").hide(),$.isEmptyObject(this.tags))a.hide();else{for(t in this.tags)i=this.tags[t];for(t in this.tags){var c=this.tags[t];n=$j('<span class="badge upgrade" />').append($j('<a href="#" class="tag_name" data-type="tag-btn" />').attr("id","t_"+c).text(c)),a.append(n),a.append(" "),l+=1}a.nextAll(".update-icon_separator:first").show(),a.parent().show(),a.show()}if((l>0||e.show_add_tags_button_for_zero_tags)&&this.permissions.create_tag){var _;_=0===l?$t("Add a tag to this %1","js_part_item_menu_add_tag_tooltip",ItemTypeTranslation.singular_from_item(this)):$t("Add or edit tags on this %1","js_part_item_menu_add_or_edit_tag_tooltip",ItemTypeTranslation.singular_from_item(this));var d=$j('<span class="tag_item" />').append($j('<a href="#" class="tag sprite_item_list_addtag add_tag_button" data-type="add-tag-btn" />').attr({"data-hover":"tooltip","aria-label":_}));a.append(d),a.toggle("icon"!==Canvas.get().view&&Canvas.get().expanded_list_view)}if($.isEmptyObject(this.partner_tags))s&&("undefined"!=typeof Tombstone&&Tombstone.marker("./js/box_item.js:15370","2013-05-15","auto tombstoned"),r.hide());else{for(t in this.partner_tags)i=this.partner_tags[t];for(t in this.partner_tags){var u=this.partner_tags[t],p=u.partner_data.partner_name.toLowerCase().replace(/ /g,"_"),h=["ignore_click","tag_name","badge","partner_tag_name",p];"Enterprise"==u.partner_object_type&&h.push("public_partner_tag");var m=h.join(" "),f="/referencing/"+u.partner_data.partner_name+"/"+u.partner_object_type+"/"+u.partner_object_id,g="t_"+$.box.escapeHTML(u.tag_name),v=u.partner_data.pic_url,b=$j('<a target="_blank" />').attr({href:f,id:g,"class":m}).text(u.display_name+" ");v&&b.prepend("&nbsp;").prepend($j('<img class="partner_tag_icon" />').attr("src",v)),r.append(b),i!=u&&r.append(" ")}r.nextAll(".update-icon_separator:first").show(),r.parent().show(),r.show()}}},_render_description_text:function(e){$j("#edit_description_text_"+this.id).html($.box.escapeHTML(e))},_render_metadata:function(){var e=$j(this.element);this.description?this._render_description_text(this.description):e.find(".old_description").length&&e.find(".old_description").remove();var t=this;this._is_inbox_or_profile_gallery_page()&&$j(".edit_description").each(function(){t._render_description_text(this.description)});var i=e.find(".share_link"),n=Box.Application.getGlobalConfig("showAmsterdamCollabSharing"),o=n&&this.shared?$t("Shared","js_part_item_menu_main_shared"):$t("Share","js_part_item_menu_main_share");i.html(o),"web_link"==this.type&&$j("#web_link_url_"+this.id).attr({href:$.box.escapeHTML(this.url),title:$.box.escapeHTML(this.url)}).fastText(this.url)},_render_path:function(){var e=Box.Application.getService("nav-state"),t=e.get(),i=Box.Application.getService("nav-url");if(("f"!==t.type||Canvas.get().current_folder&&Canvas.get().current_folder.is_trash_folder)&&"a"!==t.type){var n=$j(this.element),o=n.find("#path_"+this.id);o.empty();for(var a in this.path){var r=this.path[a],s=a.substr(2),l=$j("<li></li>");$j("<a></a>").attr({href:i.getFolderUrl(s,0,r.name),"data-type":"path-anchor"}).fastText(r.name).appendTo(l),r.last||l.append($j('<span class="delimiter" />').text(box_path_delimiter_char)),l&&l.appendTo(o)}}},_render_expirations:function(){var e=$j(this.element),t=this.expirations.unshare,i=this.expirations["delete"],n=$j("#link_info_"+this.id);if(t){var o=$t("Link disables on %1","js_part_item_auto_unshare_on",t);this.can_change_share_expiration&&(o='<a href="#" class="alert">'+o+"</a>"),n.show().find(".js_enabled_text").html('<span class="expiration_unshare alert">'+o+"</span>").show()}else n.length&&n.find(".js_enabled_text").text("").hide();var a=$j("#expiration_delete_"+this.id);if(i){if(!a.length){var r=n.parent();a=$j("<li />").attr("id","expiration_delete_"+this.id).appendTo(r)}var s;s="folder"==this.type?$t("Folder deletes on %1","js_part_item_folder_auto_delete_on",i):$t("File deletes on %1","js_part_item_auto_delete_on",i),this.can_change_delete_expiration&&(s='<a href="#" class="alert">'+s+"</a>"),a.html('<span class="expiration_delete">'+s+"</span>").show()}else a.length&&a.text("").hide();i?(a.length&&a.addClass("last-child"),n.length&&n.removeClass("last-child")):(n.length&&n.addClass("last-child"),a.length&&a.removeClass("last-child"));var l=e.find('[data-type="stats"]');if(l){var c=this._create_link_stats_tooltip();l.attr("data-htmltooltip",c)}},_create_link_stats_tooltip:function(){var e=this.shared?$t("Enabled","js_enabled_capitalized"):$t("Disabled","js_disabled_capitalized");return $t("Link Access Stats","js_link_access_stats")+"|"+$t("Previews","js_link_previews_label")+": "+this.shared_preview_count+"<br/>"+$t("Downloads","js_link_downloads_label")+": "+this.shared_download_count+"<br/>"+$t("Status","js_link_status_label")+": "+e},render_tooltip:function(){var e=this.name;if(this.element){if("icon"!=this.collection.view)return void $(this.element).removeAttr("data-hover title aria-label");

if(this.collaborated){e+=", ";var t=ItemTypeTranslation.singular_from_item(this);e+=this.user_is_owner?1==this.hide_collaborators?$t("Your %1","item_tooltip_hide_collab_yours",t):this._getItemTooltipTextForFolderYouOwned(t):1==this.hide_collaborators?$t("%1's %2","item_tolltip_hide_collab_not_yours",$.box.escapeHTML(this.owner),t):this._getItemTooltipTextForFolderOwnedByOthers(t)}this.element.setAttribute("aria-label",e),this.element.setAttribute("data-hover","tooltip")}},_getItemTooltipTextForFolderYouOwned:function(e){return $t("Your %1","item_tooltip_collab_your_item",e)},_getItemTooltipTextForFolderOwnedByOthers:function(e){var t=$.box.escapeHTML(this.owner);return $t("%1's %2","item_tooltip_collab_others_item",t,e)},has_expiration:function(){return this.expirations&&(this.expirations.unshare||this.expirations["delete"])},can_execute_action:function(e,t){var i=!0,n=Box.Application.getService("openbox-service-actions"),o=n.createAction(this,e,t,i);return o.can_execute()},execute_action:function(e,t,i){var n=Box.Application.getService("loading"),o=Box.Application.getService("openbox-service-actions"),a=o.createAction(this,e,t,i);return $j(window).one("popup.open",function(){n.set(!1),$j(".box_new_popup").hide()}),a.execute()},change_view:function(){},click:function(e){e=e||{};var t={},i=Box.Application.getService("openbox-service-actions"),n=Box.Application.getService("url"),o=Box.Application.getService("dom"),a=i.getDefaultOpenboxAction(this),r=this.url_for_page_link,s=e.j_element||this.j_element,l=e.evtTarget,c=l&&o.hasClass(l,"item_feed_menu");if(e||(e={}),Canvas.get().target_item=this,$j("#jquery_editable_input").blur(),this.update&&(t.update=this.update),Canvas.get().selection.unselect_all(),s){var _=s.find("a.item_link").attr("href");_&&(r=_)}if(a&&!c)a.execute();else if(this.is_deleted);else if(r&&this.is_weblink())n.openWindow(r);else if(r){var d=Box.Application.getService("nav-state");if(d.isSearch()&&this.is_file()){var u=d.get(),p={};u.mdfilters&&(p.mdfilters=u.mdfilters),r=n.createUrl(r,p)}Box.Application.navigate(r)}else this.can_open(t)?this.open(t):this.preview(e)},encoded_name:function(){var e=this.name;return this.extension&&(e=e.substr(0,e.length-this.extension.length-1)),e=e.replace(/[^A-Za-z0-9]/g,"_")},is_root_folder:function(){return"folder"==this.type&&this.id==Item.ROOT_FOLDER_ID},load_collabs:function(e){e="undefined"==typeof e?!0:e;var t=this,i={folder_id:this.id},n=$j.box.formatQuery(i),o=Box.Application.getService("url"),a=o.getGcmCompatibleRmUrl("box_collaborate_get_collabs");$j.ajax({dataType:"json",url:a,data:n,success:function(e){t.update_collabs(e)},async:e})},update_collabs:function(e){e&&(this.collaborations=e.collabs,Canvas.get().current_folder&&this.id==Canvas.get().current_folder.id&&(Canvas.get().users.set_params(e.users),Canvas.get().group_tags.set_params(e.group_tags)))},build_url:function(){var e,t=Box.Application.getService("v5").get("current_rm"),i="box_shared_show"==t||"box_shared_show_by_name"==t||"box_view_vanity_url"==t,n=this.is_file()&&!this.is_boxnote(),o=Box.Application.getService("nav-state"),a=o.get(),r=this.parent instanceof Item?this.parent.id:this.parent;return n&&i?e="/shared/"+Canvas.get().shared_name+"/"+a.page+"/"+r+"/"+this.id+"/1":n?e="/files/0/f/"+r+"/1/"+this.typed_id:i?e="/shared/"+Canvas.get().shared_name+"/"+a.page+"/"+this.id:this.is_folder()&&(e="/files/0/f/"+this.id),e},open_in_new_window:function(){var e=this.build_url(),t=Box.Application.getService("url");t.openWindow(e)},preview:function(e){e=e||{};var t=Box.Application.getService("nav-state"),i=t.get(),n=Box.Application.getService("nav-url");if(!this.permissions.preview){var o="You do not have the required permissions to preview this item.";return Box.Application.getService("popups").alert(o),!1}if(Item.find(this.id)&&this.has_valid_collection())if(t.isGcm()){var a=n.getFileUrl(this.id,this.parent,i.page,"f");Box.Application.navigate(a)}else Box.Application.broadcast("previewaction",{action:"show",itemTypedID:this.typed_id,allItems:this.collection.items});else Item.open({folder_id:this.parent,sub_type:"1",sub_id:this.typed_id});return!1},render:function(e){return e=e||{},this._render_init(e.file_view||!1),this.element?(e.init||((e.force_render_tags||e.force_render_classes)&&this._render_classes(),this._render_metadata(),this.render_tags(e),this._render_expirations()),"icon"!=this.collection.view&&this._render_path(),this.render_tooltip(),this._attach_events(),this.element):null},show_menu:function(e){e=e||{},e.item=this;var t=Box_Menus.get().menu,i=Box.Application.getGlobalConfig("showAmsterdamCollabSharing");i&&(t._get_offsets=function(){return{x:0,y:$(e.target).is("button")?16:-3}}),t.show(e)},can_select:function(e){return""==this.id?!1:this.is_hidden_external_collab?!1:!0},can_edit_on_gallery_using:function(e){return e?e.extensions_editable_on_gallery&&e.extensions_editable_on_gallery.length&&$j.inArray(this.extension,e.extensions_editable_on_gallery)>-1:!1},can_view_on_gallery_using:function(e){return e?e.extensions_viewable_on_gallery&&e.extensions_viewable_on_gallery.length&&$j.inArray(this.extension,e.extensions_viewable_on_gallery)>-1:!1},select:function(e){var t=$j(this.element);!this.selected&&this.can_select(t)&&(this.selected=!0,t.addClass("selected"),"icon"!=this.collection.view&&t.find(".action_list .select a").removeClass("unchecked_by_js").find("input").prop("checked",!0),Canvas.get().selection.add(this,e),t.selectableSelect())},unselect:function(e){if(this.selected){this.selected=!1;var t=$j(this.element);t.removeClass("selected");var i=function(e){$j(e.target).removeClass("unchecked_by_js")};if($j(this.element).find(".action_list .select a").addClass("unchecked_by_js").unbind("click mouseleave",i).bind("click mouseleave",this,i),"icon"!=this.collection.view){var n=$j(this.element).find("input[type=checkbox]").get(0);n&&(n.checked=!1)}Canvas.get().selection.remove(this,e),$j(this.element).selectableUnselect()}},is_box_created_document:function(){var e={gdoc:!0,gsheet:!0};return e[this.extension]},is_manually_lockable:function(){var e={gdoc:!0,gsheet:!0};return!e[this.extension]},is_item_type_taggable:function(){return this.is_file()||this.is_folder()},is_downloadable:function(){return this.permissions.download&&!this.is_boxnote()},can_view_download_stats:function(){return"file"!=this.type?!1:Canvas.get().user.has_custom_feature("display_download_stats")?this.permissions.view_download_stats:!1},show_download_stats_upgrade_message:function(){var e=this;return"file"!=e.type?!1:!Canvas.get().user.has_custom_feature("display_download_stats")&&e.user_id==Canvas.get().user.id},is_empty_folder:function(){return"folder"!=this.type?!1:this.children.is_empty()},display_in_place_share:function(){var e=Box.Application.getService("nav-state");if(Canvas.get().current_folder&&Canvas.get().current_folder.id==this.id){var t=$j("#sidebar_sharebar");t.show();var i=t.find(".sharing_off_container"),n=t.find(".sharing_on_container");if(box_sidebar.update_share_icons(this),this.permissions.share&&"shared_folder"!=box.hist_name)if(this.shared){if(""==this.vanity_name&&!e.isGcm()){var o=this;return this.get_shared_info(function(){t.show(),o.display_in_place_share()}),t.hide(),!1}$j(".in_place_share_url").val(this.shared_link),$j("#sharing_sidebar_access_level_icon").attr("class","icon sprite_16x16 "+Item.shared_access_to_icon(this.shared_access));var a=Item.shared_access_to_string(this.shared_access);$j("#sharing_sidebar_access_link").html(a+'<span class="arrow"></span>'),n.show(),i.hide()}else i.show(),n.hide();else t.hide(),i.hide(),n.hide()}},refresh:function(e,t){var i=this;t=$.extend({async:!0},t);var n=Box.Application.getService("url"),o=Box.Application.getService("search"),a=n.getGcmCompatibleRmUrl("box_get_items"),r=t.skip_render,s=Canvas.get().current_folder;s&&s.is_self_or_ancestor_collaborated&&(a+="&is_self_or_ancestor_collaborated=1"),s&&s.id==Item.ROOT_FOLDER_ID&&(a+="&displayed_in_root_folder=1");var l={};if(this.id)l.item_typed_ids=[this.typed_id];else{if(!t.upload_session_id)return;l.upload_session_ids=[t.upload_session_id]}o&&o.clearCache(),$j.getJSON(a,$j.box.formatQuery(l),function(n){{var o=Box.Application.getService("nav-state");o.get()}if(n.error)return void(t.on_error_callback&&$j.isFunction(t.on_error_callback)&&t.on_error_callback(n.error));var a,s=!1;i.id?a=i.id:(a=n.items[0].id,s=!0);var l=Item.find(a);l&&s&&i.collection.add_node(l,i._index,i.update,i.upload_id),l&&(i.permissions=n.items[0].permissions);var c=$j(n.html),_=i.typed_id?c.attr("id"):i.upload_id;if(i.collection.id>0&&i.typed_id&&(_=_.replace("c0","c"+i.collection.id),c.attr("id",_)),!r){var d=$("#"+_),u=d.hasClass("fake-item");d.replaceWith(c),l.render({init:!1,file_view:!0,force_render_tags:!0,force_render_classes:!0}),u&&c.addClass("newly-uploaded-item"),l.element=c[0]}l.selected&&(l.selected=!1,l.select()),n.items[0].missing_thumbnails&&Item.add_to_items_with_missing_thumbnails(l),e&&e(l,n.html,r),Box.Application.broadcast("x-itemrefresh",{item:l})},{async:t.async})},open_shared_page:function(){var e=Box.Application.getService("url");e.openWindow(this.shared_link,"_blank")},is_encrypted_at_rest:function(){var e=Canvas.get().users.find(this.user_id);return e&&e.enterprise_id&&"0"!=e.enterprise_id?!0:!1},shared_access_restricted_description:function(){return this.is_self_or_ancestor_collaborated?$t("Only users collaborating in this folder can access this content.","shared_access_restricted_description_default"):"file"==this.type?this.folder.id==Item.ROOT_FOLDER_ID?$t("This file is only viewable by you. Move it to a Collaborated folder to share it with others.","shared_access_restricted_description_file_at_root"):$t("This file is in a private folder and only viewable by you. Invite collaborators to the folder to share.","shared_access_restricted_description_file_in_private_folder"):$t("This %1 is private and only viewable by you. Invite collaborators to the folder to share.","shared_access_restricted_description_private_folder",ItemTypeTranslation.singular_from_item(this))},shared_access_to_tooltip:function(e){var t=this.shared_access_restricted_description(),i=[$t("Link Access: Open | This content is open to people with the link. Viewers are not required to log in.","shared_link_tooltip_icon_open"),$t("Link Access: Your Company | Only users logged in with a %1 email or users collaborating in this folder can access this content.","shared_link_tooltip_icon_company",this.owner_enterprise_desc_domain),$t("Link Access: Collaborators Only | %1","shared_link_tooltip_icon_restricted",t),$t("Link Access: No Link | This %1 cannot be accessed from a shared link. Collaborators will still have access.","shared_link_tooltip_icon_disabled",ItemTypeTranslation.singular_from_item(this))];if(0>e||e>=i.length)return"";var n=i[e];return e==Item.SHARED_ACCESS_OPEN&&this.has_password&&(n+="<br/>"+$t("Password protected.","shared_link_tooltip_password_protected")),n},shared_access_option_text:function(e,t){if(!t)return $t("Option disabled for this %1.","shared_access_menu_disabled",ItemTypeTranslation.singular_from_item(this));var i=this.owner_enterprise_desc_domain.length<=50?this.owner_enterprise_desc_domain:this.owner_enterprise_display_domain,n=[$t("This content is open to people with the link. Viewers are not required to log in.","shared_access_menu_option_open"),$t("Only users logged in with a %1 email or users collaborating in this folder can access this content.","shared_access_menu_option_company",i),this.shared_access_restricted_description(),this.get_text_for_collab_only_shared_access()];return 0>e||e>=n.length?"":n[e]},get_text_for_collab_only_shared_access:function(){return this.is_file()?$t("This file cannot be accessed from a shared link. Collaborators will still have access.","shared_access_menu_disabled_file"):this.is_folder()?$t("This folder cannot be accessed from a shared link. Collaborators will still have access.","shared_access_menu_disabled_folder"):this.is_weblink()?$t("This bookmark cannot be accessed from a shared link. Collaborators will still have access.","shared_access_menu_disabled_weblink"):("undefined"!=typeof Tombstone&&Tombstone.marker("./js/box_item.js:1946","2014-02-03","Not sure if a reachable case"),$t("This item cannot be accessed from a shared link. Collaborators will still have access.","shared_access_menu_disabled_item"))},get_unique_identifier:function(){return"c"+this.collection.id+"_"+this.typed_id},is_folder:function(){return"folder"===this.type},is_file:function(){return"file"===this.type},is_weblink:function(){return"web_link"===this.type},is_boxnote:function(){return"boxnote"===this.extension},is_music:function(){return"mp3"===this.extension},can_generate_link:function(){return this.permissions.share&&(this.is_file()||this.is_folder()||this.is_weblink())},can_collab:function(){Box.Application.getService("nav-state");return this.permissions.create_collab&&this.is_folder()&&!this.is_root_folder()},can_send:function(){return Canvas.get().logged_in&&(!this.owner_id||this.user_is_owner||this.is_self_or_ancestor_collaborated)},can_assign_new_role_to_user:function(e,t){if("Owner"==t)return!1;var i={"Co-owner":["Editor","Previewer","Previewer+Uploader","Uploader","Viewer","Viewer+Uploader"],Editor:["Previewer","Previewer+Uploader","Uploader","Viewer","Viewer+Uploader"],"Previewer+Uploader":["Previewer","Uploader","Viewer","Viewer+Uploader"],Previewer:["Uploader","Viewer","Viewer+Uploader"],"Viewer+Uploader":["Viewer","Uploader"],Uploader:["Viewer"]};return-1!=$j.inArray(e,i[t])?!1:!0},generate_lock_info_html:function(){var e=this.lock,t=Box.Application.getService("datetime");if(e){var i,n;"0"!=e.expiration?(n=t.formatRelativeDateInUserTimezone(e.expiration,t.FORMAT_TYPES.MONTH_DAY_TIME),i=$t("Locked this file until","js_locked_this_file_until")+"<div>"+n+"</div>"):(n=t.formatRelativeDateInUserTimezone(e.updated,t.FORMAT_TYPES.MONTH_DAY_TIME),i=$t("Locked this file","js_locked_this_file")+"<div>"+n+"</div>");var o="";return o=null!==e.service_id?'<ul class="tabular_nav">     <li>         <img class="mrm" src="'+e.service_pic_url+'" />     </li>     <li>         <div class="txt-bold">'+e.service_name+"</div>"+i+"     </li> </ul>":'<ul class="tabular_nav">     <li>         <img class="mrm" src="'+e.user_pic_url+'" />     </li>     <li>         <div class="txt-bold">'+e.user_display_name+"</div>"+i+"     </li> </ul>"}return""},get_shared_info:function(e,t){"undefined"==typeof t&&(t=!0);var i=Box.Application.getService("url"),n=i.getGcmCompatibleRmUrl("box_files_get_shared_info"),o={typed_id:this.typed_id};$j.getJSON(n,o,function(t){t.error?Box.Application.getService("popups").alert($t("The shared link has been deleted or is no longer available.","shared_link_not_available")):e&&e(t)},{async:t})},_is_inbox_or_profile_gallery_page:function(){return"undefined"!=typeof gallery_page&&("inbox"==gallery_page||"profile"==gallery_page)},has_valid_collection:function(){return this.collection.items.length>0},update_properties:function(e){$j.extend(!0,this,e)},update_all_references:function(e){this.update_properties(e);var t=Canvas.get().collections;for(var i in t){var n=t[i].items;for(var o in n){var a=n[o];a.id==this.id&&a.update_properties(e)}}}},{type:"item",_subtypes:["folder","file","web_link"],ROOT_FOLDER_ID:0,TRASH_FOLDER_ID:"1",actions:[{id:"change_owner"},{id:"collaborate"},{id:"collaboration_links"},{id:"create_item_feed_object"},{id:"delete_me"},{id:"delete_from_trash"},{id:"download",sync:$j.browser.msie},{id:"update_item_info"},{id:"edit_properties"},{id:"embed_upload_widget"},{id:"get_item_feed"},{id:"get_task"},{id:"lock_file"},{id:"move"},{id:"new_document"},{id:"new_folder"},{id:"save_shared_link_as_web_link"},{id:"open"},{id:"remove_star"},{id:"restore"},{id:"revoke_app_folder"},{id:"set_expirations"},{id:"sharebar"},{id:"synchronize"},{id:"tag"},{id:"unlock_file"},{id:"version_history"},{id:"enable_folder_email"},{id:"report_abuse"},{id:"set_share_access"},{id:"new_pin"},{id:"remove_pin"},{id:"show_pins"},{id:"share"},{id:"quarantine_reinstate"},{id:"quarantine_false_positive"}],getting_thumbnails:!1,items_with_missing_thumbnails:{},DEFAULT_ROOT_FOLDER_ID:"d_0",SHARED_ACCESS_OPEN:0,SHARED_ACCESS_COMPANY:1,SHARED_ACCESS_RESTRICTED:2,SHARED_ACCESS_DISABLED:3,SHARED_ACCESS_STRINGS:[$t("Open Access","shared_link_access_label_open"),$t("Company Access","shared_link_access_label_company"),$t("Collaborators Only Access","shared_link_access_label_restricted"),$t("Disabled Access","shared_link_access_label_disabled")],SHARED_ACCESS_ICONS:["sprite_16x16_link_blue","sprite_16x16_company_blue","sprite_16x16_restricted_blue","sprite_14x14_close"],SHARED_ACCESS_CLASSES:["open","company","restricted"],shared_access_to_icon:function(e){return 0>e||e>=Item.SHARED_ACCESS_ICONS.length?"":Item.SHARED_ACCESS_ICONS[e]},shared_access_to_string:function(e){return 0>e||e>=Item.SHARED_ACCESS_STRINGS.length?"":Item.SHARED_ACCESS_STRINGS[e]},shared_access_to_class:function(e){return 0>e||e>=Item.SHARED_ACCESS_CLASSES.length?"":Item.SHARED_ACCESS_CLASSES[e]},find:function(e){if(null==e||"undefined"==typeof e)return null;e=e.toString();var t,i;if(Box_Object._is_typed_id(e))t=e.substring(2),i=Box_Object.find_by_typed_id(e);else{t=e;for(var n in this._subtypes){var o=this._subtypes[n];if(e=o+"_"+t,i=Box_Object.find_by_typed_id(e))break}}return i&&t==Item.ROOT_FOLDER_ID&&!i.name&&(i.name=$t("All Files","js_global_allfiles")),i},find_or_create:function(e){if("object"!=typeof e){var t=e;e=Box_Object._get_type_and_id(t)}var i=Box_Object.find_by_type_and_id(e);return i?i.set_params(e):new Item(e)},find_async:function(e){var t,i,n,o=Box.Application.getService("promises"),a=Box_Object._get_type_and_id(e),r=Box_Object.find_by_type_and_id(a);return i=r?o.createResolved(r):o.create(function(e){t="/index.php?rm=unidb_get_items",n={type:a.type,id:a.id},$.getJSON(t,$.box.formatQuery(n),function(t){e(new Item(t))})})},find_or_create_just_uploaded_item:function(e){var t=Canvas.get().current_folder;return Item.find(e.id)||new Item({type:e.type,id:e.id,name:e.name,user_is_owner:!0,granted_permissions:{share:t?t.permissions.share:!0,view:!0,create_collab:"folder"==e.type,rename:!0,upload:!0,download:!0}})},PERMISSION_CONSTANTS:{restore:"item_restore",delete_from_trash:"item_delete_from_trash",create_tag:"item_create_tag",create_collab:"item_create_collab",create_comment:"item_create_comment",download:"item_download","delete":"item_delete",rename:"item_rename",options:"item_options",preview:"item_preview",remove:"item_remove",set_share_access:"item_set_share_access",share:"item_share",create_task:"item_create_task",upload:"item_upload",view:"item_view",synchronize:"item_synchronize",can_non_owners_invite_collab:"item_can_non_owners_invite_collab",create_instant_mode_authorization:"create_instant_mode_authorization",restore_from_quarantine:"restore_from_quarantine",add_data_retention:"add_data_retention",execute_data_retention:"execute_data_retention",apply_data_retention:"apply_data_retention",delete_file_version:"delete_file_version",perm_delete_file_version:"perm_delete_file_version",make_version_current:"make_version_current",view_file_version:"item_view_file_version",view_download_stats:"item_view_download_stats",create_view_path_collabs:"item_create_view_path_collab",enable_anonymous_uploads:"enable_anonymous_uploads",extend_data_retention:"extend_data_retention",create_file_write_lock:"create_file_write_lock",crud_watermark_label:"crud_watermark_label",non_watermarked_preview:"item_non_watermarked_preview"},open:function(e){var t=Box.Application.getService("nav-state");if(e=e||{},"undefined"!=typeof box&&"files"==box.hist_name&&"web_link"!=e.type)t.set({type:"f",subType:e.sub_type,isGallery:"1"==e.sub_type}),t.setPreviewState(e.sub_id),t.set({page:0,id:e.folder_id}),Box.Application.navigate("");else{var i=Box.Application.getService("url"),n="";if("folder"==e.type)n="/files/0/f/"+e.folder_id;else{if("web_link"==e.type)return n="/web_links/"+e.sub_id.substr(2),void i.openWindow(n);n="/files/0/f/"+e.folder_id+"/1/"+e.sub_id}i.goToUrl(n)}},add_to_items_with_missing_thumbnails:function(e){Item.items_with_missing_thumbnails[e.typed_id]=e,Item.getting_thumbnails||(Item.getting_thumbnails=!0,setTimeout(Item.get_thumbnails,1))},get_thumbnails:function(){var e=[],t=Item.items_with_missing_thumbnails;for(var i in t)t.hasOwnProperty(i)&&e.push(i);var n={item_typed_ids:e},o=$j.box.formatQuery(n),a="/index.php?rm=box_get_thumbnails";$j.getJSON(a,o,Item.get_thumbnails_callback)},get_thumbnails_callback:function(e){for(var t in e){var i=Item.items_with_missing_thumbnails[t],n=e[t];if(n){var o=$j(i.element);n.pic_s&&o.find(".thumb_small").css("background-image","url("+n.pic_s+")"),n.pic_l&&o.find(".thumb_large").css("background-image","url("+n.pic_l+")"),n.pic_x&&(i.pic_x=n.pic_x),i.has_pic_x=n.has_pic_x;var a=n.pic_s&&n.pic_l&&n.pic_x;a&&delete Item.items_with_missing_thumbnails[t]}}Item.update_preview_tooltip&&Item.update_preview_tooltip(),$.isEmptyObject(Item.items_with_missing_thumbnails)?Item.getting_thumbnails=!1:Item.get_thumbnails()},current_folder:function(){return Canvas.get().current_folder},registerActions:function(){$j.each(Item.actions,function(e){var t=Item.actions[e];Item.prototype["can_"+t.id]=function(e){return this.can_execute_action(t.id,e)},Item.prototype[t.id]=function(e){return this.execute_action(t.id,e,t.sync)}})},translateRemovedPermissions:function(e){var t=$.extend({},e);if(e)for(var i in Item.PERMISSION_CONSTANTS)if(Item.PERMISSION_CONSTANTS.hasOwnProperty(i)){var n=Item.PERMISSION_CONSTANTS[i];n in e&&(delete t[n],t[i]=e[n])}return t}});Item.registerActions(),Box.Timing.execution.push({name:"js/box_item_action_validator.js",time:(new Date).getTime()});var ItemActionValidator=Base.extend({invalid_items:[],valid_items:[],validate:function(e){this.invalid_items=[],this.valid_items=[];var t,i;for(t in e)e.hasOwnProperty(t)&&(i=e[t],this._validate(i)?this.valid_items.push(i):this.invalid_items.push(i));return 0===this.invalid_items.length},_validate:function(e){return"undefined"!=typeof Tombstone&&Tombstone.marker("./js/box_item_action_validator.js:7113","2013-05-15","auto tombstoned"),!0},has_errors:function(){return 0!==this.invalid_items.length}},{}),RequiredPermissionItemActionValidator=ItemActionValidator.extend({constructor:function(e,t,i){this.required_permissions=e.required_permissions||{},this.locking=e.locking,this.service_action_id=e.service_action_id,this.item_collaboration_permissions=i.item_permissions||{},this.service_id=e.service_id},_validate:function(e){var t=!0,i=this;return $.each(this.required_permissions,function(n,o){return o?e.permissions[n]?!0:"multiple"===i.locking&&e.lock&&e.lock.service_action_id===i.service_action_id?("undefined"!=typeof Tombstone&&Tombstone.marker("./js/box_item_action_validator.js:7118","2013-05-15","auto tombstoned"),!0):e.lock&&i.service_id&&e.lock.service_id===i.service_id&&e.removed_permissions&&"access_exception_item_locked_by_app_lock"===e.removed_permissions[n]?!0:i.item_collaboration_permissions[n]?!0:(t=!1,!1):!0}),t}},{}),InvalidExtensionItemActionValidator=ItemActionValidator.extend({constructor:function(e,t,i){this.allowed_extensions=e.allowed_extensions,this.other_extensions_disallowed=e.other_extensions_disallowed||!1},_validate:function(e){return this.allowed_extensions[e.extension]===!1?!1:this.allowed_extensions[e.extension]===!0?!0:void 0==this.allowed_extensions[e.extension]&&this.other_extensions_disallowed?!1:!0}},{}),InvalidTypeItemActionValidator=ItemActionValidator.extend({constructor:function(e,t,i){this.allowed_types=e.allowed_types},_validate:function(e){return this.allowed_types[e.type]}},{}),CustomItemActionValidator=ItemActionValidator.extend({constructor:function(e,t,i){this.custom_permissions=e.custom_permissions||[],this.action=t},_validate:function(e){for(var t=0,i=this.custom_permissions.length;i>t;t++){var n=this.custom_permissions[t].apply(this.action,[e,this.action]);if(!n)return!1}return!0}},{});Box.Timing.execution.push({name:"js/box_item_action.js",time:(new Date).getTime()});var ItemAction=Base.extend({validators:[],action:null,class_name:"",collection:null,description:"",executed_by_default:!1,favicon_url:"",id:null,item:null,menu_item_id:"",name:"",options:null,"static":!1,on_load_callbacks:null,sync:!1,constructor:function(e){return e=e||{},e.id&&(e.item||e.collection)?(this.id=e.id,this.item=e.item,this.collection=e.collection,this.options=e.options||{},this.sync=e.sync,this.set_source(),this.set_class_name(),this.set_name(),this.menu_item_id="menu_item_"+this.id,this.on_load_callbacks=[],this.deferred=$.Deferred(),!window[this.class_name]&&OpenboxAction.exists(e.id)&&(window[this.class_name]=OpenboxAction.create(e.id)),window[this.class_name]&&this.set_action(),this.load_attempts=10,void this.load()):!1},set_source:function(){var e=Box.Application.getService("v5").get("current_rm");switch(e){case"box_files":case"box_files_search":case"box_files_tag":case"box_files_pin":case"box_master_content":case"box_master_quarantine":this.source="files";break;case"box_v2_new_inbox":this.source="updates";break;case"box_shared_show_by_name":this.source="shared_folder";break;case"box_user_profile_view":this.source="user_profile";break;case"box_view_vanity_url":this.source="vanity_url";break;case"box_collaborators_get_page":"undefined"!=typeof Tombstone&&Tombstone.marker("./js/box_item_action.js:set_source()","2015-03-10","comment mentions webdoc but not sure if this is still webdoc specific"),this.source="collaborators_get"}this.source&&"unknown"!=this.source||(this.source="shared_file")},_initialize_validators:function(){this.validators={required_permission:new RequiredPermissionItemActionValidator(window[this.class_name],this.action,this.options),extension:new InvalidExtensionItemActionValidator(window[this.class_name],this.action,this.options),type:new InvalidTypeItemActionValidator(window[this.class_name],this.action,this.options),custom:new CustomItemActionValidator(window[this.class_name],this.action,this.options)}},can_execute:function(){if(this.options.ignore_permissions)return!0;var e=this.item?[this.item]:this.collection?this.collection.items:[];this._initialize_validators();var t,i;for(t in this.validators)this.validators.hasOwnProperty(t)&&(i=this.validators[t],i.validate(e));return!(this.validators.required_permission.has_errors()||this.validators.extension.has_errors()||this.validators.type.has_errors()||this.validators.custom.has_errors())},execute:function(e){if(!this.is_loaded()){var t=this;return this.add_on_load_callback(function(){t.execute()}),this.deferred.promise()}if(this.can_execute())return this.item&&!this.collection&&(Canvas.get().target_item=this.item),this.action.execute(e),this.deferred.promise();var i=this.create_validation_error();return $.popup.alert($t("Error","js_popup_title_error"),i),this.deferred.reject({reason:ItemAction.PERMISSION_DENIED_REASON,message:"Cannot execute"}),this.deferred.promise()},create_validation_error:function(){var e=this.validators.extension.has_errors()||this.validators.type.has_errors()?$t("You cannot perform the %1 action","error_notice_js_you_cannot_perform_action",this.name):$t("You do not have the required permissions to perform the %1 action","error_notice_js_you_donot_have_permissions",this.name);if(this.item&&(e+=' on "'+$.box.escapeHTML(this.item.name||$t("All Files","js_global_allfiles"))+'".'),this.collection){e+=" on the following items:<br /><br />";var t=[];this.validators.extension.has_errors()?t=this.validators.extension.invalid_items:this.validators.type.has_errors()?t=this.validators.type.invalid_items:this.validators.required_permission.has_errors()?t=this.validators.required_permission.invalid_items:this.validators.custom.has_errors()&&("undefined"!=typeof Tombstone&&Tombstone.marker("./js/box_item_action.js:7476","2013-05-15","auto tombstoned"),t=this.validators.custom.invalid_items),e+=$j.map(t,function(e){return'"'+$.box.escapeHTML(e.name)+'"'}).join("<br />")}return e},load:function(){if(!this.action){var e=Box.Application.getService("assets").getAssetURL(js_path,"actions/"+this.id+".js",!this.sync);if(this.sync)this.load_script(e),this.set_action();else{var t=this;this.load_script_async(e,function(){if(!window[t.class_name]){if(!t.load_attempts)return;return t.load_attempts--,void window.setTimeout(function(){t.load()},0)}t.set_action();for(var e=0;e<t.on_load_callbacks.length;e++)t.on_load_callbacks[e]()})}}},load_script:function(e){$.ajax({type:"GET",url:e,dataType:"script",cache:!0,async:!1,no_context:!0})},load_script_async:function(e,t){var i=document.createElement("script");i.readyState?i.onreadystatechange=function(){/loaded|complete/.test(i.readyState)&&(i.onload=i.onreadystatechange=null,t())}:i.onload=function(){t()},i.type="text/javascript",i.src=e,document.body.appendChild(i)},set_action:function(){this.action=new window[this.class_name]({collection:this.collection,item:this.item,source:this.source,deferred:this.deferred},this.options),this.description=this.action.description,this.executed_by_default=this.action.extensions_executed_by_default&&this.item&&"file"==this.item.type&&$j.in_array(this.item.extension,this.action.extensions_executed_by_default),this.editable_on_gallery=this.item&&this.item.can_edit_on_gallery_using(this.action),this.favicon_url=this.action.favicon_url,this.action.name&&(this.name=this.action.name)},set_class_name:function(){var e="",t=this.id.split("_");for(var i in t)e+=t[i].substr(0,1).toUpperCase(),e+=t[i].substr(1).toLowerCase();e+="Action",this.class_name=e},set_name:function(){this.name=this.id.toLowerCase().split("_").join(" "),"delete me"==this.name&&(this.name="delete")},is_loaded:function(){return this.action},add_on_load_callback:function(e){this.on_load_callbacks.push(e)}},{PERMISSION_DENIED_REASON:"permission_denied"});Box.Timing.execution.push({name:"js/box_item_collection.js",time:(new Date).getTime()});var ItemCollection=Base.extend({_items_by_id:null,collaborated:null,element:null,id:null,items:null,maximum_items:null,nodes:null,permissions:null,removed_permissions:null,shared_name:null,view:null,constructor:function(e){this._items_by_id={},this.items=[],e=e||{},this.collaborated=e.collaborated||!1,this.element=e.container,this.id="undefined"!=typeof e.id?e.id:null,this.maximum_items=e.maximum_items||null,this.nodes=e.nodes||{},this.permissions=e.permissions||{},this.removed_permissions=e.removed_permissions||{},this.shared_name=e.shared_name||null,this.view=e.view||"icon";var t=0;for(var i in this.nodes){var n=this.nodes[i];this.add_node(n,t,e.update),t++}},can_execute_action:function(e,t){if(0!==this.size()){var i=!0,n=new ItemAction({id:e,collection:this,options:t,sync:i});return n.can_execute()}},execute_action:function(e,t,i){if(0!==this.size()){var n=Box.Application.getService("loading"),o=new ItemAction({id:e,collection:this,options:t,sync:i});return $j(window).one("popup.open",function(){n.set(!1),$j(".box_new_popup").hide()}),o.execute()}},add:function(e,t){if(e instanceof Item){var i=this._insert_to_item_collection(e,t);i&&this.items.push(e)}},prepend:function(e,t){if(e instanceof Item){var i=this._insert_to_item_collection(e,t);if(i){for(var n=0,o=0,a=this.items.length;a>o&&$(this.items[o].element).hasClass("fake-item");o++)n++;this.items.splice(n,0,e)}}},_insert_to_item_collection:function(e,t){var i=t||e.id,n=e.id||e.upload_id;if(this._items_by_id[i]){for(var o=0;o<this.items.length;o++){var a=this.items[o].upload_id||this.items[o].id;if(i==a){this.items[o]=e;break}}return i!=n&&delete this._items_by_id[i],this._items_by_id[n]=e,!1}return this._items_by_id[n]=e,!0},add_node:function(e,t,i,n){e.permissions||(e.permissions=""),e.removed_permissions||(e.removed_permissions=[]),e.collection=this,e.folder=Item.find(e.parent)||new Item({type:"folder",id:e.parent}),i&&(e.update=i);var o=Item.find_or_create(e);return this.add(o,n),o},change_view:function(e,t){t=t||{},
this.view=e;var i=t.change_items_view_only||!1,n=$j(this.element);i||("icon"!=this.view?n.removeClass("icon_view").addClass("list_view"):n.removeClass("list_view").addClass("icon_view"),Canvas.get().expanded_list_view?n.addClass("list_view_expanded"):n.removeClass("list_view_expanded"));for(var o in this.items)this.items[o].change_view(this.view),this.items[o].render_tooltip(),this.items[o]._render_classes()},find:function(e){if("number"==typeof e||"string"==typeof e)return this._items_by_id[e];e=e||{};for(var t=new ItemCollection,i=0;i<this.items.length;i++){var n=this.items[i];if(this._param_applies(e.extension,n.extension)&&!(e.image&&!n.image||e.user_is_owner&&!n.user_is_owner)){if(e.permission){"undefined"!=typeof Tombstone&&Tombstone.marker("./js/box_item_collection.js:20782","2013-05-15","auto tombstoned"),"string"==typeof e.permission&&(e.permission=[e.permission]);for(var o=!1,a=0;a<e.permission.length;a++)if("undefined"!=typeof Tombstone&&Tombstone.marker("./js/box_item_collection.js:20783","2013-05-15","auto tombstoned"),!n.permissions[e.permission[a]]){"undefined"!=typeof Tombstone&&Tombstone.marker("./js/box_item_collection.js:20784","2013-05-15","auto tombstoned"),o=!0;break}if(o)continue}this._param_applies(e.type,n.type)&&t.add(n)}}return t},_param_applies:function(e,t){if("undefined"==typeof e)return!0;if("string"==typeof e)return e&&t!=e?!1:!0;if("object"==typeof e){var i=!0;for(var n in e)(e[n]&&t!=n||!e[n]&&t==n)&&(i=!1);return i}},remove:function(e){if(e instanceof Item){delete this._items_by_id[e.id];for(var t=0;t<this.items.length;t++)if(this.items[t].id==e.id){this.items.splice(t,1);break}}},render:function(e){e||(e={});var t=0;for(var i in this.items){var n=this.items[i];n.render({init:!0,file_view:e.file_view}),this.maximum_items&&t>=this.maximum_items&&$j(n.element).hide(),t++}return(!e.page||"inbox"!=e.page&&"profile"!=e.page&&!e.skip_change_view)&&this.change_view(this.view,e),this.element},select:function(e){for(var t in this.items)this.items[t].select(e)},selectable_count:function(){for(var e=0,t=0;t<this.items.length;t++)this.items[t].can_select()&&e++;return e},size:function(){return this.items.length},raw_size:function(){"undefined"!=typeof Tombstone&&Tombstone.marker("./js/box_item_collection.js:20800","2013-05-15","auto tombstoned");var e=0;for(var t in this.items)e+=parseInt(this.items[t].raw_size);return e},unselect:function(e){for(var t=this.items.length-1;t>=0;t--)this.items[t].unselect(e)},display_type:function(e){e||(e={});var t=e.capital,i={};$j.map(this.items,function(e){i[e.type]||(i[e.type]=0),i[e.type]++});var n,o=0;for(var a in i)o++,n=a;1!=o&&(n="item");var r;return r=1==this.size()?t?ItemTypeTranslation.singularCapital(n):ItemTypeTranslation.singular(n):t?ItemTypeTranslation.pluralCapital(n):ItemTypeTranslation.plural(n)},is_empty:function(){return 0===this.size()}},{actions:[{id:"delete_from_trash"},{id:"delete_me"},{id:"download",sync:$j.browser.msie},{id:"move"},{id:"restore"},{id:"sharebar"},{id:"share"},{id:"tag"},{id:"new_pin"},{id:"synchronize"}],registerActions:function(){$j.each(ItemCollection.actions,function(e){var t=ItemCollection.actions[e];ItemCollection.prototype["can_"+t.id]=function(e){return this.can_execute_action(t.id,e)},ItemCollection.prototype[t.id]=function(e){return this.execute_action(t.id,e,t.sync)}})}});ItemCollection.registerActions(),Box.Timing.execution.push({name:"js/box_item_selection.js",time:(new Date).getTime()});var ItemSelection=Base.extend({collection:null,constructor:function(e){e=e||{},this.collection=new ItemCollection},add:function(e,t){this.collection.find(e.id)||(this.collection=this.clone(this.collection),this.collection.add(e),t||Box_Menus.get().multi_options_menu.render(this.collection),this.check_select_all())},remove:function(e,t){this.collection.find(e.id)&&(this.collection=this.clone(this.collection),this.collection.remove(e),t||Box_Menus.get().multi_options_menu.render(this.collection),this.check_select_all())},check_select_all:function(){Canvas.get().count_items()==Canvas.get().selection.collection.size()?$(".select_all").children("a").removeClass("sprite_item_list_checkbox").addClass("sprite_item_list_checkbox_checked"):$(".select_all").children("a").removeClass("sprite_item_list_checkbox_checked").addClass("sprite_item_list_checkbox")},select_all:function(){for(var e in Canvas.get().collections)Canvas.get().collections[e].select(!0);$j("#select_all").removeClass("sprite_item_list_checkbox").addClass("sprite_item_list_checkbox_checked"),Box_Menus.get().multi_options_menu.render(this.collection)},toggle_all:function(){for(var e=0,t=0;t<Canvas.get().collections.length;t++)e=Canvas.get().collections[t].selectable_count();this.collection.size()<e?this.select_all():this.unselect_all()},unselect_all:function(){this.collection=this.clone(this.collection),this.collection.unselect(!0),$j("#select_all").addClass("sprite_item_list_checkbox").removeClass("sprite_item_list_checkbox_checked"),"undefined"!=typeof Box_Menus.get().multi_options_menu&&Box_Menus.get().multi_options_menu.render(this.collection)},clone:function(e,t){var i;if("object"==typeof e)if(e)if(e instanceof Base)if("undefined"!=typeof t)i=e;else{var n=function(){};n.prototype=e.constructor.prototype,i=new n;for(var o in e)e.hasOwnProperty(o)&&(i[o]=this.clone(e[o],"object["+o+"]"))}else if(e instanceof Array){i=[];for(var a=0;a<e.length;a++)i[a]=this.clone(e[a],t+"["+a+"]")}else{i={};for(var r in e)i[r]=this.clone(e[r],t+"["+r+"]")}else i=null;else i=e;return i}},{});Box.Timing.execution.push({name:"js/box_item_type_translations.js",time:(new Date).getTime()});var ItemTypeTranslation=Base.extend({},{_translations:{file:{singular:$t("file","js_global_type_file"),singularCapital:$t("File","js_global_type_file_capital"),plural:$t("files","global_type_files"),pluralCapital:$t("Files","global_type_files_capital")},folder:{singular:$t("folder","js_global_type_folder"),singularCapital:$t("Folder","js_global_type_folder_capital"),plural:$t("folders","global_type_folders"),pluralCapital:$t("Folders","global_type_folders_capital")},item:{singular:$t("item","global_type_item"),singularCapital:$t("Item","global_type_item_capital"),plural:$t("items","global_type_items"),pluralCapital:$t("Items","global_type_items_capital")},web_link:{singular:$t("bookmark","global_type_web_link"),singularCapital:$t("Bookmark","global_type_web_link_capital"),plural:$t("bookmarks","global_type_web_links"),pluralCapital:$t("Bookmarks","global_type_web_links_capital")}},_get:function(e){return ItemTypeTranslation._translations[e]||ItemTypeTranslation._translations.item},plural:function(e){return ItemTypeTranslation._get(e).plural},pluralCapital:function(e){return ItemTypeTranslation._get(e).pluralCapital},singular:function(e){return ItemTypeTranslation._get(e).singular},singularCapital:function(e){return ItemTypeTranslation._get(e).singularCapital},singular_from_item:function(e){return ItemTypeTranslation._get(e.type).singular},translate:function(e,t,i){return 1!=t?i?ItemTypeTranslation.pluralCapital(e):ItemTypeTranslation.plural(e):i?ItemTypeTranslation.singularCapital(e):ItemTypeTranslation.singular(e)}});Box.Timing.execution.push({name:"js/box_item_expiration.js",time:(new Date).getTime()});var Item_Expiration=Box_Object.extend({action:null,execute_at:null,id:null,item:null,need_notify:null,notify_at:null,constructor:function(e){this.set_params(e)}},{type:"item_expiration"});Action.register_actions("Item_Expiration",[]),Box.Timing.execution.push({name:"js/selections/box_abstract_selection.js",time:(new Date).getTime()});var Abstract_Selection=Base.extend({selected_item_collection:null,_all_loaded_items_collections:null,_select_all_element_id:"select_all",_on_select:null,_on_deselect:null,constructor:function(e){e=e||{},this._on_select=e.on_select,this._on_deselect=e.on_deselect,this._select_all_element_id=e.select_all_element_id||this._select_all_element_id},select:function(e,t){this.selected_item_collection.find(e.id)||(this.selected_item_collection.add(e),t||(this._handle_rendering_options_menu(),$j.isFunction(this._on_select)&&this._on_select(e)),this.check_select_all())},_handle_rendering_options_menu:function(){},unselect:function(e,t){this.selected_item_collection.find(e.id)&&(this.selected_item_collection.remove(e),t||(this._handle_rendering_options_menu(),$j.isFunction(this._on_deselect)&&this._on_deselect(e)),this.check_select_all())},check_select_all:function(){this._all_loaded_items_collections.size()==this.selected_item_collection.size()?$j("#"+this._select_all_element_id).removeClass("sprite_item_list_checkbox").addClass("sprite_item_list_checkbox_checked"):$j("#"+this._select_all_element_id).removeClass("sprite_item_list_checkbox_checked").addClass("sprite_item_list_checkbox")},select_all:function(){var e=this._all_loaded_items_collections.each(function(e){e.select(!0)});this.check_select_all(),this._handle_rendering_options_menu(),$j.isFunction(this._on_select)&&this._on_select(e)},toggle_all:function(){this.selected_item_collection.size()<this._all_loaded_items_collections.size()?this.select_all():this.unselect_all()},unselect_all:function(){var e=this._all_loaded_items_collections.each(function(e){e.unselect(!0)});this.check_select_all(),this._handle_rendering_options_menu(),$j.isFunction(this._on_deselect)&&this._on_deselect(e)},reset:function(){this.selected_item_collection&&this.selected_item_collection.reset(),this.selected_item_collection&&this._all_loaded_items_collections.reset()}},{});Box.Timing.execution.push({name:"js/selections/box_device_pinning_selection.js",time:(new Date).getTime()});var Device_Pinning_Selection=Abstract_Selection.extend({constructor:function(e,t,i){i=i||{},this.base(i),this.selected_item_collection=t?t:new Device_Pinning_Collection,this._all_loaded_items_collections=e?e:new Device_Pinning_Collection},_handle_rendering_options_menu:function(){},check_select_all:function(){this._all_loaded_items_collections.size()==this.selected_item_collection.size()?$j("#"+this._select_all_element_id).attr("checked","checked"):$j("#"+this._select_all_element_id).removeAttr("checked")}},{});Box.Timing.execution.push({name:"js/collections/box_abstract_collection.js",time:(new Date).getTime()});var Abstract_Collection=Base.extend({objects:null,_length:0,constructor:function(e){this.reset(),this.set_params(e)},reset:function(){this.objects={},this._length=0},set_params:$j.abstract_function,_is_correct_object_instance:$j.abstract_function,add:function(e,t){this._is_correct_object_instance(e)&&(this.objects[t]=e,this._length+=1)},remove:function(e,t){this._is_correct_object_instance(e)&&(delete this.objects[t],this._length-=1)},find:function(e){return"number"==typeof e||"string"==typeof e?this.objects[e]:void 0},size:function(){return this._length},each:function(e){return $.map(this.objects,function(t,i){return e(t),t})}},{});Box.Timing.execution.push({name:"js/collections/box_device_pinning_collection.js",time:(new Date).getTime()});var Device_Pinning_Collection=Abstract_Collection.extend({set_params:function(e){e=e||{};var t=this;$j.each(e,function(e,i){var n=t.find(i.id);n?n.set_params(i):(n=new Device_Pinning(i),n.j_selected_element=$j("#"+i.typed_id).find("input[type=checkbox]"),t.add(n))})},add:function(e){this.base(e,e.id)},remove:function(e){this.base(e,e.id)},_is_correct_object_instance:function(e){return e instanceof Device_Pinning}},{});Box.Timing.execution.push({name:"js/box_openbox_action.js",time:(new Date).getTime()});var OpenboxAction=Base.extend({_input_params:null,_open_in_window:!1,_openbox_action_id:null,_skip_popup:!1,_asct:null,description:"",favicon_url:null,id:0,item:null,name:"",source:"unknown",uniq_name:"",_on_window_close:null,_call:function(e){e=e||{};var t="https:",i=t+"//"+window.location.host+"/services/";i+=this.uniq_name+"/"+this.id+"/"+this.item.id,(this.item.file_id_hash||this._asct)&&(i+="/"+(this.item.file_id_hash?this.item.file_id_hash:"")+(this._asct?"."+this._asct:"")),this.item.name&&(i+="/"+this.item.encoded_name()),("shared_folder"==this.source||"shared_file"==this.source||"vanity_url"==this.source)&&(i+="/shared/"+(window.shared_name||this.item.shared_name));var n="";if("file"!=this.item.type&&(n+="&node_type="+this.item.type),$j.each(e,function(t){n+="&name[]="+encodeURIComponent(t),n+="&value[]="+encodeURIComponent(e[t])}),this._open_new_window){var o="openbox_"+this.id+"_"+this.item.typed_id,a="";this.extensions_executed_by_default.length||(this._new_window_opens_in_tab||(a="height="+this.height+", width="+this.width+", left=100, top=120, status=no,toolbar=no,menubar=no,location=no,scrollbars=yes,resizable=yes"),n+="&loading_page=1");var r=window.open("",o,a);try{if(r.is_openbox_service)return this._focus_on_new_window(r),void(this.extensions_executed_by_default.length||$j.popup.close())}catch(s){}n&&(n="?"+n.substr(1));var l=Box.Application.getService("url");r=l.openWindow(i+n,o,a);var c=this._on_window_close;if(this._on_window_close)var _=setInterval(function(){r.closed&&(clearInterval(_),c())},500);return r&&r.focus(),void(this.extensions_executed_by_default.length||$j.popup.close())}n+="&ajax_call=1",this._popup_loading(),n&&(n="?"+n.substr(1)),$j.getJSON(i+n,function(e){var t=Box.Application.getService("url"),i=e.message,n=e.message.match(/(.*)<a href="(mailto:.*)"\ .*>(.*)<\/a>/),o={};n&&n[1]&&n[2]&&n[3]&&(o={action:{text:n[3],onclick:function(){t.goToUrl(n[2])}}},t.goToUrl(n[2]),i=n[1]),$j.popup.close(),box.after_load_callback=function(){Box.Application.getService("notifications").confirm(i,o)},Box.Application.navigate("",{},{not_scroll:!0})})},_focus_on_new_window:function(e){function t(){e.onfocus=n,i||e.alert($t("Here is the window that you have already opened for this %1","openbox_service_already_open_for_item",ItemTypeTranslation.singular(o.item.type)))}var i=!1,n=e.onfocus,o=this;e.onfocus=function(){i=!0,n&&n()},setTimeout(t,50),e.focus()},_create_popup:function(){$j.popup.form($.box.escapeHTML(this.name),[{type:"text",data:$t("Loading...","js_loading")}],{favicon_url:this.favicon_url})},_get_input_params:function(){var e=this,t="/index.php?rm=",i=null;i="files"==this.source||"updates"==this.source||"user_profile"==this.source?"box_service_action_get_input_params":"box_openbox_get_input_params_on_shared_node&shared_name="+(this.item.params.folder||this.item).shared_name,t+=i;var n={action_id:this._openbox_action_id,node_type:this.item.type,node_id:this.item.id};jQuery.ajax({type:"POST",url:t,data:n,dataType:"json",async:!1,success:function(t){e._skip_popup=t.skip_popup,e.description=t.message,e.oauth2_permission_message=t.oauth2_permission_message,e._asct=t.asct,e._skip_popup||(e._input_params=t.input_params,e._populate_popup())}}),this._skip_popup&&this._call()},_populate_popup:function(){var data_types={checkbox:"checkbox",drop_down:"dropdown","enum":"radio",password:"password",string:"input",text:"textarea"},section=null,controls=$j.map(this._input_params,function(data,i){data.section_break&&(section={type:"section",align:"left",collapsable:!0,collapsed:0!=i,label:data.section_break,contents:[]});var type=data_types[data.data_type];if(!type)return null;var item={type:type,data:data.value,items:data.enum_values?eval(data.enum_values):null,label:data.label,linebreak:!0,name:data.name,value:data.value};return section?(section.contents.push(item),data.section_break?section:null):item}),headline_text=this._open_new_window?$t("You will be taken to a third-party application","openbox_action_popup_third_party_app"):$t("This file will be sent to third-party application","openbox_action_send_file_to_third_party_app"),j_image_tag=$j('<img style="vertical-align: middle; margin-right: 3px;" />').attr("src",Box.Application.getService("assets").getAssetURL(images_path,"application_link.png")),j_security_message_title=$t("Notice","openbox_action_popup_tooltip_title")+"|"+$t("OpenBox lets you send your files to other applications and web services.","openbox_action_tooltip_text_short"),j_security_message=$j('<div class="block" id="security_message"/>').append(j_image_tag).append($.box.escapeHTML(headline_text)).append($j('<div class="list_img sprite_16x16_info mls"></div>').attr({"data-hover":"tooltip","aria-label":j_security_message_title})),me=this,popup_input=[];this.oauth2_permission_message&&(popup_input=popup_input.concat([{type:"html",data:$t("This third party application is requesting the ability to:","openbox_action_oauth2_request_access")},{type:"html",data:this.oauth2_permission_message}])),popup_input=popup_input.concat([{type:"html",data:this.description},{type:"section",align:"left",contents:controls},{type:"buttons",items:{okay:{value:$t("Okay","js_popup_button_okay"),click:function(e,t){me._call(e)}},cancel:{value:$t("Cancel","js_popup_button_cancel"),click:$j.popup.close}}},{type:"html",data:j_security_message}]),$j.popup.form($.box.escapeHTML(this.name),popup_input)},_popup_loading:function(){$j.popup.form($.box.escapeHTML(this.name),[{type:"text",data:$t("Please wait while your request is being processed...","openbox_action_popup_processed")}],{favicon_url:this.favicon_url})},execute:function(e){var t=e&&e.skip_popup||this._skip_popup;return e&&e.onClose&&(this._on_window_close=e.onClose),this.extensions_executed_by_default.length||t?void this._call():(this._create_popup(),void this._get_input_params())}},{actions:[],data:{},create:function(e){e=e.substr("openbox_service".length);var t=OpenboxAction.data[e],i=function(i,n){i=i||{},this.item=i.item,this.source=i.source,n=n||{},this.ssl=1==t.ssl,this._open_new_window=1==t.open_new_window,this._new_window_opens_in_tab=1==t.new_window_opens_in_tab,this._openbox_action_id=e,this._skip_popup=i.skip_popup||1==t.skip_popup,this.description=t.message,this.extensions_executed_by_default=t.extensions_executed_by_default,this.extensions_editable_on_gallery=t.extensions_editable_on_gallery,this.extensions_viewable_on_gallery=t.extensions_viewable_on_gallery,this.favicon_url=t.favicon_url,this.id=e,this.name=t.name,this.uniq_name=t.service_uniq_name,this.width=t.width,this.height=t.height,this._asct=t.asct},n=t.allowed_extensions||[];i.allowed_extensions={};for(var o=0;o<n.length;o++)i.allowed_extensions[n[o].toLowerCase()]=!0;return $.isEmptyObject(i.allowed_extensions)||(i.other_extensions_disallowed=!0),i.allowed_types={file:"both"==t.node_type||"file"==t.node_type,folder:"both"==t.node_type||"folder"==t.node_type,web_link:"web_link"==t.node_type},i.required_permissions={create_tag:-1!=t.required_permissions.indexOf("g"),create_collab:-1!=t.required_permissions.indexOf("k"),create_comment:-1!=t.required_permissions.indexOf("c"),download:-1!=t.required_permissions.indexOf("d"),"delete":-1!=t.required_permissions.indexOf("e"),rename:-1!=t.required_permissions.indexOf("n"),remove:-1!=t.required_permissions.indexOf("r"),options:-1!=t.required_permissions.indexOf("o"),preview:-1!=t.required_permissions.indexOf("p"),set_share_access:-1!=t.required_permissions.indexOf("h"),share:-1!=t.required_permissions.indexOf("s"),synchronize:-1!=t.required_permissions.indexOf("y"),upload:-1!=t.required_permissions.indexOf("u"),view:-1!=t.required_permissions.indexOf("v")},i.service_action_id=t.id,i.locking=t.locking,i.service_id=t.service_id,i.prototype=OpenboxAction.prototype,i},exists:function(e){for(var t in OpenboxAction.actions)if(OpenboxAction.actions[t]==e)return!0;return!1},load:function(e){if(e){var t={};OpenboxAction.actions=[];for(var i in e)OpenboxAction.actions.push("openbox_service"+e[i].id),t[e[i].id]=e[i];OpenboxAction.data=t}},incrementalLoad:function(e){if(e){var t=OpenboxAction.data;for(var i in e){var n="openbox_service"+e[i].id;-1==$j.inArray(n,OpenboxAction.actions)&&OpenboxAction.actions.push("openbox_service"+e[i].id),t[e[i].id]=e[i]}OpenboxAction.data=t}}});Box.Timing.execution.push({name:"js/box_user.js",time:(new Date).getTime()});var User=Box_Object.extend({_actions:null,features:null,auto_accept_collab:!1,collab_in_current_folder:null,email:null,enterprise_id:null,hide_auto_accept_collab_dialog:!1,hide_upload_new_version_upgrade_dialog:!1,id:null,is_free_user:!1,is_master:null,is_submaster:null,is_sync_user:null,login:null,name:null,job_title:null,public_name:null,space_amount:null,see_other_slaves:null,uniq_id:null,_timeout_id:null,poc:"",pic_urls:{},max_upload_size:null,custom_properties:null,master_invite_status:null,slave_status_id:null,selected:!1,j_selected_element:null,constructor:function(e){this._actions={},this.set_params(e)},set_params:function(e){return e=e||{},this.base(e),this.id&&"0"!=this.id?this.uniq_id=this.id:this.email?this.uniq_id=this.email:$j.not_implemented("user uniq_id"),this.process_permissions(e.granted_permissions,User.PERMISSION_CONSTANTS),this},update_params_and_render:function(e,t){},display_name:function(e){e||(e={}),"undefined"==typeof e.use_you&&(e.use_you=!0),"undefined"==typeof e.capitalize&&(e.capitalize=!0),"undefined"==typeof e.html&&(e.html=!0);var t,i=e.return_wrapper?e.return_wrapper:"<span></span>",n=this.is_you(),o=e.use_self&&this.email==e.use_self.email;return t=n&&e.use_you?o?e.capitalize?t=$t("Yourself","yourself_capitalized"):$t("yourself","js_yourself"):e.capitalize?t=$t("You","js_you_capitalized"):$t("you","js_you"):o?e.capitalize?t=$t("Theirself","js_theirself_upper"):$t("theirself","js_theirself"):this.id==User.ANONYMOUS_USER_ID?e.capitalize?$t("Someone","js_someone_upper"):$t("someone","js_someone_lower"):$.box.escapeHTML(this.name),e.html?(e.profile_link&&this.id&&"0"!=this.id&&"2"!=this.id?t=this.profile_link(t):e.profile_link&&this.id==User.ANONYMOUS_USER_ID?t=this.profile_link("Someone"):e.profile_link&&0==this.id&&(t=this.profile_link(this.email)),t=$j(i).append(t)):t},open_profile:function(){var e=Box.Application.getService("url");return e.goToUrl("/profile/"+this.id),!1},enterprise:function(){return Canvas.get().enterprises.find(this.enterprise_id)},profile_link:function(e,t){if(this.id&&"0"!=this.id&&"2"!=this.id){var i="/profile/"+this.id;return t?i:$j('<a class="user" />').attr({id:this.id,href:i}).text(e)}return t?"":$j('<a class="user" href="#" />').text(e)},permission_on_folder:function(e,t,i){if(!e.collaborations&&e.id.length){var n=!1;e.load_collabs(n)}if(e.user_id==this.id)return"Owner";var o=Canvas.get();if(e.collaborations){var a=e.collaborations[this.email];i=i||{};var r,s=[];if(this.id!=o.user.id&&e&&e.permissions.rename)for(r in a)t?a[r].item_id==o.current_folder.id&&s.push(a[r].permission):0==a[r].accepted&&!i.ignore_accepted||a[r].item_id==o.current_folder.id||s.push(a[r].permission);if(0===s.length)for(r in a)(0!=a[r].accepted||i.ignore_accepted)&&s.push(a[r].permission);var l=Collab.merge_permissions(s);return l}return null},permission_on_current_folder:function(e,t){return this.permission_on_folder(Canvas.get().current_folder,e,t)},has_custom_feature:function(e){return-1!=$j.inArray(e,this.features)},trash_folder:function(){var e=Item.find(Item.TRASH_FOLDER_ID);return e},is_co_owner:function(){return!1},is_anonymous:function(){return this.id===User.ANONYMOUS_USER_ID},is_you:function(){return!this.email&&this.login?this.login==Canvas.get().user.login:this.email==Canvas.get().user.login}},{ANONYMOUS_USER_ID:2,type:"user",PERMISSION_CONSTANTS:{instant_login:"user_instant_login",view:"user_view",edit:"user_edit","delete":"user_delete",deactivate:"user_deactivate",activate:"user_activate",add_as_slave:"user_add_as_slave",edit_external_collaborator:"user_edit_external_collaborator",message:"user_message",promote_to_submaster:"user_promote_to_submaster",change_slave_status:"user_change_slave_status",change_master_user:"user_change_master_user",cancel:"user_cancel",create_admin_access_token:"user_create_admin_access_token",access_grant:"user_access_grant",can_create_reseller:"user_create_reseller",can_create_reseller_rep:"user_create_reseller_rep",reset_password:"user_reset_password",can_change_primary_email:"user_change_primary",edit_groups:"user_edit_group_tag",can_act_as_user:"user_api_act_as_userpi_act_as_user",can_act_on_behalf_of_user:"user_api_on_behalf_of_userpi_on_behalf_of_user",create_login_token:"user_create_login_token",create_app_tracker:"user_create_app_tracker",disable:"disable",can_view_folder_tree:"user_can_view_folder_tree",app_user_view:"app_user_view",app_user_edit:"app_user_edit",app_user_delete:"app_user_delete",automation_user_view:"automation_user_view",automation_user_edit:"automation_user_edit",automation_user_delete:"automation_user_delete"},find_item_owner_data_by_item_typed_id:function(e,t,i){var n=User.find(e);if(n)$j.isFunction(i)&&i();else{var o=$j.box.formatQuery({item_typed_id:t});$j.getJSON("/index.php?rm=box_files_get_item_owner_info",o,function(e){e&&(Canvas.get().users.set_params(e),$j.isFunction(i)&&i())})}},find_collab_data_by_email:function(e){var t=null,i=Canvas.get().current_folder;if(i&&i.collaborations){var n=i.collaborations[e];n&&(t=new User({name:n[0].name,email:n[0].email}),t.collab_in_current_folder=n)}return t}});Action.register_actions("User",["edit","delete_me","instant_login","add_as_slave","change_master_user","edit_external_collaborator","message","remove_invited_collaborator"]),Box.Timing.execution.push({name:"js/box_contact_info.js",time:(new Date).getTime()});var Box_Contact_Info=Box_Object.extend({_contact_info:null,constructor:function(){Box_Contact_Info.__instance=this,this._contact_info=box_contact_info||null},get_contact_info:function(e,t){try{return this._contact_info[e][t]||""}catch(i){return""}}},{type:"contact_info",get:function(){return Box_Contact_Info.__instance||(Box_Contact_Info.__instance=new Box_Contact_Info),Box_Contact_Info.__instance}});Box.Timing.execution.push({name:"js/box_friend.js",time:(new Date).getTime()});var Friend=Box_Object.extend({},{type:"friend"});Box.Timing.execution.push({name:"js/box_device_pinning.js",time:(new Date).getTime()});var Device_Pinning=Box_Object.extend({id:null,selected:!1,j_selected_element:null,constructor:function(e){this.base(e)},select:function(e){if(!this.selected){this.selected=!0;var t=this.j_selected_element;t.attr("checked","checked"),Canvas.get().device_pinning_selection.select(this,e)}},unselect:function(e){if(this.selected){this.selected=!1;var t=this.j_selected_element;t.removeAttr("checked"),Canvas.get().device_pinning_selection.unselect(this,e)}}},{type:"device_pinning"});Box.Timing.execution.push({name:"js/box_admin_permission_assignment.js",time:(new Date).getTime()});var Admin_Permission_Assignment=Box_Object.extend({id:null,constructor:function(e){this.base(e)},has_coadmin_permission_to_create_coadmins:function(){return this.can_manage_users&&this.can_manage_groups&&this.can_instant_login&&this.can_view_enterprise_settings&&this.can_edit_enterprise_settings&&this.can_access_reports},has_some_coadmin_permissions:function(e,t,i,n){var o=t&&this.can_view_policies,a=t&&this.can_edit_policies,r=i&&this.can_view_automations,s=i&&this.can_edit_automations,l=n&&this.can_edit_metadata_templates;return this.can_manage_users||this.can_manage_groups||this._is_can_view_gcm_enabled(e,!1)||this._is_can_edit_gcm_enabled(e,!1)||this.can_instant_login||this.can_view_enterprise_settings||this.can_edit_enterprise_settings||this.can_access_reports||r||s||o||a||l},_is_can_view_gcm_enabled:function(e,t){return e?this.can_view_global_content:t},_is_can_edit_gcm_enabled:function(e,t){return e?this.can_edit_global_content:t}},{type:"admin_permission_assignment"});Box.Timing.execution.push({name:"js/box_user_collection.js",time:(new Date).getTime()});var UserCollection=Base.extend({_users:null,constructor:function(e){this._users={},this.set_params(e)},set_params:function(e){e=e||{};var t,i,n,o;for(var a in e)t=e[a],i=t.id||t.user_id,i&&"0"!=i?n=i:t.email&&(n=t.email),o=this.find(n),o?o.set_params(t):(o=new User(t),this.add(o))},add:function(e){e instanceof User&&(this._users[e.uniq_id]=e)},find:function(e){return this._users[e]}},{});Box.Timing.execution.push({name:"js/box_group_tag.js",time:(new Date).getTime()});var Group_Tag=Box_Object.extend({name:null,id:null,constructor:function(e){this.set_params(e)},set_params:function(e){e=e||{},this.name=e.display_name||e.group_tag_name||e.name,this.id=e.id||e.group_tag_id,this.base(e);var t=e.permissions?e.permissions:e.granted_permissions;this.process_permissions(t,Group_Tag.PERMISSION_CONSTANTS)}},{type:"group_tag",PERMISSION_CONSTANTS:{view:"group_tag_view",edit:"group_tag_edit","delete":"group_tag_delete",message:"group_tag_message",invite_to_collab:"group_tag_invite_to_collab",view_members:"group_tag_view_members"}});Action.register_actions("Group_Tag",["edit","message","delete_me"]),Box.Timing.execution.push({name:"js/box_group_tag_collection.js",time:(new Date).getTime()});var Group_Tag_Collection=Base.extend({_group_tags_by_id:null,group_tags:null,group_tag_params_array:null,constructor:function(e){this._group_tags_by_id={},this.group_tags=[],this.set_params(e)},set_params:function(e){this.group_tag_params_array=e||{};for(var t in this.group_tag_params_array){var i=this.group_tag_params_array[t],n=i.id||i.group_tag_id,o=n,a=this.find(o);a?a.set_params(i):(a=new Group_Tag(i),this.add(a))}},add:function(e){e instanceof Group_Tag&&("undefined"!=typeof Tombstone&&Tombstone.marker("./js/box_group_tag_collection.js:21062","2014-07-09","tvanas: might always return above"),this.group_tags.push(e),this._group_tags_by_id[e.id]=e)},find:function(e){if("number"==typeof e||"string"==typeof e)return this._group_tags_by_id[e];e=e||{};for(var t=new Group_Tag_Collection,i=0;i<this.group_tags.length;i++){var n=this.group_tags[i];t.add(n)}return t}},{});Box.Timing.execution.push({name:"js/box_enterprise.js",time:(new Date).getTime()});var Enterprise=Box_Object.extend({name:null,id:null,all_users_count:null,permissions:null,item_permissions:null,constructor:function(e){this.set_params(e)},set_params:function(e){e=e||{},this.base(e),this.name=e.display_name||e.name||this.name,this.id=e.id||e.enterprise_id||this.id,this.process_permissions(e.granted_permissions,Enterprise.PERMISSION_CONSTANTS)},display_name:function(){return this.display_name||this.name},show_action_menu:function(e){e=e?e:{},e.enterprise=this,Box_Menus.get().enterprise_action_menu.show(e)}},{type:"enterprise",PERMISSION_CONSTANTS:{view:"enterprise_view",view_profile:"enterprise_view_profile",edit:"enterprise_edit","delete":"enterprise_delete",deactivate:"enterprise_deactivate",activate:"enterprise_activate",add_app_user:"enterprise_add_app_user",add_automation_user:"enterprise_add_automation_user",manage_app_authorizations:"enterprise_manage_app_authorizations",add_user:"enterprise_add_user",add_group_tag:"enterprise_add_group_tag",bulk_add_users:"enterprise_bulk_add_users",bulk_edit_users:"enterprise_bulk_edit_users",invite_all_group_tags:"enterprise_invite_all_group_tags",view_all_group_tags:"enterprise_view_all_group_tags",view_all_users:"enterprise_view_all_users",view_logs:"enterprise_view_logs",view_home_tab:"enterprise_view_home_tab",view_users_tab:"enterprise_view_users_tab",view_external_users_tab:"enterprise_view_external_users_tab",view_groups_tab:"enterprise_view_groups_tab",view_reports_tab:"enterprise_view_reports_tab",view_admin_settings_tab:"enterprise_view_admin_settings_tab",view_app_use_management_tab:"enterprise_view_app_use_management_tab",view_policies_tab:"enterprise_view_policies_tab",view_automations_tab:"enterprise_view_automations_tab",view_metadata_tab:"enterprise_view_metadata_tab",view_device_pinners:"enterprise_view_device_pinners",manage_content:"enterprise_manage_content",manage_enterprise:"enterprise_manage_enterprise",view_gcm_tab:"enterprise_view_gcm_tab",can_change_tos:"enterprise_can_change_tos",cancel_billing:"enterprise_cancel_billing",edit_trial_length:"enterprise_edit_trial_length",create_content_workflow_policy:"create_content_workflow_policy",create_content_workflow_automation:"create_content_workflow_automation",manage_data_retention_policy:"manage_data_retention_policy",manage_legal_holds_policy:"manage_legal_holds_policy",
enterprise_view_quarantines:"enterprise_view_quarantines",publish:"enterprise_publish",enterprise_view_client_setting_values:"enterprise_view_client_setting_values",enterprise_manage_ip_whitelist:"enterprise_manage_ip_whitelist"}});Action.register_actions("Enterprise",["add_user","add_group_tag","bulk_add_users","bulk_edit_users","edit","instant_login"]),Box.Timing.execution.push({name:"js/box_enterprise_collection.js",time:(new Date).getTime()});var Enterprise_Collection=Base.extend({_enterprises_by_id:null,enterprises:null,enterprise_params_array:null,constructor:function(e){this._enterprises_by_id={},this.enterprises=[],this.set_params(e)},set_params:function(e){this.enterprise_params_array=e||{};for(var t in this.enterprise_params_array){var i=this.enterprise_params_array[t],n=i.id||i.enterprise_id,o=n,a=this.find(o);a?a.set_params(i):(a=new Enterprise(i),this.add(a))}},add:function(e){e instanceof Enterprise&&(this.enterprises.push(e),this._enterprises_by_id[e.id]=e)},find:function(e){if("number"==typeof e||"string"==typeof e)return this._enterprises_by_id[e];e=e||{};var t=new Enterprise_Collection;return t},remove:function(e){}},{});Box.Timing.execution.push({name:"js/box_in_app_message.js",time:(new Date).getTime()});var In_App_Message=Base.extend({_in_app_message_max_request_time:5e3,_in_app_message_id:0,get_in_app_message_to_show:function(){var e=this,t="/index.php?rm=box_in_app_message_get",i=window.location.pathname.replace(/^\//,""),n={page:"undefined"!=typeof box&&box.hist_name?box.hist_name:i},o=(new Date).getTime();$j.post(t,n,function(t){if(t){var i=(new Date).getTime()-o;i<e._in_app_message_max_request_time&&(e._in_app_message_id=t.in_app_message_id,e.display_in_app_message(t),t.should_log_view&&e._log_in_app_message_view())}})},dismiss_in_app_message:function(){if(this._in_app_message_id){var e="/index.php?rm=box_in_app_message_dismiss",t={in_app_message_id:this._in_app_message_id};$j.post(e,t)}},display_in_app_message:function(e){if(e.name&&0===e.name.indexOf("SHOW_NET_PROMOTER_SURVEY"))Net_Promoter_Survey.get().execute();else if("popup"==e.render_type)this._show_popup(e.slides);else if("banner"==e.render_type){var t={call_dismiss_action_on_close:e.duration>0,auto_rotate:!0};this._show_banner(e.slides,t)}},_log_in_app_message_view:function(){if(this._in_app_message_id){var e="/index.php?rm=box_in_app_message_log_in_app_message_view",t={in_app_message_id:this._in_app_message_id};$j.post(e,t)}},_show_banner:function(e,t){var i=new Banner_Message(e,t);i.show()},_show_popup:function(e){if(e.length){var t=1==e.length?this._construct_single_slide_popup_content(e[0]):this._construct_multi_slide_popup_content(e);$j.popup.form("",t,{layout:"modal",hide_next_prev_buttons:!0,width:610,close_popup_on_click_outside:!1,title_classes:"center_contents"})}},_construct_multi_slide_popup_content:function(e){for(var t=[],i=0;i<e.length;i++){var n={type:"slide",id:"in_app_popup_slide"+i,label:"",contents:[]};n.contents.push({type:"html",data:e[i].html}),n.contents.push(this._construct_popup_slide_buttons()),t.push(n)}return t},_construct_single_slide_popup_content:function(e){var t=[];return t.push({type:"html",data:e.html}),t.push(this._construct_popup_slide_buttons()),t},_construct_popup_slide_buttons:function(){return{type:"buttons",items:{close:{value:$t("Close","popup_window_close_tooltip"),click:function(){return $j.popup.close(null,!0),!1}}}}}},{get:function(){return In_App_Message.__instance||(In_App_Message.__instance=new In_App_Message),In_App_Message.__instance}});Box.Timing.execution.push({name:"js/box_validator.js",time:(new Date).getTime()});var Validator={file_name_regex:"^\\s*$",bookmark_name_regex:'^((COM\\d)|(LPT\\d)|(CON)|(PRN)|(AUX)|(NUL)|CLOCK\\$)$|[<>|/\\\\"]|\\.$',url_protocol_regex:"^(HTTP|FTP)S?://.*$",url_regex:"^(https?|ftp):\\/\\/(((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:)*@)?(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5]))|((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?)(:\\d*)?)(\\/((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)+(\\/(([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)*)*)?)?(\\?((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|[\\uE000-\\uF8FF]|\\/|\\?)*)?(\\#((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|\\/|\\?)*)?$",file_name_special_chars:'(\\, /, ", :, <, >, |, *, ?)',file_name_special_char_replacement:"_",validate_login:function(e){return Validator.prototype.validate_email(e)},validate_empty_field:function(e){return""===e?!1:!0},validate_email:function(e){return $j.box.isEmail(e)},validate_password:function(e,t){return t=t||!1,t?Validator.validate_string(e,0,255):Validator.validate_string(e,1,255)},validate_phone:function(e){var t=$j.trim(e);return Boolean(t.match(/^(\(?\+?[\d]*\)?)?[\d\-\.\s\(\)]+(\s*(x|ext\.?|extension)\s*\d+)?$/g)&&t.length<=100)},validate_string:function(e,t,i){return void 0!=e.length&&e.length>=t&&e.length<=i?!0:!1},validate_number:function(e){return!isNaN(parseFloat(e))},validate_nonnegative_float:function(e){if("number"!=typeof e){var t=/^[0-9\.]*$/;if(!t.test(e))return!1;e=parseFloat(e)}return e>=0},validate_positive_integer:function(e){if("number"!=typeof e){var t=/^[0-9]*$/;if(!t.test(e))return!1;e=parseInt(e)}return e>0},validate_nonnegative_integer:function(e){if("number"!=typeof e){var t=/^[0-9]*$/;if(!t.test(e))return!1;e=parseInt(e)}return e>=0},validate_public_name:function(e){return Validator.validate_name(e)},validate_name:function(e){return Validator.validate_string(e,1,255)},validate_company:function(e){return Validator.validate_string(e,1,255)},validate_cvv:function(e){var t=Validator.validate_nonnegative_integer(e),i=Validator.validate_string(e,3,4);return t&&i},validate_slave_count:function(e){return Validator.validate_positive_integer(e)},validate_space_amount:function(e){return Validator.validate_positive_integer(e)},validate_slave_space_amount:function(e){return Validator.validate_nonnegative_float(e)?!0:!1},validate_enterprise_type:function(e){return"business"==e?!0:"enterprise"==e?!0:!1},validate_deal_status:function(e){return"live_deal"==e?!0:"potential_deal"==e?!0:"trial"==e?!0:"trial_extension"==e?!0:!1},validate_subdomain:function(e){e=$j.trim(e).toLowerCase();var t=/^[a-zA-Z0-9]*(-[a-zA-Z0-9]+)*$/;return null==e.match(t)?!1:e.length<3?!1:!0},validate_group_tag_name:function(e){return e&&"none"==e.toLowerCase()?!1:Validator.validate_string(e,1,255)},validate_file_name:function(e){var t=null;t=new RegExp(Validator.file_name_regex);var i=e.toUpperCase();return null==t.exec(i)},validate_bookmark_name:function(e){var t=new RegExp(Validator.bookmark_name_regex),i=e.toUpperCase();return null==t.exec(i)},validate_url_protocol:function(e){var t=new RegExp(Validator.url_protocol_regex),i=e.toUpperCase();return-1===i.indexOf("://")&&(i="HTTP://"+i),null!=t.exec(i)},validate_url:function(e,t){t&&(e.match(/^(http|ftp)s?:\/\//i)||(e="http://"+e));var i=new RegExp(Validator.url_regex,"i");return i.test(e)},validate_partial_url:function(e){var t=/^[A-Za-z0-9-]+$/;return t.test(e)},fix_file_name:function(e){var t=new RegExp(Validator.file_name_regex,"g");return e=e.replace(t,Validator.file_name_special_char_replacement)},convert_units:function(e,t,i){var n=0;if("bytes"!=t)throw new Error('Unknown units type passed to "convert_units" function as the "from_units" parameter. The units might just not be implemented yet. from_units: "'+t+'"');if("gigabytes"!=i)throw new Error('Unknown units type passed to "convert_units" function as the "to_units" parameter. The units might just not be implemented yet. to_units: "'+i+'"');return n=Math.round(e/Math.pow(2,30))}};Box.Timing.execution.push({name:"js/folder_tree/model.js",time:(new Date).getTime()});var Folder_Tree_Model=Base.extend({constructor:function(e){this.controller=e,this.clear()},clear:function(){this.items={}},get_item_by_id:function(e,t,i){if("undefined"!=typeof this.items[e])return i(this.items[e]),!1;var n,o=this,a={item_typed_ids:[e],unidb_format:"folder_selector"};return n=this.controller._canvas_obj_in_page&&t&&t!=Canvas.get().user.id?"/index.php?rm=box_master_export_tree_get_unidb_formatted_items":"/index.php?rm=box_export_tree_get_unidb_formatted_items",$j.getJSON(n,a,function(e){if(!(e.error||e.items&&e.items.length<1)){var t=e.items[0],n=t.typed_id;o.items[n]=t,i(t)}}),!1}},{});Box.Timing.execution.push({name:"js/folder_tree/view.js",time:(new Date).getTime()});var Folder_Tree_View=Base.extend({SMALL_WINDOW_HEIGHT_THRESHOLD:500,SMALL_FOLDER_TREE_HEIGHT:142,DEFAULT_FOLDER_TREE_HEIGHT:300,constructor:function(e){this.controller=e},render_folders_into_container:function(e,t,i){if(e.prev().find(".spinner").remove(),e.html(t).removeClass("container_loading").show(),i&&i.disable_root_folder&&this.disable_root_folder(e),i&&i.selected_item_id){var n=$j("#folder_tree_"+i.selected_item_id),o=e.height(),a=e.scrollTop(),r=a+o,s=n.position().top;(s>=r||a>s)&&e.scrollTop(s-o/2)}var l=e.children(".container").children(".container");l.prev().data("refresh_needed",!0)},disable_root_folder:function(e){var t=e.find(".folder"),i=t.filter('[data-typed_item_id="d_0"]');if(i.removeClass("selected").addClass("not_selectable"),1==t.length){var n='<span class="disabled">'+$t("Create a folder to invite collaborators.","no_folder_in_account_text_folder_tree")+"</span>";return e.html(n),void this.controller.clear_current_cache()}},display_loading_message_in_container:function(e){e.children().length||e.html("&nbsp;&nbsp;&nbsp;"+$t("Loading...","js_loading_capitalized_with_ellipsis")).addClass("container_loading").show()},_collapse_folder_or_user:function(e,t){e.removeClass("opened sprite_19x19_down_arrow").addClass("closed sprite_19x19_right_arrow"),t.hide();var i=e.closest(".link").find(".ft_folder_icon");if(i.length){var n;i.hasClass("sprite_19x19_collab_folder_open")?n="sprite_19x19_collab_folder_":i.hasClass("sprite_19x19_external_collab_folder_open")?n="sprite_19x19_external_collab_folder_":i.hasClass("sprite_19x19_private_folder_open")&&(n="sprite_19x19_private_folder_"),i.removeClass(n+"open").addClass(n+"closed")}},_expand_folder_or_user:function(e,t){e.removeClass("closed sprite_19x19_right_arrow").addClass("opened sprite_19x19_down_arrow");var i,n=e.closest(".link").find(".ft_folder_icon");if(n.length){var o;n.hasClass("sprite_19x19_collab_folder_closed")?o="sprite_19x19_collab_folder_":n.hasClass("sprite_19x19_external_collab_folder_closed")?o="sprite_19x19_external_collab_folder_":n.hasClass("sprite_19x19_private_folder_closed")&&(o="sprite_19x19_private_folder_"),n.removeClass(o+"closed").addClass(o+"open")}var i=!1;if(t.hasClass("container")&&t.prev().data("refresh_needed")&&(t.prev().data("refresh_needed",!1),t.remove(),i=!0),!t.hasClass("container")||i){e.append($j('<img class="spinner" style="background-color: #e8f1f8;margin-top:1px;margin-left:1px" />').attr("src",Box.Application.getService("assets").getAssetURL(images_box_path,"spinner.gif")));var a;if(t=$j('<div class="container no_break"></div>').hide().insertAfter(e.parent()),e.parent().hasClass("person"))a=e.parent().data("user_id"),this.controller.load_folder_into_container(t,"d_0",a,e,{is_gcm:this instanceof GCM_Folder_Tree_View});else{var r=e.data("typed_item_id");a=e.data("user_id"),a?this.controller.load_folder_into_container(t,r,a,e):this.controller.load_folder_into_container(t,r,void 0,e)}}else t.show()},is_visible:function(){return $j("#folder_tree").is(":visible")},setup_container:function(e,t,i,n){n=n||{},$(window).height()<=this.SMALL_WINDOW_HEIGHT_THRESHOLD?n.height=this.SMALL_FOLDER_TREE_HEIGHT:n.height||(n.height=this.DEFAULT_FOLDER_TREE_HEIGHT);var o=this;if(t.unbind("click").bind("click",function(e){return o.event_click(e),!1}),"dropdown"==this.controller.behavior&&window.setTimeout(function(){$j(document.body).click(o._clicked_elsewhere)},10),"auto"==i?t.width("auto"):i&&t.width(parseInt(i,10)+"px"),n.height&&t.height(parseInt(n.height,10)+"px"),n.append)e.append(t);else{var a=e.offset();a&&t.css({position:"absolute",left:a.left,top:a.top+e.outerHeight()+1})}t.removeClass("container_loading")},append_to:function(e){$j("#folder_tree").appendTo(e)},hide:function(){$j("#folder_tree").hide().empty().unbind("click"),$j(document.body).unbind("click",this._clicked_elsewhere)},event_click:function(e){var t=$j(e.target),i=Box.Application.getService("logger");if(t.hasClass("not_selectable")||t.parent().hasClass("not_selectable"))return!1;var n,o,a,r=t.hasClass("link");if(r?(o=t.find(".folder"),a=t.find(".person")):(o=t.closest(".folder"),a=t.closest(".person")),t.hasClass("expander")){var s=t,l=s.parent().next();s.hasClass("closed")?this._expand_folder_or_user(s,l):this._collapse_folder_or_user(s,l)}else if(o.length){var c=o.data("typed_item_id");if(!c)return!1;if("selector"==this.controller.behavior){var _=$j("#folder_tree").find(".selected").removeClass("selected");o.parents(".link").addClass("selected")}n=o.data("user_id");var d=this;this.controller.model.get_item_by_id(c,n,function(t){if(t||i.sendLog("js_error","item_not_found",{item_typed_id:c}),"undefined"!=typeof Item){var a=Item.find(c);a||(a=new Item(t),a.set_params(t))}var r=d._is_root_folder(c),s=d._check_item_permission(t,d.controller.check_permission,r);if(s){var l=o.find(".folder_name").text();if("undefined"!=typeof gallery_page&&"files"==gallery_page){var u=Box.Application.getService("strings");l=u.getShortString(l,240,o[0])}n=o.data("user_id"),d.controller.call_click_callback(c,l,n,e,t),"dropdown"==d.controller.behavior&&d.controller.hide()}else"selector"==d.controller.behavior&&($j("#folder_tree").find(".selected").removeClass("selected"),_.parents(".link").addClass("selected"))})}else a.length&&("selector"==this.controller.behavior&&($j("#folder_tree").find(".selected").removeClass("selected"),a.addClass("selected")),n=a.data("user_id"),this.controller.call_click_callback("d_0",void 0,n,e));return!1},_clicked_elsewhere:function(e){return"folder_tree"!=$j(e.target).attr("id")&&folder_tree.hide(),!1},_check_item_permission:function(e,t,i){if("folder"==e.type){if("upload"==t&&"0"==e.upload_permission)return alert($t("You do not have permission to upload, move, or edit any files to this folder.","folder_tree_no_upload_permission")),!1;if("owner"==t&&!e.user_is_owner)return alert($t("You must be an owner to invite guests to this folder","folder_tree_must_own_to_invite_guests_message")),!1;if("collaborate"==t&&("All Files"==e.name||"0"==e.can_invite_collaborators&&!e.user_is_owner))return alert(i?$t("You cannot add collaborators to your root folder. Please select a folder you would like to add collaborators to.","folder_tree_select_non_root"):"Select a folder in your Box"==e.name?$t("Please select a folder you would like to add collaborators to.","folder_tree_select_folder_to_add_collaborators_to"):$t("Sorry, you cannot select a collaborated folder that doesn't belong to you; only the owner of this folder can add new collaborators to it. Please select a different folder.","folder_tree_cant_select_collab_folder_that_doesnt_belong_to_you")),!1}return!0},_is_root_folder:function(e){var t=Box.Application.getService("v5"),i="0",n=t.get("root_folder_id");null!==n&&(i=n.toString()),i=i.replace("d_","");var o=e.replace("d_","");return i==o}},{});Box.Timing.execution.push({name:"js/folder_tree/controller.js",time:(new Date).getTime()});var Folder_Tree_Controller=Base.extend({constructor:function(e){this.mode="folders",this.behavior="dropdown",this.click_callback=null,this.USER_RETURN_LIMIT=500,this.check_permission=null,this.model=new Folder_Tree_Model(this),this.view=new Folder_Tree_View(this),this._canvas_obj_in_page="undefined"!=typeof Canvas},clear:function(){this.model.clear(),this.clear_current_cache()},get_folder_by_id:function(e,t){return"undefined"!=typeof Tombstone&&Tombstone.marker("./js/folder_tree/controller.js:6982","2013-05-15","auto tombstoned"),this.model.get_folder_by_id(e,t)},show:function(e,t,i,n,o){if(o=o||{},!o.force_open&&this.view.is_visible())return void this.hide();var a=o.user_id||null;this.behavior=o.behavior||"dropdown",this.click_callback=t||null,this.hide_callback=o.hide_callback||null,this.check_permission=o.check_permission||null,this.show_all_item_types=o.show_all_item_types||!1,("undefined"==typeof root_folder_id||0==root_folder_id)&&(root_folder_id="d_0"),i||(i=root_folder_id);var r=$j(e),s=$j("#folder_tree"),l=this.find_cached_folder_tree(o.cache_identifier);if(s.length?(s.attr("style",""),l||s.empty()):s=$j('<div id="folder_tree" />').addClass("dropdown"==this.behavior?" drop_down":"").appendTo(document.body).hide(),this.view.display_loading_message_in_container(s),this.view.setup_container(r,s,n,o),l){s.html(l.html()).css("display","block"),o&&o.disable_root_folder&&this.view.disable_root_folder(s);var c=s.find("#folder_tree_"+i);c.length&&(s.find(".selected").removeClass("selected"),c.addClass("selected"))}else o.selected_item_id=i,o.has_parents=!0,this.load_folder_into_container(s,i,a,null,o),s.show()},hide:function(){if(this.view.hide(),"function"==typeof this.hide_callback){var e=this.hide_callback;this.hide_callback=null,e()}this.check_permission=null},is_visible:function(){return this.view.is_visible()},find_cached_folder_tree:function(e){if(!e)return!1;var t=!1,i=$j("#folder_tree_cache");return i.length&&(t=i.data("cache_identifier")==e,t||i.data("cache_identifier","")),t?i.clone().attr("style",""):!1},clear_current_cache:function(){$j("#folder_tree_cache").data("cache_identifier","").html("")},load_folder_into_container:function(e,t,i,n,o){var a=this;o=o||{},e=e||$j("#folder_tree"),i=i||null,!i&&this._canvas_obj_in_page&&(i=Canvas.get().user.id);var r=o.selected_item_id||!1,s={user_id:i,item_id:t||r,selected_item_id:r,is_gcm:o.is_gcm||!1,show_trash:o.show_trash||!1,has_parents:o.has_parents||!1,skip_no_invite_collab:o.skip_no_invite_collab||!1,enterprise_collab_folders_only:o.enterprise_collab_folders_only||!1,include_submaster_collab_folders:o.include_submaster_collab_folders||!1,show_all_item_types:this.show_all_item_types||!1,sort_direction:o.sort_direction||"asc"};s.ancestors_only=o.ancestors_only||!1;var l=$j.box.formatQuery(s),c=Box.Application.getService("nav-state"),_="";_=c.isGcm()||c.isAutomation()||c.isPolicies()?"/index.php?rm=box_master_export_user_folder_tree_html":"/index.php?rm=box_export_tree_export_files_and_folders_html",$j.getJSON(_,l,function(t){a._load_folder_into_container_request_callback(t,e,o,n)})},_load_folder_into_container_request_callback:function(e,t,i,n){t&&t.find(".spinner").remove(),i=i||{};var o=e.html;if(e.error)o=$t("There was an error loading your folder tree. Please try again.","folder_tree_error_loading_tree");else if(i.cache_identifier){var a=$j("#folder_tree_cache");a.length||(a=$j('<div id="folder_tree_cache" style="display: none;"></div>').appendTo(document.body)),a.html(o).data("cache_identifier",i.cache_identifier)}this.view.is_visible()&&this.view.render_folders_into_container(t,o,i),""==o&&n&&n.css("opacity","0")},call_click_callback:function(e,t,i,n,o){this.click_callback&&this.click_callback(e,t,i,n,o)},appendTo:function(e){this.view.append_to(e)},get_selected_item_id:function(){return $j("#folder_tree").find(".selected .folder").data("typed_item_id")}},{}),folder_tree=new Folder_Tree_Controller;Box.Timing.execution.push({name:"js/box_sidebar.js",time:(new Date).getTime()});var box_sidebar={show_sidebar:function(e){var t=Box.Application.getService("nav-state"),i=t.get();if(e=e||box_sidebar.get_current_folder(),e&&e.collaborated){if("t"==i.type){var n=Box.Application.getService("url");$j("#sidebar_files_know .sidebar_text").html($t("You can add your own tags by clicking the tag icon to the right of the file or folder. %1Learn more%2","tags_tip_text_in_js",'<a href="https://product.'+n.getHostDomain()+'/help/149" target="_blank">',"</a>"))}$j("#sidebar_files_know")[0==i.id||"item"===i.type?"show":"hide"]()}this.init_sharebar_in_sidebar()},get_current_folder:function(){var e=Box.Application.getService("v5"),t=e.get("Canvas"),i=Box.Application.getService("nav-state");return t.current_folder?t.current_folder:t.target_item&&i.isGcm()?t.target_item.folder:null},get_current_item:function(){var e=Box.Application.getService("v5"),t=e.get("Canvas"),i=Box.Application.getService("nav-state");return t.target_item&&i.isGcm()?t.target_item:t.current_folder},init_sharebar_in_sidebar:function(){var e=$j("#sidebar_sharebar"),t=box_sidebar.get_current_item(),i=Box.Application.getService("nav-state"),n=i.get();if(t){var o=1==t.id;t.is_root_folder()||o?e.addClass("hidden"):"s"==n.type&&"folder"==t.type?e.addClass("hidden"):e.removeClass("hidden")}t&&t.display_in_place_share()},hide_sidebar_collaborator:function(){$j("#mod-sidebar-collaborators").hide()},update_share_icons:function(e){var t=box_sidebar.get_current_item(),i=Item.shared_access_to_icon(e.shared_access),n=e.shared_access_to_tooltip(e.shared_access);if(e==t){var o=$j("#sharing_sidebar_access_level_icon");o.removeClass().addClass("icon sprite_16x16 "+i+" list_img"),o.attr({"data-hover":"tooltip","aria-label":n})}var a=$j("#popup_settings_launcher span:first");a.removeClass().addClass("sprite_16x16 "+i+" list_img"),a.attr({"data-hover":"tooltip","aria-label":n}),"undefined"!=typeof SharebarAction&&SharebarAction.update_warnings(e)}};Box.Timing.execution.push({name:"js/box_option_dropdown.js",time:(new Date).getTime()});var Box_Option_Dropdown=Box_Base.extend({_j_dropdown:null,_j_dropdown_container:null,_j_dropdown_items:{},_j_no_results_item:null,_on_select_callback:null,_option_keys:[],_option_indices:{},_highlighted_option_index:null,_option_is_selectable:{},max_dropdown_height:null,no_results_label:$t("No results","option_selector_no_results_label"),default_item_text:"",default_item_sprite_class:"",default_item_callback:null,hide_no_results_item:!1,allow_not_selectable_items:!1,no_results_label_timeout_duration:0,constructor:function(e){this._j_dropdown_items={},this._option_is_selectable={},e&&e.no_results_label&&(this.no_results_label=e.no_results_label,e.no_results_label_timeout_duration&&(this.no_results_label_timeout_duration=e.no_results_label_timeout_duration)),this.base(e),this._init_ui_component()},get_ui_component:function(){return this._j_dropdown_container},show:function(){this._is_empty()||this._j_dropdown_container.show()},hide:function(){this._j_dropdown_container.hide()},position:function(e,t,i){"undefined"==typeof i&&(i=0),this._j_dropdown_container.css({position:"absolute",top:e+"px",left:i,width:t-1})},highlight_and_populate:function(e,t,i,n){if("object"!=typeof task_field_fixed||this._j_dropdown_container.parents(task_field_fixed).length||(task_field_fixed.restoreZIndex(),task_field_fixed=null),i)this._is_empty()&&this._populate();else{var o=this._highlight(e,t);this._available_options=o,this._populate(o)}this._is_empty()&&this.hide_no_results_item?this._j_dropdown_container.hide():n&&n.hide_no_results||this._j_dropdown_container.show()},get_key_from_index:function(e){return null===e||0>e||e>=this._option_keys.length?(e==this._option_keys.length&&"function"==typeof this.default_item_callback&&this.default_item_callback(),null):this._option_keys[e]},set_on_select_callback:function(e){this._on_select_callback=e},delete_index:function(e){var t=this._option_keys;this._option_keys=[];for(var i in t)t[i]!=e&&this._option_keys.push(t[i]);delete this._option_indices[e];var n=0;for(var o in this._option_indices)this._option_indices[o]=n,++n},remove:function(e){var t=this;this._j_dropdown_items[e]&&(this._j_dropdown_items[e].slideUp("fast",function(){$(this).remove(),t.highlight_first_option()}),this.delete_index(e))},highlight_first_option:function(){null===this._highlighted_option_index&&this.highlight_next_option()},highlight_next_option:function(e){for(var t=!1;!t;)t=null===this._highlighted_option_index?this.highlight_option_by_index(0,e):this.highlight_option_by_index(this._highlighted_option_index+1,e)},highlight_previous_option:function(e){for(var t=!1;!t;)t=null===this._highlighted_option_index?this.highlight_option_by_index(this._j_dropdown.children().length-1,e):this.highlight_option_by_index(this._highlighted_option_index-1,e)},reset_highlight_index:function(){null!=this._highlighted_option_index&&this._j_dropdown.children().eq(this._highlighted_option_index).removeClass("selected"),this._highlighted_option_index=null},highlight_option_by_index:function(e,t){var i=this._j_dropdown.children().length;if(i>0){var n=this._highlighted_option_index;if(e=Math.max(0,Math.min(e,i-1)),n!=e){this._highlighted_option_index=e;var o=this._j_dropdown.children();o.eq(n).removeClass("selected");var a=o.eq(e).addClass("selected");t&&$(this._j_dropdown).scrollTo(a);var r=this._option_keys[e];return this._option_is_selectable[r]}}return!0},get_highlighted_option_index:function(){return this._highlighted_option_index},_init_ui_component:function(){this._j_dropdown_container=$('<div class="drop_down_container mtn"></div>'),this._j_dropdown=$('<ul class="list_ext drop_down_inner list_ext_no_bottom_border box_options_drop_down scrollable"></ul>'),this._j_dropdown_container.hide().append(this._j_dropdown)},_populate:function(e){var t,i=this,n=!1;this._j_dropdown.empty(),this._highlighted_option_index=null,this._option_keys=[],this._option_indices={};for(t in e)this._add_dropdown_item(t,e[t])&&(n=!0,window.clearTimeout(this.no_results_label_timeout));n?this.highlight_first_option():this.hide_no_results_item||(this.no_results_label_timeout=window.setTimeout(function(){i._add_no_results_item()},this.no_results_label_timeout_duration)),this._add_default_item()},_add_default_item:function(){if(this.default_item_text){if(this._j_default_item||(this._j_default_item=$('<li class="option_dropdown_default_item"/>').append($j('<a href="#" />').text(this.default_item_text)).mouseenter(function(e){$(this).addClass("selected")}).mouseleave(function(e){$(this).removeClass("selected")}),this.default_item_sprite_class&&this._j_default_item.prepend($j('<span class="icon img" />').addClass(this.default_item_sprite_class))),this.default_item_callback){var e=this;this._j_default_item.off("click").on("click",function(){return e.default_item_callback(),!1})}this._j_default_item.appendTo(this._j_dropdown)}},_highlight:function(e,t){var i={};for(var n in t)this._option_is_selectable[n]=!this.allow_not_selectable_items||!t[n].not_selectable,i[n]=this._highlight_label_callback(e,n,t[n]);return i},_is_empty:function(){return 0===this._option_keys.length},_add_dropdown_item:function(e,t){var i=this;return 0===this._option_keys.length&&this._j_dropdown.empty(),this._create_dropdown_item(e),this._j_dropdown_items[e].click(function(t){var n=$j(t.target);return i._on_select_callback(e,n),!1}).mouseenter(function(t){i.highlight_option_by_index(i._option_indices[e])}).mouseleave(function(e){i.reset_highlight_index()}).removeClass("selected hover").toggleClass("not_selectable",!this._option_is_selectable[e]).html(t),this._j_dropdown_items[e].show().appendTo(this._j_dropdown),this._option_indices[e]=this._option_keys.length,this._option_keys.push(e),!0},_create_dropdown_item:function(e){this._j_dropdown_items[e]||(this._j_dropdown_items[e]=$("<li></li>"))},_add_no_results_item:function(){this._j_no_results_item||(this._j_no_results_item=$('<li class="not_selectable"/>').append($j("<strong />").text(this.no_results_label)).mouseenter(function(e){$(this).addClass("selected")}).mouseleave(function(e){$(this).removeClass("selected")})),0===this._j_dropdown.children().length&&this._j_no_results_item.prependTo(this._j_dropdown)},_has_match:function(e,t){return $.isFunction(this._match_callback)&&this._match_callback(e,t)},_match_callback:function(e,t){return""!=e&&0===t.toLowerCase().indexOf(e.toLowerCase())},_highlight_label_callback:function(e,t,i){return this._highlight_string_callback(e,i)},_highlight_string_callback:function(e,t){return this._has_match(e,t)?this._highlight_match_callback($.box.escapeHTML(t.substr(0,e.length)))+$.box.escapeHTML(t.substr(e.length,t.length)):$.box.escapeHTML(t)},_highlight_match_callback:function(e){return"<b>"+e+"</b>"}},{});Box.Timing.execution.push({name:"js/box_contact_dropdown.js",time:(new Date).getTime()});var Box_Contact_Dropdown=Box_Option_Dropdown.extend({_highlight_label_callback:function(e,t,i){if("group"===i.type){var n=$t("Group","group_text");return this._highlight_string_callback(e,i.name)+" ("+n+")"}return this._highlight_string_callback(e,i.name)+" ("+this._highlight_string_callback(e,i.email)+")"}},{});Box.Timing.execution.push({name:"js/box_folder_tree_search_dropdown.js",time:(new Date).getTime()});var Box_Folder_Tree_Search_Dropdown=Box_Option_Dropdown.extend({constructor:function(e){this.base(e),this._j_dropdown.addClass("man")},_add_no_results_item:function(){this._j_no_results_item||(this._j_no_results_item=$j('<li class="strong pam pbn"></li>'),this._j_no_results_item.text(this.no_results_label)),this._j_no_results_item.prependTo(this._j_dropdown)},_highlight_string_callback:function(e,t){return t},position:function(){},_create_dropdown_item:function(e){this._j_dropdown_items[e]||(this._j_dropdown_items[e]=$('<li class="ban pan txt_m"></li>'))},get_folder_name:function(e){var t=this._j_dropdown_items[e];return t?t.find(".fts_result").attr("data-item_name"):null},hide:function(e){this._j_dropdown_container.hide()},show_loading:function(){if(0===$j("#ft_dropdown_loading").length){this._j_dropdown.hide();var e=this.get_ui_component(),t=$t("Loading your results...","qs_loading_text"),i='<ul id="ft_dropdown_loading" class="inline_list inline_list_icon_aligned lh16 pam pbn mtn">	<li>		<img src="'+Box.Application.getService("assets").getAssetURL(images_box_path,"spinner.gif")+'"/>  </li>  <li class="strong">'+t+" </li></ul>";e.append(i).show()}},hide_loading:function(){$j("#ft_dropdown_loading").remove(),this._j_dropdown.show()}},{});Box.Timing.execution.push({name:"js/box_item_contact_dropdown.js",time:(new Date).getTime()});var Box_Item_Contact_Dropdown=Box_Contact_Dropdown.extend({_highlight_label_callback:function(e,t,i){var n=this.base(e,t,i);return!this._option_is_selectable[t]&&this.allow_not_selectable_items&&(i.is_uploader?n=n+' <span data-hover="tooltip" aria-label="'+$t("This user does not have permission to add comments or respond to tasks.","item_contact_selector_uploader_permission")+'" class="badge role">'+$t("UPLOADER","item_contact_dropdown_uploader_badge")+"</span>":i.is_edit_disabled_in_enterprise&&(n=n+' <span data-hover="tooltip" aria-label="'+$t("This user has editing disabled in the enterprise and does not have permission to add comments or respond to tasks.","item_contact_selector_edit_disabled_in_enterprise_permission")+'" class="badge role">'+$t("DISABLED","item_contact_dropdown_disabled_badge")+"</span>")),n}},{});Box.Timing.execution.push({name:"js/box_state_machine.js",time:(new Date).getTime()});var Box_State_Machine=Box_Base.extend({_current_state_id:null,_transitions:{},_callbacks:{},constructor:function(e){this._current_state_id=e,this._callbacks={},this._transitions={}},is_in_state:function(e){return this._current_state_id==e},set_state:function(e){return this._current_state_id=e,
e},_get_transition:function(e){var t=this._transitions[e];if(t){var i=this._current_state_id;if("undefined"!=typeof t[i]){var n=t[i];return{from:i,to:n}}}return null},add_state:function(e){var t=e.id,i=e.transitions,n=e.callbacks;for(var o in i)this.add_transition(o,t,i[o]);n&&(n[Box_State_Machine.CALLBACK_TYPES.ON_ENTER]&&this._add_callback(Box_State_Machine.CALLBACK_TYPES.ON_ENTER,t,n[Box_State_Machine.CALLBACK_TYPES.ON_ENTER]),n[Box_State_Machine.CALLBACK_TYPES.ON_EXIT]&&("undefined"!=typeof Tombstone&&Tombstone.marker("./js/box_state_machine.js:15088","2013-05-15","auto tombstoned"),this._add_callback(Box_State_Machine.CALLBACK_TYPES.ON_EXIT,t,n[Box_State_Machine.CALLBACK_TYPES.ON_EXIT])))},add_transition:function(e,t,i){this._transitions[e]||(this._transitions[e]={}),this._transitions[e][t]=i},on_transition:function(e,t){var i=Box_State_Machine.CALLBACK_TYPES.ON_TRANSITION;this._callbacks[i]||(this._callbacks[i]={}),this._callbacks[i][e]=t},_add_callback:function(e,t,i){this._callbacks[e]||(this._callbacks[e]={}),this._callbacks[e][t]=i},_apply_on_transition:function(e,t){var i;this._callbacks[Box_State_Machine.CALLBACK_TYPES.ON_TRANSITION]&&(i=this._callbacks[Box_State_Machine.CALLBACK_TYPES.ON_TRANSITION][e]),i&&i(t[0],t[1])},_apply_callback:function(e,t,i){var n=this._callbacks[e];n&&n[t]&&n[t].apply(null,[i])},dispatch:function(e){var t=this._get_transition(e);return t?(this._apply_callback(Box_State_Machine.CALLBACK_TYPES.ON_EXIT,t.from,e),this.set_state(t.to),this._apply_on_transition(e,Array.prototype.slice.call(arguments,1)),this._apply_callback(Box_State_Machine.CALLBACK_TYPES.ON_ENTER,t.to,e),!0):!1}},{CALLBACK_TYPES:{ON_ENTER:"ON_ENTER",ON_EXIT:"ON_EXIT",ON_TRANSITION:"ON_TRANSITION"}});Box.Timing.execution.push({name:"js/box_toaster.js",time:(new Date).getTime()});var Toaster=Base.extend({constructor:function(){this.j_toaster=$j("#toaster"),this.j_toaster.length||(this.j_toaster=$j('<div id="toaster" class="toaster" style="display: none;"><div class="cntr_progress" id="toaster_progress"><div class="progress_bar" style="width: 0;"><div class="barber_pole"/></div></div><div class="media"><div class="img_ext"><a href="#" id="toaster_hide">'+$t("Hide","box_toaster_hide")+'</a><span id="toaster_separator">&nbsp;|&nbsp;</span><a href="#" id="toaster_cancel">'+$t("Cancel","box_cancel")+'</a></div><div id="toaster_message" class="bd">&nbsp;</div></div></div>').appendTo($j("body")),this.j_toaster.find("#toaster_hide").on("click",function(){return Toaster.get().hide(),!1}),this.j_toaster.find("#toaster_cancel").on("click",function(){return Toaster.get().cancel(),!1}))},j_toaster:null,on_cancel_callback:null,progress:null,intv_id:null,show:function(e){e=e||{},this.on_cancel_callback=e.on_cancel_callback,e.hide_progress?this.j_toaster.find("#toaster_progress, #toaster_separator").hide():(this.j_toaster.find("#toaster_progress").show(),e.hide_cancel?this.j_toaster.find("#toaster_cancel, #toaster_separator").hide():this.j_toaster.find("#toaster_cancel, #toaster_separator").show()),this.visible=!0,this.j_toaster.show().animate({bottom:"0"})},_hide:function(){var e=this;this.visible=!1,this.j_toaster.animate({bottom:"-50px"},1e3,function(){e.j_toaster.hide()})},hide:function(e){var t=this;e&&"number"==typeof e?window.setTimeout(function(){t._hide()},e):this._hide()},set_progress:function(e){this.progress=e,0>e&&(e=0),e>100&&(e=100),this.j_toaster.find(".progress_bar").css("width",e+"%")},set_message:function(e){this.j_toaster.find("#toaster_message").html(e)},set_fake_toaster:function(e){var t=this;return this.intv_id=setInterval(function(){t.progress<98?t.set_progress(++t.progress):(clearInterval(t.intv_id),t.set_progress(100),t.hide(200))},e/(98-t.progress)),this},finish_fake_toaster:function(e){clearInterval(this.intv_id),this.set_progress(100),this.hide(e?e:0)},toggle_progress_toaster:function(e){this.show({hide_cancel:!0}),e?(this.set_progress(100),this.hide(1e3)):this.set_progress(60)},toggle_cancel_link:function(e){e?$j("#toaster_cancel, #toaster_separator").show():$j("#toaster_cancel, #toaster_separator").hide()},cancel:function(){this.on_cancel_callback&&"function"==typeof this.on_cancel_callback&&this.on_cancel_callback()},is_visible:function(){return this.j_toaster&&this.visible}},{get:function(){return Toaster.__instance||(Toaster.__instance=new Toaster),Toaster.__instance}});Box.Timing.execution.push({name:"js/box_tag_collection.js",time:(new Date).getTime()});var Tag_Collection=Base.extend({constructor:function(e){e=e||{},this.my_tags=e.my_tags||{},Tag_Collection.__instance=this},apply_tags:function(e){var t=Box.Application.getService("url"),i=Box.Application.getService("nav-state"),n=Box.Application.getService("nav-url");if(e.length>0){var o=e.join(",");"files"!=box.hist_name?t.goToUrl("/files/0/t/"+o):Box.Application.navigate(n.getTagsUrl(o,0)),box_sidebar.hide_sidebar_collaborator()}else"files"==box.hist_name&&(i.setItemInFiles(root_folder_id.substr(2)),Box.Application.navigate(""))},delete_tag:function(e,t){var i=this,n=Box.Application.getService("popups");n.confirm($t("Are you sure you would like to delete this tag from all your files and folders?","js_confirm_delete_tag"),{onconfirm:function(){var o=t.find("a").text(),a={tag_id:e},r=$.box.formatQuery(a),s="/index.php?rm=box_tag_item_delete_tag",l=Box.Application;$.postJSON(s,r,function(a){a.result&&"no_access"==a.result?n.alert($t("You do not have permission to delete tags.","popup_myfiles_tag_delete_js_error")):(t.remove(),delete i.my_tags[e],box.after_load_callback=function(){l.getService("notifications").confirm($t('Tag "%1" was deleted.',"js_tag_deleted_confirmation_message",o))},l.navigate(""),n.close())})},isBlocking:!0})},remove:function(e){var t=$t("All Files","js_global_allfiles"),i=Box.Application.getService("nav-url"),n=Box.Application.getService("nav-state"),o=n.get();if(!e)return Box.Application.navigate(i.getFolderUrl(0,0,t)),!1;var a=[];if("t"==o.type){var r=o.tags.split(",");for(var s in r)r[s]!=e&&a.push(r[s]);return Box.Application.navigate(0===a.length?i.getFolderUrl(0,0,t):i.getTagsUrl(a.join(","),0)),!1}}},{get:function(){return Tag_Collection.__instance}});Box.Timing.execution.push({name:"js/box_realtime_notification.js",time:(new Date).getTime()});var Realtime_Notification=Box_Base.extend({display:$j.abstract_function},{_realtime_url:window.realtime_url,_qsn:0,subscriber_id:window.realtime_subscriber_id,ACTION_KEEP_ALIVE:"keepalive",action_log_ids:{},create:function(e){var t=e.action;if(t==Realtime_Notification.ACTION_KEEP_ALIVE)return null;var i=Box.Application.getService("strings"),n="Realtime_Notification_Update_"+i.capitalize(t),o=window[n];return o?new o(e):null},is_enabled:function(){return Boolean(this._realtime_url)},_delay_after_error:0,_retry_count:0,_max_retries:window.realtime_max_retries,initialize:function(e,t){if(this.is_enabled()){e="undefined"!=typeof e?e:!1,t="undefined"!=typeof t?t:0;var i=t+2;if(!(t>this._max_retries||1<<i===0)){var n=0;return e&&(n=Math.random()*(1<<i)*1e3),n?void setTimeout(function(){Realtime_Notification.initialize(!1,t)},n):void $j.getJSON("/index.php?rm=box_realtime_get_realtime_info",{},function(e){"get_realtime_info_ok"==e.status?(Realtime_Notification._qsn=e.qsn,Realtime_Notification._realtime_url=e.realtime_url,Realtime_Notification.subscribe_to_notifications()):Realtime_Notification.initialize(!0,t+1)},{error:function(){Realtime_Notification.initialize(!0,t+1)}})}}},subscribe_to_notifications:function(e){if(this.is_enabled()){var t=this._retry_count+2;if(!(this._retry_count>this._max_retries||1<<t===0)){e=e||{};var i=e.use_delay_after_error;delete e.use_delay_after_error;var n=0;return i&&(this._delay_after_error=Math.random()*(1<<t)*1e3,n=this._delay_after_error),n?void setTimeout(function(){Realtime_Notification.subscribe_to_notifications(e)},n):void $j.getCrossDomain(this._realtime_url+"&caching_hash="+Math.random(),{},function(t){if("new_change"==t.message){var i="/index.php?rm=box_realtime_get_latest_events",n={qsn:Realtime_Notification._qsn},o=$j.box.formatQuery(n);$j.getJSON(i,o,function(t){"get_latest_events_ok"==t.status?(Realtime_Notification._qsn=t.qsn,Realtime_Notification.display_notifications(t.events),Realtime_Notification._delay_after_error=0,Realtime_Notification._retry_count=0,Realtime_Notification.subscribe_to_notifications(e)):(e.use_delay_after_error=!0,Realtime_Notification._retry_count+=1,Realtime_Notification.subscribe_to_notifications(e))},{error:function(){e.use_delay_after_error=!0,Realtime_Notification._retry_count+=1,Realtime_Notification.subscribe_to_notifications(e)}})}else"reconnect"==t.message?(Realtime_Notification._delay_after_error=0,Realtime_Notification._retry_count=0,Realtime_Notification.subscribe_to_notifications(e)):(e.use_delay_after_error=!0,Realtime_Notification._retry_count+=1,Realtime_Notification.subscribe_to_notifications(e))},{error:function(){e.use_delay_after_error=!0,Realtime_Notification._retry_count+=1,Realtime_Notification.subscribe_to_notifications(e)}})}}},display_notifications:function(e){$j.each(e,function(e,t){var i=Box.Application.getService("unidb"),n=Realtime_Notification.create(i.decode(t));!n||n.action_log_id in Realtime_Notification.action_log_ids||(Realtime_Notification.action_log_ids[n.action_log_id]=!0,n.display())})},display_item_notifications:function(e){var t=Realtime_Notification.create(e);t&&t.display()},subscribe_to_item_notifications:function(e){var t=this._retry_count+2;if(!(this._retry_count>this._max_retries||1<<t===0)){e||(e={});var i=e.use_delay_after_error,n=e.delay,o=e.notification_url;if(delete e.use_delay_after_error,delete e.delay,Boolean(o))return i&&(this._delay_after_error=Math.random()*(1<<t)*1e3,n=this._delay_after_error),n?void setTimeout(function(){Realtime_Notification.subscribe_to_item_notifications(e)},n):void $j.getCrossDomain(o+"&caching_hash="+Math.random(),{},function(t){if("reconnect"==t.message)return Realtime_Notification._delay_after_error=0,Realtime_Notification._retry_count=0,void Realtime_Notification.subscribe_to_item_notifications(e);try{var i=$j.parseJSON(t.message);if(e.callback&&"representation"===i.action)e.callback(i);else{if("representation"!==i.action)throw new Error("Bad response received from Conversion-Realtime system");Realtime_Notification.display_item_notifications(i)}}catch(n){e.use_delay_after_error=!0,Realtime_Notification._retry_count+=1,Realtime_Notification.subscribe_to_item_notifications(e)}},{error:function(){e.use_delay_after_error=!0,Realtime_Notification._retry_count+=1,Realtime_Notification.subscribe_to_item_notifications(e)}})}}});Loader.pageLoad.done(function(){var e=4e3;setTimeout(function(){Realtime_Notification.initialize()},e)}),Box.Timing.execution.push({name:"js/box_realtime_notification_update.js",time:(new Date).getTime()});var Realtime_Notification_Update=Realtime_Notification.extend({is_from_user_you:!1,is_from_user_anonymous:!0,display:function(){return this.realtime_subscriber_id==Realtime_Notification.subscriber_id?void $j.log("self-notification ignored"):this._item_uniq_version_already_loaded()?void $j.log("self-notification ignored"):(this.target&&"file"==this.target.type&&!this.target.parent&&this.target_parent&&(this.target.folder=this.target.parent=this.target_parent),this.from_user.id!=Canvas.get().user.id&&this._display_growl_notification(),void this._update_objects())},_display_growl_notification:function(){var e=this.message();if(e){var t=this.priority();return t<Realtime_Notification_Update.realtime_notification_priority_threshold_value?void $j.log("Notification priority too low: "+t+" < "+Realtime_Notification_Update.realtime_notification_priority_threshold_value):void Box.Application.getService("growl-notifications").display(this.icon(),e).then(this.callback())}},priority:function(){return $j.isFunction(this._priority)?this._priority():this._priority},icon:function(){return this.target.small_thumb},message:function(){this.is_from_user_you=this.from_user.is_you(),this.is_from_user_anonymous=$j.isFunction(this.from_user.is_anonymous)?this.from_user.is_anonymous():this.from_user.is_anonymous;var e=$j.isFunction(this._message)?this._message():this._message;return e?e:null},callback:function(){var e=this;return function(){Box_Object.load_params(e.target,"complete",function(){e._callback()})}},_priority:$j.abstract_function,_message:$j.abstract_function,_callback:function(){this.target.click()},_update_objects:$j.abstract_function,_item_uniq_version_already_loaded:$j.abstract_function},{realtime_notification_priority_threshold_value:window.realtime_notification_priority_threshold_value}),Realtime_Notification_Update_Created=Realtime_Notification_Update.extend({_priority:function(){var e=!1;return e?65:75},_item_uniq_version_already_loaded:function(){var e=Canvas.get().collections;if(!e||!e.length)return!1;for(var t=0,i=e[t].items,n=e.length;n>t;t++){if(!i||!i.length)return!1;for(var o=this.target.id,a=this.target_uniq_name,r=0,s=i[r],l=i.length;l>r;r++)if(s.id===o&&s.uniq_name===a)return!0}return!1},_message:function(){var e=null;return e="file"==this.target.type?this.is_from_user_you?$t("You uploaded%1%2","you_uploaded_file_update","<br>",$.box.escapeHTML(this.target.name)):this.is_from_user_anonymous?$t("Someone uploaded%1%2","someone_uploaded_file_update","<br>",$.box.escapeHTML(this.target.name)):$t("%1 uploaded%2%3","box_user_uploaded_file_update",$.box.escapeHTML(this.from_user.name),"<br>",$.box.escapeHTML(this.target.name)):this.is_from_user_you?$t("You created%1%2","you_created_folder_update","<br>",$.box.escapeHTML(this.target.name)):this.is_from_user_anonymous?$t("Someone created%1%2","someone_created_folder_update","<br>",$.box.escapeHTML(this.target.name)):$t("%1 created%2%3","box_user_created_folder_update",$.box.escapeHTML(this.from_user.name),"<br>",$.box.escapeHTML(this.target.name))},_update_objects:function(){var e={message:this.message(),from_user:this.from_user};this.target.update_params_and_render({new_version:!0},e);var t=this._get_new_version_children();for(var i in t){var n=Box_Object.find_by_typed_id(i);n.update_params_and_render({new_version:!0},e)}this.target_parent.update_params_and_render({created_children:this._get_created_children(),new_version_children:t},e)},_get_created_children:function(){return[this.target.typed_id]},_get_new_version_children:function(){return[]},_item_uniq_version_already_loaded:function(){return!1}}),Realtime_Notification_Update_Uploaded=Realtime_Notification_Update_Created,Realtime_Notification_Update_Downloaded=Realtime_Notification_Update.extend({_priority:function(){return this.as_shared_item?50:25},_message:function(){var e=null;return e=this.is_from_user_you?$t("You downloaded%1%2","you_downloaded_file_update","<br>",$.box.escapeHTML(this.target.name)):this.is_from_user_anonymous?$t("Someone downloaded%1%2","someone_downloaded_file_update","<br>",$.box.escapeHTML(this.target.name)):$t("%1 downloaded%2%3","box_user_downloaded_file_update",$.box.escapeHTML(this.from_user.name),"<br>",$.box.escapeHTML(this.target.name))},_update_objects:function(){},_item_uniq_version_already_loaded:function(){return!1}}),Realtime_Notification_Update_Invited_Collaborator=Realtime_Notification_Update.extend({callback:function(){var e=this;return function(){var t="/index.php?rm=box_get_pending_collab",i={collab_id:e.collab_id};$.getJSON(t,$j.box.formatQuery(i),function(e){var t=e.collab,i=new Collab(t);i.accept({required_accept_options:!0})})}},_priority:function(){return this._is_for_current_user()?100:10},_message:function(){var e=null;if("auto_accept"in this&&this.auto_accept===!0)return null;if(this._is_for_current_user())e=this.is_from_user_you?$t("You invited yourself to %1%2","you_invited_yourself_to_collab_on_folder_update","<br>",$.box.escapeHTML(this.target.name)):this.is_from_user_anonymous?$t("Someone invited you to %1%2","someone_invited_you_to_collab_on_folder_update","<br>",$.box.escapeHTML(this.target.name)):$t("%1 invited you to %2%3","box_user_invited_you_to_collab_on_folder_update",$.box.escapeHTML(this.from_user.name),"<br>",$.box.escapeHTML(this.target.name));else{var t="collab_user_name"in this?this.collab_user_name:this.collab_user_email;e=this.is_from_user_you?$t("You invited %1 to %2%3","you_invited_someone_to_collab_on_folder_update",t,"<br>",$.box.escapeHTML(this.target.name)):this.is_from_user_anonymous?$t("Someone invited %1 to %2%3","someone_invited_someone_to_collab_on_folder_update",t,"<br>",$.box.escapeHTML(this.target.name)):$t("%1 invited %2 to %3%4","box_user_invited_someone_to_collab_on_folder_update",$.box.escapeHTML(this.from_user.name),t,"<br>",$.box.escapeHTML(this.target.name))}return e},_update_objects:function(){},_is_for_current_user:function(){return Canvas.get().user.email==this.collab_user_email},_item_uniq_version_already_loaded:function(){return!1}}),Realtime_Notification_Update_Added_Collaborator=Realtime_Notification_Update.extend({_priority:function(){return this._is_for_current_user()?100:10},_message:function(){var e=null;if(!("auto_accept"in this)||this.auto_accept===!1)return null;if(this._is_for_current_user())e=this.is_from_user_you?$t("You added yourself to %1%2","you_added_yourself_to_collab_on_folder_update","<br>",$.box.escapeHTML(this.target.name)):this.is_from_user_anonymous?$t("Someone added you to %1%2","someone_added_you_to_collab_on_folder_update","<br>",$.box.escapeHTML(this.target.name)):$t("%1 added you to %2%3","box_user_added_you_to_collab_on_folder_update",$.box.escapeHTML(this.from_user.name),"<br>",$.box.escapeHTML(this.target.name));else{var t="collab_user_name"in this?this.collab_user_name:this.collab_user_email;e=this.is_from_user_you?$t("You added %1 to %2%3","you_added_someone_to_collab_on_folder_update",t,"<br>",$.box.escapeHTML(this.target.name)):this.is_from_user_anonymous?$t("Someone added %1 to %2%3","someone_added_someone_to_collab_on_folder_update",t,"<br>",$.box.escapeHTML(this.target.name)):$t("%1 added %2 to %3%4","box_user_added_someone_to_collab_on_folder_update",$.box.escapeHTML(this.from_user.name),t,"<br>",$.box.escapeHTML(this.target.name))}return e},_update_objects:function(){},_is_for_current_user:function(){return Canvas.get().user.email==this.collab_user_email},_item_uniq_version_already_loaded:function(){return!1}}),Realtime_Notification_Update_Joined=Realtime_Notification_Update.extend({_priority:function(){return 50},_message:function(){var e=null;return e=this.is_from_user_you?$t("You joined %1%2","you_joined_folder_update","<br>",$.box.escapeHTML(this.target.name)):this.is_from_user_anonymous?$t("Someone joined %1%2","someone_joined_folder_update","<br>",$.box.escapeHTML(this.target.name)):$t("%1 joined %2%3","box_user_joined_folder_update",$.box.escapeHTML(this.from_user.name),"<br>",$.box.escapeHTML(this.target.name))},_update_objects:function(){this.target.update_params_and_render({created_collabs:[this.collab]},{message:this.message()})},_item_uniq_version_already_loaded:function(){return!1}}),Realtime_Notification_Update_Shared=Realtime_Notification_Update.extend({_priority:10,_message:function(){var e=null;return e=this.is_from_user_you?$t("You activated a link for %1%2","you_activated_shared_link_for_document_update","<br>",$.box.escapeHTML(this.target.name)):this.is_from_user_anonymous?$t("Someone activated a link for %1%2","someone_activated_shared_link_for_document_update","<br>",$.box.escapeHTML(this.target.name)):$t("%1 activated a link for %2%3","box_user_activated_shared_link_for_document_update",$.box.escapeHTML(this.from_user.name),"<br>",$.box.escapeHTML(this.target.name))},_update_objects:function(){this.target.update_params_and_render({shared:this.shared,shared_name:this.shared_name,shared_link:this.shared_link},{message:this.message()})},_item_uniq_version_already_loaded:function(){return!1}}),Realtime_Notification_Update_Sent=Realtime_Notification_Update.extend({_priority:100,_message:function(){var e=null;return e=this.is_from_user_you?$t("You sent yourself %1%2","you_sent_yourself_document_update","<br>",$.box.escapeHTML(this.target.name)):this.is_from_user_anonymous?$t("Someone sent you %1%2","someone_sent_you_document_update","<br>",$.box.escapeHTML(this.target.name)):$t("%1 sent you %2%3","box_user_sent_you_document_update",$.box.escapeHTML(this.from_user.name),"<br>",$.box.escapeHTML(this.target.name))},_callback:function(){this.target.open_shared_page()},_update_objects:function(){this.target.update_params_and_render({shared:this.shared,shared_name:this.shared_name,shared_link:this.shared_link},{message:this.message()})},_is_for_current_user:function(){},_item_uniq_version_already_loaded:function(){return!1}}),Realtime_Notification_Update_Unshared=Realtime_Notification_Update.extend({_priority:50,_message:function(){var e=null;return e=this.is_from_user_you?$t("You deactivated a link for %1%2","you_deactivated_shared_link_for_document_update","<br>",$.box.escapeHTML(this.target.name)):this.is_from_user_anonymous?$t("Someone deactivated a link for %1%2","someone_deactivated_shared_link_for_document_update","<br>",$.box.escapeHTML(this.target.name)):$t("%1 deactivated a link for %2%3","box_user_deactivated_shared_link_for_document_update",$.box.escapeHTML(this.from_user.name),"<br>",$.box.escapeHTML(this.target.name))},_update_objects:function(){this.target.update_params_and_render({shared:this.shared,shared_name:this.shared_name,shared_link:this.shared_link},{message:this.message()})},_item_uniq_version_already_loaded:function(){return!1}}),Realtime_Notification_Update_Renamed=Realtime_Notification_Update.extend({_priority:50,_message:function(){var e=null;return"old_name"in this?e=this.is_from_user_you?$t("You renamed %1%2 to %3","you_renamed_update","<br>",$.box.escapeHTML(this.old_name),$.box.escapeHTML(this.target.name)):this.is_from_user_anonymous?$t("Someone renamed %1%2 to %3","someone_renamed_update","<br>",$.box.escapeHTML(this.old_name),$.box.escapeHTML(this.target.name)):$t("%1 renamed %2%3 to %4","box_user_renamed_update",$.box.escapeHTML(this.from_user.name),"<br>",$.box.escapeHTML(this.old_name),$.box.escapeHTML(this.target.name)):"old_description"in this?e=""==this.old_description?this.is_from_user_you?$t("You added a description to %1%2","you_added_description_update","<br>",$.box.escapeHTML(this.target.name)):this.is_from_user_anonymous?$t("Someone added a description to %1%2","someone_added_description_update","<br>",$.box.escapeHTML(this.target.name)):$t("%1 added a description to %2%3","box_user_added_description_update",$.box.escapeHTML(this.from_user.name),"<br>",$.box.escapeHTML(this.target.name)):""==this.description?this.is_from_user_you?$t("You deleted the description of %1%2","you_deleted_description_update","<br>",$.box.escapeHTML(this.target.name)):this.is_from_user_anonymous?$t("Someone deleted the description of %1%2","someone_deleted_description_update","<br>",$.box.escapeHTML(this.target.name)):$t("%1 deleted the description of %2%3","box_user_deleted_description_update",$.box.escapeHTML(this.from_user.name),"<br>",$.box.escapeHTML(this.target.name)):this.is_from_user_you?$t("You updated the description of %1%2","you_updated_description_update","<br>",$.box.escapeHTML(this.target.name)):this.is_from_user_anonymous?$t("Someone updated the description of %1%2","someone_updated_description_update","<br>",$.box.escapeHTML(this.target.name)):$t("%1 updated the description of %2%3","box_user_updated_description_update",$.box.escapeHTML(this.from_user.name),"<br>",$.box.escapeHTML(this.target.name)):$j.not_implemented("web_link url"),e},_update_objects:function(){var e={};"name"in this&&(e.name=this.name),"description"in this&&(e.description=this.description),this.target.update_params_and_render(e,{message:this.message()})},_item_uniq_version_already_loaded:function(){return!1}}),Realtime_Notification_Update_Commented=Realtime_Notification_Update.extend({_priority:75,_message:function(){var e=null;return e=this.is_from_user_you?$t("You commented on %1%2","you_commented_on_update","<br>",$.box.escapeHTML(this.target.name)):this.is_from_user_anonymous?$t("Someone commented on %1%2","someone_commented_on_update","<br>",$.box.escapeHTML(this.target.name)):$t("%1 commented on %2%3","box_user_commented_on_update",$.box.escapeHTML(this.from_user.name),"<br>",$.box.escapeHTML(this.target.name))},_callback:function(){var e=this.target;this.target.click({show_comments_callback:function(){"file"==e.type&&setTimeout(function(){var t=$j("#cmttxt_"+e.typed_id+"_0");if(t.length){var i=t.parents(".comment_list").find(".comment").last(),n=1e3;$j.scrollTo(t,n),setTimeout(function(){var e=i.find(".message"),t=$j("<span></span>").html(e.html()).addClass("new");e.html(t)},n)}},2e3)}})},_update_objects:function(){this.target.update_params_and_render({created_comments:!0},{message:this.message()})},_item_uniq_version_already_loaded:function(){return!1}});Box.Timing.execution.push({name:"js/box_pub_sub.js",time:(new Date).getTime()});var Box_Pub_Sub=Base.extend({subscribe:function(e,t,i){$(this).on(e,t,i)},publish:function(e,t){$(this).trigger(e,t)}},{});Box.Timing.execution.push({name:"js/selectors/box_master_user_selector.js",time:(new Date).getTime()});var Box_Master_User_Selector=Box_Contact_Selector.extend({constructor:function(e){e.placeholder_text=$t("Enter name or email address","contact_selector_placeholder_text_singular"),e.filter=new Box_GCM_Filter,this.base(e)}},{});Box.Timing.execution.push({name:"js/net_promoter_survey.js",time:(new Date).getTime()});var Net_Promoter_Survey=Base.extend({can_execute:function(){var e=Box.Application.getService("nav-state");return e.isFiles()},execute:function(){this._create_popup(),this._log_open_survey()},submit:function(e,t){var i="undefined"!=typeof e.recommend_box_score&&parseInt(e.recommend_box_score,10)>=9,n=Box.Application,o=n.getService("logger");return $j("#net_promoter_improvement_area_error").hide(),$j("#net_promoter_feedback_required_for_other").hide(),i||""!=e.improvement_area?"Other"==e.improvement_area&&""==e.feedback?($j("#net_promoter_feedback_required_for_other").show(),$j("#popup_textarea_feedback").focus(),void $j.popup.revert()):($j.popup.close(),n.getService("notifications").confirm(Net_Promoter_Survey.THANK_YOU_MESSAGE),void o.sendLog("net_promoter_survey","NET_PROMOTER_SURVEY_POPUP_SUBMIT",e)):($j("#net_promoter_improvement_area_error").show(),void $j.popup.revert())},cancel:function(){$.popup.close(),this._log_cancel_survey()},_create_popup:function(){var e=this;$j.popup.form($t("How are we doing?","net_promoter_popup_title_how_are_we_doing"),[{type:"html",data:['<div class="mts pbs">',"	<strong>"+$t("How likely are you to recommend Box to a colleague or friend?","net_promoter_recommend_label")+"</strong>","</div>",'<table class="mvm" style="width:100%;">',"	<tr>",'		<td colspan="5" class="txt_l pbm">','			<label for="nps_radio0">'+$t("Not at all likely","net_promoter_not_likely")+"</label>","		</td>",'		<td colspan="6" class="txt_r pbm">','			<label for="nps_radio10">'+$t("Extremely likely","net_promoter_extremely_likely")+"</label>","		</td>","	</tr>",'	<tr class="recommend_radio center_contents">',this._build_radio_button_html(),"	</tr>",'	<tr class="center_contents">','		<td><label for="nps_radio0" class="legal">0</label></td>','		<td colspan="4"></td>','		<td><label for="nps_radio5" class="legal">5</label></td>','		<td colspan="4"></td>','		<td><label for="nps_radio10" class="legal">10</label></td>',"	</tr>","</table>",'<hr class="divider_medium mbm"/>'].join("")},{type:"dropdown",name:"improvement_area",label:['<div class="mbm">',$t("Is there a particular area where we can improve?","net_promoter_improve_recommend_label"),"</div>",'<div id="net_promoter_improvement_area_error" class="error mbm" style="display:none;">',$t("Please choose an area where we can improve","net_promoter_improve_error_msg"),"</div>"].join(""),items:[{value:"",label:$t("Select one...","net_promotoer_select_option_option")},{value:"Sync",label:$t("Sync (Windows, Mac)","net_promotoer_sync_windows_mac_options")},{value:"Performance",label:$t("Speed (website, upload/download)","net_promotoer_speed_options")},{value:"Mobile Apps",label:$t("Mobile Apps (iOS, Android)","net_promotoer_mobile_apps_option")},{value:"User Interface",label:$t("Site Features (navigation, search, previewing, etc)","net_promoter_user_interface_option")},{value:"File Preview",label:$t("File Previews (Viewing files within the Box website)","net_promoter_file_preview_option")},{value:"Storage",label:$t("Storage (space amount, upload size limit)","net_promotoer_storage_option")},{value:"Email Communication",label:$t("Email Communication","net_promoter_email_communication_option")},{value:"Security",label:$t("Security Features","net_promoter_security_options")},{value:"Cost",label:$t("Cost","net_promotoer_cost_option")},{value:"Training",label:$t("Training","net_promotoer_training_option")},{value:"Support / Services",label:$t("Customer Support","net_promoter_customer_support_option")},{value:"Other",label:$t("Other","other")}]},{type:"html",data:['<div id="net_promoter_feedback_required_for_other" class="error strong plt mbm" style="position:relative;top:10px;display:none;">',$t('Please explain why you chose "Other" as an improvement area.',"net_promoter_feedback_required_for_other_improvements"),"</div>"].join("")},{type:"textarea","class":"scrollable",name:"feedback",instructions:$t("Please provide any additional feedback you think would help us improve Box.","net_promoter_feedback_label"),value:""},{type:"buttons",items:[{value:$t("Submit","popup_button_submit"),click:function(t,i){e.submit(t,i)}},{value:$t("Cancel","js_popup_button_cancel"),click:function(t,i){e.cancel()}}]}],{favicon_class:"sprite_24x24_discussion",cancel_popup_callback:function(){e._log_cancel_survey()}},function(){})},_build_radio_button_html:function(){for(var e="",t=0;10>=t;t++)e+='<td class="size1of11"><input id="nps_radio'+t+'" class="radio_button" style="float:none;" type="radio" name="recommend_box_score" value="'+t+'"/></td>';return e},_log_open_survey:function(){var e=Box.Application.getService("logger");e.sendLog("net_promoter_survey","NET_PROMOTER_SURVEY_POPUP_OPEN",{})},_log_cancel_survey:function(){var e=Box.Application.getService("logger");e.sendLog("net_promoter_survey","NET_PROMOTER_SURVEY_POPUP_CANCEL",{})}},{THANK_YOU_MESSAGE:$t("Thank you for taking our survey! Your feedback is important to us.","net_promoter_thanks_confirmation"),get:function(){return Net_Promoter_Survey.__instance||(Net_Promoter_Survey.__instance=new Net_Promoter_Survey),Net_Promoter_Survey.__instance}});Box.Timing.execution.push({name:"js/box_partial_user.js",time:(new Date).getTime()});var Contact_User=Box_Object.extend({id:null,login:null,constructor:function(e){this.set_params(e)}},{type:"contact_user"});Box.Timing.execution.push({name:"js/box_banner_message.js",time:(new Date).getTime()});var Banner_Message=Base.extend({params:null,_num_slides:0,_is_transitioning:!1,_j_banner_message_anchor:null,_j_banner_message_slides_container:null,_j_nav_dots_container:null,_visible_slide_idx:-1,_auto_rotate_interval:null,_auto_rotate_resume_timeout:null,_auto_rotate_delay_ms:9e3,_auto_rotate_resume_delay_ms:15e3,_animation_time_for_auto_rotate:1200,_animation_time_for_manual_click:1200,constructor:function(e,t){this.params=t||{},this._j_banner_message_anchor=$j("#banner_message_anchor"),this._num_slides=e.length,this._j_banner_message_container=this._create_container(),this._j_banner_message_container.append(this._create_slides(e)),this._num_slides>1&&this._j_banner_message_container.append(this._create_nav_dots())},show:function(){return this._j_banner_message_anchor.length&&this._j_banner_message_anchor.is(":empty")?(this.params.auto_rotate&&this._num_slides>1&&this._set_interval_for_auto_rotate(),void this._j_banner_message_anchor.append(this._j_banner_message_container).hide().slideDown()):!1},_create_container:function(){var e=this,t=$j("<div/>",{
"class":"cntr pam banner_container"}),i=$j("<a/>",{id:"banner_message_close_btn","class":"img_ext sprite_14x14_close",href:"#",click:function(){return e._close(),!1}});return t.append(i),t},_create_slides:function(e){this._visible_slide_idx=0,this._j_banner_message_slides_container=$j("<div/>",{"class":"mrl",css:{position:"relative",overflow:"hidden"}});for(var t=0;t<e.length;t++){var i=$j("<div>",{css:t>0?{display:"none"}:"",html:e[t].html,data:{slide_idx:t}});this._j_banner_message_slides_container.append(i)}return this._j_banner_message_slides_container},_create_nav_dots:function(){var e=this;this._j_nav_dots_container=$j("<ul/>",{"class":"nav_dots_container center_contents inline_list"});for(var t=0;t<this._num_slides;t++){var i=$j("<li/>",{"class":"phs"}),n=$j('<a href="#" />').addClass("nav_dot "+(0===t?"active":"")).data("slide_index",t);i.append(n),this._j_nav_dots_container.append(i)}return this._j_nav_dots_container.on("click",".nav_dot",function(){var t=$j(this).data("slide_index");return e._select_slide(t),!1}),this._j_nav_dots_container},_select_slide:function(e){var t=this;this.params.auto_rotate&&(this._clear_auto_rotate_timers(),this._auto_rotate_resume_timeout=setTimeout(function(){t._set_interval_for_auto_rotate()},this._auto_rotate_resume_delay_ms)),this._transition(t._visible_slide_idx,e,!1)},_clear_auto_rotate_timers:function(){this._auto_rotate_interval&&(clearInterval(this._auto_rotate_interval),this._auto_rotate_interval=null),this._auto_rotate_resume_timeout&&(clearTimeout(this._auto_rotate_resume_timeout),this._auto_rotate_resume_timeout=null)},_transition:function(e,t,i){if(e!=t&&!this._is_transitioning){this._is_transitioning=!0;var n=this._j_banner_message_slides_container.children(),o=e>t?!0:!1,a=i?this._animation_time_for_auto_rotate:this._animation_time_for_manual_click;this._j_banner_message_slides_container.height(this._j_banner_message_slides_container.height());var r=n.eq(e),s=n.eq(t);this._animate_slide_out(r,a,o),this._j_banner_message_slides_container.animate({height:s.height()},"fast"),this._animate_slide_in(s,a,o)}},_animate_slide_out:function(e,t,i){e.css({position:"absolute"}).animate({left:i?"100%":"-100%",opacity:0},t,function(){$j(this).css({position:"",left:0,display:"none"})});var n=e.data("slide_idx");this._j_nav_dots_container.find("a").eq(n).removeClass("active")},_animate_slide_in:function(e,t,i){var n=this,o=e.width();e.css({position:"absolute",left:i?"-100%":"100%",display:"block",opacity:0,width:o+"px"}).animate({left:"0%",opacity:1},t,function(){$j(this).css({position:"",left:0,width:"auto"}),n._is_transitioning=!1});var a=e.data("slide_idx");this._j_nav_dots_container.find("a").eq(a).addClass("active"),this._visible_slide_idx=a},_set_interval_for_auto_rotate:function(){var e=this;this._auto_rotate_interval=setInterval(function(){var t=(e._visible_slide_idx+1)%e._num_slides;e._transition(e._visible_slide_idx,t,!0)},this._auto_rotate_delay_ms)},_close:function(){var e=this;this._j_banner_message_anchor.slideUp(function(){e._j_banner_message_anchor.empty()}),this.params.call_dismiss_action_on_close&&In_App_Message.get().dismiss_in_app_message(),this._clear_auto_rotate_timers()}});Box.Timing.execution.push({name:"js/menus/abstract_simple_menu.js",time:(new Date).getTime()});var Abstract_Simple_Menu=Abstract_Menu.extend({_menu_id:"",_menu_data:{},_structure:function(e){if(e=e||{},!this._e_menu){var t=$j('<ul class="list_menu hover_list" />');for(var i in this._menu_data){var n=this._menu_data[i],o=$j('<a href="#" />').attr("id",n.id).text(n.text);n.attributes&&o.attr(n.attributes),t.append($j("<li/>").append(o))}this._e_menu=$j('<div class="box-menu cntr drop_down_ext handle_menu_events"/>').attr("id",this._menu_id).append(t).appendTo(document.body).get(0)}}},{});Box.Timing.execution.push({name:"js/menus/box_upload_menu.js",time:(new Date).getTime()});var Upload_Menu=Abstract_Menu.extend({_timeout_duration:500,upload_widgets:[],constructor:function(e){e=e||{},this._e_menu=$j("#dd_menu_upload").get(0)},show:function(e){$("body").trigger("close.menus"),e=e||{},this._j_target_element=$j(e.target),this._callback=e.callback,this.base()},delete_upload_widgets:function(){for(var e=0;e<this.upload_widgets.length;e++)this.upload_widgets[e]&&this.upload_widgets[e].destroy();this.upload_widgets=[]},_get_offsets:function(e){return{x:0,y:11}},_render:function(){this._init_upload()},_init_upload:function(){"undefined"!=typeof Upload_Process&&(this.delete_upload_widgets(),this.upload_widgets.push(this.add_file_picker()),this.upload_widgets.push(this.add_folder_picker()),"flash"==Upload_Process.get().get_type()&&(this._elements_that_keep_menu_open=Upload_Process.get().container))},add_file_picker:function(){var e=$j("#upload_menu_upload_files");return this._add_upload_trigger(e)},add_folder_picker:function(){var e,t=!0;return Box.Application.getService("browser").canFolderUpload()?(e=$j("#upload_menu_bulk_upload"),this._add_upload_trigger(e,t)):void 0},_add_upload_trigger:function(e,t){var i=this;if(e.length){var n=Upload_Process.get();return n.add_trigger({element:e,folder:i.item,directory_upload:t,over_callback:function(){e.addClass("hover"),i._hover_on()},out_callback:function(){e.removeClass("hover"),i._hover_off()},handle_change:function(e,t){i.hide(),n.handle_change(e,t)}})}}},{});Box.Timing.execution.push({name:"js/plugins/t3/error-bindings.js",time:(new Date).getTime()}),function(){function e(){}function t(e,t){t.init(null,{ignoreAjaxAbort:!0,ignore3rdPartyErrors:!0}).attach(),e.on("error",function(e){e=e.data.exception,t.send(e,{t3:!0,objectName:e.objectName,method:e.objectName+"."+e.methodName})})}Box.Application.on("init",function(){var i=window.Box.Application,n=i.getGlobalConfig(),o=n.log_t3_errors,a=n.debug,r=i.getGlobal("localStorage"),s=i.getGlobal("Raygun");if(r&&r.getItem("debug")&&(a=!0),a){if(!s)throw new Error("Raygun.js is not available on this page!");i.on("error",function(e){throw e})}else o?s&&t(i,s):e()})}(),Box.Timing.execution.push({name:"js/behaviors/preview/preview-edit.js",time:(new Date).getTime()}),Box.Application.addBehavior("preview-edit",function(e){"use strict";function t(){var t=e.getService("popups"),o=e.getService("box-edit"),r=e.getService("openbox-service-actions"),s=e.getService("notifications"),l=e.getService("function-utils");return i.permissions.edit?(n||(n=l.debounce(function(){var e,n,a,l=null,c=r.getActions(null,{type:"openbox",itemTypedId:i.typedId}),_=c.length;for(e=0;_>e;e++)n=c[e].action,a=$.inArray(i.extension,n.extensions_editable_on_gallery)>-1,!l&&a&&(l=c[e]);l?l.execute():o.isBoxEditDisabledByAdmin()?s.error($t("Box Edit is removed or not available.","preview_edit_not_available_error")):o.isBoxEditInstalled()?o.canUserOpenFileOnDesktop(i)?o.executeBoxEdit(i.id,i.typedId):s.error($t("Box Edit does not support this file type.","preview_edit_unsupported_filetype_error")):t.open("box_edit_download",{data:{action:"edit",typed_id:i.typedId,extension:i.extension}})},a,!0)),void n()):void s.error($t("Either this file is not editable or you do not have permission to edit this file.","preview_edit_no_permission_error"))}var i,n,o,a=2e3;return{messages:["previewedit"],onmessage:function(e){"previewedit"===e&&t()},init:function(){o=e.getService("preview-cache"),i=o.recall("currentFile")},onclick:function(e,i,n){i&&!i.disabled&&"preview-edit"===n&&(t(),e.preventDefault(),e.stopPropagation())}}}),Box.Timing.execution.push({name:"js/behaviors/preview/preview-lock.js",time:(new Date).getTime()}),Box.Application.addBehavior("preview-lock",function(e){"use strict";function t(e){var t=i.query(".btn-preview-header-overflow")||i.query('[data-module="preview"]');e?a.upgrade({target:t,yOffset:s,xOffset:r}):n.locked?a.unlock(n.id,n.fullName,n.hash,n.locked,{target:t,yOffset:s,xOffset:r}):a.lock(n.id,n.fullName,n.hash,{target:t,yOffset:s,xOffset:r})}var i,n,o,a,r=-250,s=5;return{init:function(){i=e.getService("dom"),o=e.getService("preview-cache"),a=e.getService("fileop-lock-preview"),n=o.recall("currentFile")},onclick:function(e,i,n){if(i&&n&&!i.disabled){switch(n){case"preview-lock":t(!1);break;case"preview-lock-upgrade":t(!0);break;default:return}e.preventDefault(),e.stopPropagation()}}}}),Box.Timing.execution.push({name:"js/behaviors/preview/preview-print.js",time:(new Date).getTime()}),Box.Application.addBehavior("preview-print",function(e){"use strict";function t(){var e=n.recall("currentFile");e&&(e.permissions.print?r||!e.printUrl?a.getPrintUrl().then(i):i({data:{url:e.printUrl}}):o.error($t("Either this file is not printable or you do not have permission to print this file.","preview_print_no_permission_error")))}function i(i){i.data&&i.data.url?(e.getGlobal("window").open(i.data.url),c=0):202===i.status&&l>c&&(c++,setTimeout(t,3e3))}var n,o,a,r,s,l=40,c=0;return{messages:["previewprint"],onmessage:function(e){"previewprint"===e&&t()},init:function(){o=e.getService("notifications"),n=e.getService("preview-cache"),a=e.getService("preview-api"),r=!1,s=setTimeout(function(){r=!0},84e4)},destroy:function(){clearTimeout(s)},onclick:function(e,i,n){i&&!i.disabled&&"preview-print"===n&&(t(),e.preventDefault(),e.stopPropagation())}}}),Box.Timing.execution.push({name:"js/behaviors/preview/preview-share.js",time:(new Date).getTime()}),Box.Application.addBehavior("preview-share",function(e){"use strict";function t(){if(n.permissions.share){if(e.getGlobalConfig("showAmsterdamCollabSharing")){var t=i.getGcmCompatibleRm("item_share");s.open(t,{data:{itemTypedId:n.typedId}})}else o.open("show_share_properties_for_item",{data:{itemTypedId:n.typedId,selectedTab:"share"}});e.broadcast("sharedlinkcreated",{itemTypedId:n.typedId,context:"preview"})}else r.error($t("You do not have permission to share this file.","preview_share_no_permission_error"))}var i,n,o,a,r,s;return{messages:["previewshare"],onmessage:function(e){"previewshare"===e&&t()},init:function(){i=e.getService("url"),o=e.getService("popups"),a=e.getService("preview-cache"),r=e.getService("notifications"),s=e.getService("popups-amsterdam"),n=a.recall("currentFile")},onclick:function(e,i,n){i&&!i.disabled&&"preview-share"===n&&(t(),e.preventDefault(),e.stopPropagation())}}}),Box.Timing.execution.push({name:"js/behaviors/preview/preview-download.js",time:(new Date).getTime()}),Box.Application.addBehavior("preview-download",function(e){"use strict";function t(e,t){t=t||r.getSharedName(),s.downloadViaGet("/index.php?rm=box_download_shared_file&shared_name="+t+"&file_id=f_"+e)}function i(e,t){var i={file_id:"f_"+e};t&&(i.file_version_id=t),r.isGcm()?s.downloadViaPost("/index.php?rm=box_master_gcm_box_download_file_via_post",i):s.downloadViaPost("/index.php?rm=box_download_file_via_post",i)}function n(){var e=o.recall("currentFile");e&&(e.permissions.download?r.isShared()?t(e.id,e.sharedName):i(e.id,e.versionId):a.error($t("Either this file is not downloadable or you do not have permission to download this file.","preview_download_no_permission_error")))}var o,a,r,s;return{messages:["previewdownload"],onmessage:function(e){"previewdownload"===e&&n()},init:function(){a=e.getService("notifications"),s=e.getService("download"),o=e.getService("preview-cache"),r=e.getService("preview-nav")},onclick:function(e,t,i){t&&!t.disabled&&"preview-download"===i&&(n(),e.preventDefault(),e.stopPropagation())}}}),Box.Timing.execution.push({name:"js/behaviors/preview/preview-favorite.js",time:(new Date).getTime()}),Box.Application.addBehavior("preview-favorite",function(e){"use strict";function t(e){n.isFavorited?(a.remove(n.typedId,!0,"unfavoritefilepreview"),i.removeClass(e,"is-favorited"),i.setHTML(e,$t("Favorite","preview_favorite"))):(a.add(n.typedId,!0,"favoritefilepreview"),i.addClass(e,"is-favorited"),i.setHTML(e,$t("Unfavorite","preview_unfavorite")))}var i,n,o,a;return{init:function(){i=e.getService("dom"),o=e.getService("preview-cache"),a=e.getService("fileop-favorites"),n=o.recall("currentFile")},onclick:function(e,i,n){i&&!i.disabled&&"preview-favorite"===n&&(t(i),e.preventDefault(),e.stopPropagation())}}}),Box.Timing.execution.push({name:"js/behaviors/preview/preview-embed-scrolling.js",time:(new Date).getTime()}),Box.Application.addBehavior("preview-embed-scrolling",function(e){"use strict";function t(){l.addClass(s,b)}function i(){_.hideAll(),l.removeClass(s,b)}function n(){l.removeClass(s,w),l.removeClass(s,y),h&&l.addClass(s,p?y:w),p?t():i()}function o(){l.on(s,"touchstart",function(){g=!0,l.on(s,"touchmove",function e(){g=!1,l.off(s,"touchmove",e)})})}function a(){l.on(s,"mouseover",c.throttle(t,S)),l.on(s,"mousemove",c.throttle(t,S)),l.on(s,"mousemove",c.debounce(i,x))}var r,s,l=e.getService("dom"),c=e.getService("function-utils"),_=e.getService("tooltips-amsterdam"),d=e.getService("browser"),u=!1,p=!1,h=!1,m={},f=!1,g=!1,v="ontouchstart"in window,b="is-visible",w="is-disabled",y="is-displayed",x=d.isMobileOS()?4e3:2e3,S=1e3;return{messages:["viewerscrollstarted","viewerscrollended","previewcontentupdated","embedsharepopupchanged","embedwidgetevent"],onmessage:function(e,t){switch(e){case"embedsharepopupchanged":"show"===t?(p=!0,h=!0):"hide"===t&&(h=!1);break;case"viewerscrollstarted":s&&!u&&(m=p,p=!1,h=!0);break;case"viewerscrollended":s&&(u?u=!1:(h=v?g:!1,p=v?!m:!0));break;case"previewcontentupdated":s&&!f&&(v&&o(),d.isMobileOS()||a(),f=!0);break;case"embedwidgetevent":if("previouspage"!==t.type&&"nextpage"!==t.type)return;u=!0}n()},init:function(){r=e.getElement(),s=l.query(".preview-embed-widget",r)}}}),Box.Timing.execution.push({name:"js/behaviors/preview/preview-edit-office-online.js",time:(new Date).getTime()}),Box.Application.addBehavior("preview-edit-office-online",function(e){"use strict";function t(){o&&o.isOfficeOnlineAvailableAndSupportedForFile(i)&&(r||(r=a.debounce(function(){o.launchFileActionForItemWithTypedId(i.typedId)},s,!0)),r())}var i,n,o,a,r,s=2e3;return{messages:["previeweditofficeonline"],onmessage:function(e){"previeweditofficeonline"===e&&t()},init:function(){n=e.getService("preview-cache"),o=e.getService("office-online"),a=e.getService("function-utils"),i=n.recall("currentFile")},onclick:function(e,i,n){i&&!i.disabled&&"preview-edit-office-online"===n&&(t(),e.preventDefault(),e.stopPropagation())}}}),Box.Timing.execution.push({name:"js/services/fileop-movecopy-legacy.js",time:(new Date).getTime()}),Box.Application.addService("fileop-movecopy-legacy",function(e){"use strict";return{showMoveCopyPopup:function(t){var i=e.getGlobal("Item");i&&i.find_async("f_"+t).then(function(e){e&&e.move({create_new_action_instance:!0})})}}}),Box.Timing.execution.push({name:"js/services/preview/fileop-lock-preview.js",time:(new Date).getTime()}),Box.Application.addService("fileop-lock-preview",function(e){"use strict";function t(e,t){return t=t||{},e===y?{node_id:t.id,node_type:"file",action_id:k.lockActionId,file_id_hash:k.lockActionAsct?t.hash+"."+k.lockActionAsct:t.hash,"name[0]":"duration","value[0]":t.duration||0,"name[1]":"generate_update","value[1]":t.download_and_lock?0:1,"name[2]":"prevent_download","value[2]":t.preventDownload||0}:{node_id:t.id,node_type:"file",action_id:k.unlockActionId,file_id_hash:k.unlockActionAsct?t.hash+"."+k.unlockActionAsct:t.hash}}function i(e){S.error(e)}function n(e){27===e.keyCode&&(o(),e.stopPropagation())}function o(){u&&(T.off(u.overlay.querySelector(v),"click",p),T.off(u.overlay.querySelector(b),"click",o),T.off(u.overlay,"keydown",n),u.destroy(),u=null,p=null)}function a(n,o){if(e.getGlobalConfig("useNewLockUnlockRm")){var a={};n===y&&(a.duration=o.duration||0,a.preventDownload=o.preventDownload?!0:!1),a.isLock=n===y,a.itemID="f_"+o.id,x.post(w,a).then(function(){var t;t=n===y?$t("File successfully locked.","lock_file_success_msg"):$t("File successfully unlocked.","unlock_file_success_msg"),S.confirm(t),e.broadcast(n===y?"filelocked":"fileunlocked",{fileId:o.id}),e.broadcast("itemupdated",{itemTypedId:"f_"+o.id})},function(e){S.error(e.data.message)})}else x.get(h,t(n,o)).then(function(t){var a=t.data,r=a.message;"success"===a.result?(S.confirm(r),e.broadcast(n===y?"filelocked":"fileunlocked",{fileId:o.id}),e.broadcast("itemupdated",{itemTypedId:"f_"+o.id})):(r||(r=$t("There was an error when %1ing this file. Please try again.","toggle_lock_error_notification",n)),i(r))},i).caught(i)}function r(t){var n=e.getGlobal("location"),o=n.pathname,a=f;t.notify&&x.post(m,{q:{locks:{0:{file_id:t.id}}}}).caught(function(){}),0===o.indexOf("/master/")&&(a=g),x.post(a,{q:{item_id:t.id,message:t.message,lock_id:t.lockInfo.id}}).then(function(e){var t=e.data;"success"===t.result?S.confirm(t.message):i(t.message)})}function s(e,t){if(!p)switch(e){case"lock":p=function(){t.duration=u.overlay.querySelector("select").value-0,t.preventDownload=u.overlay.querySelector("input").checked-0,o(),a("lock",t)};break;case"unlock":p=function(){o(),a("unlock",t)};break;case"request-unlock":p=function(){t.message=u.overlay.querySelector("textarea").value,t.notify=u.overlay.querySelector("input").checked,o(),r(t)};break;case"lock-upgrade":p=function(){$.goToUrl("/ref/upsell_file_lock")}}return p}function l(e,t){u.openBelow(t.target,t.xOffset,t.yOffset),u.focusFirst(v),T.on(u.overlay.querySelector(v),"click",s(e,t)),T.on(u.overlay.querySelector(b),"click",o),T.on(u.overlay,"keydown",n)}function c(e){o(),u=C.create(j.getTemplateFragment("fileop-lock",{fileName:e.name})),l("lock",e)}function _(e,t){o(),u=C.create(j.getTemplateFragment("fileop-lock-"+e,{fileName:t.name,fileLockerName:t.lockInfo.lockedBy.name,fileLockerAvatar:t.lockInfo.lockedBy.pic,lockedMessage:t.lockInfo.updated})),l(e,t)}function d(e){o(),u=C.create(j.getTemplateFragment("fileop-lock-upgrade")),l("lock-upgrade",e)}var u,p,h="box_services_execute_action",m="box_services_add_locking_notification_request",f="box_unlock_request",g="box_master_gcm_unlock_request",v=".btn-fileop-ok",b=".btn-fileop-cancel",w="lock_unlock_item",y="lock",x=e.getService("ajax"),S=e.getService("notifications"),k=e.getGlobalConfig("lockConfig"),T=e.getService("dom"),j=e.getService("templates"),C=e.getService("overlay"),$=e.getService("url");return k||(k={lockActionId:e.getGlobal("locking_action_id"),unlockActionId:e.getGlobal("unlocking_action_id"),lockActionAsct:e.getGlobal("locking_action_asct"),unlockActionAsct:e.getGlobal("unlocking_action_asct")}),{upgrade:function(e){d(e||{})},lock:function(e,t,i,n){var o=n||{};o.id=e,o.name=t,o.hash=i,c(o)},unlock:function(e,t,i,n,o){var r=o||{};r.id=e,r.name=t,r.hash=i,r.lockInfo=n,n.canUnlock?n.lockedBy.me?a("unlock",r):_("unlock",r):_("request-unlock",r)}}}),Box.Timing.execution.push({name:"js/services/preview/preview-api.js",time:(new Date).getTime()}),Box.Application.addService("preview-api",function(e){"use strict";function t(e){var t="";return c.isGcm()?t="_gcm":c.isSharedFileEmbed()?t="_embed":(c.isSharedFilePage()||c.isSharedFolderPage()||c.isSharedFolderEmbed())&&(t="_shared"),e.replace("{pointOfView}",t)}function i(e){return function(){delete P[e]}}function n(e){e&&e.isPending()&&e.cancel()}function o(e,t){t=t||{},t.sharedName=c.getSharedName(),t.vanityName=c.getVanityName(),t.isSharedFilePage=c.isSharedFilePage(),t.isSharedFileEmbed=c.isSharedFileEmbed(),t.isSharedFolderPage=c.isSharedFolderPage(),t.isSharedFolderEmbed=c.isSharedFolderEmbed(),t.clientIsMobile=d,t.clientSupportsSWF=u,t.clientSupportsSVG=p,t.clientSupportsMP3=h,t.clientSupportsH264Baseline=m,t.clientSupportsMSE=f,t.clientSupportsDash=g,t.clientSupportsWebGL=v,t.clientSupportsPdfjs=b;var i=s.get();return i&&(t.sortType=i.sort,t.sortDirection=i.sortDirection),0===e.indexOf("file_version_")?t.fileVersionId=e.substr(13):t.fileId=e,t}function a(e,a,r){e+="",a=t(a),r=o(e,r);var s,c=r.isPrefetch?"prefetch_"+e:a;return n(P["prefetch_"+e]),n(P[c]),s=l.get(a,r),s.caught(i(c)).lastly(i(c)),P[c]=s,s}var r=e.getService("browser"),s=e.getService("nav-state"),l=e.getService("ajax"),c=e.getService("preview-nav"),_=e.getService("preview-cache"),d="iOS"===r.getOSName()||"Android"===r.getOSName(),u=r.hasMinimumFlashVersion(),p=r.hasSVGSupport(),h=r.canPlayMP3(),m=r.canPlayH264Baseline(),f=r.supportsMSE(),g=r.supportsDash(),v=r.supportsWebGL(),b=r.supportsPdfjs(),w="box_tasks_complete_task_assignment",y="box_tasks_delete_task_assignment",x="box_tasks_delete_task",S="box_tasks_edit_task",k="box_tasks_create_task",T="box_comments_create",j="box_comments_delete",C="box_files_update_item_info",$="preview{pointOfView}",A="preview_print_url{pointOfView}",E="preview_activity_feed{pointOfView}",B="preview_metadata{pointOfView}",I="crocodoc_status{pointOfView}",P={};return{getPrintUrl:function(){var e=_.recall("currentFile");return a(e.id,A,{fileVersionId:e.versionId})},getCrocodocStatus:function(){var e=_.recall("currentFile");return a(e.id,I,{fileVersionId:e.versionId})},getPreview:function(e,t){return a(e,$,t)},updatePreview:function(e){var t=_.recall("currentFile");return e.fileVersionId=t.versionId,a(t.id,$,e)},prefetchPreview:function(e){return a(e,$,{isPrefetch:!0,ignoreFolderContents:!0,referrerUrl:_.recall("currentFile").referrerUrl})},getSidebarActivityFeed:function(e){return a(e,E)},getSidebarMetadata:function(e){return a(e,B)},task:{remove:function(e){var t={task_id:e,is_from_sidebar:!0};return l.post(x,t)},reject:function(e,t){var i={item_typed_id:e,task_assignment_id:t,is_from_sidebar:!0};return l.post(y,i)},complete:function(e){var t={complete:"complete",task_assignment_id:e,is_from_sidebar:!0};return l.post(w,t)},edit:function(e,t,i,n,o){var a={task_id:e||null,item_typed_id:t,is_from_sidebar:1,description:i.message,message_mentioned:i.messageMentioned,assignment_emails:n,due:o||0,action:"review"};return l.post(S,a)},create:function(e,t,i,n){var o={task_id:null,item_typed_id:e,is_from_sidebar:1,description:t.message,message_mentioned:t.messageMentioned,assignment_emails:i,due:n||0,action:"review"};return l.post(k,o)},comment:function(e,t){var i={task_assignment_id:e,feedback:t.message,message_mentioned:t.messageMentioned,is_from_sidebar:!0};return l.post(w,i)}},comment:{create:function(e,t,i){var n={commentable_item_typed_id:e,message:t.message,message_mentioned:t.messageMentioned,get_updated_list:!0,show_all:!1,exclude_tasks:!1,is_from_sidebar:!0};return i&&(n.parent_comment_id=i),l.post(T,n)},reply:function(e,t,i){var n={commentable_item_typed_id:e,parent_comment_id:t,message:i.message,message_mentioned:i.messageMentioned,get_updated_list:!0,show_all:!1,exclude_tasks:!1,is_from_sidebar:!0};return l.post(T,n)},remove:function(e,t){var i={comment_id:t,commentable_item_typed_id:e,is_from_sidebar:!0};return l.post(j,i)}},properties:{update:function(e,t,i){var n={item_id:e,item_type:"file",field:t,value:i};return l.post(C,n)}}}}),Box.Timing.execution.push({name:"js/services/preview/preview-cache.js",time:(new Date).getTime()}),Box.Application.addService("preview-cache",function(){"use strict";function e(){var e,i=Object.keys(t);i.length>n&&(e=i.reduce(function(e,i){return t[e].lastAccessed>t[i].lastAccessed?i:e}),delete t[e])}var t={},i={},n=30,o="pending";return{add:function(i,n){var a,r=!!(i.content&&i.header&&i.sidebar);Object.keys&&(a=i.file.id,n!==o&&r?t[a]=i:delete t[a],e())},memorize:function(e,t){i[e]=t},remove:function(e){delete t[e]},fetch:function(e){return t[e]},recall:function(e){return i[e]},has:function(e){return!!t[e]},reset:function(){t={}},touch:function(e){this.has(e)&&(t[e].lastAccessed=(new Date).getTime())}}}),Box.Timing.execution.push({name:"js/services/preview/preview-logger.js",time:(new Date).getTime()}),Box.Application.addService("preview-logger",function(e){"use strict";function t(){var e,t=m?m.get("user_location"):h?h.userLocation:null;return d||(e=t||navigator.language||navigator.userLanguage||navigator.browserLanguage||"",e=e.split("-"),e=e[e.length-1],d=e.toUpperCase()),d}function i(e){p=!1,0===(e+"").indexOf("f_")&&(e=e.substr(2)),u={typedId:"f_"+e,file_id:e,requestStart:(new Date).getTime()}}function n(){if(!p){var e="lightbox";g.isSharedFileEmbed()?e="shared_file_embed":g.isSharedFolderEmbed()?e="shared_folder_embed":g.isSharedFilePage()?e="shared_file_page":g.isSharedFolderPage()?e="shared_folder_page":g.isGcm()&&(e="gcm");var i=$.extend({typedId:u.typedId||"",file_id:u.file_id||"",cached:u.cached?x:S,uniq_name:u.uniqueName,extension:u.extension||"",contentType:u.contentType||"",error:u.error||"",interrupted:u.interrupted?x:S,interrupt_reason:u.interrupt_reason?u.interrupt_reason:"",isConversionNeeded:u.isConversionNeeded?x:S,isFreshOpenPreview:0===u.prevNextNavCount?x:S,navigation_count:u.prevNextNavCount,preview_count:u.previewCount,country_code:t(),previewSource:e},w);u.interrupted?i.interruption_time=(new Date).getTime()-u.requestStart:"number"==typeof u.rendered&&"number"==typeof u.requestStart&&(i.total_load_time=u.rendered-u.requestStart),u={},f.sendLog(y,y,i),p=!0}}function o(e,t){e&&f.sendLog(y,"user_action",{typedId:"f_"+e.id,file_id:e.id,uniq_name:e.uniq_name||e.uniqueName,extension:e.extension,action:t,wasPreviewLoaded:p?x:S})}function a(e,t){e&&f.sendLog(y,"error",{typedId:"f_"+e.id,file_id:e.id,uniq_name:e.uniq_name||e.uniqueName,extension:e.extension,error:t,wasPreviewLoaded:p?x:S})}function r(e){p||(u.contentType="unknown",u.interrupt_reason=e,u.interrupted=!0,u.cached=v.has(u.typedId),n())}function s(e,t){var i=(new Date).getTime();switch(e.status){case"none":u.error="File type not supported",u.rendered=i,n();break;case"error":u.error="Error, likely a permission issue.",u.rendered=i,n()}}function l(e,t){u[e]=t}function c(e){return u[e]}function _(){return p}var d,u={},p=!1,h=e.getGlobalConfig(),m=e.getService("v5"),f=e.getService("logger"),g=e.getService("preview-nav"),v=e.getService("preview-cache"),b=e.getService("browser"),w={browser_name:b.getName(),browser_version:b.getVersion(),browser_swf:b.hasMinimumFlashVersion(),browser_svg:b.hasSVGSupport(),browser_mp3:b.canPlayMP3(),browser_mse:b.supportsMSE(),browser_dash:b.supportsDash(),browser_h264_baseline:b.canPlayH264Baseline(),browser_h264_main:b.canPlayH264Main(),browser_h264_high:b.canPlayH264High(),browser_webgl:b.supportsWebGL()},y="preview",x="true",S="false";return{log:n,fail:s,interrupt:r,action:o,error:a,init:i,add:l,fetch:c,hasLogged:_}}),Box.Timing.execution.push({name:"js/services/preview/preview-nav.js",time:(new Date).getTime()}),Box.Application.addService("preview-nav",function(e){"use strict";function t(){var t=e.getGlobal("location");return t.pathname}return{getSharedName:function(){var t=e.getGlobalConfig("sharedName"),i=e.getGlobal("shared_name");return t||i||null},getVanityName:function(){var t=e.getGlobalConfig("vanityName"),i=e.getGlobal("vanity_name");return t||i||null},isShared:function(){return"string"==typeof this.getSharedName()},isSinglePage:function(){return!!e.getGlobalConfig("singlePage")},isEmbed:function(){var t=!!e.getGlobalConfig("embed"),i=!!e.getGlobal("embed");return t||i},isSharedFilePage:function(){return this.isShared()&&this.isSinglePage()&&!this.isEmbed()},isSharedFolderPage:function(){return this.isShared()&&!this.isSinglePage()&&!this.isEmbed()},isSharedFileEmbed:function(){return this.isShared()&&this.isSinglePage()&&this.isEmbed()},isSharedFolderEmbed:function(){return this.isShared()&&!this.isSinglePage()&&this.isEmbed()},isSharedFilePageOrSharedFileEmbed:function(){return this.isSharedFilePage()||this.isSharedFileEmbed()},isGcm:function(){return 0===t().indexOf("/master/")}}}),Box.Timing.execution.push({name:"js/services/preview/preview-realtime.js",time:(new Date).getTime()}),Box.Application.addService("preview-realtime",function(e){"use strict";function t(e){return"pending"===e.status||"pdf"===e.kind||"filmstrip"===e.kind}function i(e,t){r>a&&(a++,n(e,t))}function n(r,s){o=$.getJSON(s),o.then(function(o){var l;try{l=JSON.parse(o.message)}catch(c){}l&&l.content&&"representation"===l.action&&r===l.content.file_id+""?(a=0,e.broadcast("previewprogress",l.content),t(l.content)&&n(r,s)):i(r,s)})}var o,a=0,r=2;return{poll:function(e,t){e&&t&&(a=0,this.abort(),n(e,t))},abort:function(){o&&"function"==typeof o.abort&&o.abort(),o=null}}}),Box.Timing.execution.push({name:"js/services/preview/widgets/preview-progress.js",time:(new Date).getTime()}),Box.Application.addService("preview-progress",function(e){"use strict";function t(t,i){clearTimeout(t.expireTimeoutId),t.expireTimeoutId=setTimeout(function(){e.broadcast("previewcontentreload",i)},s)}function i(e){var t=o.query(d,e.containerEl),i=o.query(u,t),n=o.query(m,t),a=o.query(g,t),r=o.query(".preview-progress-bar",a),s=l;e.time=0,o.removeClass(i,h),o.removeClass(a,p),o.setText(n,_),e.progressBarIntervalId=setInterval(function(){e.time+=(100-e.time)/s,s++,r.style.width=Math.min(e.time,100)+"%"},200)}function n(e){var t=a.getTemplateFragment("preview-progress",{initialLoadingText:c});this.containerEl=e,this.time=0,this.started=!1,this.progressBarIntervalId=null,this.expireTimeoutId=null,o.setHTML(this.containerEl,t)}var o=e.getService("dom"),a=e.getService("templates"),r=e.getService("preview-realtime"),s=5e3,l=20,c="",_=$t("Generating Preview...","preview_progress_converting"),d=".preview-progress",u=".loading-container",p="hidden",h="is-loading",m=".loading-text",f=".progress-download",g=".preview-progress-bar-container";return n.prototype={start:function(e,n){this.started?t(this,n):(this.started=!0,i(this),e.realtimeUrl?r.poll(e.id,e.realtimeUrl):t(this,n),e.permissions.download&&o.removeClass(o.query(f,this.containerEl),p))},end:function(){var e=o.query(d,this.containerEl),t=o.query(u,e),i=o.query(f,e),n=o.query(g,e),a=o.query(m,e);clearTimeout(this.expireTimeoutId),clearInterval(this.progressBarIntervalId),o.addClass(i,p),o.addClass(t,h),o.addClass(n,p),o.setText(a,"")},destroy:function(){clearInterval(this.progressBarIntervalId),clearTimeout(this.expireTimeoutId),this.containerEl&&o.remove(o.query(d,this.containerEl)),this.started=!1,delete this.containerEl}},{create:function(e){return new n(e)}}}),Box.Timing.execution.push({name:"js/services/amsterdam/fileops/fileop-favorites.js",time:(new Date).getTime()}),Box.Application.addService("fileop-favorites",function(e){"use strict";var t="add_to_favorites",i="remove_from_favorites",n="favorites",o=$t("Item added to Favorites.","fileop_favorites_add_to_favorite"),a=$t("Item removed from Favorites.","fileop_favorites_remove_from_favorite");return{add:function(i,a,r){var s=e.getService("ajax"),l=e.getService("resin"),c={itemTypedId:i};return r&&l.recordAction({application:"files",page:"explorer",component:"content",feature:n,target:r,action:"click"}),e.broadcast("favoritestarted"),s.post(t,c).then(function(){e.broadcast("favoritesuccess",c),a&&e.broadcast("itemupdated",c),e.getService("notifications-amsterdam").info(o)},function(){e.broadcast("favoriteerror",c)})},remove:function(t,o,r){var s=e.getService("ajax"),l=e.getService("resin"),c={itemTypedId:t};return r&&l.recordAction({application:"files",page:"explorer",component:"content",feature:n,target:r,action:"click"}),e.broadcast("unfavoritestarted"),s.post(i,c).then(function(){e.broadcast("unfavoritesuccess",c),o&&e.broadcast("itemupdated",c),e.getService("notifications-amsterdam").info(a)},function(){e.broadcast("unfavoriteerror",c)})}}}),Box.Timing.execution.push({name:"js/services/amsterdam/fileops/fileop-upload.js",time:(new Date).getTime()}),Box.Application.addService("fileop-upload",function(e){"use strict";var t=e.getService("v5");return{uploadFileNewVersion:function(i){var n=e.getGlobal("Item");n&&n.find_async("f_"+i).then(function(i){if(i){var n,o=t.get("Upload_Process");"default"===o.get_type()?(n=e.getService("upload-process"),n&&n.showAjaxEolMessage()):o.show_upload_new_version_popup({file:i,show_toaster:!0})}})}}}),Box.Timing.execution.push({name:"js/services/amsterdam/fileops/fileop-versions.js",time:(new Date).getTime()}),Box.Application.addService("fileop-versions",function(e){"use strict";var t=e.getService("ajax"),i=e.getService("promises"),n="version_history_make_current",o="version_history_remove",a="version_history_restore";return{showVersionsPopup:function(t){var i=e.getGlobal("Item");i&&i.find_async("f_"+t).then(function(e){
e&&e.version_history()})},makeCurrentVersion:function(e){return t.post(n,{fileVersionId:e}).then(function(e){return i.createResolved(e)},function(e){return i.createRejected(e)})},removeVersion:function(e,n){return t.post(o,{fileId:e,fileVersionId:n}).then(function(e){return i.createResolved(e)},function(e){return i.createRejected(e)})},restoreVersion:function(e,n){return t.post(a,{fileId:e,fileVersionId:n}).then(function(e){return i.createResolved(e)},function(e){return i.createRejected(e)})}}}),Box.Timing.execution.push({name:"js/modules/preview/preview.js",time:(new Date).getTime()}),Box.Application.addModule("preview",function(e){"use strict";function t(){return G||(G=U.debounce(function(){e.broadcast("previewresized")},je)),G}function i(){Ee.title=se.isSharedFilePage()?$t("%1 - File Shared from Box","preview_document_title_shared",z.fullName):$t("%1 - Box","preview_document_title",z.fullName)}function n(){ae&&ae.hideAll()}function o(){$.popup&&$.popup.close(),$.datepicker&&$.datepicker._hideDatepicker(),ie&&ie.hide()}function a(){var e;return H||(H=U.throttle(function(){clearTimeout(e),D.addClass(pe,Te),e=setTimeout(function(){D.removeClass(pe,Te)},Ce)},Ce-500,!0)),H}function r(){te&&(te.destroy(),te=null)}function s(){D.removeClass(pe,"hidden"),D.addClass(fe,"no_scroll has_lightbox"),D.on(Ae,"resize",t()),D.on(O,"mousemove",a()),ge=Ee.title,me.memorize("currentFile",void 0),Q=!0}function l(){Q&&(n(),o(),D.addClass(pe,"hidden"),D.removeClass(fe,"no_scroll has_lightbox"),D.off(Ae,"resize",t()),D.off(N,"mousemove",a()),he&&(X.setSearchFilters(he),he=null),ce.interrupt("close"),Pe=0,ne&&ne.unsetConfig(xe),r(),D.setHTML(N,""),D.setHTML(V,""),Ee.title=ge,me.memorize("currentFile",void 0),clearTimeout(J),Q=!1)}function c(t,i){if(!se.isSharedFilePageOrSharedFileEmbed())if(t||(t="/files"),l(),e.hasService("navigation")){var n=e.getService("navigation");i?n.navigate(t,null,{reload_page_after_preview:!0}):n.navigate(t)}else re.redirect(t)}function _(){return e.getGlobalConfig("singlePage")||X.isGcmQuarantinePreview()||X.isSearch()||X.isGcmSearch()||se.isSharedFilePageOrSharedFileEmbed()}function d(e){var t,i,n;t=_()?Be:K.files,D.addClass(L,ke),D.addClass(q,ke),i=$.inArray(e,t),n=$.inArray(e,Be),n>-1&&t&&t.length>0&&(0!==i&&D.removeClass(L,ke),i!==t.length-1&&D.removeClass(q,ke))}function u(t,i){return function(){n(),"string"==typeof t.header&&i.updateHeader&&D.setHTML(W,t.header),"string"==typeof t.footer&&(D.setHTML(Y,t.footer),t.status===ye&&D.addClass(Y,"has-large-logo")),"string"==typeof t.content&&i.updateContent&&(D.setHTML(N,t.content),e.broadcast("previewcontentupdated")),"string"==typeof t.sidebar&&i.updateSidebar&&D.setHTML(V,t.sidebar),d(t.file.id)}}function p(t,i){if(!i.prefetching){var n,o=e.hasService("postload")?e.getService("postload"):null;o?(n=o.getCompletionPromise(),n.isFulfilled()?u(t,i)():n.then(u(t,i))):u(t,i)()}}function h(){te||(te=ee.create(R)),D.setHTML(N,"")}function m(t,i){var n=t.file,a=me.fetch(n.id)||{},r={file:n,content:t.content_html||a.content,header:t.header_html||a.header,footer:t.footer_html,sidebar:t.sidebar_html||a.sidebar,lastAccessed:(new Date).getTime(),status:t.status||a.status};i.updateContent=!(i.prefetching||a.file&&a.file.uniqueName===r.file.uniqueName&&a.status===r.status),i.updateHeader=!i.prefetching&&a.header!==r.header,i.updateSidebar=!i.prefetching&&a.sidebar!==r.sidebar,i.updateContent&&a.content&&(a.status!==ve||r.status!==ve&&r.status!==be||(ie.warn($t("A new version of this file is available. Would you like to refresh the page?","item_notification_new_version_refresh"),{containerNode:".preview-notification",action:{text:$t("Yes","js_Yes"),onclick:function(){o(),e.broadcast("previewcontentreload")}}}),i.updateContent=!1)),i.prefetching&&t.imgUrl&&!a.content&&(Ee.createElement("img").src=t.imgUrl),r.file.isCurrent&&(i.fileId?-1===i.fileId.indexOf("file_version_"):!0)&&me.add(r,t.status),p(r,i)}function f(t){var i=$t("An error occurred while loading Preview. Please try again later.","preview_server_error");return function(n){t||n instanceof de.CancellationError||(r(),e.getGlobalConfig("debug")&&(i=n.data||n.message||"Unknown Error"),c(),ie.error(i,{action:{text:$t("Reload page","preview_error_reload"),onclick:function(){e.getService("navigation").navigate("")}}}))}}function g(e){m(e.data,{prefetching:!0})}function v(e,t){var i,n,o,a=D.queryAll('[data-module="item-list"] [data-type="item-row"]'),r=a.length,s=!1,l=0,c=Be;for(0===r&&(a=D.queryAll('[data-module="item-list-gcm"] [data-type="item-row"]'),r=a.length),Be=[],o=0;r>o;o++)n=a[o],0===n.getAttribute("data-typed-id").indexOf("f_")&&(Be.push(n.getAttribute("data-typed-id").substr(2)),s=s||Be[l]!==c[l],l++);return i=$.inArray(e,t),0>i&&(s=!0),s}function b(e,t){var i=t?me.recall("d_"+t.file.folder.id):[],n=v(e,i),o=!n;return o||_()}function w(){var e,t,i,n=$.inArray(z.id,Be),o=f(!0);if(Object.keys&&!se.isSharedFilePageOrSharedFileEmbed()&&Be.length>1&&n>-1){for(e=1;Ie>=e;e++)t=Be[n+e],t&&!me.has(t)&&oe.prefetchPreview(t).then(g,o).caught(o);for(e=1;Ie>=e&&De;e++)i=Be[n-e],i&&!me.has(i)&&oe.prefetchPreview(i).then(g,o).caught(o)}}function y(t,n){return function(t){var o=t.data;switch(Me=Me&&o.shouldShowTour,z=o.file,K=z.folder,z.referrerUrl=n.referrerUrl||void 0,me.memorize("currentFile",z),K.files&&K.files.length>0?(K.files=Z.map(K.files,function(e){return e+""}),me.memorize("d_"+K.id,K.files)):K.files=me.recall("d_"+K.id),n.firstLoad&&ce.add("isConversionNeeded",o.status===be),m(o,n),o.status){case ve:te&&te.end();break;case be:te&&te.start(z,n);break;case we:case ye:e.broadcast("previewloaded",{contentType:o.status})}n.firstLoad&&(i(),w())}}function x(e){var t,i=X.get();return t=X.isGcmSearch()?_e.getGcmUrlForSearchPreview(i.searchString,i.page,e):X.isGcm()?_e.getGcmUrlForPreview(i.gcmUserId,i.id,i.page,e):_e.getFileUrlForPreview(e)}function S(e,t){var i,n=X.get(),o=parseInt(n.page,10)+t;return o=0>o?0:o,i=X.isGcmSearch()?_e.getGcmUrlForSearchPreview(n.searchString,o,e):X.isGcm()?_e.getGcmUrlForPreview(n.gcmUserId,n.id,o,e):_e.getFileUrlForPreview(e,o)}function k(t){ce.interrupt("prev_next");var i,n,o,a,r,s,l,c,_,d,u,p,h=!1;clearTimeout(J),r=Be.length,n=z?$.inArray(z.id,Be):-1,r>0&&-1!==n&&(l=Be[0],c=Be[r-1],o=n+t,s=K.files,s&&(_=$.inArray(l,s),d=$.inArray(c,s),u=s[d+1],p=s[_-1]),0>o&&!p?o=0:o>=r&&!u&&(o=r-1),0>t&&o>=0||t>0&&r>o?(a=Be[o],i=x(a)):(a=0>t?p:u,i=S(a,t),z&&z.id===a||(Be=[],h=!0)),z&&z.id===a||(D.removeClass(pe,"is-scrollbar-visible"),De=0>t,Pe++,me.memorize("currentFile",void 0),e.getService("navigation").navigate(i,null,{switchUnderlyingPage:h})))}function T(){var e=[];return se.isSharedFilePageOrSharedFileEmbed()||(e=e.concat([{key:"j",handler:function(){k(-1),M.recordAction({application:"files",page:xe,component:"",feature:"hotkeys",target:"prevpreview",action:Se})}},{key:"k",handler:function(){k(1),M.recordAction({application:"files",page:xe,component:"",feature:"hotkeys",target:"nextpreview",action:Se})}},{key:"left",handler:function(){k(-1),M.recordAction({application:"files",page:xe,component:"",feature:"hotkeys",target:"prevpreview",action:Se})}},{key:"right",handler:function(){k(1),M.recordAction({application:"files",page:xe,component:"",feature:"hotkeys",target:"nextpreview",action:Se})}}])),e}function j(){ne.setConfig([{key:"right",handler:function(){k(1),M.recordAction({application:"files",page:xe,component:"",feature:"nextpreview",target:"close",action:Se})}},{key:"left",handler:function(){k(-1),M.recordAction({application:"files",page:xe,component:"",feature:"prevpreview",target:"close",action:Se})}}],xe)}function C(){var e=null;try{e=Ee.activeElement}catch(t){e=Ee.body}return e}function A(){var e=D.query('[data-type="accessibility-helper-top"]'),t=D.query('[data-type="accessibility-helper-bottom"]');D.on(t,"focus",function(){var e=D.query($e,W);e&&e.focus()}),D.on(e,"focus",function(){var e=$(pe).find($e).filter(':not([data-type="accessibility-helper-bottom"]):visible:last')[0];e&&e.focus()})}function E(e,t){if(!e)return c(),void ie.error($t("This file cannot be found or you do not have access to this file.","preview_error_file_not_found"));t=t||{};var i,n=f(),a=C(),r={fileId:e,referrerUrl:t.referrerUrl||void 0,firstLoad:!0};ce.init(e),ce.add("previewCount",Fe),ce.add("prevNextNavCount",Pe),he=t.searchFilters||he||null,a&&"BODY"!==a.nodeName&&"function"==typeof a.blur&&a.blur(),h(),j(),Q||(s(),ne.setConfig(T(),xe,!1)),o(),me.has(e)&&(ce.add("cached",!0),me.touch(e),i=me.fetch(e),z=i.file,K=z.folder,me.memorize("currentFile",z),p(i,{updateContent:!0,updateSidebar:!0,updateHeader:!0})),r.ignoreFolderContents=b(e,i),oe.getPreview(e,r).then(y(e,r),n).caught(n),"function"==typeof W.focus&&W.focus()}function B(e,t){if(Q){t=t||{};var i=f(),n={referrerUrl:z.referrerUrl,ignoreFolderContents:!0};switch(e){case"previewfilenamechanged":case"favoritesuccess":case"unfavoritesuccess":case"favoriteerror":case"unfavoriteerror":n.ignoreContent=!0,n.ignoreSidebar=!0;break;case"filelocked":case"fileunlocked":n.ignoreContent=!0;break;case"previewcontentreload":n.ignoreHeader=!0,n.ignoreSidebar=!0,n.isFlashFallback=t.isFlashFallback||void 0,n.isNativeVideoFallback=t.isNativeVideoFallback||void 0,h()}oe.updatePreview(n).then(y(z.id,n),i).caught(i)}}function I(t){function i(){e.broadcast("previewresized")}t?D.addClass(pe,"is-preview-sidebar-visible",i):D.removeClass(pe,"is-preview-sidebar-visible",i)}function P(){var t=e.hasService("tours")?e.getService("tours"):null,i=D.getBoundingClientRect(Ee.documentElement);t&&Me&&i.height>=600&&i.width>=1e3&&t&&null===t.getCurrentTourName()&&(t.start("preview"),Me=!1)}function F(e){r(),Fe++,ce.add("previewCount",Fe),ce.add("contentType",e),ce.add("rendered",(new Date).getTime()),ce.add("uniqueName",z.uniqueName),ce.add("extension",z.extension),ce.log(),M.recordAction({application:"files",page:xe,component:"",feature:e,target:"loaded",action:Se}),J=setTimeout(function(){M.recordAction({application:"files",page:xe,component:"",feature:e,target:"longdwell",action:Se})},5e3),P()}var D,M,O,N,R,L,q,U,G,H,V,W,Y,z,K,Q,J,X,Z,ee,te,ie,ne,oe,ae,re,se,le,ce,_e,de,ue,pe,he,me,fe,ge,ve="success",be="pending",we="error",ye="none",xe="preview",Se="keypress",ke="hidden",Te="is-preview-navigation-visible",je=500,Ce=1500,$e="input, textarea, button, select, a[href]",Ae=e.getGlobal("window"),Ee=Ae.document,Be=[],Ie=0,Pe=0,Fe=0,De=!1,Me=!0;return{behaviors:["tooltips-amsterdam","preview-download","preview-embed-scrolling"],messages:["previewloaded","previewaction","previewerror","previewready","previewshownext","previewfilenamechanged","previewcontentresized","previewcontentreload","previewcontentunload","previewtogglesidebar","previewcloseandnavigatetourl","filelocked","fileunlocked","favoritesuccess","unfavoritesuccess","favoriteerror","unfavoriteerror"],onmessage:function(e,t){var i;switch(e){case"previewshownext":k(1);break;case"previewaction":this.handleUserAction(t);break;case"previewerror":ce.error(z,t.errorType);break;case"previewcontentreload":i=me.fetch(z.id),i&&(i.file=null,i.content=null),B(e,t);break;case"previewfilenamechanged":case"filelocked":case"fileunlocked":case"favoritesuccess":case"unfavoritesuccess":case"favoriteerror":case"unfavoriteerror":B(e);break;case"previewloaded":F(t.contentType);break;case"previewready":r();break;case"previewcontentresized":t.isScrollbarVisible?D.addClass(pe,"is-scrollbar-visible"):D.removeClass(pe,"is-scrollbar-visible");break;case"previewcontentunload":ue.abort();break;case"previewtogglesidebar":I(t.showSidebar);break;case"previewcloseandnavigatetourl":c(t.url,t.reloadUnderlyingPage)}},init:function(){var t,i;pe=e.getElement(),_e=e.getService("nav-url"),D=e.getService("dom"),M=e.getService("resin"),U=e.getService("function-utils"),ue=e.getService("preview-realtime"),X=e.getService("nav-state"),ie=e.getService("notifications"),ce=e.getService("preview-logger"),ne=e.getService("hotkeys"),ee=e.getService("preview-progress"),oe=e.getService("preview-api"),me=e.getService("preview-cache"),de=e.getService("promises"),ae=e.getService("tooltips-amsterdam"),se=e.getService("preview-nav"),re=e.getService("nav"),le=e.hasService("office-online")?e.getService("office-online"):null,Z=e.getService("array-utils"),Ie=e.getGlobalConfig("previewPrefetchCount"),le&&!se.isSharedFilePageOrSharedFileEmbed()&&le.init(),W=D.query(".preview-header-container",pe)||D.query(".preview-embed-widget-header-controls-wrapper",pe),Y=D.query(".preview-embed-widget-footer-controls-wrapper",pe),O=D.query(".preview-content",pe),N=D.query(".preview-representation",O),V=D.query(".preview-sidebar",pe),R=D.query(".progress-widget",O),fe=D.query("body"),L=D.query(".preview-navigate-left",O),q=D.query(".preview-navigate-right",O),A(),t=pe.getAttribute("data-file-id"),i=pe.getAttribute("data-file-version-id"),i?E("file_version_"+i):t&&E(t),D.getBoundingClientRect(Ee.body).width>799&&D.addClass(pe,"is-preview-sidebar-visible")},handleUserAction:function(e){switch(e.action){case"show":E(e.fileId,e);break;case"close":l();break;case"invalidatecache":me.remove(e.fileId)}},onclick:function(e,t,i){if(t&&i&&!t.disabled)switch(n(),i){case"preview-show-next":k(1),e.preventDefault();break;case"preview-show-previous":k(-1),e.preventDefault()}}}}),Box.Timing.execution.push({name:"js/behaviors/pending-collab-menu.js",time:(new Date).getTime()}),Box.Application.addBehavior("pending-collab-menu",function(e){"use strict";function t(){d&&u&&d.destroy(),u&&u.parentNode.removeChild(u),u=null}function i(i,n,o,a){d&&t();var r=e.getService("templates"),s=r.getTemplateFragment("pending-collab-menu",{userEmail:n,collabId:o,dateInvited:a});u=h.getFirstElementChild(s);var l=h.getNearest(i,".collabs-container");l?l.appendChild(s):i.parentNode.appendChild(s),d=e.getService("menus").create(u),d.init()}function n(){var t="",i=h.query(".collabs-container",e.getElement());return i&&"1"===i.getAttribute("data-is-collabed")&&(t=i.getAttribute("data-folder-typed-id")),t}function o(t,i,n,o){e.broadcast(t,{message:i,collabId:o,context:n})}function a(e,t,i){o(e,t,m,i)}function r(t,i){var n=$t("You have removed %1 as a collaborator on this folder.","collaborate_confirmation_remove_collab",t);a("collabremoved",n,i),e.broadcast("x-collabchange")}function s(t,i){var n=e.getService("popups");n.open(x,{data:{collabId:t,currentFolderId:i}})}function l(t){var i=e.getService("popups");i.confirm($t("You can only modify this collaboration record through the parent folder, since collaboration is inherited from it.","collab_update_inherited_collab_record_confirmation_message"),{onconfirm:function(){s(t,n())},confirmText:$t("Take Me There","js_popup_button_take_me_there"),isBlocking:!0})}function c(e,t,i){var o=p.getGcmCompatibleRmUrl(w),s=n(),c={collabId:t,folderTypedId:s,ignoreTaskWarning:i?!0:!1,ignoreInheritanceCheck:"popup"===m};$.postJSON(o,c,function(i){if(i.success)return void r(e,t);switch(i.code){case"inheritedCollab":l(t);break;default:a("collabremoveerror",i.message,t)}})}function _(e,t){var i=p.getGcmCompatibleRmUrl(y),n=$.box.formatQuery({collab_id:t});$.postJSON(i,n,function(t){t.error?a("collabinviteresenderror",$t("There was an error resending the collaboration invite.","collaborate_resend_invite_error")):a("collabinviteresent",$t("You resent a collaboration invite to %1","collaborate_resend_invite_success",e))})}var d,u,p,h,m,f="bottom left",g={x:-51,y:13},v=223,b=68,w="delete_collab_by_folder_and_collab",y="box_collaborate_resend_collab_invite_email",x="show_collab_details_popup";return{init:function(){m=e.getConfig().context,p=e.getService("url"),h=e.getService("dom")},destroy:function(){p=null,h=null,t()},onclick:function(e,t,i){if(t&&!h.hasClass(t,"disabled")){var n=t.getAttribute("data-user-email"),o=t.getAttribute("data-collab-id"),a=parseInt(t.getAttribute("data-is-updatable"),10),r=t.getAttribute("data-date-invited");if(a){switch(i){case"pending-collab-menu-btn":d&&d.isOpen()?this.hideMenu():this.showMenu(t,n,o,r);break;default:return}e.preventDefault(),e.stopPropagation()}}},handleMenuClick:function(e,t){var i=e.parentNode.getAttribute("data-user-email"),n=e.parentNode.getAttribute("data-collab-id");if(e&&!h.hasClass(e,"disabled")){switch(t){case"resend-invite":_(i,n);break;case"remove-user":c(i,n)}this.hideMenu()}},showMenu:function(e,t,n,o){i(e,t,n,o),this.bindMenuSelectEvent(),d.showWithBeak(e,f,g,v,b)},hideMenu:function(){d.hide(),this.unbindMenuSelectEvent(),t()},bindMenuSelectEvent:function(){var e=this;d.on("menuselect",function(t){var i=t.data.targetElement;e.handleMenuClick(i,i.getAttribute("data-type"))})},unbindMenuSelectEvent:function(){d.off("menuselect")}}}),Box.Timing.execution.push({name:"js/behaviors/role-change-menu.js",time:(new Date).getTime()}),Box.Application.addBehavior("role-change-menu",function(e){"use strict";function t(){var t="";switch(B){case te:t=e.getElement().getAttribute("data-folder-typed-id");break;default:var i=e.getService("dom").query(".collabs-container",e.getElement());i&&"1"===i.getAttribute("data-is-collabed")&&(t=i.getAttribute("data-folder-typed-id"))}return t}function i(e){switch(e){case I:return $t("Owner","owner");case P:return $t("Co-owner","co_owner");case F:return $t("Editor","editor");case D:return $t("Viewer Uploader","viewer_uploader");case M:return $t("Previewer Uploader","previewer_uploader");case O:return $t("Viewer","viewer");case N:return $t("Previewer","previewer");case R:return $t("Uploader","uploader")}}function n(e){var t='[data-role-id="'+e+'"]',i=j.query(t,A);j.addClass(i,"selected")}function o(){C&&A&&(C.destroy(),C=null),A&&A.parentNode.removeChild(A),A=null}function a(t,i,a,r,s,l,c,_){C&&o();var d,u=e.getService("templates");if(l||c||!_){var p=l?"true":"false";d=u.getTemplateFragment("role-change-menu-without-owner",{displayName:i,collabId:r,isCurrentUser:s,isGroup:p})}else d=u.getTemplateFragment("role-change-menu",{userEmail:i,collabId:r,isCurrentUser:s});A=j.getFirstElementChild(d),n(a);var h=j.getNearest(t,".collabs-container");h?h.appendChild(d):t.parentNode.appendChild(d),C=e.getService("menus").create(A),C.init()}function r(t,i,n,o){e.broadcast(t,{message:i,collabId:o,context:n})}function s(e,t,i){r(e,t,B,i)}function l(t){var i=$t("Are you sure you want to remove yourself as a collaborator? You will no longer have access to content in this folder or its sub-folders and will not be able to complete pending tasks.","task_affected_current_user_removal_warning"),n=e.getService("popups");n.confirm(i,{onconfirm:function(){m(!0,t)},oncancel:function(){e.broadcast("collabchangecanceled")}})}function c(t,i){i||(i=""),e.getService("navigation").navigate(i,{},{callback:function(){e.getService("popups").close(),e.getService("notifications").confirm(t)}})}function _(t,i,n){var o=$t("You have removed %1 as a collaborator on this folder.","collaborate_confirmation_remove_collab",t);s("collabremoved",o,i),e.broadcast("x-collabchange"),n&&e.getService("notifications").confirm(o)}function d(t,i,n){var o=$t("Are you sure you want to remove %1 as a collaborator?  %2 will no longer be able to complete pending tasks in this folder.","task_affected_removal_warning",t,t),a=e.getService("popups");a.confirm(o,{onconfirm:function(){f(t,i,!0,n)},oncancel:function(){e.broadcast("collabchangecanceled")}})}function u(t,i){var n=e.getService("popups");n.open(Q,{data:{collabId:t,currentFolderId:i}})}function p(i){var n=e.getService("popups");n.confirm($t("You can only modify this collaboration record through the parent folder, since collaboration is inherited from it.","collab_update_inherited_collab_record_confirmation_message"),{onconfirm:function(){e.broadcast("collabchangecanceled"),u(i,t())},oncancel:function(){e.broadcast("collabchangecanceled")},confirmText:$t("Take Me There","js_popup_button_take_me_there"),isBlocking:!0})}function h(){var t=e.getService("popups"),i=$t("You cannot modify your collaboration settings in a subfolder of a collaborated folder. Please visit the parent folder you are collaborated in to make any changes.","modify_own_collab_settings_error_due_to_inherited_collab");t.alert(i,{onclose:function(){e.broadcast("collabchangecanceled")}})}function m(i,n){var o=e.getService("url").getGcmCompatibleRmUrl(K);n||(n=t());var a={folderTypedId:n,ignoreTaskWarning:!!i,ignoreInheritanceCheck:"popup"===B};$.postJSON(o,a,function(e){if(e.success){var t=$t("You have removed yourself as a collaborator.","collaborate_confirmation_remove_self_as_collab");return void c(t,"/files")}switch(e.code){case X:h();break;case Z:l(n);break;default:s("collabremoveerror",e.message)}})}function f(i,n,o,a){var r=e.getService("url").getGcmCompatibleRmUrl(z),l="popup"===B,u=o&&l;a||(a=t());var h={collabId:n,folderTypedId:a,ignoreTaskWarning:!!o,ignoreInheritanceCheck:l};$.postJSON(r,h,function(e){if(e.success)if(e.isCurrentUserGroupCollab){var t=$t("You have removed your group from the folder.","collab_remove_user_group_collab");c(t,"/files")}else _(i,n,u);else switch(e.code){case ee:p(n);break;case Z:d(i,n,a);break;default:s("collabremoveerror",e.message,n)}})}function g(t,i){var n=$t("Are you sure you want to change your role? You may no longer be able to complete pending tasks in this folder.","task_affected_current_user_warning"),o=e.getService("popups");o.confirm(n,{onconfirm:function(){w(t,!0,i)},oncancel:function(){e.broadcast("collabchangecanceled")}})}function v(t,i,n,o){var a=$t("Are you sure you want to change %1's role?  %2 may no longer be able to complete pending tasks in this folder.","task_affected_warning",t,t),r=e.getService("popups");r.confirm(a,{onconfirm:function(){b(t,i,n,!0,o)}})}function b(n,o,a,r,l){var _=e.getService("url").getGcmCompatibleRmUrl(V),d="popup"===B,u=d&&r;l||(l=t());var h={folderTypedId:l,collabId:o,newRoleId:a,ignoreTaskWarning:!!r,ignoreInheritanceCheck:"popup"===B};$.postJSON(_,h,function(t){if(!t.success){switch(t.code){case Z:return void v(n,o,a,l);case ee:return void p(o)}return void s("collabrolechangeerror",t.message,o)}var r="",_=i(a);t.isCurrentUserGroupCollab?(r=$t("You have changed your group to %1 role.","changed_user_group_role_success",_),c(r)):(r=$t("You have changed %1 to %2 role.","changed_collab_role_success",n,_),s("collabrolechanged",r,o),e.broadcast("x-collabchange"),u&&e.getService("notifications").confirm(r))})}function w(n,o,a){var r=e.getService("url").getGcmCompatibleRmUrl(W);a||(a=t());var l={folderTypedId:a,newRoleId:n,ignoreTaskWarning:o?!0:!1,ignoreInheritanceCheck:"popup"===B};$.postJSON(r,l,function(e){if(!e.success){switch(e.code){case Z:return void g(n,a);case X:return void h()}return void s("collabrolechangeerror",e.message)}var t=i(n),o=$t("You have changed your role to %1","changed_your_role_success",t);c(o)})}function y(t){var i=$t("You have made %1 the owner of the folder","changed_folder_owner_to_collab",t);e.getService("navigation").navigate("",{},{callback:function(){e.getService("notifications").confirm(i)}})}function x(t,i,n,o){var a=e.getService("url").getGcmCompatibleRmUrl(Y),s={folderTypedId:i,newOwnerEmail:t};$.postJSON(a,s,function(i){i.success?y(t):(r("folderownertransfererror",i.message,n),o.showNotificationsAfterClose&&e.getService("notifications").error(i.message))})}function S(i,n){var o=e.getService("popups"),a=t(),r=e.getConfig(),s=function(e,t){return function(){x(n,e,t,r)}}(a,B,r);o.confirm(i,{onconfirm:s,oncancel:function(){e.broadcast("collabchangecanceled")}})}function k(e){var i=E.getGcmCompatibleRmUrl(J),n=t(),o={folderTypedId:n,newOwnerEmail:e};$.postJSON(i,o,function(t){t.success?S(t.message,e):s("folderownertransfererror",t.message)})}function T(){var e=j.queryAll("li:not(.separate-last,.ui-menu-divider)",A).length;if(0===e){var t=j.query(".ui-menu-divider",A);A.removeChild(t);var i=j.query(".separate-last");j.removeClass(i,"separate-last"),j.addClass(i,"only-option")}}var j,C,A,E,B,I="owner",P="15",F="7",D="17",M="13",O="3",N="9",R="11",L="remove",q="bottom left",U={x:-51,y:13},G=223,H=68,V="update_collab_role_by_item_and_email",W="update_current_user_collab_role_by_item_and_email",Y="change_folder_ownership_by_item_and_email",z="delete_collab_by_folder_and_collab",K="delete_current_user_collab_by_folder",Q="show_collab_details_popup",J="get_change_folder_confirm_message",X="collabNotFound",Z="taskAffected",ee="inheritedCollab",te="detailsOnly";return{init:function(){B=e.getConfig().context,j=e.getService("dom"),E=e.getService("url")},destroy:function(){o(),j=null,E=null},onclick:function(e,t,i){if(t&&!j.hasClass(t,"disabled")){var n=t.getAttribute("data-user-email"),o=parseInt(t.getAttribute("data-is-updatable"),10),a=t.getAttribute("data-role-id"),r=t.getAttribute("data-collab-id"),s=t.getAttribute("data-is-current-user"),l=t.getAttribute("data-is-group"),c=t.getAttribute("data-group-name"),_=t.hasAttribute("data-is-pending"),d=t.getAttribute("data-is-owner-changeable");if(1===o&&a){switch(i){case"role-change-menu-btn":C&&C.isOpen()?this.hideMenu():this.showMenu(t,l?c:n,a,r,s,l,_,d);break;default:return}e.preventDefault(),e.stopPropagation()}}},handleMenuClick:function(i,n){var o=i.parentNode,a=o.getAttribute("data-user-email"),r=o.getAttribute("data-collab-id"),s="true"===o.getAttribute("data-is-current-user"),c="true"===o.getAttribute("data-is-group"),_=o.getAttribute("data-group-name"),d=c?_:a;if(i&&!j.hasClass(i,"disabled"))switch(e.broadcast("collabchangeinitiated"),this.hideMenu(),n){case I:k(a);break;case L:s?l(t()):f(d,r);break;default:s?w(n):b(d,r,n)}},bindMenuSelectEvent:function(){var e=this;C.on("menuselect",function(t){var i=t.data.targetElement;e.handleMenuClick(i,i.getAttribute("data-role-id"))})},unbindMenuSelectEvent:function(){C.off("menuselect")},showMenu:function(e,t,i,n,o,r,s,l){a(e,t,i,n,o,r,s,l),T(),this.bindMenuSelectEvent(),C.showWithBeak(e,q,U,G,H)},hideMenu:function(){C.hide(),this.unbindMenuSelectEvent(),o()}}}),Box.Timing.execution.push({name:"js/modules/sidebar/collab.js",time:(new Date).getTime()}),Box.Application.addModule("collab",function(e){"use strict";function t(){var t=r.query(".collabs-container",e.getElement()),i="";return t&&(i=t.getAttribute("data-folder-typed-id")),i}function i(){var e=t();return e?e.substr(2):""}function n(){var e=r.query(".sidebar-collab-spinner-container");e&&(r.addClass(e,"is-displayed"),r.removeClass(e,"hidden"))}function o(){var e=r.query(".sidebar-collab-spinner-container");e&&(r.removeClass(e,"is-displayed"),r.addClass(e,"hidden"))}function a(){var t=e.getService("ajax"),n=s.getGcmCompatibleRm(_),a={folderId:i()};t.get(n,a,{success:function(t){var i=e.getElement();r.setHTML(i,t.data.html),o()},error:function(){var e=$t("Failed to load collabs.","failed_to_load_collabs");l.alert(e)}})}var r,s,l,c,_="box_get_collab_sidebar_module_contents",d="collaborate",u="mail_all_collaborators",p="show_collabs_by_folder",h="show_collab_details_popup";return{behaviors:["role-change-menu","pending-collab-menu"],messages:["x-collabchange","collabchangeinitiated","collabchangecanceled","collabinviteresent","collabremoved","collabrolechanged","collabremoveerror","collabinviteresenderror","collabrolechangeerror","folderownertransfererror"],init:function(){r=e.getService("dom"),s=e.getService("url"),l=e.getService("popups"),c=e.getService("notifications")},destroy:function(){r=null,s=null,l=null,c=null},onmessage:function(t,i){var r=i&&i.context===e.getConfig().context;switch(t){case"x-collabchange":i&&i.doNotRefresh||a();break;case"collabinviteresent":case"collabremoved":case"collabrolechanged":r&&c.confirm(i.message);break;case"collabremoveerror":case"collabinviteresenderror":case"collabrolechangeerror":case"folderownertransfererror":r&&c.error(i.message),o();break;case"collabchangeinitiated":n();break;case"collabchangecanceled":o()}},onclick:function(e,i,n){if(i&&!r.hasClass(i,"disabled")){switch(n){case"invite-more-users-btn":this.showInviteCollaboratorsPopup();break;case"more-collabs-link":this.showMoreCollaboratorsPopup(i);break;case"collab-expiration-btn":var o=i.getAttribute("data-collab-id");this.showCollabDetailsPopup(o,t());break;case"mail-all-btn":this.mailAllCollaborators();break;case"collab-details-link":this.showMoreCollaboratorsPopup(i);break;default:return}e.preventDefault(),e.stopPropagation()}},showInviteCollaboratorsPopup:function(){var e=t();e&&l.open(d,{data:{typed_id:e}})},showMoreCollaboratorsPopup:function(t){var n=i();if(n){var o=t.getAttribute("data-collab-id")||"-1",a=t.getAttribute("data-collab-type");e.getService("logger").sendLog("collab","OPEN_COLLAB_POPUP",{context:"item_menu",content:"redesign"}),l.open(p,{data:{folderId:n,collabId:o,collabType:a}})}},showCollabDetailsPopup:function(e,t){l.open(h,{data:{collabId:e,currentFolderId:t}})},mailAllCollaborators:function(){var e=i();e&&l.open(u,{data:{folderId:e}})}}}),Box.Timing.execution.push({name:"js/modules/sidebar/share.js",time:(new Date).getTime()}),Box.Application.addModule("share",function(e){"use strict";function t(){var t=r.query(".sidebar-share-spinner-container",e.getElement());r.addClass(t,"is-displayed"),r.addClass(e.getElement(),"is-loading")}function i(){r.removeClass(e.getElement(),"is-loading")}function n(){var n=s.getGcmCompatibleRm(p),o={itemTypedId:_};t(),l.get(n,o,{success:function(t){var n,o=t.data;o&&(n=r.query(".share-module-content",e.getElement()),r.setHTML(n,o.html),i())},error:function(){var e=$t("Failed to refresh share sidebar.","failed_to_refresh_share_sidebar");c.error(e)}})}function o(){var n=s.getGcmCompatibleRm(u),o={itemTypedId:_};t(),l.post(n,o,{success:function(t){var n,o,a=t.data,s=e.getElement();if(a){n=r.query(".share-module-content",s),r.setHTML(n,a.html),i(),o=$t("Folder successfully shared.","successfully_shared_folder"),c.confirm(o);var l=$(s).find(".shared-link-text-box");l.length&&(l.focus(),l.select())}},error:function(e){c.error(e.data)}})}function a(){e.getService("popups").open(h,{data:{itemTypedId:_}})}var r,s,l,c,_,d,u="box_share_and_get_sidebar_html",p="box_get_share_sidebar_html",h="show_share_properties_for_item";return{behaviors:["share-access-menu"],messages:["sharedlinkcreated","sharedlinkchanged","sharedlinkremoved"],init:function(){r=e.getService("dom"),s=e.getService("url"),l=e.getService("ajax"),c=e.getService("notifications"),_=e.getElement().getAttribute("data-item-typed-id"),e.getConfig()&&(d=e.getConfig().context)},destroy:function(){r=null,s=null,l=null,c=null,_=""},onclick:function(e,t,i){if(t&&!r.hasClass(t,"disabled")){switch(i){case"share-item-btn":this.shareItem();break;case"share-settings-btn":this.showSettingsPopup();break;case"select-text-when-clicked":this.selectText(t);break;default:return}e.preventDefault(),e.stopPropagation()}},shareItem:o,showSettingsPopup:a,selectText:function(e){e.focus(),e.select()},onmessage:function(e,t){var i=t.context;if(t&&t.itemTypedId===_)switch(e){case"sharedlinkchanged":n(),i===d&&c.confirm($t("Link to folder has been modified.","shared_link_for_folder_modified"));break;case"sharedlinkremoved":n(),i===d&&c.confirm($t("Link to folder has been removed.","shared_link_for_folder_removed"));break;case"sharedlinkcreated":n()}}}}),Box.Timing.execution.push({name:"done",time:(new Date).getTime()});
//# sourceMappingURL=/js/section_application_p1.js.map
XHR finished loading: GET "https://app.box.com/index.php?rm=box_realtime_get_realtime_info".
Error saving setting with name: consoleHistory, value length: 6216404. Error: Failed to set the 'consoleHistory' property on 'Storage': Setting the value of 'consoleHistory' exceeded the quota.
Ten largest settings: 
Setting: 'consoleHistory', size: 5213214
Setting: 'previouslyViewedFiles', size: 4188
Setting: 'savedURLs', size: 1414
Setting: 'breakpoints', size: 227
Setting: 'domBreakpoints', size: 2
Setting: 'eventListenerBreakpoints', size: 2
Setting: 'experiments', size: 2
Setting: 'fileSystemMapping', size: 2
Setting: 'workspaceExcludedFolders', size: 2
553
XHR finished loading: POST "https://app.box.com/index.php?rm=box_in_app_message_get".

-
https://cdn01.boxcdn.net/_assets/js/section_application_p1.min-ZrBcRn.js
